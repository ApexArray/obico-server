(function(e){function t(t){for(var i,o,s=t[0],c=t[1],l=t[2],u=0,p=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&p.push(r[o][0]),r[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);d&&d(t);while(p.length)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(i=!1)}i&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},r={printers:0},a=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/static/frontend/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var d=c;a.push([4,"chunk-vendors"]),n()})({"0036":function(e,t,n){},"020c":function(e,t,n){"use strict";var i=n("c2fe"),r=n.n(i);r.a},"0548":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("a026"),r=n("f357"),a=n("5f5b"),o=n("785f"),s=n("648b"),c=n("8ffe"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("pull-to-reveal",{attrs:{shiftContent:!0,showEdge:!0,enable:e.printers.length>0},on:{hide:e.closeMenus}},[n("navbar",{ref:"navbar",attrs:{"view-name":"printers"}}),e.printers.length>1?n("div",{staticClass:"container"},[n("div",{staticClass:"option-drawer"},[n("div",{staticClass:"panel-group",attrs:{id:"accordion",role:"tablist","aria-multiselectable":"true"}},[n("div",{staticClass:"panel panel-default"},[n("div",{staticClass:"panel-collapse in",attrs:{id:"collapse-one",role:"tabpanel","aria-labelledby":"headingOne"}},[n("div",{staticClass:"panel-body p-3"},[n("div",[n("div",{ref:"filters",staticClass:"sorting-and-filter"},[n("Select",{staticClass:"my-1 mx-2",attrs:{id:"printer-sorting",options:e.sortFilters},on:{input:function(t){return e.onSortFilterChanged()}},model:{value:e.filters.sort,callback:function(t){e.$set(e.filters,"sort",t)},expression:"filters.sort"}}),n("Select",{staticClass:"my-1 mx-2",attrs:{id:"printer-filtering",options:e.stateFilters},on:{input:function(t){return e.onStateFilterChanged()}},model:{value:e.filters.state,callback:function(t){e.$set(e.filters,"state",t)},expression:"filters.state"}})],1)]),n("hr"),n("div",e._l(e.visiblePrinters,(function(t){return n("a",{key:t.id,staticClass:"btn btn-outline-primary btn-sm my-1 mx-3 printer-link",attrs:{href:"#"+t.id,role:"button"}},[n("i",{staticClass:"fas fa-map-pin"}),e._v(" "+e._s(t.name)+" ")])})),0)])])])])])]):e._e()],1),!e.user.is_pro&&e.printers.length>0?n("div",{staticClass:"row justify-content-center"},[e._m(0)]):e._e(),n("div",{staticClass:"row justify-content-center pt-2",attrs:{id:"printers"}},[e.loading?n("b-spinner",{staticClass:"mt-5",attrs:{label:"Loading..."}}):e._e(),e._l(e.visiblePrinters,(function(t){return n("printer-card",{key:t.id,attrs:{printer:t,"is-pro-account":e.user.is_pro},on:{PrinterUpdated:e.onPrinterUpdated}})}))],2),e._m(1),n("div",{staticClass:"p-5"},[n("b-collapse",{staticClass:"warning-collapse",attrs:{visible:e.shouldShowFilterWarning}},[n("div",{staticClass:"warning"},[n("span",[e._v(e._s(e.hiddenPrinterCount))]),e._v(" printers are hidden by the filtering settings. "),n("a",{attrs:{role:"button",href:"#"},on:{click:function(t){return e.onShowAllPrintersClicked()}}},[e._v("Show All Printers")])]),n("a",{staticClass:"p-3",attrs:{role:"button"},on:{click:function(t){e.dontShowFilterWarning=!0}}},[n("i",{staticClass:"fas fa-times"})])]),n("b-collapse",{staticClass:"warning-collapse",model:{value:e.shouldShowArchiveWarning,callback:function(t){e.shouldShowArchiveWarning=t},expression:"shouldShowArchiveWarning"}},[n("div",{staticClass:"warning"},[e._v(" Some of your printers have been archived. "),n("a",{attrs:{href:"/ent/printers/archived/"}},[e._v("Find them here >>>")])]),n("a",{staticClass:"py-3",attrs:{role:"button"},on:{click:function(t){e.shouldShowArchiveWarning=!1}}},[n("i",{staticClass:"fas fa-times"})])])],1)],1)},d=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"col-sm-12 col-lg-6"},[n("div",{staticClass:"form-container",staticStyle:{margin:"1em 0 -1em 0",padding:"0.5em 1em"}},[n("p",{staticStyle:{margin:"0"}},[e._v("Please consider "),n("a",{attrs:{href:"/ent/pricing?utm_source=tsd&utm_medium=printers-page"}},[e._v("upgrading")]),e._v(" to support our development efforts! "),n("a",{attrs:{href:"https://www.thespaghettidetective.com/docs/upgrade-to-pro#why-cant-the-detective-just-work-for-free-people-love-free-you-know",target:"_new"}},[e._v("Why?")])])])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"row justify-content-center"},[n("div",{staticClass:"col-sm-12 col-lg-6",attrs:{id:"new-printer"}},[n("div",{staticClass:"new-printer-container"},[n("a",{attrs:{href:"/printers/wizard/"}},[n("i",{staticClass:"fa fa-plus fa-2x"}),n("div",[e._v("Link OctoPrint Printer")])])])])])}],u=(n("4de4"),n("7db0"),n("c740"),n("4160"),n("b0c0"),n("4fad"),n("159b"),n("fc11")),p=n("bc3a"),f=n.n(p),v=n("c707"),m=n.n(v),h=n("5128"),g=n.n(h),b=n("3c33"),w=n("502a"),y=n("1807"),_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"col-sm-12 col-lg-6 printer-card",attrs:{id:e.printer.id}},[n("div",{staticClass:"card"},[n("div",{staticClass:"card-header"},[n("div",{staticClass:"title-box"},[e.hasCurrentPrintFilename?n("div",{staticClass:"primary-title print-filename"},[e._v(e._s(e.printer.current_print.filename))]):e._e(),n("div",{staticClass:"printer-name",class:{"secondary-title":e.hasCurrentPrintFilename}},[e._v(e._s(e.printer.name)+" ("),n("a",{class:e.statusClass,attrs:{href:"#printer-actions-"+e.printer.id}},[e._v(e._s(e.statusText))]),e._v(") ")])]),n("div",{staticClass:"dropdown"},[n("button",{staticClass:"btn icon-btn",attrs:{type:"button",id:"dropdownMenuButton","data-toggle":"dropdown","aria-haspopup":"true","aria-label":e.printer.name+" Controls"}},[n("i",{staticClass:"fas fa-ellipsis-v"})]),n("div",{staticClass:"dropdown-menu dropdown-menu-right",attrs:{"aria-labelledby":"dropdownMenuButton"}},[n("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.onSharePrinter()}}},[n("i",{staticClass:"fas fa-share-alt fa-lg"}),e._v("Share ")]),n("a",{staticClass:"dropdown-item",attrs:{href:e.octoPrintTunnelUrl()}},[n("svg",{staticClass:"menu-icon",attrs:{fill:"currentColor",viewBox:"0 0 346.26 368.59"}},[n("use",{attrs:{href:"#svg-octoprint-tunneling"}})]),e._v(" Tunneling ")]),n("div",{staticClass:"dropdown-divider"}),n("a",{staticClass:"dropdown-item",attrs:{href:e.settingsUrl()}},[n("i",{staticClass:"fas fa-wrench fa-lg"}),e._v("Configure ")])])])]),n("streaming-box",{attrs:{printer:e.printer,webrtc:e.webrtc}}),e.printer.alertUnacknowledged()?n("div",{staticClass:"failure-alert card-body bg-warning px-2 py-1"},[n("i",{staticClass:"fas fa-exclamation-triangle align-middle"}),n("span",{staticClass:"align-middle"},[e._v("Failure Detected!")]),n("button",{staticClass:"btn btn-outline-primary btn-sm float-right",attrs:{type:"button",id:"not-a-failure"},on:{click:function(t){return e.onNotAFailureClicked(t,!1)}}},[e._v("Not a failure?")])]):e._e(),n("div",{staticClass:"card-body gauge-container",class:{overlay:!e.isWatching}},[e.isWatching?e._e():n("div",{staticClass:"overlay-top text-center",staticStyle:{left:"0",width:"100%",top:"50%","margin-top":"-55px"}},[n("H1",[n("i",{staticClass:"far fa-eye-slash"})]),n("h5",{staticClass:"text-warning"},[e._v("The Detective Is Not Watching")]),e.printer.not_watching_reason?n("small",[e._v(e._s(e.printer.not_watching_reason)+". "),e._m(0)]):e._e(),n("div")],1),n("Gauge",{attrs:{normalizedP:e.printer.normalized_p,isWatching:e.isWatching}}),n("hr")],1),n("PrinterActions",e._b({staticClass:"container",attrs:{id:"printer-actions-"+e.printer.id},on:{PrinterActionPauseClicked:e.onPrinterActionPauseClicked,PrinterActionResumeClicked:function(t){return e.onPrinterActionResumeClicked(t)},PrinterActionCancelClicked:e.onPrinterActionCancelClicked,PrinterActionConnectClicked:e.onPrinterActionConnectClicked,PrinterActionStartClicked:e.onPrinterActionStartClicked,PrinterActionControlClicked:e.onPrinterActionControlClicked}},"PrinterActions",e.actionsProps,!1)),n("div",{staticClass:"info-section settings"},[n("button",{staticClass:"info-section-toggle btn btn-sm no-corner mx-2",class:{pressed:e.section_toggles.settings},attrs:{type:"button"},on:{click:function(t){return e.onSettingsToggleClicked()}}},[n("i",{staticClass:"fas fa-cog fa-lg"})]),n("button",{staticClass:"info-section-toggle btn btn-sm no-corner mx-2",class:{pressed:e.section_toggles.time},attrs:{type:"button"},on:{click:function(t){return e.onTimeToggleClicked()}}},[n("i",{staticClass:"fas fa-clock fa-lg"})]),n("button",{staticClass:"info-section-toggle btn btn-sm no-corner mx-2",class:{pressed:e.section_toggles.statusTemp},attrs:{type:"button"},on:{click:function(t){return e.onStatusTempToggleClicked()}}},[n("i",{staticClass:"fas fa-thermometer-half fa-lg"})])]),n("div",{staticClass:"info-section",staticStyle:{height:"0.3rem"}}),n("div",[n("div",{staticClass:"info-section container"},[e.section_toggles.settings?n("div",{attrs:{id:"panel-settings"}},[n("div",{staticClass:"pt-2 pb-3"},[n("div",{staticClass:"row justify-content-center px-3"},[n("div",{staticClass:"col-12 setting-item"},[n("label",{staticClass:"toggle-label",attrs:{for:"watching_enabled-toggle-"+e.printer.id}},[e._v("Watch for failures "),e.watchForFailures?e._e():n("div",{staticClass:"text-muted font-weight-light font-size-sm"},[e._v("Subsequent prints NOT watched until turned on. ")])]),n("div",{staticClass:"custom-control custom-switch"},[n("input",{staticClass:"custom-control-input update-printer",attrs:{type:"checkbox",name:"watching_enabled",id:"watching_enabled-toggle-"+e.printer.id},domProps:{checked:e.watchForFailures},on:{click:e.onWatchForFailuresToggled}}),n("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"watching_enabled-toggle-"+e.printer.id}})])])]),n("div",{staticClass:"row justify-content-center px-3"},[n("div",{staticClass:"col-12 setting-item"},[n("label",{staticClass:"toggle-label",attrs:{for:"pause-toggle-"+e.printer.id}},[e._v("Pause on detected failures "),e.pauseOnFailure?e._e():n("div",{staticClass:"text-muted font-weight-light font-size-sm"},[e._v("You will still be alerted via notifications ")])]),n("div",{staticClass:"custom-control custom-switch"},[n("input",{staticClass:"custom-control-input update-printer",attrs:{type:"checkbox",name:"pause_on_failure",id:"pause-toggle-"+e.printer.id},domProps:{checked:e.pauseOnFailure},on:{click:e.onPauseOnFailureToggled}}),n("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"pause-toggle-"+e.printer.id}})])])])])]):e._e(),e.section_toggles.time?n("div",{attrs:{id:"print-time"}},[n("div",{staticClass:"py-2"},[e._m(1),n("div",{staticClass:"row"},[e._m(2),n("duration-block",e._b({staticClass:"col-5 numbers",attrs:{id:"print-time-remaining"}},"duration-block",e.timeRemaining,!1)),n("duration-block",e._b({staticClass:"col-5 numbers",attrs:{id:"print-time-total"}},"duration-block",e.timeTotal,!1)),n("div",{staticClass:"col-12"},[n("div",{staticClass:"progress",staticStyle:{height:"2px"}},[n("div",{staticClass:"progress-bar",class:{"progress-bar-striped":e.progressPct<100,"progress-bar-animated":e.progressPct<100},style:"width: "+e.progressPct+"%;",attrs:{id:"print-progress",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100"}})])])],1)])]):e._e(),e.section_toggles.statusTemp&&e.tempProps.show?n("StatusTemp",e._b({attrs:{id:"status_temp_block"},on:{TempEditClicked:e.onTempEditClicked}},"StatusTemp",e.tempProps,!1)):e._e()],1)])],1)])},C=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{attrs:{href:"https://www.thespaghettidetective.com/docs/detective-not-watching/",target:"_blank"}},[e._v("Learn more. "),n("small",[n("i",{staticClass:"fas fa-external-link-alt"})])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"row text-muted"},[n("small",{staticClass:"col-5 offset-2"},[e._v(" Remaining ")]),n("small",{staticClass:"col-5"},[e._v(" Total ")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"col-2 text-muted"},[n("i",{staticClass:"fas fa-clock"})])}],S=(n("99af"),n("d81d"),n("b6802"),n("d0ff")),k=n("9b02"),x=n.n(k),T=n("e9a7"),P=n.n(T),D=n("c1df"),A=n.n(D),O=n("9380"),E=n.n(O),j=(n("c19f"),n("4ec9"),n("d3b7"),n("ac1f"),n("25f0"),n("3ca3"),n("5319"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("ddb0"),n("dce5")),I=n.n(j),R=n("aaa7"),L=n.n(R),M=n("acff");function B(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a={};return a.printerId=e,a.wsUri=t,a.onPrinterUpdateReceived=n,a.onStatusReceived=r,a.ws=null,a.webrtc=null,a.passthruQueue=new Map,L.a.on("blur",(function(){a.closeWebSocket()})),L.a.on("focus",(function(){a.connect()})),a.onPassThruReceived=function(e){var t=e.ref;if(t&&a.passthruQueue.get(t)){var n=a.passthruQueue.get(t);a.passthruQueue.delete(t),n(null,e.ret)}},a.connect=function(){a.ws=new WebSocket(window.location.protocol.replace("http","ws")+"//"+window.location.host+a.wsUri),a.ws.onmessage=function(e){var t={};try{t=JSON.parse(e.data)}catch(i){throw console.log(e.data),i}"passthru"in t?a.onPassThruReceived(t.passthru):n(t)},a.ensureWebsocketClosed(),setTimeout((function(){a.heartbeat()}),3e4)},a.setWebRTC=function(e){function t(e){var t={};try{t=JSON.parse(e)}catch(n){return}t&&"ref"in t&&"ret"in t?a.onPassThruReceived(t):a.onStatusReceived&&a.onStatusReceived(t)}a.webrtc=e,a.webrtc.callbacks.onData=function(e){if(e)if(e instanceof ArrayBuffer)try{var n=M["a"].ungzip(new Uint8Array(e),{to:"string"});t(n)}catch(r){console.error("could not decompress datachannel arraybuffer")}else if(e instanceof Blob){var i=new FileReader;i.addEventListener("loadend",(function(e){var n=e.srcElement.result;try{var i=M["a"].ungzip(new Uint8Array(n),{to:"string"});t(i)}catch(r){console.error("could not decompress datachannel blob")}})),i.readAsArrayBuffer(e)}else t(e)}},a.passThruToPrinter=function(e,t){if(a.canSend()){var n=Math.random().toString();I()(e,{ref:n}),t&&(a.passthruQueue.set(n,t),setTimeout((function(){a.passthruQueue.has(n)&&i["default"].swal.Toast.fire({type:"error",title:"Failed to contact OctoPrint, or the TSD plugin version is older than 1.2.0."})}),1e4)),a.webrtc&&a.webrtc.sendData(JSON.stringify(e)),a.ws.send(JSON.stringify({passthru:e}))}else t&&t("Message not passed through. No suitable WebSocket.")},a.ensureWebsocketClosed=function(){a.ws.onclose=function(e){a.ws===e.target&&(a.ws=null)},a.ws.onerror=function(){a.ws&&a.ws.close()}},a.closeWebSocket=function(){a.ws&&a.ws.close()},a.heartbeat=function(){a.canSend()&&(a.ws.send(JSON.stringify({})),setTimeout((function(){a.heartbeat()}),3e4))},a.canSend=function(){return a.ws&&1===a.ws.readyState},a}var N=n("c297"),F=function(e){return"/ws/janus/".concat(e,"/")},V=function(e){return"/ws/share_token/janus/".concat(e,"/")};function $(e){var t={callbacks:{},initialized:!1,streamId:void 0,streaming:void 0,videoEnabled:null!==e&&void 0!==e&&e,openForShareToken:function(e){t.connect(V(e),e)},openForPrinter:function(e,n){t.connect(F(e),n)},connect:function(e,n){N["a"].init({debug:"all",callback:function(){t.initialized=!0,N["a"].isWebrtcSupported()&&t.connectJanusWebSocket(e,n)}}),L.a.on("blur",(function(){t.stopStream()})),L.a.on("focus",(function(){t.startStream()}))},connectJanusWebSocket:function(e,n){var i="streamingtest-"+N["a"].randomString(12),r=[{urls:["stun:stun.l.google.com:19302"]}];if(n){var a=window.location.hostname.replace("app","turn");r.push({urls:"turn:"+a+":80?transport=udp",credential:n,username:n}),r.push({urls:"turn:"+a+":80?transport=tcp",credential:n,username:n})}var o=new N["a"]({server:window.location.protocol.replace("http","ws")+"//"+window.location.host+e,iceServers:r,success:function(){o.attach({plugin:"janus.plugin.streaming",opaqueId:i,success:function(e){N["a"].log("Plugin attached! ("+e.getPlugin()+", id="+e.getId()+")");var n={request:"list"};N["a"].debug("Sending message ("+JSON.stringify(n)+")"),e.send({message:n,success:function(n){var i=x()(n,"list[0]");i&&(t.streamId=i.id,t.streaming=e,t.startStream())}}),setInterval((function(){console.log(e.getBitrate())}),5e3)},error:function(e){N["a"].error("  -- Error attaching plugin... ",e),o.destroy()},onmessage:function(e,n){t.onMessage(e,n)},onremotestream:function(e){N["a"].debug(" ::: Got a remote stream :::"),N["a"].debug(e),"onRemoteStream"in t.callbacks&&t.callbacks.onRemoteStream(e)},ontrackmuted:function(){"onTrackMuted"in t.callbacks&&t.callbacks.onTrackMuted()},ontrackunmuted:function(){"onTrackUnmuted"in t.callbacks&&t.callbacks.onTrackUnmuted()},slowLink:function(e,n){"onSlowLink"in t.callbacks&&t.callbacks.onSlowLink(n)},ondataopen:function(){},ondata:function(e){"onData"in t.callbacks&&t.callbacks.onData(e)},oncleanup:function(){"onCleanup"in t.callbacks&&t.callbacks.onCleanup()}})},error:function(e){N["a"].error("  -- Error -- ",e),o.destroy()},destroyed:function(){t.streaming=void 0,t.streamId=void 0}})},onMessage:function(e,t){var n=this;N["a"].debug(" ::: Got a message :::"),N["a"].debug(e);var i=e["result"];if(null!==i&&void 0!==i){if(void 0!==i["status"]&&null!==i["status"]){var r=i["status"];"starting"===r?console.log("Starting"):"started"===r?console.log("Started"):"stopped"===r&&n.stopStream()}}else if(void 0!==e["error"]&&null!==e["error"])return N["a"].error(e),void n.stopStream();void 0!==t&&null!==t&&(N["a"].debug("Handling SDP as well..."),N["a"].debug(t),n.streaming.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){N["a"].debug("Got SDP!"),N["a"].debug(e);var t={request:"start"};n.streaming.send({message:t,jsep:e})},error:function(e){N["a"].error("WebRTC error:",e)}}))},channelOpen:function(){return!(void 0===t.streamId||void 0===t.streaming)},startStream:function(){if(t.channelOpen()){var e={request:"watch",offer_video:t.videoEnabled,id:parseInt(t.streamId)};t.streaming.send({message:e})}},stopStream:function(){if(t.channelOpen()){var e={request:"stop"};t.streaming.send({message:e}),t.streaming.hangup()}},sendData:function(e){t.channelOpen()&&t.streaming.data({text:e,success:function(){}})}};return t}var W,z=n("6868"),U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card-img-top webcam_container"},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.slowLinkLoss>50,expression:"slowLinkLoss > 50"}],ref:"slowLinkWrapper",staticClass:"slow-link-wrapper",on:{click:e.slowLinkClicked,mouseenter:function(t){e.fixSlowLinkTextWidth(),e.slowLinkShowing=!0,e.slowLinkHiding=!1},mouseleave:function(t){e.fixSlowLinkTextWidth(),e.slowLinkShowing=!1,e.slowLinkHiding=!0}}},[e._m(0),n("div",{ref:"slowLinkText",staticClass:"text",class:{"show-and-hide":!e.slowLinkShowing&&!e.slowLinkHiding,showing:e.slowLinkShowing&&!e.slowLinkHiding,hiding:!e.slowLinkShowing&&e.slowLinkHiding}},[e._v("Video frames dropped")])]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.trackMuted,expression:"trackMuted"}],staticClass:"muted-status-wrapper"},[n("div",{staticClass:"text"},[e._v("Buffering...")]),n("a",{attrs:{href:"#"},on:{click:function(t){return e.showMutedStatusDescription(t)}}},[e._v("Why is it stuck?")])]),e.trackMuted||e.videoLoading?n("b-spinner",{staticClass:"loading-icon",attrs:{label:"Buffering..."}}):e._e(),e.isVideoVisible&&e.taggedImgAvailable?n("div",{staticClass:"streaming-switch"},[n("div",{staticClass:"dropdown"},[n("button",{staticClass:"btn icon-btn",attrs:{type:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-label":e.printer.name+" Controls"}},[n("i",{staticClass:"fas fa-ellipsis-v"})]),n("div",{staticClass:"dropdown-menu dropdown-menu-right"},[n("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.forceStreamingSrc(null)}}},[n("span",{staticClass:"title",class:{active:null===e.stickyStreamingSrc}},[n("i",{directives:[{name:"show",rawName:"v-show",value:null===e.stickyStreamingSrc,expression:"stickyStreamingSrc === null"}],staticClass:"fas fa-check"}),e._v(" Auto ")]),n("br"),n("span",{staticClass:"description"},[e._v("Show the best quality stream that is available")])]),n("div",{staticClass:"dropdown-divider"}),n("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.forceStreamingSrc("VIDEO")}}},[n("span",{staticClass:"title",class:{active:"VIDEO"===e.stickyStreamingSrc}},[n("i",{directives:[{name:"show",rawName:"v-show",value:"VIDEO"===e.stickyStreamingSrc,expression:"stickyStreamingSrc === 'VIDEO'"}],staticClass:"fas fa-check"}),e._v(" Premium webcam streaming view ")]),n("br"),n("span",{staticClass:"description"},[e._v("Premium-only feature (25 fps)")])]),n("div",{staticClass:"dropdown-divider"}),n("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.forceStreamingSrc("IMAGE")}}},[n("span",{staticClass:"title",class:{active:"IMAGE"===e.stickyStreamingSrc}},[n("i",{directives:[{name:"show",rawName:"v-show",value:"IMAGE"===e.stickyStreamingSrc,expression:"stickyStreamingSrc === 'IMAGE'"}],staticClass:"fas fa-check"}),e._v(" Detective webcam view ")]),n("br"),n("span",{staticClass:"description"},[e._v("Shows detection boxes if present (0.1 fps)")])])])])]):e._e(),n("div",{class:e.webcamRotateClass},[n("div",{staticClass:"webcam_fixed_ratio",class:e.webcamRatioClass},[n("div",{staticClass:"webcam_fixed_ratio_inner full"},[e.taggedSrc!==e.printerStockImgSrc?n("img",{staticClass:"tagged-jpg",class:{flipH:e.printer.settings.webcam_flipH,flipV:e.printer.settings.webcam_flipV},attrs:{src:e.taggedSrc,alt:e.printer.name+" current image"}}):n("svg",{attrs:{viewBox:"0 0 1200 1200",width:"100%",height:"100%"}},[n("use",{attrs:{href:"#"+e.printerStockImgSrc}})])]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showVideo,expression:"showVideo"}],staticClass:"webcam_fixed_ratio_inner ontop full"},[n("video",{ref:"video",staticClass:"remote-video",class:{hide:!e.isVideoVisible,flipH:e.printer.settings.webcam_flipH,flipV:e.printer.settings.webcam_flipV},attrs:{width:"960",height:e.webcamVideoHeight,poster:e.taggedSrc,autoplay:"",muted:"",playsinline:""},domProps:{muted:!0},on:{loadstart:function(t){return e.onLoadStart()},canplay:function(t){return e.onCanPlay()}}})])])])],1)},q=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"icon bg-warning"},[n("i",{staticClass:"fas fa-exclamation"})])}],G=n("f3f3"),J={name:"StreamingBox",created:function(){var e=this;this.webrtc&&(this.webrtc.callbacks=Object(G["a"])(Object(G["a"])({},this.webrtc.callbacks),{},{onRemoteStream:this.onWebRTCRemoteStream,onCleanup:this.onWebRTCCleanup,onSlowLink:this.onSlowLink,onTrackMuted:function(){return e.trackMuted=!0},onTrackUnmuted:function(){return e.trackMuted=!1}}))},props:{printer:{type:Object,required:!0},webrtc:{type:Object,required:!1}},data:function(){return{stickyStreamingSrc:null,isVideoVisible:!1,slowLinkLoss:0,slowLinkShowing:!1,slowLinkHiding:!1,trackMuted:!1,videoLoading:!1,printerStockImgSrc:"svg-video-placeholder"}},computed:{taggedImgAvailable:function(){return this.taggedSrc!==this.printerStockImgSrc},showVideo:function(){return this.isVideoVisible&&"IMAGE"!==this.stickyStreamingSrc},webcamRotateClass:function(){switch(this.printer.settings.webcam_rotate90){case!0:return"webcam_rotated";case!1:return"webcam_unrotated";default:return"webcam_unrotated"}},webcamRatioClass:function(){switch(this.printer.settings.ratio169){case!0:return"ratio169";case!1:return"ratio43";default:return"ratio43"}},webcamVideoHeight:function(){switch(this.printer.settings.ratio169){case!0:return 540;case!1:return 720;default:return 720}},taggedSrc:function(){return x()(this.printer,"pic.img_url",this.printerStockImgSrc)}},methods:{forceStreamingSrc:function(e){this.stickyStreamingSrc=e},onCanPlay:function(){this.videoLoading=!1},onLoadStart:function(){this.videoLoading=!0},onWebRTCRemoteStream:function(e){N["a"].attachMediaStream(this.$refs.video,e);var t=e.getVideoTracks();null===t||void 0===t||0===t.length?this.isVideoVisible=!1:this.isVideoVisible=!0},onWebRTCCleanup:function(){this.isVideoVisible=!1},fixSlowLinkTextWidth:function(){var e=window.getComputedStyle(this.$refs.slowLinkText).width;this.$refs.slowLinkText.style.width=e},onSlowLink:function(e){this.slowLinkLoss+=e},slowLinkClicked:function(){this.slowLinkShowing=!1,this.slowLinkHiding=!1,this.slowLinkLoss=0,this.$swal.Prompt.fire({title:"Video frames dropped",html:"\n          <p>The video frames are getting dropped because there is a bandwidth bottleneck along the route it they take to travel from your Raspberry Pi to your computer. The bottleneck can be anywhere but in most cases <Text bold>it's either your computer's internet connection, or your Raspberry Pi's</Text>.</p>\n          <p>Make sure your computer is connected to the same network as your Pi. If you still see this warning, you need to trouble-shoot your computer's Wi-Fi connection, probably by moving closer to the Wi-Fi router.</p>\n          <p>If the webcam stream is smooth when your computer is on the same Wi-Fi network as your Pi, the bottleneck is likely with the upload speed of your internet connection. You need to run a speed test to make sure you have high-enough upload speed, as well as <b>low latency (ping)</b>.</p>\n          <p>Check out <a target=\"_blank\" href=\"https://www.thespaghettidetective.com/docs/webcam-feed-is-laggy/\">the step-by-step trouble-shooting guide.</a></p>\n        ",showCloseButton:!0})},showMutedStatusDescription:function(e){e.preventDefault(),this.$swal.Prompt.fire({title:"Webcam stream buffering",html:'\n          <p>When you see the messaging about webcam stream is "buffering" occasionally, you can just reload the page. If this message repeatedly appears, it may indicate one of the problems:</p>\n          <p class="lead">1. A constricted video stream on <strong>your Raspberry Pi. The most common reasons are:</p>\n          <ul>\n            <li>Camera resolution is set too high.</li>\n            <li>Camera framerate is set too high. This is only when you set <a target="_blank" href="https://www.thespaghettidetective.com/docs/streaming-compatibility-mode/">the compatibility mode</a> to "always".</li>\n            <li>The upload speed of your Raspberry Pi is too low.</li>\n          </ul>\n          <p class="lead">2. The internet connection of your computer or phone is not fast enough.</p>\n          <p class="lead">3. Your webcam is not properly connected to your Raspberry Pi.</p>\n          <br>\n          <p>You should leave the compatibility mode to "auto", unless you have <a target="_blank" href="https://www.thespaghettidetective.com/docs/streaming-compatibility-mode#when-should-i-always-stream-in-the-compatibility-mode">a good reason to it to "always".</a></p>\n          <p>As a rule of thumb, for every 300k-pixel resolution (640x480), you need to have 1.5Mbps upload bandwidth to stream smoothly at 25fps. This means if you set the webcam resolution to 1024x768 (~800k pixels), you need to have 4.5Mbps upload bandwidth. Also remember that the upload bandwidth of your Raspberry Pi may not be the same as your computer, even if they are connected to the same Wi-Fi network. This is because Raspberry Pi\'s Wi-Fi chip is weaker than the most computers\'.</p>\n        ',showCloseButton:!0})}}},H=J,Y=(n("1bd8"),n("2877")),Q=Object(Y["a"])(H,U,q,!1,null,"e3ad782c",null),Z=Q.exports,X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.valid||e.printing?e._e():n("span",[e._v("-")]),!e.valid&&e.printing?n("b-spinner",{attrs:{small:"",type:"grow",label:"Calculating..."}}):e._e(),e.valid&&e.showHours?n("span",[e._v(" "+e._s(e.hours)),n("span",{staticClass:"text-subscript text-muted"},[e._v("h")])]):e._e(),e.valid&&e.showMinutes?n("span",[e._v(" "+e._s(e.minutes)),n("span",{staticClass:"text-subscript text-muted"},[e._v("m")])]):e._e(),e.valid&&e.showSeconds?n("span",[e._v(" "+e._s(e.seconds)),n("span",{staticClass:"text-subscript text-muted"},[e._v("s")])]):e._e()],1)},K=[],ee=(n("a9e3"),{name:"DurationBlock",props:{valid:{type:Boolean,required:!0},printing:{type:Boolean,required:!0},hours:{type:Number,default:function(){return 0}},showHours:{type:Boolean,default:function(){return!1}},minutes:{type:Number,default:function(){return 0}},showMinutes:{type:Boolean,default:function(){return!1}},seconds:{type:Number,default:function(){return 0}},showSeconds:{type:Boolean,default:function(){return!1}}}}),te=ee,ne=Object(Y["a"])(te,X,K,!1,null,null,null),ie=ne.exports,re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[!e.printer.isOffline()&&e.printer.hasError()?n("div",{staticClass:"row my-2"},[n("div",{staticClass:"col-12 bg-danger text-center"},[n("div",[e._v("OctoPrint Error")]),n("div",[e._v(e._s(e.printer.status.state.text))])])]):e._e(),e.printer.inTransientState()?n("div",{staticClass:"row my-2"},[n("div",{staticClass:"col-12 text-center my-3"},[n("b-spinner",{attrs:{label:"Processing..."}}),n("div",[e._v(e._s(e.printer.status.state.text)+" ...")])],1)]):n("div",{staticClass:"row my-2"},[e.printer.isOffline()||e.printer.isDisconnected()||e.printer.isIdle()?e._e():n("div",{staticClass:"col-sm-6"},[e.printer.isPaused()?n("button",{staticClass:"btn btn-block mt-2 btn-outline-success",attrs:{type:"button"},on:{click:function(t){return e.onPauseToggled(t)}}},[n("i",{staticClass:"fas fa-play"}),e._v(" Resume ")]):n("button",{staticClass:"btn btn-block mt-2 btn-outline-warning",attrs:{type:"button"},on:{click:function(t){return e.onPauseToggled(t)}}},[n("i",{staticClass:"fas fa-pause"}),e._v(" Pause ")])]),e.printer.isOffline()||e.printer.isDisconnected()||e.printer.isIdle()?e._e():n("div",{staticClass:"col-sm-6"},[n("button",{staticClass:"btn btn-outline-danger btn-block mt-2 mb-2",attrs:{id:"print-cancel",type:"button"},on:{click:function(t){return e.$emit("PrinterActionCancelClicked",t)}}},[n("i",{staticClass:"fas fa-stop"}),e._v(" Cancel ")])]),e.printer.isOffline()||e.printer.isDisconnected()||!e.printer.isIdle()?e._e():n("div",{staticClass:"col-sm-6"},[n("button",{staticClass:"btn btn-outline-primary btn-block mt-2",attrs:{id:"start-print",type:"button"},on:{click:function(t){return e.$emit("PrinterActionStartClicked",t)}}},[n("i",{staticClass:"fas fa-star"}),e._v(" Start Printing ")])]),e.printer.isOffline()||e.printer.isDisconnected()||!e.printer.isIdle()?e._e():n("div",{staticClass:"col-sm-6"},[n("button",{staticClass:"btn btn-outline-secondary btn-block mt-2 mb-2",attrs:{type:"button"},on:{click:function(t){return e.$emit("PrinterActionControlClicked",t)}}},[n("i",{staticClass:"fas fa-arrows-alt"}),e._v(" Control ")])])]),!e.printer.isOffline()&&e.printer.isDisconnected()?n("div",{staticClass:"row my-2"},[n("div",{staticClass:"col-12 text-center py-2 text-warning"},[n("div",[e._v("Printer is not connected to OctoPrint.")]),n("button",{staticClass:"btn btn-outline-primary btn-block mt-2",attrs:{id:"connect-printer",type:"button",disabled:e.connecting},on:{click:this.onConnectClicked}},[e.connecting?n("b-spinner",{attrs:{small:""}}):n("i",{staticClass:"fab fa-usb"}),e._v(" "+e._s(e.connecting?"Contacting OctoPrint":"Connect")+" ")],1)])]):e._e(),e.printer.isOffline()?n("div",{staticClass:"row my-2"},[e._m(0)]):e._e()])},ae=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"col-12 text-center py-3 text-warning"},[n("div",[e._v(" OctoPrint is not powered on, or is offline. "),n("a",{attrs:{target:"_blank",href:"https://www.thespaghettidetective.com/docs/octoprint-is-offline/"}},[e._v("Why? "),n("small",[n("i",{staticClass:"fas fa-external-link-alt"})])])])])}],oe={name:"PrinterActions",props:{printer:{}},data:function(){return{connectBtnClicked:!1}},computed:{connecting:function(){return this.connectBtnClicked&&this.printer.isDisconnected()}},methods:{onPauseToggled:function(e){this.printer.isPaused()?this.$emit("PrinterActionResumeClicked",e):this.$emit("PrinterActionPauseClicked",e)},onConnectClicked:function(e){var t=this;this.$emit("PrinterActionConnectClicked",e),this.connectBtnClicked=!0,setTimeout((function(){t.connectBtnClicked=!1}),1e4)}}},se=oe,ce=Object(Y["a"])(se,re,ae,!1,null,null,null),le=ce.exports,de=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"py-2"},[e._m(0),e._l(e.temperatures,(function(t){return n("div",{key:t.id,staticClass:"row"},[n("div",{staticClass:"col-2 numbers"},[n("span",{staticClass:"text-subscript text-muted"},[e._v(e._s(t.toolName))])]),n("div",{staticClass:"col-5 numbers"},[e._v(" "+e._s(t.actual)),n("span",{staticClass:"text-subscript text-muted"},[e._v("°C")])]),n("div",{staticClass:"col-5 numbers",attrs:{id:t.id},on:{click:function(n){return e.onEditClicked(t)}}},[e._v(e._s(t.target)),n("span",{staticClass:"text-subscript text-muted"},[e._v("°C")]),e.editable?n("span",[e._v(" "),n("i",{staticClass:"fas fa-pencil-alt",staticStyle:{"font-size":"0.6em"}})]):e._e()])])}))],2)},ue=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"row text-muted"},[n("div",{staticClass:"col-2"},[n("i",{staticClass:"fas fa-thermometer-half fa-lg"})]),n("small",{staticClass:"col-5"},[e._v(" Actual ")]),n("small",{staticClass:"col-5"},[e._v(" Target ")])])}],pe={name:"StatusTemp",props:{temperatures:{type:Array,required:!0},editable:{type:Boolean,required:!0}},methods:{onEditClicked:function(e){this.editable&&this.$emit("TempEditClicked",e)}}},fe=pe,ve=Object(Y["a"])(fe,de,ue,!1,null,null,null),me=ve.exports,he=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"control-panel"},[n("search-input",{staticClass:"search-input",model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}}),e._m(0)],1),n("br"),e.gcodeFiles.length?n("div",e._l(e.visibleGcodeFiles,(function(t){return n("div",{key:t.id,staticClass:"card"},[n("div",{staticClass:"card-body"},[n("div",{staticClass:"mb-2"},[n("strong",{staticClass:"gcode-filenam"},[e._v(" "+e._s(t.filename)+" ")])]),n("div",{staticClass:"info-and-actions"},[n("small",{staticClass:"gcode-info"},[n("div",{staticClass:"pr-3"},[n("span",{staticClass:"text-muted"},[e._v("Size: ")]),e._v(" "+e._s(t.filesize))]),n("div",[n("span",{staticClass:"text-muted"},[e._v("Uploaded: ")]),e._v(" "+e._s(t.created_at.fromNow()))])]),n("button",{staticClass:"send-print btn btn-primary",attrs:{type:"button",disabled:e.isSending},on:{click:function(n){return e.onSendPrintClicked(t.id)}}},[e.isSending?n("b-spinner",{attrs:{small:"",label:"Loading..."}}):e._e(),e._v("Print ")],1)])])])})),0):n("div",[e._m(1)])])},ge=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"btn btn-outline-primary",attrs:{role:"button",href:"/gcodes/",title:"Upload more G-Code"}},[n("i",{staticClass:"fas fa-upload fa-lg mx-2"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",{staticClass:"text-center font-weight-bold my-3"},[e._v("No G-Codes yet. You can upload them "),n("a",{attrs:{href:"/gcodes/"}},[e._v("here")]),e._v(".")])}],be=(n("c975"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"search-wrapper"},[e._m(0),n("input",{staticClass:"dark",attrs:{type:"text",placeholder:"Search"},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)}}})])}),we=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"search-icon"},[n("i",{staticClass:"fas fa-search"})])}],ye={name:"SearchInput",props:{value:{type:String,default:""}}},_e=ye,Ce=(n("bac1"),Object(Y["a"])(_e,be,we,!1,null,"8b64328e",null)),Se=Ce.exports,ke={name:"StartPrint",components:{SearchInput:Se},props:{gcodeFiles:{type:Array,required:!0},onGcodeFileSelected:{type:Function,required:!0}},data:function(){return{searchText:"",isSending:!1}},computed:{visibleGcodeFiles:function(){var e=this.searchText.toLowerCase();return this.gcodeFiles.filter((function(t){return t.filename.toLowerCase().indexOf(e)>-1}))}},methods:{onSendPrintClicked:function(e){this.isSending=!0,this.onGcodeFileSelected(this.gcodeFiles,e)}}},xe=ke,Te=(n("630d"),Object(Y["a"])(xe,he,ge,!1,null,"9e082c6c",null)),Pe=Te.exports,De=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._m(0),n("div",[n("b-form-select",{attrs:{id:"connect-port"},model:{value:e.selectedPort,callback:function(t){e.selectedPort=t},expression:"selectedPort"}},e._l(e.connectionOptions.ports,(function(t){return n("b-form-select-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1),n("br"),e._m(1),n("div",[n("b-form-select",{attrs:{id:"connect-baudrate"},model:{value:e.selectedBaudrate,callback:function(t){e.selectedBaudrate=t},expression:"selectedBaudrate"}},[n("b-form-select-option",{attrs:{value:""}},[e._v(" Auto ")]),e._l(e.connectionOptions.baudrates,(function(t){return n("b-form-select-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])}))],2)],1)])},Ae=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h5",[e._v("Serial Port:")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h5",[e._v("Baudrate:")])])}],Oe={name:"ConnectPrinter",props:{connectionOptions:{type:Object,required:!0}},data:function(){return{selectedPort:this.connectionOptions.ports[0],selectedBaudrate:""}}},Ee=Oe,je=Object(Y["a"])(Ee,De,Ae,!1,null,null,null),Ie=je.exports,Re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"text-center"},[e.value>0?n("h1",{staticClass:"target-temp-degree"},[e._v(e._s(e.value)+" "),n("span",{staticClass:"text-subscript text-muted"},[e._v("°C")])]):e._e(),e.value<1?n("h1",{staticClass:"target-temp-degree"},[e._v("OFF")]):e._e()]),n("br"),n("div",{staticClass:"mb-5"},[e._m(0),n("div",[n("b-form-select",{attrs:{id:"id_preset"},on:{change:e.onPresetChanged},model:{value:e.preset,callback:function(t){e.preset=t},expression:"preset"}},e._l(e.allPresets,(function(t){return n("b-form-select-option",{key:t.value,attrs:{value:parseInt(t.value)}},[e._v(" "+e._s(t.title)+" ")])})),1)],1),n("br"),n("h5",[e._v("Manual:")]),n("div",[n("vue-slider",{attrs:{min:0,max:e.maxTemp,step:1,tooltip:"none"},on:{change:e.onSliderChanged},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],attrs:{id:"target-temp",type:"hidden"},domProps:{value:e.value},on:{input:function(t){t.target.composing||(e.value=t.target.value)}}})],1)])])},Le=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h5",[e._v("Presets:")])])}],Me=n("4971"),Be=n.n(Me),Ne={name:"TempTargetEditor",components:{VueSlider:Be.a},props:{presets:{type:Array,required:!0},maxTemp:{type:Number,required:!0},curTarget:{type:Number,required:!0}},data:function(){var e=this,t=this.presets.find((function(t){return t.target==e.curTarget}))||{target:0!=this.curTarget?-1:0};return{value:this.curTarget,preset:t.target}},computed:{allPresets:function(){var e=[];return e.push({value:-1,title:"Manual"}),e.push({value:0,title:"OFF"}),this.presets.forEach((function(t){e.push({value:t.target,title:"".concat(t.name," (").concat(t.target,"°C)")})})),e}},methods:{onPresetChanged:function(){this.preset>-1&&(this.value=this.preset)},onSliderChanged:function(){0==this.value?this.preset=0:this.preset=-1}}},Fe=Ne,Ve=Object(Y["a"])(Fe,Re,Le,!1,null,null,null),$e=Ve.exports,We=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h2",{staticClass:"text-center"},[e._v("Printer Feed Sharing")]),n("hr"),e.isProAccount?n("div",[n("div",{staticClass:"py-3"},[n("div",{staticClass:"custom-control custom-switch"},[n("input",{staticClass:"custom-control-input update-printer",attrs:{type:"checkbox",id:"sharing_enabled-toggle-"+e.printer.id},domProps:{checked:e.sharedResource},on:{click:e.onSharingToggled}}),n("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"sharing_enabled-toggle-"+e.printer.id}},[e._v('Share live feed for printer "'),n("b",[e._v(e._s(e.printer.name))]),e._v('"')])]),n("div",{staticClass:"form-group"},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.sharedLink,expression:"sharedLink"}]},[n("div",{staticClass:"input-group mt-4 mb-2"},[n("input",{ref:"sharedLink",staticClass:"form-control shared-link-text",attrs:{type:"text",id:"secret-token-input","aria-label":"Secret token",readonly:""},domProps:{value:e.sharedLink}}),n("div",{staticClass:"input-group-append"},[n("div",{staticClass:"btn btn-outline-primary",staticStyle:{"border-radius":"0 !important"},attrs:{id:"copy-link",type:"button","data-clipboard-target":"#secret-token-input","aria-label":"Copy secure link to clipboard"},on:{click:e.copyToClipboard}},[n("i",{staticClass:"fas fa-clipboard"})]),n("b-tooltip",{attrs:{show:e.copyStatus,target:"copy-link",triggers:"click",placement:"bottom"},on:{"update:show":function(t){e.copyStatus=t}}},[e._v(e._s(e.copyMessage))])],1)]),n("div",{staticClass:"my-1"},[e._v("Click the clipboard icon above to copy the secure shareable link to your clipboard.")]),n("div",{staticClass:"my-1"},[e._v("You can test the shareable link by right-clicking "),n("a",{attrs:{href:e.sharedLink}},[e._v("here")]),e._v(' and select "Open Link in Incognito Window".')]),n("br"),e._m(3)])]),n("br")])]):n("div",[e._m(0),n("p",[e._v("Printer feed sharing is a Pro feature.")]),e._m(1),e._m(2)])])},ze=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("h5",{staticClass:"mb-5"},[e._v("Wait! You need to "),n("a",{attrs:{href:"/ent/pricing/"}},[e._v("upgrade to Pro plan")]),e._v(" to enable Printer feed. ")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[n("a",{attrs:{href:"https://www.thespaghettidetective.com/docs/upgrade-to-pro#why-cant-the-detective-just-work-for-free-people-love-free-you-know"}},[e._v("Running TSD incurs non-trivial amount of costs")]),e._v(". With little more than 1 Starbucks per month, you can upgrade to a Pro account and help us run TSD smoothly.")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[n("a",{attrs:{href:"/ent/pricing/"}},[e._v("Check out Pro pricing >>>")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("em",{staticClass:"text-muted"},[n("small",[n("div",[e._v("Notes:")]),n("ul",[n("li",[e._v("Send the secure link to anyone you want to share your printer feed with. They do NOT need a The Spaghetti Detective account to see your printer feed.")]),n("li",[e._v("Anyone with this shareable link will be able to see your printer feed. "),n("a",{attrs:{href:"https://www.thespaghettidetective.com/docs/printer-feed-sharing/"}},[e._v("Learn more about what they can see.")])])])])])}],Ue={props:{isProAccount:{type:Boolean,default:!1},printer:{type:Object,required:!0}},data:function(){return{share:!1,sharedResource:null,copyStatus:!1,copyMessage:""}},created:function(){this.fetchSharedResources()},computed:{sharedLink:function(){if(this.sharedResource){var e=window.location;return"".concat(e.protocol,"//").concat(e.host,"/printers/share_token/").concat(this.sharedResource.share_token,"/")}return""}},methods:{fetchSharedResources:function(){var e=this;return f.a.get(y["a"].sharedResources({printer_id:this.printer.id})).then((function(t){t.data.length>0&&(e.sharedResource=t.data[0])}))},postSharedResources:function(){var e=this;return f.a.post(y["a"].sharedResources({printer_id:this.printer.id})).then((function(t){t.data.length>0&&(e.sharedResource=t.data[0])}))},deleteSharedResources:function(){var e=this;return f.a.delete(y["a"].sharedResource(this.sharedResource.id)).then((function(){e.sharedResource=null}))},onSharingToggled:function(){this.sharedResource?this.deleteSharedResources():this.postSharedResources()},copyToClipboard:function(){this.copyStatus=!0,this.$refs.sharedLink.focus(),this.$refs.sharedLink.select();try{document.execCommand("copy"),this.copyMessage="Copied!"}catch(e){console.error("Fallback: Oops, unable to copy",e),this.copyMessage="Failed!"}}}},qe=Ue,Ge=(n("9423"),Object(Y["a"])(qe,We,ze,!1,null,"1d4ce3da",null)),Je=Ge.exports,He="/pause_print/",Ye="/resume_print/",Qe="/cancel_print/",Ze="/mute_current_print/?mute_alert=true",Xe="/acknowledge_alert/?alert_overwrite=NOT_FAILED",Ke=!0,et=!1,tt={Settings:"panel-settings",Time:"print-time",StatusTemp:"status_temp_block"},nt={name:"PrinterCard",components:{StreamingBox:Z,Gauge:z["a"],DurationBlock:ie,PrinterActions:le,StatusTemp:me},props:{printer:{type:Object,required:!0},isProAccount:{type:Boolean,required:!0}},data:function(){return{section_toggles:{settings:Object(b["a"])(tt.Settings+String(this.printer.id),Ke),time:Object(b["a"])(tt.Time+String(this.printer.id),et),statusTemp:Object(b["a"])(tt.StatusTemp+String(this.printer.id),Ke)},webrtc:$(this.isProAccount)}},created:function(){var e=this;this.printerComm=B(this.printer.id,y["a"].printerWebSocket(this.printer.id),(function(t){e.$emit("PrinterUpdated",e.updatedPrinter(t))}),(function(t){e.$emit("PrinterUpdated",e.updatedPrinter({status:t.octoprint_data}))})),this.printerComm.connect(),this.webrtc.openForPrinter(this.printer.id,this.printer.auth_token),this.printerComm.setWebRTC(this.webrtc)},computed:{isWatching:function(){return!this.printer.not_watching_reason},timeRemaining:function(){return this.toDuration(this.secondsLeft,this.printer.isPrinting())},timeTotal:function(){var e=null;return this.secondsPrinted&&this.secondsLeft&&(e=this.secondsPrinted+this.secondsLeft),this.toDuration(e,this.printer.isPrinting())},secondsLeft:function(){return x()(this.printer,"status.progress.printTimeLeft")},secondsPrinted:function(){return x()(this.printer,"status.progress.printTime")},watchForFailures:function(){return this.printer.watching_enabled},pauseOnFailure:function(){return"PAUSE"==this.printer.action_on_failure},hasCurrentPrintFilename:function(){return!(!this.printer.current_print||!this.printer.current_print.filename)},actionsProps:function(){return{printer:this.printer}},progressPct:function(){return x()(this.printer,"status.progress.completion")||0},tempProps:function(){var e=this,t=void 0!=x()(this.printer,"settings.temp_profiles"),n=[],i=["bed","tool0","tool1"];return i.forEach((function(t){var i=x()(e.printer,"status.temperatures."+t);i&&(i.actual=parseFloat(i.actual).toFixed(1),i.target=Math.round(i.target),Object.assign(i,{toolName:P()(t)}),i.id=e.printer.id+"-"+t,i.key=t,n.push(i))})),{temperatures:n,show:n.length>0,editable:t}},statusText:function(){return x()(this.printer,"status.state.text","Offline")},statusClass:function(){return this.printer.hasError()?"text-danger":this.printer.isOffline()||this.printer.isDisconnected()||this.printer.inTransientState()?"text-warning":"text-success"}},methods:{updatedPrinter:function(e){return Object(w["d"])(e,this.printer)},shareUrl:function(){return"/printers/".concat(this.printer.id,"/share/")},settingsUrl:function(){return"/printers/".concat(this.printer.id,"/")},octoPrintTunnelUrl:function(){return"/tunnel/".concat(this.printer.id,"/")},onSettingsToggleClicked:function(){this.section_toggles.settings=!this.section_toggles.settings,Object(b["b"])(tt.Settings+String(this.printer.id),this.section_toggles.settings)},onTimeToggleClicked:function(){this.section_toggles.time=!this.section_toggles.time,Object(b["b"])(tt.Time+String(this.printer.id),this.section_toggles.time)},onStatusTempToggleClicked:function(){this.section_toggles.statusTemp=!this.section_toggles.statusTemp,Object(b["b"])(tt.StatusTemp+String(this.printer.id),this.section_toggles.statusTemp)},onNotAFailureClicked:function(e,t){var n=this;this.$swal.Confirm.fire({title:"Noted!",html:'<p>Do you want The Detective to keep watching this print?</p><small>If you select "No", The Detective will stop watching this print, but will automatically resume watching on your next print.</small>',confirmButtonText:"Yes",cancelButtonText:"No"}).then((function(e){"cancel"==e.dismiss&&setTimeout((function(){n.sendPrinterAction(n.printer.id,Ze,!1)}),1e3),t?n.sendPrinterAction(n.printer.id,Ye,!0):n.sendPrinterAction(n.printer.id,Xe,!1)})),e.preventDefault()},onWatchForFailuresToggled:function(){this.printer.watching_enabled=!this.printer.watching_enabled,this.updatePrinter(this.printer)},onPauseOnFailureToggled:function(){this.printer.action_on_failure="PAUSE"==this.printer.action_on_failure?"NONE":"PAUSE",this.updatePrinter(this.printer)},onPrinterActionPauseClicked:function(){var e=this;this.$swal.Confirm.fire({html:'If you haven\'t changed the default configuration, the heaters will be turned off, and the print head will be z-lifted. The reversed will be performed before the print is resumed. <a target="_blank" href="https://www.thespaghettidetective.com/docs/detection-print-job-settings#when-print-is-paused">Learn more. <small><i class="fas fa-external-link-alt"></i></small></a>'}).then((function(t){t.value&&e.sendPrinterAction(e.printer.id,He,!0)}))},onPrinterActionResumeClicked:function(e){this.printer.alertUnacknowledged()?this.onNotAFailureClicked(e,!0):this.sendPrinterAction(this.printer.id,Ye,!0)},onPrinterActionCancelClicked:function(){var e=this;this.$swal.Confirm.fire({text:"Once cancelled, the print can no longer be resumed."}).then((function(t){t.value&&e.sendPrinterAction(e.printer.id,Qe,!0)}))},onPrinterActionConnectClicked:function(){var e=this;this.printerComm.passThruToPrinter({func:"get_connection_options",target:"_printer"},(function(t,n){t?e.$swal.Toast.fire({icon:"error",title:"Failed to connect!"}):n.ports.length<1?e.$swal.Toast.fire({icon:"error",title:"Uh-Oh. No printer is found on the serial port."}):e.$swal.openModalWithComponent(Ie,{connectionOptions:n},{confirmButtonText:"Connect",showCancelButton:!0,preConfirm:function(){return{port:document.getElementById("connect-port").value,baudrate:document.getElementById("connect-baudrate").value}}}).then((function(t){if(t.value){var n=[t.value.port,t.value.baudrate];e.printerComm.passThruToPrinter({func:"connect",target:"_printer",args:n})}}))}))},onPrinterActionStartClicked:function(){var e=this;this.isProAccount?f.a.get(y["a"].gcodes(1,1e3)).then((function(t){var n=Object(S["a"])(t.data.results.map((function(e){return Object(w["b"])(e)})));e.$swal.openModalWithComponent(Pe,{gcodeFiles:n,onGcodeFileSelected:e.onGcodeFileSelected},{title:'Start print on "'+e.printer.name+'"',showConfirmButton:!1,showCloseButton:!0})})):this.$swal.Reject.fire({html:'\n              <h5 class="mb-3">You need to <a href="/ent/pricing/">upgrade to Pro plan</a> to start a remote print job. </h5>\n              <p>Remote G-Code upload and print start is a Pro feature.</p>\n              <p>With <a href="/ent/pricing/">little more than 1 Starbucks per month</a>, you can upgrade to a Pro account.</p>\n            '})},onGcodeFileSelected:function(e,t){var n=this;this.printerComm.passThruToPrinter({func:"download",target:"file_downloader",args:E()(e,{id:t})},(function(e,t){if(e||t.error)n.$swal.Toast.fire({icon:"error",title:e||t.error});else{var i=t.target_path,r='\n          <div class="text-center">\n            <i class="fas fa-spinner fa-spin fa-lg py-3"></i>\n            <h5 class="py-3">\n              Uploading G-Code to '.concat(n.printer.name," ...\n            </h5>\n            <p>\n              ").concat(i,"\n            </p>\n          </div>");n.$swal.Prompt.fire({html:r,showConfirmButton:!1});var a=function e(){"Operational"==x()(n.printer,"status.state.text")?setTimeout(e,1e3):n.$swal.close()};a()}}))},onPrinterActionControlClicked:function(){window.location=y["a"].printerControl(this.printer.id)},onTempEditClicked:function(e){var t,n=this,i=x()(this.printer,"settings.temp_profiles",[]),r=350;"bed"==e.key?(t=i.map((function(e){return{name:e.name,target:e["bed"]}})),r=140):t=i.map((function(e){return{name:e.name,target:e["extruder"]}})),this.$swal.openModalWithComponent($e,{presets:t,maxTemp:r,curTarget:e.target},{title:"Set "+e.toolName+" Temperature",confirmButtonText:"Confirm",showCancelButton:!0,preConfirm:function(){return{target:parseInt(document.getElementById("target-temp").value)}}}).then((function(t){if(t.value){var i=t.value.target;n.printerComm.passThruToPrinter({func:"set_temperature",target:"_printer",args:[e.key,i]})}}))},updatePrinter:function(e){var t=this;return f.a.patch(y["a"].printer(e.id),{watching_enabled:e.watching_enabled,action_on_failure:e.action_on_failure}).then((function(e){if(!e.data.succeeded)throw e;t.$emit("PrinterUpdated",Object(w["d"])(e.data.printer,t.printer))})).catch((function(e){console.error(e),t.$swal.Toast.fire({icon:"error",title:"Failed to update printer!"})}))},sendPrinterAction:function(e,t,n){var i=this;f.a.get(y["a"].printerAction(e,t)).then((function(){var e="";n&&(e+="<h6>Successfully sent command to OctoPrint!</h6><p>It may take a while to be executed by OctoPrint.</p>"),""!=e&&i.$swal.Toast.fire({icon:"success",html:e})}))},shouldVideoBeFull:function(e){var t=x()(e,"pic.img_url"),n=e.alertUnacknowledged()&&t;return!n},toDuration:function(e,t){if(null==e||0==e)return{valid:!1,printing:t};var n=A.a.duration(e,"seconds"),i=Math.floor(n.asHours()),r=n.minutes(),a=n.seconds();return{valid:!0,printing:t,hours:i,showHours:i>0,minutes:r,showMinutes:i>0||r>0,seconds:a,showSeconds:0==i&&0==r}},onSharePrinter:function(){this.$swal.openModalWithComponent(Je,{isProAccount:this.isProAccount,printer:this.printer},{confirmButtonText:"Close"})}}},it=nt,rt=(n("ee6b"),Object(Y["a"])(it,_,C,!1,null,"1ffe9a9d",null)),at=rt.exports,ot=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-dropdown",{attrs:{"toggle-class":"btn-light tsd-dropdown-toggle","menu-class":"tsd-dropdown-menu"},scopedSlots:e._u([{key:"button-content",fn:function(){return[n("div",{staticClass:"tsd-dropdown-selected-title"},[e._v(e._s(e.selected_title)+" "),e.selected.iconClass?n("i",{class:e.selected.iconClass}):e._e()])]},proxy:!0}])},e._l(e.options,(function(t){return n("b-dropdown-item",{key:t.value,attrs:{active:e.value==t.value},on:{click:function(n){return e.onOptionClicked(t)}}},[e._v(e._s(t.title)+" "),t.iconClass?n("i",{class:t.iconClass}):e._e()])})),1)},st=[],ct={name:"Select",props:["options","value"],methods:{onOptionClicked:function(e){this.$emit("input",e.value)}},computed:{selected:function(){var e=this;return this.options?this.options.find((function(t){return t.value==e.value})):null},selected_title:function(){var e=this.selected;return e.selected_title||e.title}}},lt=ct,dt=(n("08e1"),Object(Y["a"])(lt,ot,st,!1,null,"976ec99a",null)),ut=dt.exports,pt=n("b768"),ft={Asc:"asc",Desc:"desc"},vt={All:"all",OnlineOnly:"online",ActiveOnly:"active"},mt={DateAsc:"by-date-asc",DateDesc:"by-date-desc",NameAsc:"by-name-asc",NameDesc:"by-name-desc"},ht=(W={},Object(u["a"])(W,ft.Asc,"fas fa-long-arrow-alt-up"),Object(u["a"])(W,ft.Desc,"fas fa-long-arrow-alt-down"),W),gt={StateFilter:"printer-filtering",SortFilter:"printer-sorting"},bt=function(e,t,n){var i=Object.entries(e).find((function(e){return e[1]==t}));return i?i[1]:n},wt={name:"PrinterListPage",components:{PrinterCard:at,Select:ut,Navbar:c["a"],PullToReveal:pt["a"]},created:function(){this.user=JSON.parse(document.querySelector("#user-json").text),this.StateFilter=vt,this.SortFilter=mt,this.SortOrder=ft,this.stateFilters=[{value:vt.All,title:"All Printers"},{value:vt.OnlineOnly,title:"Online Printers Only"},{value:vt.ActiveOnly,title:"Active Printers Only"}],this.sortFilters=[{value:mt.DateAsc,title:"Sort By Date",iconClass:ht[ft.Asc]},{value:mt.DateDesc,title:"Sort By Date",iconClass:ht[ft.Desc]},{value:mt.NameAsc,title:"Sort By Name",iconClass:ht[ft.Asc]},{value:mt.NameDesc,title:"Sort By Name",iconClass:ht[ft.Desc]}],this.fetchPrinters()},data:function(){return{user:null,printers:[],loading:!0,filters:{visible:!1,state:bt(vt,Object(b["a"])(gt.StateFilter,vt.All),vt.All),sort:bt(mt,Object(b["a"])(gt.SortFilter,mt.DateDesc),mt.DateDesc)},dontShowFilterWarning:!1,shouldShowArchiveWarning:!1}},computed:{visiblePrinters:function(){var e=this.printers;switch(this.filters.state){case vt.OnlineOnly:e=e.filter((function(e){return!e.isDisconnected()}));break;case vt.ActiveOnly:e=e.filter((function(e){return e.isPrinting()}));break;case vt.All:break}switch(this.filters.sort){case mt.DateAsc:e=m()(e,(function(e){return e.createdAt()}));break;case mt.DateDesc:e=g()(m()(e,(function(e){return e.createdAt()})));break;case mt.NameAsc:e=m()(e,(function(e){return e.name}));break;case mt.NameDesc:e=g()(m()(e,(function(e){return e.name})));break}return e},hiddenPrinterCount:function(){return this.printers.length-this.visiblePrinters.length},shouldShowFilterWarning:function(){return this.hiddenPrinterCount>0&&!this.dontShowFilterWarning}},methods:{fetchPrinters:function(){var e=this;return this.loading=!0,f.a.get(y["a"].printers(),{params:{with_archived:!0}}).then((function(t){e.loading=!1,t.data.forEach((function(t){t.archived_at?e.shouldShowArchiveWarning=!0:e.insertPrinter(Object(w["d"])(t))}))}))},toggleFiltersPanel:function(){this.filters.visible=!this.filters.visible},onSortFilterChanged:function(){Object(b["b"])(gt.SortFilter,this.filters.sort),this.toggleFiltersPanel()},onStateFilterChanged:function(){Object(b["b"])(gt.StateFilter,this.filters.state),this.toggleFiltersPanel()},onShowAllPrintersClicked:function(){this.filters.state=vt.All,Object(b["b"])(gt.StateFilter,this.filters.state)},insertPrinter:function(e){this.printers.push(e)},onPrinterUpdated:function(e){var t=this.printers.findIndex((function(t){return t.id==e.id}));t<0||this.$set(this.printers,t,e)},closeMenus:function(){if(this.$refs.navbar.hideDropdowns(),this.$refs.filters){var e=this.$refs.filters.querySelectorAll(".dropdown");e.forEach((function(e){e.classList.contains("show")&&(e.classList.remove("show"),e.querySelector(".dropdown-menu").classList.remove("show"))}))}}}},yt=wt,_t=(n("b01d"),Object(Y["a"])(yt,l,d,!1,null,null,null)),Ct=_t.exports,St=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("pull-to-reveal",[n("navbar",{attrs:{"view-name":"printer_shared"}})],1),n("div",{staticClass:"row justify-content-center"},[e.loading?n("b-spinner",{staticClass:"mt-5",attrs:{label:"Loading..."}}):e._e(),e.printer?n("div",{staticClass:"col-sm-12 col-lg-6 printer-card"},[n("div",{staticClass:"card"},[n("div",{staticClass:"card-header"},[n("div",[e._v(e._s(e.printer.name))])]),n("streaming-box",{attrs:{printer:e.printer,webrtc:e.webrtc}}),n("div",{staticClass:"p-3 p-md-5"},[n("p",{staticClass:"text-center"},[e._v("You are viewing an awesome 3D print your friend shared specifically with you on")]),n("a",{attrs:{href:"https://www.thespaghettidetective.com/"}},[n("svg",{staticClass:"logo-img",attrs:{viewBox:"0 0 1965 240",width:"100%"}},[n("use",{attrs:{href:"#svg-navbar-brand"}})])]),n("hr"),n("br"),n("br"),n("a",{staticClass:"btn btn-block btn-primary",attrs:{href:"/accounts/signup/"}},[e._v("Get OctoPrint remote monitoring/access for FREE")])])],1)]):e._e()],1)],1)},kt=[],xt=(n("fb6a"),n("6625")),Tt=n.n(xt),Pt={name:"SharedPrinterPage",components:{StreamingBox:Z,PullToReveal:pt["a"],Navbar:c["a"]},created:function(){var e=this;this.shareToken=Tt()(window.location.pathname,"/").slice(-2,-1).pop(),this.printerComm=B(this.shareToken,y["a"].printerSharedWebSocket(this.shareToken),(function(t){e.printer=Object(w["d"])(t,e.printer),e.loading=!1})),this.printerComm.connect(),this.webrtc.openForShareToken(this.shareToken)},data:function(){return{printer:null,shareToken:null,videoAvailable:{},loading:!0,webrtc:$(!0)}}},Dt=Pt,At=(n("7428"),Object(Y["a"])(Dt,St,kt,!1,null,"638bb882",null)),Ot=At.exports,Et=n("e644"),jt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"row justify-content-center"},[i("pull-to-reveal",[i("navbar",{attrs:{"view-name":"app.views.web_views.edit_printer"}})],1),i("div",{staticClass:"col-sm-12 col-lg-10 wizard-container form-container",class:{"logo-bg":e.verifiedPrinter}},[e.verifiedPrinter?i("div",{staticClass:"text-center py-5"},[i("svg",{staticClass:"success-checkmark",attrs:{fill:"currentColor",viewBox:"0 0 446 410"}},[i("use",{attrs:{href:"#svg-success-checkmark"}})]),i("h3",{staticClass:"pb-4"},[e._v("Successfully linked to your account!")]),i("div",{staticClass:"col-sm-12 col-md-8 offset-md-2 col-lg-6 offset-lg-3 d-flex flex-column align-center justify-content-center"},[i("saving-animation",{attrs:{errors:e.errorMessages.printer_name,saving:e.saving.printer_name}},[i("div",{staticClass:"printer-name-input"},[i("div",{staticClass:"edit-icon"},[i("i",{staticClass:"fas fa-pen"})]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.verifiedPrinter.name,expression:"verifiedPrinter.name"}],staticClass:"dark",attrs:{type:"text",placeholder:"Printer name"},domProps:{value:e.verifiedPrinter.name},on:{input:[function(t){t.target.composing||e.$set(e.verifiedPrinter,"name",t.target.value)},e.updatePrinterName]}})])]),e._m(0)],1),i("br"),i("br"),i("div",{staticClass:"col-sm-12 col-md-8 offset-md-2 col-lg-6 offset-lg-3 d-flex flex-column align-center justify-content-center"},[e._m(1),e._m(2),e._m(3),i("div",{staticClass:"mt-4"},[i("a",{staticClass:"btn btn-outline-secondary btn-block mx-auto btn",attrs:{href:e.editPrinterUrl}},[e._v("Change Printer Settings")])]),e._m(4)])]):i("div",[i("form-wizard",{attrs:{color:"rgb(var(--color-primary))","step-size":"sm"},scopedSlots:e._u([{key:"footer",fn:function(t){return[i("div",{staticClass:"wizard-footer-left"},[t.activeTabIndex>0?i("wizard-button",{staticClass:"btn btn-link btn-back",nativeOn:{click:function(n){t.prevTab(),e.prevTab(t.activeTabIndex)}}},[e._v("< Back")]):e._e()],1),i("div",{staticClass:"wizard-footer-right"},[t.isLastStep?e._e():i("wizard-button",{staticClass:"wizard-footer-right wizard-btn",style:t.fillButtonStyle,nativeOn:{click:function(n){t.nextTab(),e.nextTab(t.activeTabIndex)}}},[e._v("Next >")])],1)]}}])},[i("h3",{attrs:{slot:"title"},slot:"title"},[i("svg",{staticClass:"header-img",attrs:{viewBox:"0 0 165 152"}},[i("use",{attrs:{href:"#svg-octoprint-logo"}})]),e._v(" "+e._s(e.title)+" ")]),e.printerIdToLink?i("tab-content",{attrs:{title:"Open Plugin Settings"}},[i("div",{staticClass:"container"},[i("div",{staticClass:"row justify-content-center pb-3"},[i("div",{staticClass:"col-sm-12 col-lg-8"},[i("div",{staticClass:"text-warning"},[e._v(" Warning: Re-Linking OctoPrint should be your last resort to solve issues. Please make sure you have exhausted all options on "),i("a",{attrs:{href:"https://www.thespaghettidetective.com/help/"}},[e._v("TSD's help website")]),e._v(". ")]),i("ol",[i("li",[e._v("Open OctoPrint in another browser tab. ")]),i("li",[e._v("Select "),i("em",[e._v('"OctoPrint settings menu → Access Anywhere - The Spaghetti Detective"')]),e._v(".")]),i("li",[e._v("Select "),i("em",[e._v('"Troubleshooting → Re-run Wizard"')]),e._v(".")])])])]),i("div",{staticClass:"row justify-content-center"},[i("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[i("img",{staticClass:"mx-auto",attrs:{src:n("754e")}})])])])]):i("tab-content",{attrs:{title:"Install Plugin"}},[i("div",{staticClass:"container"},[i("div",{staticClass:"row justify-content-center pb-3"},[i("div",{staticClass:"col-sm-12 col-lg-8"},[i("ol",[i("li",[e._v("Open OctoPrint in another browser tab. ")]),i("li",[e._v("Select "),i("em",[e._v('"OctoPrint settings menu → Plugin Manager → Get More..."')]),e._v(".")]),i("li",[e._v('Enter "The Spaghetti Detective" to locate the plugin. Click '),i("em",[e._v('"Install"')]),e._v(".")]),i("li",[e._v("Restart OctoPrint when prompted.")])])])]),i("div",{staticClass:"row justify-content-center"},[i("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[i("img",{staticClass:"mx-auto screenshot",attrs:{src:n("842d")},on:{click:function(t){return e.zoomIn(t)}}})])])])]),e.autoDiscovering?i("tab-content",{attrs:{title:"Link It!"}},[i("loading",{attrs:{active:e.autoLinking,"can-cancel":!0,"on-cancel":e.cancelAutoLinking}}),i("div",{staticClass:"discover"},[i("div",{staticClass:"discover-body"},[0===e.discoveredPrinters.length?i("div",{staticStyle:{"text-align":"center"}},[i("div",{staticClass:"spinner-border big",attrs:{role:"status"}},[i("span",{staticClass:"sr-only"})]),i("div",{staticClass:"lead"},[e._v(" Scanning... ")])]):i("div",[i("div",{staticClass:"lead my-3"},[i("div",{staticClass:"spinner-border",attrs:{role:"status"}},[i("span",{staticClass:"sr-only"})]),i("span",{staticClass:"sr-only"}),e._v("Scanning..., "+e._s(e.discoveredPrinters.length)+" OctoPrint(s) found on your local network:")]),e._l(e.discoveredPrinters,(function(t){return i("discovered-printer",{key:t.device_id,attrs:{discoveredPrinter:t},on:{"auto-link-printer":e.autoLinkPrinter}})}))],2),i("div",{staticClass:"mt-5 mb-3"},[e._v(" Can't find the OctoPrint you want to link? Switch to "),i("a",{staticClass:"link",on:{click:function(t){e.autoDiscovering=!1}}},[e._v("Manual Setup")]),e._v(" instead. ")]),e.discoveryCount>=2?i("div",{staticClass:"text-muted"},[i("div",[e._v("To link your OctoPrint, please make sure:")]),i("ul",[i("li",[e._v("The Raspberry Pi is powered on.")]),i("li",[e._v("The Raspberry Pi is connected to the same local network as your phone/computer.")]),i("li",[e._v("The Spaghetti Detective plugin version is 1.7 or above.")])])]):e._e()])])],1):i("tab-content",{attrs:{title:"Plugin Wizard"}},[i("div",{staticClass:"container"},[i("div",{staticClass:"row justify-content-center pb-3"},[i("div",{staticClass:"col-sm-12 col-lg-8"},[i("ol",[i("li",[e._v("Wait for "),i("em",[e._v('"Access Anywhere - The Spaghetti Detective"')]),e._v(" wizard to popup.")]),i("li",[e._v("Follow the instructions in the wizard.")]),i("li",[e._v("Select "),i("em",[e._v('"Web Setup"')]),e._v(" when asked.")])])])]),i("div",{staticClass:"row justify-content-center"},[i("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[i("img",{staticClass:"mx-auto screenshot",attrs:{src:n("ebff")},on:{click:function(t){return e.zoomIn(t)}}})])])])]),e.autoDiscovering?e._e():i("tab-content",{attrs:{title:"Enter Code"}},[i("div",{staticClass:"container"},[i("div",{staticClass:"row justify-content-center pb-3"},[i("div",{staticClass:"col-sm-12 col-lg-8  d-flex flex-column align-items-center"},[i("input",{ref:"code",staticClass:"code-btn",attrs:{disabled:""},domProps:{value:""+(e.verificationCode&&e.verificationCode.code)}}),i("small",{staticClass:"mx-auto py-1",class:{"text-muted":!e.copied}},[e._v(e._s(e.copied?"Code copied to system clipboard":"Ctrl-C/Cmd-C to copy the code"))]),i("div",{staticClass:"mx-auto pt-1 pb-4"},[i("span",{staticClass:"text-muted"},[e._v("Code expires in ")]),e._v(e._s(e.timeToExpire))]),i("div",{staticClass:"lead"},[e._v("Enter the "),i("strong",[e._v("6-digit verification code")]),e._v(" in the plugin")])])]),i("div",{staticClass:"row justify-content-center"},[i("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[i("img",{staticClass:"screenshot",attrs:{src:n("5f18")},on:{click:function(t){return e.zoomIn(t)}}}),i("div",{staticClass:"helper mx-auto py-2"},[i("a",{staticClass:"link font-weight-bold",on:{click:e.showVerificationCodeHelpModal}},[e._v("Can't find the page to enter the 6-digit code?")])])])])])])],1),e._m(5)],1)])],1)},It=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"text-muted mx-auto text-center font-weight-light"},[e._v("Give your printer a shiny name.")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mt-4"},[n("a",{staticClass:"btn-primary btn-block mx-auto btn btn-lg",attrs:{href:"/printers/"}},[e._v("Go Check Out Printer Feed!")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mt-5"},[n("a",{staticClass:"btn btn-outline-secondary btn-block mx-auto btn",attrs:{href:"/user_preferences/"}},[e._v("Add Phone Number")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"text-muted mx-auto text-center font-weight-light"},[e._v("Receive text (SMS) in case of print failures.")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"text-muted mx-auto text-center font-weight-light"},[e._v("You can always change it later.")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"row"},[n("div",{staticClass:"helper col-sm-12"},[e._v("Need help? Check out the "),n("a",{attrs:{href:"https://www.thespaghettidetective.com/docs/octoprint-plugin-setup/"}},[e._v("step-by-step set up guide.")])])])}],Rt=(n("841c"),n("2b3d"),n("2ee4")),Lt=(n("da93"),n("9062")),Mt=n.n(Lt),Bt=(n("e40d"),n("99b8")),Nt=n.n(Bt),Ft=n("cb3d"),Vt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"discovered-printers mt-4"},[i("div",{staticClass:"flex-grow-0 pt-1 mr-2"},[e.discoveredPrinter.rpi_model?i("img",{staticClass:"logo-img",attrs:{src:n("7eac")}}):i("img",{staticClass:"logo-img",attrs:{src:n("adbd")}})]),i("div",{staticClass:"row flex-grow-1 ml-1 link-action"},[i("div",{staticClass:"col-sm-12 col-md-10 pb-2"},[e.discoveredPrinter.rpi_model?i("div",[e._v(" "+e._s(e.discoveredPrinter.rpi_model)+" ")]):e._e(),e.discoveredPrinter.machine_type?i("div",[e._v(" "+e._s(e.discoveredPrinter.machine_type)+" ")]):e._e(),e.discoveredPrinter.host_or_ip?i("div",{staticClass:"text-muted small"},[e._v(" IP address: "+e._s(e.discoveredPrinter.host_or_ip)+" ")]):e._e(),e.discoveredPrinter.hostname?i("div",{staticClass:"text-muted small"},[e._v(" Hostname: "+e._s(e.discoveredPrinter.hostname)+" ")]):e._e(),e.discoveredPrinter.octopi_version?i("div",{staticClass:"text-muted small"},[e._v(" OctoPi: "+e._s(e.discoveredPrinter.octopi_version)+" ")]):e._e(),!e.discoveredPrinter.octopi_version&&e.discoveredPrinter.os?i("div",{staticClass:"text-muted small"},[e._v(" OS: "+e._s(e.discoveredPrinter.os)+" ")]):e._e()]),i("div",{staticClass:"col-sm-12 col-md-2 center px-3"},[i("button",{staticClass:"btn btn-block btn-primary",on:{click:function(t){return e.$emit("auto-link-printer",e.discoveredPrinter.device_id)}}},[e._v("Link")])])])])},$t=[],Wt={name:"DiscoveredPrinter",props:{discoveredPrinter:{type:Object,required:!0}}},zt=Wt,Ut=(n("9be8"),Object(Y["a"])(zt,Vt,$t,!1,null,null,null)),qt=Ut.exports,Gt=720,Jt={components:{FormWizard:Rt["FormWizard"],TabContent:Rt["TabContent"],WizardButton:Rt["WizardButton"],Loading:Mt.a,PullToReveal:pt["a"],Navbar:c["a"],SavingAnimation:Ft["a"],DiscoveredPrinter:qt},data:function(){return{theme:Nt.a,verificationCode:null,verifiedPrinter:null,onVerificationStep:!1,copied:!1,saving:{},errorMessages:{},delayedSubmit:{printer_name:{delay:1e3,timeoutId:null}},autoDiscovering:!0,discoveryCount:0,discoveredPrinters:[],autoLinking:!1,apiCallIntervalId:null}},created:function(){var e=JSON.parse(document.querySelector("#user-json").text);"pro-comp-50-dh"===x()(e,"subscription.plan_id")&&1===x()(e,"subscription.printers_subscribed")||(this.autoDiscovering=!1),this.printerIdToLink&&(this.autoDiscovering=!1),this.discoverPrinter(),this.getVerificationCode()},computed:{printerIdToLink:function(){return new URLSearchParams(window.location.search.substring(1)).get("printerId")},title:function(){return this.printerIdToLink?"Re-Link OctoPrint":"Link OctoPrint"},editPrinterUrl:function(){return"/printers/".concat(this.verifiedPrinter.id,"/")},expiryMoment:function(){return this.verificationCode?A()(this.verificationCode.expired_at):null},timeToExpire:function(){return this.expiryMoment?A.a.duration(this.expiryMoment.diff(A()())).humanize():"-"}},methods:{setSavingStatus:function(e,t){t&&delete this.errorMessages[e],this.$set(this.saving,e,t)},updatePrinterName:function(){var e=this;if("name"in this.verifiedPrinter&&this.verifiedPrinter.name){var t=this.delayedSubmit["printer_name"];return t["timeoutId"]&&clearTimeout(t["timeoutId"]),void(this.delayedSubmit["printer_name"]["timeoutId"]=setTimeout((function(){return e.setSavingStatus("printer_name",!0),f.a.patch(y["a"].printer(e.verifiedPrinter.id),{name:e.verifiedPrinter.name}).catch((function(e){console.log(e)})).then((function(){e.setSavingStatus("printer_name",!1)}))}),t["delay"]))}var n=this.delayedSubmit["printer_name"];n["timeoutId"]&&clearTimeout(n["timeoutId"])},prevTab:function(){document.querySelector(".wizard-nav.wizard-nav-pills li.active .wizard-icon-circle").classList.remove("checked"),this.onVerificationStep=!1},nextTab:function(e){if(document.querySelector(".wizard-nav.wizard-nav-pills li.active .wizard-icon-circle").classList.add("checked"),this.onVerificationStep=1==e,this.onVerificationStep){var t=this.copyCode,n=!1,i=17,r=91,a=67;document.addEventListener("keydown",(function(e){e.keyCode!=i&&e.keyCode!=r||(n=!0)})),document.addEventListener("keyup",(function(e){e.keyCode!=i&&e.keyCode!=r||(n=!1)})),document.addEventListener("keydown",(function(e){n&&e.keyCode==a&&t()}))}},verificationCodeUrl:function(){var e=y["a"].verificationCode();return this.verificationCode?this.verificationCode.verified_at||A()().isBefore(this.expiryMoment)?"".concat(e).concat(this.verificationCode.id,"/"):e:this.printerIdToLink?"".concat(e,"?printer_id=").concat(this.printerIdToLink):e},copyCode:function(){if(this.onVerificationStep&&this.verificationCode){var e=document.createElement("textarea");e.value=this.verificationCode.code,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),this.copied=!0}catch(t){console.error("Fallback: Oops, unable to copy",t)}document.body.removeChild(e)}},callVerificationCodeApi:function(){var e=this;f.a.get(this.verificationCodeUrl()).then((function(t){t.data&&(e.verificationCode=t.data,e.verificationCode.verified_at&&(e.verifiedPrinter=t.data.printer))}))},getVerificationCode:function(){var e=this;this.callVerificationCodeApi(),this.apiCallIntervalId=setInterval((function(){e.verifiedPrinter?clearInterval(e.apiCallIntervalId):e.callVerificationCodeApi()}),5e3)},showVerificationCodeHelpModal:function(){this.$swal.fire({title:"Can't find the page to enter the 6-digit code?",html:'<p>The 6-digit code needs to be entered in The Spaghetti Detective plugin in OctoPrint. There are a few reasons why you can\'t find this page:</p>\n        <p><ul>\n        <li style="margin: 10px 0;">You don\'t have the plugin installed or you haven\'t restarted OctoPrint after installation. Click <a href="/printers/wizard/">here</a> to walk through the process again.</li>\n        <li style="margin: 10px 0;">The installed plugin is on a version earlier than 1.5.0. You need to upgrade the plugin to <b>1.5.0</b> or later.</li>\n        <li style="margin: 10px 0;">Still no dice? Check out the step-by-step <a href="https://www.thespaghettidetective.com/docs/octoprint-plugin-setup/">set up guide</a>.</li>\n        </ul></p>',customClass:{container:"dark-backdrop"}})},zoomIn:function(e){e.target.classList.toggle("zoomedIn")},callPrinterDiscoveryApi:function(){var e=this;this.autoDiscovering&&(this.discoveryCount>=Gt&&0===this.discoveredPrinters.length&&(this.autoDiscovering=!1,this.$swal.Toast.fire({title:"No OctoPrint discovered on your local network. Switched to manual linking."})),this.discoveryCount+=1,f.a.get(y["a"].printerDiscovery()).then((function(t){e.discoveredPrinters=m()(t.data,(function(e){return e.device_id}))})))},discoverPrinter:function(){var e=this;this.callPrinterDiscoveryApi(),setTimeout((function(){e.discoverPrinter()}),5e3)},autoLinkPrinter:function(e){var t=this;f.a.post(y["a"].printerDiscovery(),{code:this.verificationCode.code,device_id:e}),this.autoLinking=!0,setTimeout((function(){t.autoLinking&&!t.verifiedPrinter&&(t.$swal.Toast.fire({icon:"error",title:"Something went wrong. Switched to using 6-digit code to link OctoPrint."}),t.autoDiscovering=!1),t.autoLinking=!1}),2e4)},cancelAutoLinking:function(){this.autoLinking=!1}}},Ht=Jt,Yt=(n("2dc0"),n("020c"),Object(Y["a"])(Ht,jt,It,!1,null,"745d9c42",null)),Qt=Yt.exports,Zt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container my-5"},[n("pull-to-reveal",[n("navbar",{attrs:{"view-name":"app.views.web_views.printer_control"}})],1),n("div",{staticClass:"row justify-content-center",staticStyle:{margin:"-24px -31px 0px"}},[e.printer?n("div",{staticClass:"col-sm-12 col-lg-8 printer-card"},[n("div",{staticClass:"card"},[n("div",{staticClass:"card-header"},[n("div",{staticClass:"title-box"},[n("div",{staticClass:"printer-name"},[e._v(e._s(e.printer.name))])])]),n("streaming-box",{attrs:{printer:e.printer,webrtc:e.webrtc}}),n("div",{staticClass:"card-body",class:{overlay:!e.printer.isIdle()}},[n("div",{directives:[{name:"show",rawName:"v-show",value:!e.printer.isIdle(),expression:"!printer.isIdle()"}],staticClass:"overlay-top text-center",staticStyle:{left:"0",width:"100%",top:"50%","margin-top":"-85px"}},[n("div",[e._v("Printer controls are disabled")]),n("div",[e._v("because the printer is not idle.")])]),n("div",{staticClass:"printer-controls"},[n("div",{staticClass:"xy-controls"},[n("button",{staticClass:"btn",attrs:{type:"button","data-axis":"y","data-dir":"up"},on:{click:function(t){return e.control(e.axis.y,e.directions.up)}}},[n("i",{staticClass:"fas fa-angle-up fa-lg"})]),n("div",{staticClass:"x-controls"},[n("button",{staticClass:"btn",attrs:{type:"button","data-axis":"x","data-dir":"down"},on:{click:function(t){return e.control(e.axis.x,e.directions.down)}}},[n("i",{staticClass:"fas fa-angle-left fa-lg"})]),n("button",{staticClass:"btn",attrs:{type:"button","data-axis":"xy","data-dir":"home"},on:{click:function(t){return e.control(e.axis.xy,e.directions.home)}}},[n("i",{staticClass:"fas fa-home fa-lg"})]),n("button",{staticClass:"btn",attrs:{type:"button","data-axis":"x","data-dir":"up"},on:{click:function(t){return e.control(e.axis.x,e.directions.up)}}},[n("i",{staticClass:"fas fa-angle-right fa-lg"})])]),n("button",{staticClass:"btn",attrs:{type:"button","data-axis":"y","data-dir":"down"},on:{click:function(t){return e.control(e.axis.y,e.directions.down)}}},[n("i",{staticClass:"fas fa-angle-down fa-lg"})])]),n("div",{staticClass:"z-controls"},[n("button",{staticClass:"btn",attrs:{type:"button","data-axis":"z","data-dir":"up"},on:{click:function(t){return e.control(e.axis.z,e.directions.up)}}},[n("i",{staticClass:"fas fa-angle-up fa-lg"})]),n("button",{staticClass:"btn",attrs:{type:"button","data-axis":"z","data-dir":"home"},on:{click:function(t){return e.control(e.axis.z,e.directions.home)}}},[n("i",{staticClass:"fas fa-home fa-lg"})]),n("button",{staticClass:"btn",attrs:{type:"button","data-axis":"z","data-dir":"down"},on:{click:function(t){return e.control(e.axis.z,e.directions.down)}}},[n("i",{staticClass:"fas fa-angle-down fa-lg"})])])]),n("br"),n("div",{staticClass:"control-options"},[n("div",{staticClass:"btn-group btn-group-toggle",attrs:{"data-toggle":"buttons"}},e._l(e.jogDistanceOptions,(function(t){return n("label",{key:t,staticClass:"btn",class:{active:e.jogDistance==t},on:{click:function(n){e.jogDistance=t}}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.jogDistance,expression:"jogDistance"}],attrs:{type:"radio",name:"jogDistance",autocomplete:"off"},domProps:{value:t,checked:e._q(e.jogDistance,t)},on:{change:function(n){e.jogDistance=t}}}),e._v(" "+e._s(t)+"mm ")])})),0)])])],1)]):e._e()])],1)},Xt=[],Kt={x:"x",y:"y",z:"z",xy:["x","y"]},en={up:1,down:-1,home:0},tn={name:"PrinterControlPage",components:{StreamingBox:Z,PullToReveal:pt["a"],Navbar:c["a"]},data:function(){return{axis:Kt,directions:en,user:null,printerId:null,printer:null,webrtc:null,jogDistance:10,jogDistanceOptions:[.1,1,10,100]}},created:function(){var e=this;this.user=JSON.parse(document.querySelector("#user-json").text),this.printerId=Tt()(window.location.pathname,"/").slice(-3,-2).pop();var t=localStorage.getItem("mm-per-step-".concat(this.printerId));this.jogDistance=t||this.jogDistance,this.webrtc=$(this.user.is_pro),this.printerComm=B(this.printerId,y["a"].printerWebSocket(this.printerId),(function(t){e.printer=Object(w["d"])(t,e.printer),e.webrtc&&!e.webrtc.initialized&&(e.webrtc.openForPrinter(e.printer.id,e.printer.auth_token),e.printerComm.setWebRTC(e.webrtc))})),this.printerComm.connect()},methods:{control:function(e,t){var n=[],i="jog";t===this.directions.home?(n.push(e),i="home"):n.push(Object(u["a"])({},e,t*this.jogDistance));var r={func:i,target:"_printer",args:n};this.printerComm.passThruToPrinter(r)}},watch:{jogDistance:function(e){localStorage.setItem("mm-per-step-".concat(this.printerId),e)}}},nn=tn,rn=(n("6fc0"),Object(Y["a"])(nn,Zt,Xt,!1,null,"3f264116",null)),an=rn.exports,on=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("pull-to-reveal",[n("navbar",{attrs:{"view-name":"app.views.web_views.gcodes"}})],1),e.user.is_pro?n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("div",{staticClass:"row my-3 justify-content-center"},[n("div",{staticClass:"col-sm-12 col-lg-10"},[n("vue-dropzone",{ref:"gcodesDropzone",staticClass:"upload-box",attrs:{id:"dropzone",options:e.dropzoneOptions,useCustomSlot:!0},on:{"vdropzone-queue-complete":e.gcodeUploadSuccess,"vdropzone-error":e.gcodeUploadError}},[n("div",{staticClass:"dz-message needsclick"},[n("i",{staticClass:"fas fa-upload fa-2x"}),e._v(" "),n("br"),e._v(" Drop files here or click to upload."),n("br"),e._v(" G-Code files only. Up to 100MB each. ")])])],1)]),n("div",{staticClass:"row justify-content-center mb-2"},[n("div",{staticClass:"col-sm-12 col-lg-10"},[n("div",{staticClass:"gcodes-wrapper"},[n("div",{staticClass:"control-panel"},[n("search-input",{staticClass:"search-input",model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1),n("div",{staticClass:"sorting-panel"},[n("div",{staticClass:"sorting-option",class:{active:e.activeSorting===e.sorting.NAME},on:{click:function(t){return e.updateSorting(e.sorting.NAME)}}},[n("span",{staticClass:"text"},[e._v("File name")]),n("div",{staticClass:"direction"},[e.activeSorting===e.sorting.NAME&&e.sortDirection===e.direction.DESC?n("i",{staticClass:"fas fa-arrow-down"}):n("i",{staticClass:"fas fa-arrow-up"})])]),n("div",{staticClass:"sorting-option",class:{active:e.activeSorting===e.sorting.SIZE},on:{click:function(t){return e.updateSorting(e.sorting.SIZE)}}},[n("span",{staticClass:"text"},[e._v("File size")]),n("div",{staticClass:"direction"},[e.activeSorting===e.sorting.SIZE&&e.sortDirection===e.direction.DESC?n("i",{staticClass:"fas fa-arrow-down"}):n("i",{staticClass:"fas fa-arrow-up"})])]),n("div",{staticClass:"sorting-option",class:{active:e.activeSorting===e.sorting.UPLOADED},on:{click:function(t){return e.updateSorting(e.sorting.UPLOADED)}}},[n("span",{staticClass:"text"},[e._v("Uploaded")]),n("div",{staticClass:"direction"},[e.activeSorting===e.sorting.UPLOADED&&e.sortDirection===e.direction.DESC?n("i",{staticClass:"fas fa-arrow-down"}):n("i",{staticClass:"fas fa-arrow-up"})])])]),n("div",{staticClass:"gcode-items-wrapper"},e._l(e.gcodesToShow,(function(t){return n("div",{key:t.id,staticClass:"item"},[n("div",{staticClass:"item-info"},[n("div",{staticClass:"filename"},[e._v(e._s(t.filename))]),n("div",{staticClass:"filesize"},[e._v(e._s(t.filesize))]),n("div",{staticClass:"uploaded"},[e._v(e._s(t.created_at.fromNow()))])]),n("div",{staticClass:"remove-button-wrapper"},[n("div",{staticClass:"remove-button",on:{click:function(n){return e.removeItem(t.id)}}},[n("i",{staticClass:"far fa-trash-alt"})])])])})),0),n("mugen-scroll",{staticClass:"text-center p-4",attrs:{handler:e.fetchGCodes,"should-handle":!e.loading}},[e.noMoreData?n("div",{staticClass:"text-center p-2"},[e._v("End of your G-Codes list.")]):e._e(),e.noMoreData?e._e():n("b-spinner",{attrs:{label:"Loading..."}})],1)],1)])])])]):n("div",{staticClass:"row my-3 justify-content-center"},[e._m(0)])],1)},sn=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"col-sm-11 col-md-10 col-lg-8"},[n("div",{staticClass:"form-container printer-settings"},[n("h5",{staticClass:"mb-5"},[e._v("Wait! You need to "),n("a",{attrs:{href:"/ent/pricing/"}},[e._v("upgrade to Pro plan")]),e._v(" to upload G-Code files or start prints remotely. ")]),n("p",[e._v("G-Code remote upload and printing is a Pro feature.")]),n("p",[n("a",{attrs:{href:"https://www.thespaghettidetective.com/docs/upgrade-to-pro#why-cant-the-detective-just-work-for-free-people-love-free-you-know"}},[e._v("Running TSD incurs non-trivial amount of costs")]),e._v(". With little more than 1 Starbucks per month, you can upgrade to a Pro account and help us run TSD smoothly.")]),n("p",[n("a",{attrs:{href:"/ent/pricing/"}},[e._v("Check out Pro pricing >>>")])])])])}],cn=(n("a434"),n("92c3")),ln=n.n(cn),dn=(n("1e3f"),n("996c")),un=n.n(dn),pn={NAME:1,SIZE:2,UPLOADED:3},fn={ASC:1,DESC:-1},vn={name:"GCodesPage",components:{Navbar:c["a"],PullToReveal:pt["a"],vueDropzone:ln.a,MugenScroll:un.a,SearchInput:Se},props:{csrf:{type:String,requeired:!0}},data:function(){return{dropzoneOptions:{withCredentials:!0,maxFilesize:100,timeout:36e5,acceptedFiles:".g,.gcode,.gco",url:"upload/",headers:{"X-CSRFToken":this.csrf}},searchText:"",activeSorting:pn.UPLOADED,sortDirection:fn.DESC,sorting:pn,direction:fn,gcodes:[],currentPage:1,loading:!1,noMoreData:!1}},computed:{gcodesToShow:function(){var e=this.gcodes;if(!e)return[];var t=this.searchText.toLowerCase();e=e.filter((function(e){return e.filename.toLowerCase().indexOf(t)>-1}));var n=this.sortDirection;switch(this.activeSorting){case pn.NAME:e.sort((function(e,t){var i=e.filename.toUpperCase(),r=t.filename.toUpperCase();return i<r?n===fn.ASC?-1:1:i>r?n===fn.ASC?1:-1:0}));break;case pn.SIZE:e.sort((function(e,t){return n===fn.ASC?e.num_bytes-t.num_bytes:t.num_bytes-e.num_bytes}));break;case pn.UPLOADED:e.sort((function(e,t){var i=e.created_at.unix(),r=t.created_at.unix();return n===fn.ASC?i-r:r-i}));break}return e}},created:function(){this.user=JSON.parse(document.querySelector("#user-json").text),this.fetchGCodes()},methods:{gcodeUploadSuccess:function(){this.$refs.gcodesDropzone.removeAllFiles(),this.gcodes=[],this.currentPage=1,this.noMoreData=!1,this.fetchGCodes()},gcodeUploadError:function(e,t){this.$swal.Reject.fire({html:'<p class="text-center">'.concat(t,"</p>")})},fetchGCodes:function(){var e=this;if(!this.noMoreData)return this.loading=!0,f.a.get(y["a"].gcodes(this.currentPage)).then((function(t){e.loading=!1,e.noMoreData=null===t.data.next;var n,i=t.data.results;i&&((n=e.gcodes).push.apply(n,Object(S["a"])(i.map((function(e){return Object(w["b"])(e)})))),e.currentPage+=1)})).catch((function(t){console.log(t),e.noMoreData=!0}))},updateSorting:function(e){this.activeSorting===e?this.sortDirection=-this.sortDirection:(this.activeSorting=e,this.sortDirection=fn.ASC)},removeItem:function(e){var t=this;f.a.delete(y["a"].gcode(e)).then((function(){for(var n=0;n<t.gcodes.length;n++){var i=t.gcodes[n];if(i.id===e){t.gcodes.splice(n,1);var r="";r+='<h6 class="text-danger">'.concat(i.filename," successfully deleted!</h6>"),t.$swal.Toast.fire({html:r})}}}))}}},mn=vn,hn=(n("d9ae"),Object(Y["a"])(mn,on,sn,!1,null,"3e64d8ad",null)),gn=hn.exports;Object(s["b"])(),Object(o["a"])(i["default"]),i["default"].use(a["a"]),i["default"].use(r["a"]),document.getElementById("navbar-mount")&&new i["default"]({components:{Navbar:c["a"]}}).$mount("#navbar-mount"),document.getElementById("printer-list-mount")&&new i["default"]({components:{PrinterListPage:Ct}}).$mount("#printer-list-mount"),document.getElementById("shared-printer-mount")&&new i["default"]({components:{SharedPrinterPage:Ot}}).$mount("#shared-printer-mount"),document.getElementById("printer-settings-mount")&&new i["default"]({components:{PrinterSettingsPage:Et["a"]}}).$mount("#printer-settings-mount"),document.getElementById("printer-wizard-mount")&&new i["default"]({components:{PrinterWizardPage:Qt}}).$mount("#printer-wizard-mount"),document.getElementById("printer-control-mount")&&new i["default"]({components:{PrinterControlPage:an}}).$mount("#printer-control-mount"),document.getElementById("share-printer-mount")&&new i["default"]({components:{SharePrinter:Je}}).$mount("#share-printer-mount"),document.getElementById("gcodes-page-mount")&&new i["default"]({components:{GCodesPage:gn}}).$mount("#gcodes-page-mount")},"08e1":function(e,t,n){"use strict";var i=n("a440"),r=n.n(i);r.a},1807:function(e,t,n){"use strict";n("99af"),n("a15b");var i=n("0b49"),r=n.n(i),a=n("dd61"),o=n.n(a);t["a"]={publicTimelapse:function(){return"/api/v1/publictimelapse/"},printShotFeedback:function(e,t){return"/api/v1/printshotfeedbacks/".concat(e,"/?print_id=").concat(t)},print:function(e){return"/api/v1/prints/".concat(e,"/")},prints:function(){return"/api/v1/prints/"},printsBulkDelete:function(){return"/api/v1/prints/bulk_delete/"},printAlertOverwrite:function(e){return"/api/v1/prints/".concat(e,"/alert_overwrite/")},printers:function(){return"/api/v1/printers/"},printer:function(e){return"/api/v1/printers/".concat(e,"/")},printerAction:function(e,t){return"/api/v1/printers/".concat(e).concat(t)},pubPrinter:function(){return"/api/v1p/printer/"},gcodes:function(e,t){return"/api/v1/gcodes/?page=".concat(e,"&page_size=").concat(t||24)},gcode:function(e){return"/api/v1/gcodes/".concat(e,"/")},tunnelUsage:function(){return"/api/v1/tunnelusage/"},verificationCode:function(){return"/api/v1/onetimeverificationcodes/"},user:function(){return"/api/v1/users/me/"},sharedResources:function(e){return"/api/v1/sharedresources/?"+o()(r()(e),(function(e){return e.join("=")})).join("&")},sharedResource:function(e){return"/api/v1/sharedresources/".concat(e,"/")},printerDiscovery:function(){return"/api/v1/printer_discovery/"},printerControl:function(e){return"/printers/".concat(e,"/control/")},printerWebSocket:function(e){return"/ws/web/".concat(e,"/")},printerSharedWebSocket:function(e){return"/ws/share_token/web/".concat(e,"/")},printerWizard:function(e){return"/printers/wizard/?printerId=".concat(e)}}},1853:function(e,t,n){},"1bd8":function(e,t,n){"use strict";var i=n("d10a"),r=n.n(i);r.a},2121:function(e,t,n){},2773:function(e,t,n){},"2a22":function(e,t,n){},"2dc0":function(e,t,n){"use strict";var i=n("50f6"),r=n.n(i);r.a},"3c33":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var i=function(e,t){var n=localStorage.getItem(e)||t;try{return JSON.parse(n)}catch(i){return n}},r=function(e,t){return localStorage.setItem(e,t)}},4:function(e,t,n){e.exports=n("0548")},4099:function(e,t,n){"use strict";var i=n("2121"),r=n.n(i);r.a},4694:function(e,t,n){},"471f":function(e,t,n){"use strict";var i=n("6e31"),r=n.n(i);r.a},"502a":function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return p})),n.d(t,"d",(function(){return f})),n.d(t,"a",(function(){return v}));n("caad"),n("2532");var i=n("f3f3"),r=n("c1df"),a=n.n(r),o=n("9b02"),s=n.n(o),c=n("49d5"),l=n.n(c),d=function(e){return e?a()(e):null},u=function(e){return e.ended_at=d(e.cancelled_at||e.finished_at),e.started_at=d(e.started_at),e.uploaded_at=d(e.uploaded_at),e.has_alerts=Boolean(e.alerted_at),e},p=function(e){return e.created_at=d(e.created_at),e.updated_at=d(e.updated_at),e.deleted=d(e.deleted),e.filesize=l()(e.num_bytes),e},f=function(e,t){var n={createdAt:function(){return d(this.created_at)},isOffline:function(){return null===s()(this,"status",null)},isPaused:function(){return s()(this,"status.state.flags.paused",!1)},isIdle:function(){return"Operational"===s()(this,"status.state.text","")},isDisconnected:function(){return s()(this,"status.state.flags.closedOrError",!0)},isPrinting:function(){return!this.isDisconnected()&&"Operational"!==s()(this,"status.state.text","")},inTransientState:function(){return!this.hasError()&&s()(this,"status.state.text","").includes("ing")&&!s()(this,"status.state.text","").includes("Printing")},hasError:function(){return s()(this,"status.state.flags.error")||s()(this,"status.state.text","").toLowerCase().includes("error")},alertUnacknowledged:function(){return s()(this,"current_print.alerted_at")&&a()(s()(this,"current_print.alerted_at")).isAfter(a()(s()(this,"current_print.alert_acknowledged_at")||0))}};return t?(s()(t,"status._ts",-1)>s()(e,"status._ts",s()(t,"status._ts",0))&&delete e.status,Object(i["a"])(Object(i["a"])(Object(i["a"])({},t),e),n)):Object(i["a"])(Object(i["a"])({},e),n)},v=function(e,t,n){var i=Math.round(e.length*t),r=n?"p":"fields.normalized_p";return s()(e[i],"".concat(r),0)}},"50f6":function(e,t,n){},"5f18":function(e,t,n){e.exports=n.p+"img/plugin_verification_code.png"},"630d":function(e,t,n){"use strict";var i=n("c504"),r=n.n(i);r.a},"648b":function(e,t,n){"use strict";n.d(t,"a",(function(){return N})),n.d(t,"d",(function(){return F})),n.d(t,"b",(function(){return U})),n.d(t,"c",(function(){return q}));n("99af"),n("4160"),n("b0c0"),n("d3b7"),n("ac1f"),n("159b"),n("ddb0");var i,r,a,o,s,c,l,d,u,p,f,v,m,h,g,b,w,y,_,C,S,k,x,T,P,D,A,O,E,j,I,R,L,M=n("fc11"),B=n("a026"),N={Light:"Light",Dark:"Dark",System:"System"},F=B["default"].observable({value:N.Dark,system:!1}),V=[{name:"primary-variant",values:(i={},Object(M["a"])(i,N.Light,"#B289F8"),Object(M["a"])(i,N.Dark,"#9A6AEF"),i)},{name:"primary",values:(r={},Object(M["a"])(r,N.Light,"#9965f4"),Object(M["a"])(r,N.Dark,"#A57BEE"),r)},{name:"on-primary",values:(a={},Object(M["a"])(a,N.Light,"#ffffff"),Object(M["a"])(a,N.Dark,"#ffffff"),a)},{name:"secondary",values:(o={},Object(M["a"])(o,N.Light,"#28303A"),Object(M["a"])(o,N.Dark,"#EBEBEB"),o)},{name:"on-secondary",values:(s={},Object(M["a"])(s,N.Light,"#EBEBEB"),Object(M["a"])(s,N.Dark,"#28303A"),s)},{name:"success",values:(c={},Object(M["a"])(c,N.Light,"#5cb85c"),Object(M["a"])(c,N.Dark,"#5cb85c"),c)},{name:"success-variant",values:(l={},Object(M["a"])(l,N.Light,"#4CAE4C"),Object(M["a"])(l,N.Dark,"#4CAE4C"),l)},{name:"on-success",values:(d={},Object(M["a"])(d,N.Light,"#ffffff"),Object(M["a"])(d,N.Dark,"#ffffff"),d)},{name:"danger",values:(u={},Object(M["a"])(u,N.Light,"#d9534f"),Object(M["a"])(u,N.Dark,"#d9534f"),u)},{name:"danger-variant",values:(p={},Object(M["a"])(p,N.Light,"#C2413D"),Object(M["a"])(p,N.Dark,"#C2413D"),p)},{name:"on-danger",values:(f={},Object(M["a"])(f,N.Light,"#ffffff"),Object(M["a"])(f,N.Dark,"#ffffff"),f)},{name:"warning",values:(v={},Object(M["a"])(v,N.Light,"#f0ad4e"),Object(M["a"])(v,N.Dark,"#f0ad4e"),v)},{name:"warning-variant",values:(m={},Object(M["a"])(m,N.Light,"#DB9A3F"),Object(M["a"])(m,N.Dark,"#DB9A3F"),m)},{name:"on-warning",values:(h={},Object(M["a"])(h,N.Light,"#ffffff"),Object(M["a"])(h,N.Dark,"#ffffff"),h)},{name:"on-warning-2",values:(g={},Object(M["a"])(g,N.Light,"#000000"),Object(M["a"])(g,N.Dark,"#000000"),g)},{name:"background",values:(b={},Object(M["a"])(b,N.Light,"#EBEBEB"),Object(M["a"])(b,N.Dark,"#233141"),b)},{name:"surface-primary",values:(w={},Object(M["a"])(w,N.Light,"#ffffff"),Object(M["a"])(w,N.Dark,"#485B71"),w)},{name:"surface-secondary",values:(y={},Object(M["a"])(y,N.Light,"#f5f5f5"),Object(M["a"])(y,N.Dark,"#2D3E4F"),y)},{name:"overlay",values:(_={},Object(M["a"])(_,N.Light,"#f5f5f5"),Object(M["a"])(_,N.Dark,"#000000"),_)},{name:"hover",values:(C={},Object(M["a"])(C,N.Light,"#666666"),Object(M["a"])(C,N.Dark,"#ffffff"),C)},{name:"divider",values:(S={},Object(M["a"])(S,N.Light,"#ABB6C2"),Object(M["a"])(S,N.Dark,"#6A7B8A"),S)},{name:"text-primary",values:(k={},Object(M["a"])(k,N.Light,"#28303A"),Object(M["a"])(k,N.Dark,"#EBEBEB"),k)},{name:"text-secondary",values:(x={},Object(M["a"])(x,N.Light,"#8A94A2"),Object(M["a"])(x,N.Dark,"#AAACB0"),x)},{name:"text-help",values:(T={},Object(M["a"])(T,N.Light,"#4c9be8"),Object(M["a"])(T,N.Dark,"#4c9be8"),T)},{name:"input-background",values:(P={},Object(M["a"])(P,N.Light,"#E2E8ED"),Object(M["a"])(P,N.Dark,"#42566B"),P)},{name:"table-accent-1",values:(D={},Object(M["a"])(D,N.Light,"#E3E3E3"),Object(M["a"])(D,N.Dark,"#27323F"),D)},{name:"table-accent-2",values:(A={},Object(M["a"])(A,N.Light,"#EDEDED"),Object(M["a"])(A,N.Dark,"#1B242E"),A)},{name:"icon-tunneling-1",values:(O={},Object(M["a"])(O,N.Light,"#4e5d6c"),Object(M["a"])(O,N.Dark,"#EAEAEA"),O)},{name:"icon-tunneling-2",values:(E={},Object(M["a"])(E,N.Light,"#1d2935"),Object(M["a"])(E,N.Dark,"#CDCDCD"),E)},{name:"icon-navbar-brand",values:(j={},Object(M["a"])(j,N.Light,"#7B8993"),Object(M["a"])(j,N.Dark,"#ffffff"),j)}],$=[{name:"logo-bg",values:(I={},Object(M["a"])(I,N.Light,'url("/static/img/logo-bg/logo-bg_light.svg")'),Object(M["a"])(I,N.Dark,'url("/static/img/logo-bg/logo-bg_dark.svg")'),I)},{name:"tail-spin",values:(R={},Object(M["a"])(R,N.Light,'url("/static/img/tail-spin/tail-spin_light.svg")'),Object(M["a"])(R,N.Dark,'url("/static/img/tail-spin/tail-spin_dark.svg")'),R)}],W=[{name:"widget",values:(L={},Object(M["a"])(L,N.Light,"0px 3px 30px rgba(0, 0, 0, 0.5)"),Object(M["a"])(L,N.Dark,"0px 3px 30px rgba(0, 0, 0, 0.5)"),L)}];function z(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t||console.log("Wrong HEX value!"),[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}function U(){var e=localStorage.getItem("colorTheme"),t=e===N.System;t&&(e="not all"!==window.matchMedia("(prefers-color-scheme)").media&&window.matchMedia("(prefers-color-scheme: light)").matches?N.Light:N.Dark),null===e&&(e=F.value),V.forEach((function(t){var n=z(t.values[e]);document.documentElement.style.setProperty("--color-".concat(t.name),"".concat(n[0]," ").concat(n[1]," ").concat(n[2]))})),$.forEach((function(t){document.documentElement.style.setProperty("--url-".concat(t.name),t.values[e])})),W.forEach((function(t){document.documentElement.style.setProperty("--shadow-".concat(t.name),t.values[e])})),F.value=e,F.system=t}function q(e){localStorage.setItem("colorTheme",e),U()}},6868:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tsd-gauge-container"},[n("span",{style:{color:e.titleColor},attrs:{id:"title"}},[e._v(e._s(e.titleText))]),n("div",{staticClass:"tsd-gauge"},[n("radial-gauge",{attrs:{value:e.value,options:e.computedOptions}})],1),n("hr")])},r=[],a=(n("a9e3"),n("7489")),o=n("648b"),s={name:"Gauge",components:{RadialGauge:a["a"]},data:function(){return{}},props:{normalizedP:{type:Number},isWatching:{type:Boolean,default:!0},options:{type:Object,default:null}},computed:{computedOptions:function(){if(null!==this.options)return this.options;var e={highlight1:o["d"].value===o["a"].Light?"#929292":"#8395a7",highlight2:o["d"].value===o["a"].Light?"#b7b7b7":"#a8bacc",highlight3:o["d"].value===o["a"].Light?"#7b7b7b":"#6c7e90",needle:o["d"].value===o["a"].Light?"#2d3e4f":"#ffffff"};return{valueDec:0,valueInt:0,width:240,height:240,units:!1,box:!1,minValue:0,maxValue:100,majorTicks:["","","",""],minorTicks:4,highlights:[{from:0,to:33,color:this.isWatching?"#5cb85c":e.highlight1},{from:33,to:67,color:this.isWatching?"#f0ad4e":e.highlight2},{from:67,to:100,color:this.isWatching?"#d9534f":e.highlight3}],colorPlate:"rgba(255,255,255,.0)",colorTitle:"#5cb85c",colorStrokeTicks:"#EBEBEB",colorNeedleEnd:this.isWatching?"rgba(255, 160, 122, .9)":e.needle,colorNeedle:this.isWatching?"rgba(240, 128, 128, 1)":e.needle,colorNeedleShadowUp:this.isWatching?"rgba(2,255,255,0.2)":e.needle,valueBox:!1,animationRule:"bounce",animationDuration:500,animatedValue:!0,startAngle:90,ticksAngle:180,borders:!1}},value:function(){return 100*this.normalizedP},titleText:function(){switch(this.level()){case 0:return"Looking Good";case 1:return"Fishy...";case 2:return"Failing!";default:return"Looking Good"}},titleColor:function(){switch(this.level()){case 0:return"#5cb85c";case 1:return"#f0ad4e";case 2:return"#d9534f";default:return"#5cb85c"}}},methods:{level:function(){return this.value>66?2:this.value>33?1:0}}},c=s,l=(n("b543"),n("2877")),d=Object(l["a"])(c,i,r,!1,null,"1e8f46d0",null);t["a"]=d.exports},"6bb8":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=function(){return""!==JSON.parse(document.querySelector("#app-platform-json").text)["platform"]}},"6e31":function(e,t,n){},"6fc0":function(e,t,n){"use strict";var i=n("e087"),r=n.n(i);r.a},7428:function(e,t,n){"use strict";var i=n("e51e"),r=n.n(i);r.a},"754e":function(e,t,n){e.exports=n.p+"img/plugin_rerun_setup.png"},"785f":function(e,t,n){"use strict";n("99af"),n("fb6a"),n("b0c0"),n("d3b7"),n("ac1f"),n("25f0"),n("5319");var i=n("0122"),r=/(?:^|[-_/])(\w)/g,a="root",o="anonymous component",s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^/]+?|)(\.[^./]*|))(?:[/]*)$/,c=function(e){var t=s.exec(e);return t?t.slice(1):[]},l=function(e,t){var n=c(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},d=function(e){if(!e)return o;if(e.$root===e)return a;if(!e.$options)return o;if(e.$options.name)return e.$options.name;if(e.$options._componentTag)return e.$options._componentTag;if(e.$options.__file){var t=e.$options.__file.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"),n=l(t,".vue");return n.replace(r,(function(e,t){return t?t.toUpperCase():""}))}return o},u=function e(t,n,r,a,o,s){var c=0;for(var l in n){if(c+=1,c>s)break;"object"==Object(i["a"])(n[l])?o>a&&e(t,n[l],r+"."+l,a+1,o,s):t[r+"."+l]=n[l]}},p=function(e){var t=e.config.errorHandler;e.config.errorHandler=function(n,i,r){if(window.Sentry){var a={},o=i;if(i._original&&(o=i._original),o)try{a.componentName=d(o),u(a,JSON.parse(JSON.stringify(o.$options.propsData)),"props",0,2,10)}catch(s){console.log("Unable to extract metadata from Vue component.")}r&&(a.lifecycleHook=r),setTimeout((function(){window.Sentry.getCurrentHub().withScope((function(e){e.setContext("vue",a),window.Sentry.getCurrentHub().captureException(n)}))}))}"function"===typeof t&&t.call(e,n,i,r),e.util&&e.util.warn("Error in ".concat(r,': "').concat(n.toString(),'"'),i),console.error(n)}};t["a"]=p},"7eac":function(e,t,n){e.exports=n.p+"img/raspberry_pi.png"},"842d":function(e,t,n){e.exports=n.p+"img/install_plugin.png"},"8ffe":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.isInMobile?e._e():n("b-navbar",{class:{"navbar-dark":e.theme===e.themes.Dark,"navbar-light":e.theme===e.themes.Light},attrs:{toggleable:"xl"}},[n("b-container",[n("b-navbar-brand",{attrs:{href:"/"}},[n("svg",{attrs:{viewBox:"0 0 1965 240",width:"232",height:"28.34"}},[n("use",{attrs:{href:"#svg-navbar-brand"}})])]),n("b-navbar-toggle",{attrs:{target:"navbar-toggle-collapse"}},[[n("span",{staticClass:"navbar-toggler-icon"})]],2),n("b-collapse",{attrs:{id:"navbar-toggle-collapse","is-nav":""},model:{value:e.showMainMenu,callback:function(t){e.showMainMenu=t},expression:"showMainMenu"}},[n("b-navbar-nav",[e.user?n("b-nav-item",{class:{active:e.viewName.includes("printers")},attrs:{href:"/printers/"}},[e._v("Printer")]):e._e(),e.user?n("b-nav-item",{class:{active:e.viewName.includes("prints")},attrs:{href:"/prints/"}},[e._v("Time-lapse")]):e._e(),e.user?n("b-nav-item",{class:{active:e.viewName.includes("gcodes")},attrs:{href:"/gcodes/"}},[e._v("G-Code")]):e._e(),e.user?e._e():n("b-nav-item",{staticClass:"glowing",class:{active:"publictimelapse_list"===e.viewName},attrs:{href:"/publictimelapses/"}},[e._v("Spaghetti Gallery")]),e.isEnt?n("b-nav-item",{class:{active:"pricing"===e.viewName},attrs:{href:"/ent/pricing/"}},[e._v("Pricing")]):e._e(),n("b-nav-item",{attrs:{href:"https://www.thespaghettidetective.com/help/"}},[e._v("Help")]),n("b-nav-item",{attrs:{href:"https://discord.gg/hsMwGpD"}},[e._v("Forum")])],1),n("b-navbar-nav",{staticClass:"ml-auto"},[e.user?e._e():n("b-nav-item",{attrs:{href:"/accounts/login/"}},[e._v("Sign In")]),!e.user&&e.allowSignUp?n("b-nav-item",{attrs:{href:"/accounts/signup/"}},[e._v("Sign Up")]):e._e(),e.isEnt&&e.user?n("b-nav-item",{attrs:{href:"/ent/subscription/#detective-hour-balance","link-classes":"badge-btn"}},[n("svg",{attrs:{viewBox:"0 0 384 550",width:"14.66",height:"21"}},[n("use",{attrs:{href:"#svg-detective-hours"}})]),n("span",{staticClass:"badge badge-light",attrs:{id:"user-credits"}},[e._v(e._s(e.dhBadgeNum))]),n("span",{staticClass:"sr-only"},[e._v("Detective Hours")])]):e._e(),e.user?n("b-nav-item-dropdown",{ref:"accountDropdown",attrs:{right:"","toggle-class":"user-menu",text:e.user.first_name||e.user.email}},[n("b-dropdown-item",{attrs:{href:"/user_preferences/"}},[n("i",{staticClass:"fas fa-sliders-h mr-2"}),e._v("Preferences ")]),e.isEnt?n("b-dropdown-item",{attrs:{href:"/ent/subscription/"}},[n("i",{staticClass:"far fa-user-circle mr-2"}),e._v("Account ")]):e._e(),n("b-dropdown-divider"),n("b-dropdown-item",{attrs:{href:"/accounts/logout/"}},[n("i",{staticClass:"fas fa-sign-out-alt mr-2"}),e._v("Log out ")])],1):e._e()],1)],1)],1)],1),n("b-alert",{staticClass:"text-center",attrs:{show:e.needsEmailVerification,variant:"warning"}},[e._v(" You will not get notified by email on print failure, as your primary email address is not verified. "),n("a",{attrs:{href:"/accounts/email/"}},[e._v("Verify your email address.")])])],1)},r=[],a=(n("d3b7"),n("ac1f"),n("3ca3"),n("841c"),n("2ca0"),n("ddb0"),n("2b3d"),n("c1df")),o=n.n(a),s=n("6bb8"),c=n("648b"),l={name:"Navbar",components:{},data:function(){return{user:null,allowSignUp:!1,isEnt:!1,isInMobile:!1,themes:c["a"],showMainMenu:!1}},props:{viewName:{default:function(){return""},type:String}},created:function(){var e=JSON.parse(document.querySelector("#settings-json").text),t=e.ACCOUNT_ALLOW_SIGN_UP,n=e.IS_ENT;this.allowSignUp=!!t,this.isEnt=!!n,this.user=JSON.parse(document.querySelector("#user-json").text),this.isInMobile=Object(s["a"])()||window.location.pathname.startsWith("/mobile/")||"true"===new URLSearchParams(window.location.search).get("inMobile")},computed:{theme:function(){return c["d"].value},dhBadgeNum:function(){return this.user&&this.user.is_dh_unlimited?"∞":Math.round(this.user.dh_balance)},needsEmailVerification:function(){if(!this.user)return!1;var e=o()(this.user.date_joined).isBefore(o()().subtract(15,"days"));return this.isEnt&&!this.user.is_primary_email_verified&&e}},methods:{hideDropdowns:function(){this.showMainMenu=!1;var e=this.$refs.accountDropdown;e&&e.hide()}}},d=l,u=(n("4099"),n("2877")),p=Object(u["a"])(d,i,r,!1,null,"7e52801e",null);t["a"]=p.exports},9423:function(e,t,n){"use strict";var i=n("97e2"),r=n.n(i);r.a},"97e2":function(e,t,n){},"99b8":function(e,t,n){e.exports={primary:"#9965f4",white:"#fff"}},"9be8":function(e,t,n){"use strict";var i=n("dd69"),r=n.n(i);r.a},a02b:function(e,t,n){"use strict";var i=n("4694"),r=n.n(i);r.a},a440:function(e,t,n){},adbd:function(e,t,n){e.exports=n.p+"img/octoprint_logo.png"},b01d:function(e,t,n){"use strict";var i=n("d3a4"),r=n.n(i);r.a},b543:function(e,t,n){"use strict";var i=n("2773"),r=n.n(i);r.a},b768:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"pullToRevealWrapper",staticClass:"wrapper"},[n("div",[n("div",{staticClass:"pull-to-reveal"},[e.enable?e._t("default"):e._e()],2),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showEdge,expression:"showEdge"}],staticClass:"showing-edge"}),n("div",{staticClass:"spaceholder"})]),n("div",{ref:"staticWrapper"},[e.enable?e._e():e._t("default")],2)])},r=[],a={name:"PullToReveal",props:{showEdge:{default:function(){return!1},type:Boolean},shiftContent:{default:function(){return!0},type:Boolean},enable:{default:function(){return!1},type:Boolean}},data:function(){return{status:"closed",animationTime:.5}},watch:{enable:function(e){e?(this.destroyDisabled(),this.initEnabled()):(this.destroyEnabled(),this.initDisabled())}},mounted:function(){this.enable?this.initEnabled():this.initDisabled()},destroyed:function(){this.enable?this.destroyEnabled():this.destroyDisabled()},methods:{initEnabled:function(){window.addEventListener("scroll",this.handleScroll),document.querySelector("body").style.minHeight="101vh";var e=this.$refs.pullToRevealWrapper.querySelector(".pull-to-reveal"),t=this.$refs.pullToRevealWrapper.querySelector(".spaceholder"),n=this.animationTime;e.style.transition="all ".concat(n,"s"),t.style.transition="all ".concat(n,"s"),0===window.scrollY&&window.scrollBy({top:1,behavior:"smooth"}),window.onload=function(){var t=parseInt(window.getComputedStyle(e).height);e.style.top="-".concat(2*t,"px")}},destroyEnabled:function(){if(window&&window.removeEventListener("scroll",this.handleScroll),document&&(document.querySelector("body").style.minHeight=""),this.$refs.pullToRevealWrapper){var e=this.$refs.pullToRevealWrapper.querySelector(".pull-to-reveal");e.style.transition="none",e.style.top="-999px";var t=this.$refs.pullToRevealWrapper.querySelector(".spaceholder");t.style.transition="none"}},initDisabled:function(){var e=this.$refs.pullToRevealWrapper.querySelector(".showing-edge");e.style.display="none";var t=this.$refs.staticWrapper;t.style.position="absolute",t.style.width="100%",t.style.top="0",t.style.left="0",t.style.zIndex="10",document.querySelector("body").style.paddingTop="56px",window.onload=function(){var e=parseInt(window.getComputedStyle(t).height);document.querySelector("body").style.paddingTop="".concat(e,"px")}},destroyDisabled:function(){var e=this.$refs.pullToRevealWrapper;e&&(e.querySelector(".showing-edge").style.display="block");var t=this.$refs.staticWrapper;t&&(t.style.display="none"),document&&(document.querySelector("body").style.paddingTop=0)},handleScroll:function(){var e=window.pageYOffset,t=this.$refs.pullToRevealWrapper.querySelector(".pull-to-reveal"),n=parseInt(window.getComputedStyle(t).height);if(0===e){if("opened"===this.status)return;t.style.top=0,this.status="opened",this.shiftContent&&(this.$refs.pullToRevealWrapper.querySelector(".spaceholder").style.height="".concat(n,"px"))}else{if("closed"===this.status)return;this.$emit("hide"),t.style.top="-".concat(2*n,"px"),this.status="closed",this.shiftContent&&(this.$refs.pullToRevealWrapper.querySelector(".spaceholder").style.height=0)}}}},o=a,s=(n("cd2f"),n("2877")),c=Object(s["a"])(o,i,r,!1,null,"aef3fa0c",null);t["a"]=c.exports},bac1:function(e,t,n){"use strict";var i=n("2a22"),r=n.n(i);r.a},c297:function(e,t,n){"use strict";(function(e){n("7db0"),n("4160"),n("c975"),n("a15b"),n("45fc"),n("a434"),n("b0c0"),n("d3b7"),n("ac1f"),n("8a79"),n("3ca3"),n("466d"),n("5319"),n("1276"),n("159b"),n("ddb0"),n("2b3d");var i=n("0122");a.sessions={},a.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||a.extension.isInstalled()}return!0};var r={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var n=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var i=new Error("NavigatorUserMediaError");i.name="You cancelled the request for permission, giving up...",n(i)}else n(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function a(e){if(void 0===a.initDone)return e.error("Library not initialized"),{};if(!a.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(a.log("Library initialized: "+a.initDone),e=e||{},e.success="function"==typeof e.success?e.success:a.noop,e.error="function"==typeof e.error?e.error:a.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:a.noop,null===e.server||void 0===e.server)return e.error("Invalid server url"),{};var t=!1,n=null,r={},o=null,s=null,c=0,l=e.server;a.isArray(l)?(a.log("Multiple servers provided ("+l.length+"), will use the first that works"),l=null,s=e.server,a.debug(s)):0===l.indexOf("ws")?(t=!0,a.log("Using WebSockets to contact Janus: "+l)):(t=!1,a.log("Using REST API to contact Janus: "+l));var d=e.iceServers;void 0!==d&&null!==d||(d=[{urls:"stun:stun.l.google.com:19302"}]);var u=e.iceTransportPolicy,p=e.bundlePolicy,f=e.ipv6;void 0!==f&&null!==f||(f=!1);var v=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(v=!0===e.withCredentials);var m=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(m=e.max_poll_events),m<1&&(m=1);var h=null;void 0!==e.token&&null!==e.token&&(h=e.token);var g=null;void 0!==e.apisecret&&null!==e.apisecret&&(g=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var b=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(b=e.keepAlivePeriod),isNaN(b)&&(b=25e3);var w=6e4;function y(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(w=e.longPollTimeout),isNaN(w)&&(w=6e4);var _=!1,C=null,S={},k=this,x=0,T={};function P(){if(null!=C)if(a.debug("Long poll..."),_){var t=l+"/"+C+"?rid="+(new Date).getTime();void 0!==m&&null!==m&&(t=t+"&maxev="+m),null!==h&&void 0!==h&&(t=t+"&token="+encodeURIComponent(h)),null!==g&&void 0!==g&&(t=t+"&apisecret="+encodeURIComponent(g)),a.httpAPICall(t,{verb:"GET",withCredentials:v,success:D,timeout:w,error:function(t,n){if(a.error(t+":",n),x++,x>3)return _=!1,void e.error("Lost connection to the server (is it down?)");P()}})}else a.warn("Is the server down? (connected=false)")}function D(e,i){if(x=0,t||void 0===C||null===C||!0===i||P(),t||!a.isArray(e))if("keepalive"!==e["janus"])if("ack"!==e["janus"])if("success"!==e["janus"])if("trickle"===e["janus"]){var r=e["sender"];if(void 0===r||null===r)return void a.warn("Missing sender...");var o=S[r];if(void 0===o||null===o)return void a.debug("This handle is not attached to this session");var s=e["candidate"];a.debug("Got a trickled candidate on session "+C),a.debug(s);var c=o.webrtcStuff;c.pc&&c.remoteSdp?(a.debug("Adding remote candidate:",s),s&&!0!==s.completed?c.pc.addIceCandidate(s):c.pc.addIceCandidate(a.endOfCandidates)):(a.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),c.candidates||(c.candidates=[]),c.candidates.push(s),a.debug(c.candidates))}else{if("webrtcup"===e["janus"]){a.debug("Got a webrtcup event on session "+C),a.debug(e);r=e["sender"];if(void 0===r||null===r)return void a.warn("Missing sender...");o=S[r];return void 0===o||null===o?void a.debug("This handle is not attached to this session"):void o.webrtcState(!0)}if("hangup"===e["janus"]){a.debug("Got a hangup event on session "+C),a.debug(e);r=e["sender"];if(void 0===r||null===r)return void a.warn("Missing sender...");o=S[r];if(void 0===o||null===o)return void a.debug("This handle is not attached to this session");o.webrtcState(!1,e["reason"]),o.hangup()}else if("detached"===e["janus"]){a.debug("Got a detached event on session "+C),a.debug(e);r=e["sender"];if(void 0===r||null===r)return void a.warn("Missing sender...");o=S[r];if(void 0===o||null===o)return;o.detached=!0,o.ondetached(),o.detach()}else if("media"===e["janus"]){a.debug("Got a media event on session "+C),a.debug(e);r=e["sender"];if(void 0===r||null===r)return void a.warn("Missing sender...");o=S[r];if(void 0===o||null===o)return void a.debug("This handle is not attached to this session");o.mediaState(e["type"],e["receiving"])}else if("slowlink"===e["janus"]){a.debug("Got a slowlink event on session "+C),a.debug(e);r=e["sender"];if(void 0===r||null===r)return void a.warn("Missing sender...");o=S[r];if(void 0===o||null===o)return void a.debug("This handle is not attached to this session");o.slowLink(e["uplink"],e["lost"])}else{if("error"===e["janus"]){a.error("Ooops: "+e["error"].code+" "+e["error"].reason),a.debug(e);f=e["transaction"];if(null!==f&&void 0!==f){v=T[f];null!==v&&void 0!==v&&v(e),delete T[f]}return}if("event"===e["janus"]){a.debug("Got a plugin event on session "+C),a.debug(e);r=e["sender"];if(void 0===r||null===r)return void a.warn("Missing sender...");var l=e["plugindata"];if(void 0===l||null===l)return void a.warn("Missing plugindata...");a.debug("  -- Event is coming from "+r+" ("+l["plugin"]+")");var d=l["data"];a.debug(d);o=S[r];if(void 0===o||null===o)return void a.warn("This handle is not attached to this session");var u=e["jsep"];void 0!==u&&null!==u&&(a.debug("Handling SDP as well..."),a.debug(u));var p=o.onmessage;null!==p&&void 0!==p?(a.debug("Notifying application..."),p(d,u)):a.debug("No provided notification callback")}else{if("timeout"===e["janus"])return a.error("Timeout on session "+C),a.debug(e),void(t&&n.close(3504,"Gateway timeout"));a.warn("Unknown message/event  '"+e["janus"]+"' on session "+C),a.debug(e)}}}else{a.debug("Got a success on session "+C),a.debug(e);var f=e["transaction"];if(null!==f&&void 0!==f){var v=T[f];null!==v&&void 0!==v&&v(e),delete T[f]}}else{a.debug("Got an ack on session "+C),a.debug(e);var f=e["transaction"];if(null!==f&&void 0!==f){var v=T[f];null!==v&&void 0!==v&&v(e),delete T[f]}}else a.vdebug("Got a keepalive on session "+C);else for(var m=0;m<e.length;m++)D(e[m],!0)}function A(){if(null!==l&&t&&_){o=setTimeout(A,b);var e={janus:"keepalive",session_id:C,transaction:a.randomString(12)};null!==h&&void 0!==h&&(e["token"]=h),null!==g&&void 0!==g&&(e["apisecret"]=g),n.send(JSON.stringify(e))}}function O(i){var d=a.randomString(12),u={janus:"create",transaction:d};if(i["reconnect"]&&(_=!1,u["janus"]="claim",u["session_id"]=C,n&&(n.onopen=null,n.onerror=null,n.onclose=null,o&&(clearTimeout(o),o=null))),null!==h&&void 0!==h&&(u["token"]=h),null!==g&&void 0!==g&&(u["apisecret"]=g),null===l&&a.isArray(s)&&(l=s[c],0===l.indexOf("ws")?(t=!0,a.log("Server #"+(c+1)+": trying WebSockets to contact Janus ("+l+")")):(t=!1,a.log("Server #"+(c+1)+": trying REST API to contact Janus ("+l+")"))),t)for(var p in n=a.newWebSocket(l,"janus-protocol"),r={error:function(){if(a.error("Error connecting to the Janus WebSockets server... "+l),a.isArray(s)&&!i["reconnect"])return c++,c==s.length?void i.error("Error connecting to any of the provided Janus servers: Is the server down?"):(l=null,void setTimeout((function(){O(i)}),200));i.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){T[d]=function(e){if(a.debug(e),"success"!==e["janus"])return a.error("Ooops: "+e["error"].code+" "+e["error"].reason),void i.error(e["error"].reason);o=setTimeout(A,b),_=!0,C=e["session_id"]?e["session_id"]:e.data["id"],i["reconnect"]?a.log("Claimed session: "+C):a.log("Created session: "+C),a.sessions[C]=k,i.success()},n.send(JSON.stringify(u))},message:function(e){D(JSON.parse(e.data))},close:function(){null!==l&&_&&(_=!1,e.error("Lost connection to the server (is it down?)"))}},r)n.addEventListener(p,r[p]);else a.httpAPICall(l,{verb:"POST",withCredentials:v,body:u,success:function(e){if(a.debug(e),"success"!==e["janus"])return a.error("Ooops: "+e["error"].code+" "+e["error"].reason),void i.error(e["error"].reason);_=!0,C=e["session_id"]?e["session_id"]:e.data["id"],i["reconnect"]?a.log("Claimed session: "+C):a.log("Created session: "+C),a.sessions[C]=k,P(),i.success()},error:function(e,t){if(a.error(e+":",t),a.isArray(s)&&!i["reconnect"])return c++,c==s.length?void i.error("Error connecting to any of the provided Janus servers: Is the server down?"):(l=null,void setTimeout((function(){O(i)}),200));""===t?i.error(e+": Is the server down?"):i.error(e+": "+t)}})}function E(i){i=i||{},i.success="function"==typeof i.success?i.success:a.noop;var s=!0;void 0!==i.asyncRequest&&null!==i.asyncRequest&&(s=!0===i.asyncRequest);var c=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(c=!0===i.notifyDestroyed);var d=!1;if(void 0!==i.cleanupHandles&&null!==i.cleanupHandles&&(d=!0===i.cleanupHandles),a.log("Destroying session "+C+" (async="+s+")"),!_)return a.warn("Is the server down? (connected=false)"),void i.success();if(void 0===C||null===C)return a.warn("No session to destroy"),i.success(),void(c&&e.destroyed());if(d)for(var u in S)N(u,{noRequest:!0});var p={janus:"destroy",transaction:a.randomString(12)};if(null!==h&&void 0!==h&&(p["token"]=h),null!==g&&void 0!==g&&(p["apisecret"]=g),t){p["session_id"]=C;var f=function(){for(var e in r)n.removeEventListener(e,r[e]);n.removeEventListener("message",m),n.removeEventListener("error",b),o&&clearTimeout(o),n.close()},m=function(t){var n=JSON.parse(t.data);n.session_id==p.session_id&&n.transaction==p.transaction&&(f(),i.success(),c&&e.destroyed())},b=function(t){f(),i.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return n.addEventListener("message",m),n.addEventListener("error",b),void n.send(JSON.stringify(p))}a.httpAPICall(l+"/"+C,{verb:"POST",async:s,withCredentials:v,body:p,success:function(t){a.log("Destroyed session:"),a.debug(t),C=null,_=!1,"success"!==t["janus"]&&a.error("Ooops: "+t["error"].code+" "+t["error"].reason),i.success(),c&&e.destroyed()},error:function(t,n){a.error(t+":",n),C=null,_=!1,i.success(),c&&e.destroyed()}})}function j(e){if(e=e||{},e.success="function"==typeof e.success?e.success:a.noop,e.error="function"==typeof e.error?e.error:a.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:a.noop,e.iceState="function"==typeof e.iceState?e.iceState:a.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:a.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:a.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:a.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:a.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:a.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:a.noop,e.ondata="function"==typeof e.ondata?e.ondata:a.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:a.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:a.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:a.noop,!_)return a.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var i=e.plugin;if(void 0===i||null===i)return a.error("Invalid plugin"),void e.error("Invalid plugin");var r=e.opaqueId,o=e.token?e.token:h,s=a.randomString(12),c={janus:"attach",plugin:i,opaque_id:r,transaction:s};if(null!==o&&void 0!==o&&(c["token"]=o),null!==g&&void 0!==g&&(c["apisecret"]=g),t)return T[s]=function(t){if(a.debug(t),"success"!==t["janus"])return a.error("Ooops: "+t["error"].code+" "+t["error"].reason),void e.error("Ooops: "+t["error"].code+" "+t["error"].reason);var n=t.data["id"];a.log("Created handle: "+n);var r={session:k,plugin:i,id:n,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return i},getVolume:function(){return q(n,!0)},getRemoteVolume:function(){return q(n,!0)},getLocalVolume:function(){return q(n,!1)},isAudioMuted:function(){return G(n,!1)},muteAudio:function(){return J(n,!1,!0)},unmuteAudio:function(){return J(n,!1,!1)},isVideoMuted:function(){return G(n,!0)},muteVideo:function(){return J(n,!0,!0)},unmuteVideo:function(){return J(n,!0,!1)},getBitrate:function(){return H(n)},send:function(e){I(n,e)},data:function(e){M(n,e)},dtmf:function(e){B(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){V(n,!0,e)},createAnswer:function(e){V(n,!1,e)},handleRemoteJsep:function(e){$(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ontrackmuted:e.ontrackmuted,ontrackunmuted:e.ontrackunmuted,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){Q(n,!0===e)},detach:function(e){N(n,e)}};S[n]=r,e.success(r)},c["session_id"]=C,void n.send(JSON.stringify(c));a.httpAPICall(l+"/"+C,{verb:"POST",withCredentials:v,body:c,success:function(t){if(a.debug(t),"success"!==t["janus"])return a.error("Ooops: "+t["error"].code+" "+t["error"].reason),void e.error("Ooops: "+t["error"].code+" "+t["error"].reason);var n=t.data["id"];a.log("Created handle: "+n);var r={session:k,plugin:i,id:n,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return i},getVolume:function(){return q(n,!0)},getRemoteVolume:function(){return q(n,!0)},getLocalVolume:function(){return q(n,!1)},isAudioMuted:function(){return G(n,!1)},muteAudio:function(){return J(n,!1,!0)},unmuteAudio:function(){return J(n,!1,!1)},isVideoMuted:function(){return G(n,!0)},muteVideo:function(){return J(n,!0,!0)},unmuteVideo:function(){return J(n,!0,!1)},getBitrate:function(){return H(n)},send:function(e){I(n,e)},data:function(e){M(n,e)},dtmf:function(e){B(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){V(n,!0,e)},createAnswer:function(e){V(n,!1,e)},handleRemoteJsep:function(e){$(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ontrackmuted:e.ontrackmuted,ontrackunmuted:e.ontrackunmuted,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){Q(n,!0===e)},detach:function(e){N(n,e)}};S[n]=r,e.success(r)},error:function(e,t){a.error(e+":",t)}})}function I(e,i){if(i=i||{},i.success="function"==typeof i.success?i.success:a.noop,i.error="function"==typeof i.error?i.error:a.noop,!_)return a.warn("Is the server down? (connected=false)"),void i.error("Is the server down? (connected=false)");var r=S[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return a.warn("Invalid handle"),void i.error("Invalid handle");var o=i.message,s=i.jsep,c=a.randomString(12),d={janus:"message",body:o,transaction:c};if(null!==r.token&&void 0!==r.token&&(d["token"]=r.token),null!==g&&void 0!==g&&(d["apisecret"]=g),null!==s&&void 0!==s&&(d.jsep=s),a.debug("Sending message to plugin (handle="+e+"):"),a.debug(d),t)return d["session_id"]=C,d["handle_id"]=e,T[c]=function(e){if(a.debug("Message sent!"),a.debug(e),"success"===e["janus"]){var t=e["plugindata"];if(void 0===t||null===t)return a.warn("Request succeeded, but missing plugindata..."),void i.success();a.log("Synchronous transaction successful ("+t["plugin"]+")");var n=t["data"];return a.debug(n),void i.success(n)}"ack"===e["janus"]?i.success():void 0!==e["error"]&&null!==e["error"]?(a.error("Ooops: "+e["error"].code+" "+e["error"].reason),i.error(e["error"].code+" "+e["error"].reason)):(a.error("Unknown error"),i.error("Unknown error"))},void n.send(JSON.stringify(d));a.httpAPICall(l+"/"+C+"/"+e,{verb:"POST",withCredentials:v,body:d,success:function(e){if(a.debug("Message sent!"),a.debug(e),"success"===e["janus"]){var t=e["plugindata"];if(void 0===t||null===t)return a.warn("Request succeeded, but missing plugindata..."),void i.success();a.log("Synchronous transaction successful ("+t["plugin"]+")");var n=t["data"];return a.debug(n),void i.success(n)}"ack"===e["janus"]?i.success():void 0!==e["error"]&&null!==e["error"]?(a.error("Ooops: "+e["error"].code+" "+e["error"].reason),i.error(e["error"].code+" "+e["error"].reason)):(a.error("Unknown error"),i.error("Unknown error"))},error:function(e,t){a.error(e+":",t),i.error(e+": "+t)}})}function R(e,i){if(_){var r=S[e];if(null!==r&&void 0!==r&&null!==r.webrtcStuff&&void 0!==r.webrtcStuff){var o={janus:"trickle",candidate:i,transaction:a.randomString(12)};if(null!==r.token&&void 0!==r.token&&(o["token"]=r.token),null!==g&&void 0!==g&&(o["apisecret"]=g),a.vdebug("Sending trickle candidate (handle="+e+"):"),a.vdebug(o),t)return o["session_id"]=C,o["handle_id"]=e,void n.send(JSON.stringify(o));a.httpAPICall(l+"/"+C+"/"+e,{verb:"POST",withCredentials:v,body:o,success:function(e){a.vdebug("Candidate sent!"),a.vdebug(e),"ack"===e["janus"]||a.error("Ooops: "+e["error"].code+" "+e["error"].reason)},error:function(e,t){a.error(e+":",t)}})}else a.warn("Invalid handle")}else a.warn("Is the server down? (connected=false)")}function L(e,t,n,i){var r=S[e];if(null!==r&&void 0!==r&&null!==r.webrtcStuff&&void 0!==r.webrtcStuff){var o=r.webrtcStuff;if(o.pc){var s=function(e){var t=e.target.label;r.ondata(e.data,t)},c=function(e){a.log("Received state change on data channel:",e);var t=e.target.label,n=o.dataChannel[t]?o.dataChannel[t].readyState:"null";if(a.log("State change on <"+t+"> data channel: "+n),"open"===n){if(o.dataChannel[t].pending&&o.dataChannel[t].pending.length>0){for(var i in a.log("Sending pending messages on <"+t+">:",o.dataChannel[t].pending.length),o.dataChannel[t].pending){var s=o.dataChannel[t].pending[i];a.log("Sending string on data channel <"+t+">: "+s),o.dataChannel[t].send(s)}o.dataChannel[t].pending=[]}r.ondataopen(t)}},l=function(e){a.error("Got error on data channel:",e)};o.dataChannel[t]=n||o.pc.createDataChannel(t,{ordered:!1}),o.dataChannel[t].onmessage=s,o.dataChannel[t].onopen=c,o.dataChannel[t].onclose=c,o.dataChannel[t].onerror=l,o.dataChannel[t].pending=[],i&&o.dataChannel[t].pending.push(i)}else a.warn("Invalid PeerConnection")}else a.warn("Invalid handle")}function M(e,t){t=t||{},t.success="function"==typeof t.success?t.success:a.noop,t.error="function"==typeof t.error?t.error:a.noop;var n=S[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return a.warn("Invalid handle"),void t.error("Invalid handle");var i=n.webrtcStuff,r=t.text;if(null===r||void 0===r)return a.warn("Invalid text"),void t.error("Invalid text");var o=t.label?t.label:a.dataChanDefaultLabel;return i.dataChannel[o]?"open"!==i.dataChannel[o].readyState?(i.dataChannel[o].pending.push(r),void t.success()):(a.log("Sending string on data channel <"+o+">: "+r),i.dataChannel[o].send(r),void t.success()):(L(e,o,!1,r),void t.success())}function B(e,t){t=t||{},t.success="function"==typeof t.success?t.success:a.noop,t.error="function"==typeof t.error?t.error:a.noop;var n=S[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return a.warn("Invalid handle"),void t.error("Invalid handle");var i=n.webrtcStuff;if(null===i.dtmfSender||void 0===i.dtmfSender){if(void 0!==i.pc&&null!==i.pc){var r=i.pc.getSenders(),o=r.find((function(e){return e.track&&"audio"===e.track.kind}));if(!o)return a.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");i.dtmfSender=o.dtmf,i.dtmfSender&&(a.log("Created DTMF Sender"),i.dtmfSender.ontonechange=function(e){a.debug("Sent DTMF tone: "+e.tone)})}if(null===i.dtmfSender||void 0===i.dtmfSender)return a.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var s=t.dtmf;if(null===s||void 0===s)return a.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var c=s.tones;if(null===c||void 0===c)return a.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var l=s.duration;null!==l&&void 0!==l||(l=500);var d=s.gap;null!==d&&void 0!==d||(d=50),a.debug("Sending DTMF string "+c+" (duration "+l+"ms, gap "+d+"ms)"),i.dtmfSender.insertDTMF(c,l,d),t.success()}function N(e,i){i=i||{},i.success="function"==typeof i.success?i.success:a.noop,i.error="function"==typeof i.error?i.error:a.noop;var r=!0;void 0!==i.asyncRequest&&null!==i.asyncRequest&&(r=!0===i.asyncRequest);var o=!0;void 0!==i.noRequest&&null!==i.noRequest&&(o=!0===i.noRequest),a.log("Destroying handle "+e+" (async="+r+")"),Q(e);var s=S[e];if(null===s||void 0===s||s.detached)return delete S[e],void i.success();if(o)return delete S[e],void i.success();if(!_)return a.warn("Is the server down? (connected=false)"),void i.error("Is the server down? (connected=false)");var c={janus:"detach",transaction:a.randomString(12)};if(null!==s.token&&void 0!==s.token&&(c["token"]=s.token),null!==g&&void 0!==g&&(c["apisecret"]=g),t)return c["session_id"]=C,c["handle_id"]=e,n.send(JSON.stringify(c)),delete S[e],void i.success();a.httpAPICall(l+"/"+C+"/"+e,{verb:"POST",async:r,withCredentials:v,body:c,success:function(t){a.log("Destroyed handle:"),a.debug(t),"success"!==t["janus"]&&a.error("Ooops: "+t["error"].code+" "+t["error"].reason),delete S[e],i.success()},error:function(t,n){a.error(t+":",n),delete S[e],i.success()}})}function F(e,t,n,r,o){var s=S[e];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return a.warn("Invalid handle"),void r.error("Invalid handle");var c=s.webrtcStuff;a.debug("streamsDone:",o),o&&(a.debug("  -- Audio tracks:",o.getAudioTracks()),a.debug("  -- Video tracks:",o.getVideoTracks()));var l=!1;if(c.myStream&&n.update&&!c.streamExternal){if((!n.update&&X(n)||n.update&&(n.addAudio||n.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(c.myStream.addTrack(o.getAudioTracks()[0]),a.unifiedPlan){a.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var v=null,m=c.pc.getTransceivers();if(m&&m.length>0)for(var h in m){var g=m[h];if(g.sender&&g.sender.track&&"audio"===g.sender.track.kind||g.receiver&&g.receiver.track&&"audio"===g.receiver.track.kind){v=g;break}}v&&v.sender?v.sender.replaceTrack(o.getAudioTracks()[0]):c.pc.addTrack(o.getAudioTracks()[0],o)}else a.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),c.pc.addTrack(o.getAudioTracks()[0],o);if((!n.update&&te(n)||n.update&&(n.addVideo||n.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(c.myStream.addTrack(o.getVideoTracks()[0]),a.unifiedPlan){a.log((n.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var b=null;m=c.pc.getTransceivers();if(m&&m.length>0)for(var h in m){g=m[h];if(g.sender&&g.sender.track&&"video"===g.sender.track.kind||g.receiver&&g.receiver.track&&"video"===g.receiver.track.kind){b=g;break}}b&&b.sender?b.sender.replaceTrack(o.getVideoTracks()[0]):c.pc.addTrack(o.getVideoTracks()[0],o)}else a.log((n.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),c.pc.addTrack(o.getVideoTracks()[0],o)}else c.myStream=o,l=!0;if(!c.pc){var w={iceServers:d,iceTransportPolicy:u,bundlePolicy:p};"chrome"===a.webRTCAdapter.browserDetails.browser&&(w["sdpSemantics"]=a.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var _={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===f&&_.optional.push({googIPv6:!0}),r.rtcConstraints&&"object"===Object(i["a"])(r.rtcConstraints))for(var h in a.debug("Adding custom PeerConnection constraints:",r.rtcConstraints),r.rtcConstraints)_.optional.push(r.rtcConstraints[h]);"edge"===a.webRTCAdapter.browserDetails.browser&&(w.bundlePolicy="max-bundle"),a.log("Creating PeerConnection"),a.debug(_),c.pc=new RTCPeerConnection(w,_),a.debug(c.pc),c.pc.getStats&&(c.volume={},c.bitrate.value="0 kbits/sec"),a.log("Preparing local SDP and gathering candidates (trickle="+c.trickle+")"),c.pc.oniceconnectionstatechange=function(e){c.pc&&s.iceState(c.pc.iceConnectionState)},c.pc.onicecandidate=function(t){if(null==t.candidate||"edge"===a.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)a.log("End of candidates."),c.iceDone=!0,!0===c.trickle?R(e,{completed:!0}):U(e,r);else{var n={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===c.trickle&&R(e,n)}},c.pc.ontrack=function(e){a.log("Handling Remote Track"),a.debug(e),e.streams&&(c.remoteStream=e.streams[0],s.onremotestream(c.remoteStream),e.track.onended||(a.log("Adding onended callback to track:",e.track),e.track.onended=function(e){a.log("Remote track muted/removed:",e),c.remoteStream&&(c.remoteStream.removeTrack(e.target),s.onremotestream(c.remoteStream))},e.track.onmute=function(t){s.ontrackmuted(),e.track.onended(t)},e.track.onunmute=function(e){a.log("Remote track flowing again:",e);try{c.remoteStream.addTrack(e.target),s.onremotestream(c.remoteStream),s.ontrackunmuted()}catch(t){a.error(t)}}))}}if(l&&null!==o&&void 0!==o){a.log("Adding local stream");var C=!0===r.simulcast2;o.getTracks().forEach((function(e){if(a.log("Adding local track:",e),C)if("audio"===e.kind)c.pc.addTrack(e,o);else{a.log("Enabling rid-based simulcasting:",e);var t=y(r.simulcastMaxBitrates);c.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:[{rid:"h",active:!0,maxBitrate:t.high},{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:t.low,scaleResolutionDownBy:4}]})}else c.pc.addTrack(e,o)}))}if(ae(n)&&!c.dataChannel[a.dataChanDefaultLabel]&&(a.log("Creating data channel"),L(e,a.dataChanDefaultLabel,!1),c.pc.ondatachannel=function(t){a.log("Data channel created by Janus:",t),L(e,t.channel.label,t.channel)}),c.myStream&&s.onlocalstream(c.myStream),null===t||void 0===t)W(e,n,r);else{var k=t["sdp"],x=/420029/gi,T=k.replace(x,"42e01f");a.log(T),t["sdp"]=T,c.pc.setRemoteDescription(t).then((function(){if(a.log("Remote description accepted!"),c.remoteSdp=t.sdp,c.candidates&&c.candidates.length>0){for(var i=0;i<c.candidates.length;i++){var o=c.candidates[i];a.debug("Adding remote candidate:",o),o&&!0!==o.completed?c.pc.addIceCandidate(o):c.pc.addIceCandidate(a.endOfCandidates)}c.candidates=[]}z(e,n,r)}),r.error)}}function V(e,t,n){n=n||{},n.success="function"==typeof n.success?n.success:a.noop,n.error="function"==typeof n.error?n.error:Y;var r=n.jsep;if(t&&r)return a.error("Provided a JSEP to a createOffer"),void n.error("Provided a JSEP to a createOffer");if(!t&&(!r||!r.type||!r.sdp))return a.error("A valid JSEP is required for createAnswer"),void n.error("A valid JSEP is required for createAnswer");n.media=n.media||{audio:!0,video:!0};var o=n.media,s=S[e];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return a.warn("Invalid handle"),void n.error("Invalid handle");var c=s.webrtcStuff;if(c.trickle=oe(n.trickle),void 0===c.pc||null===c.pc)o.update=!1,o.keepAudio=!1,o.keepVideo=!1;else if(void 0!==c.pc&&null!==c.pc){if(a.log("Updating existing media session"),o.update=!0,null!==n.stream&&void 0!==n.stream)n.stream!==c.myStream&&a.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,c.myStream&&c.myStream.getAudioTracks()&&c.myStream.getAudioTracks().length)return a.error("Can't add audio stream, there already is one"),void n.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(null===c.myStream||void 0===c.myStream?(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),X(o)&&(o.keepAudio=!1,o.addAudio=!0)):null===c.myStream.getAudioTracks()||void 0===c.myStream.getAudioTracks()||0===c.myStream.getAudioTracks().length?(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),X(o)&&(o.keepVideo=!1,o.addAudio=!0)):!X(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,c.myStream&&c.myStream.getVideoTracks()&&c.myStream.getVideoTracks().length)return a.error("Can't add video stream, there already is one"),void n.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);null===c.myStream||void 0===c.myStream||null===c.myStream.getVideoTracks()||void 0===c.myStream.getVideoTracks()||0===c.myStream.getVideoTracks().length?(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),te(o)&&(o.keepVideo=!1,o.addVideo=!0)):!te(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0),o.addData&&(o.data=!0)}if(X(o)&&o.keepAudio&&te(o)&&o.keepVideo)return s.consentDialog(!1),void F(e,r,o,n,c.myStream)}if(o.update&&!c.streamExternal){if(o.removeAudio||o.replaceAudio){if(c.myStream&&c.myStream.getAudioTracks()&&c.myStream.getAudioTracks().length){var l=c.myStream.getAudioTracks()[0];a.log("Removing audio track:",l),c.myStream.removeTrack(l);try{l.stop()}catch(O){}}if(c.pc.getSenders()&&c.pc.getSenders().length){var d=!0;if(o.replaceAudio&&a.unifiedPlan&&(d=!1),d)for(var u in c.pc.getSenders()){l=c.pc.getSenders()[u];l&&l.track&&"audio"===l.track.kind&&(a.log("Removing audio sender:",l),c.pc.removeTrack(l))}}}if(o.removeVideo||o.replaceVideo){if(c.myStream&&c.myStream.getVideoTracks()&&c.myStream.getVideoTracks().length){l=c.myStream.getVideoTracks()[0];a.log("Removing video track:",l),c.myStream.removeTrack(l);try{l.stop()}catch(O){}}if(c.pc.getSenders()&&c.pc.getSenders().length){var p=!0;if(o.replaceVideo&&a.unifiedPlan&&(p=!1),p)for(var u in c.pc.getSenders()){l=c.pc.getSenders()[u];l&&l.track&&"video"===l.track.kind&&(a.log("Removing video sender:",l),c.pc.removeTrack(l))}}}}if(null!==n.stream&&void 0!==n.stream){var f=n.stream;if(a.log("MediaStream provided by the application"),a.debug(f),o.update&&c.myStream&&c.myStream!==n.stream&&!c.streamExternal){try{var v=c.myStream.getTracks();for(var m in v){var h=v[m];a.log(h),null!==h&&void 0!==h&&h.stop()}}catch(O){}c.myStream=null}return c.streamExternal=!0,s.consentDialog(!1),void F(e,r,o,n,f)}if(X(o)||te(o)){if(!a.isGetUserMediaAvailable())return void n.error("getUserMedia not available");var g={mandatory:{},optional:[]};s.consentDialog(!0);var b=X(o);!0===b&&void 0!=o&&null!=o&&"object"===Object(i["a"])(o.audio)&&(b=o.audio);var w=te(o);if(!0===w&&void 0!=o&&null!=o){var y=!0===n.simulcast,_=!0===n.simulcast2;if(!y&&!_||r||void 0!==o.video&&!1!==o.video||(o.video="hires"),o.video&&"screen"!=o.video&&"window"!=o.video)if("object"===Object(i["a"])(o.video))w=o.video;else{var C=0,k=0;"lowres"===o.video?(k=240,240,C=320):"lowres-16:9"===o.video?(k=180,180,C=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(k=720,720,C=1280):"fhdres"===o.video?(k=1080,1080,C=1920):"4kres"===o.video?(k=2160,2160,C=3840):"stdres"===o.video?(k=480,480,C=640):"stdres-16:9"===o.video?(k=360,360,C=640):(a.log("Default video setting is stdres 4:3"),k=480,480,C=640),a.log("Adding media constraint:",o.video),w={height:{ideal:k},width:{ideal:C}},a.log("Adding video constraint:",w)}else if("screen"===o.video||"window"===o.video){if(o.screenshareFrameRate||(o.screenshareFrameRate=3),navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return void navigator.mediaDevices.getDisplayMedia({video:!0}).then((function(t){s.consentDialog(!1),X(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){t.addTrack(i.getAudioTracks()[0]),F(e,r,o,n,t)})):F(e,r,o,n,t)}),(function(e){s.consentDialog(!1),n.error(e)}));function x(t,i){s.consentDialog(!1),t?n.error(t):F(e,r,o,n,i)}function T(e,t,n){a.log("Adding media constraint (screen capture)"),a.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){n?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(n){e.addTrack(n.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){s.consentDialog(!1),t(e)}))}if("chrome"===a.webRTCAdapter.browserDetails.browser){var P=a.webRTCAdapter.browserDetails.version,D=33;window.navigator.userAgent.match("Linux")&&(D=35),P>=26&&P<=D?(g={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:X(o)&&!o.keepAudio},T(g,x)):a.extension.getScreen((function(e,t){if(e)return s.consentDialog(!1),n.error(e);g={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},g.video.mandatory.chromeMediaSourceId=t,T(g,x,X(o)&&!o.keepAudio)}))}else if("firefox"===a.webRTCAdapter.browserDetails.browser){if(!(a.webRTCAdapter.browserDetails.version>=33)){var A=new Error("NavigatorUserMediaError");return A.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",s.consentDialog(!1),void n.error(A)}g={video:{mozMediaSource:o.video,mediaSource:o.video},audio:X(o)&&!o.keepAudio},T(g,(function(e,t){if(x(e,t),!e)var n=t.currentTime,i=window.setInterval((function(){t||window.clearInterval(i),t.currentTime==n&&(window.clearInterval(i),t.onended&&t.onended()),n=t.currentTime}),500)}))}return}}null!==o&&void 0!==o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then((function(t){var i=t.some((function(e){return"audioinput"===e.kind})),c=re(o)||t.some((function(e){return"videoinput"===e.kind})),l=X(o),d=te(o),u=K(o),p=ne(o);if(l||d||u||p){var v=!!l&&i,m=!!d&&c;if(!v&&!m)return s.consentDialog(!1),n.error("No capture device found"),!1;if(!v&&u)return s.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!m&&p)return s.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}var h={audio:!(!i||o.keepAudio)&&b,video:!(!c||o.keepVideo)&&w};a.debug("getUserMedia constraints",h),h.audio||h.video?navigator.mediaDevices.getUserMedia(h).then((function(t){s.consentDialog(!1),F(e,r,o,n,t)})).catch((function(e){s.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})})):(s.consentDialog(!1),F(e,r,o,n,f))})).catch((function(e){s.consentDialog(!1),n.error("enumerateDevices error",e)}))}else F(e,r,o,n)}function $(e,t){t=t||{},t.success="function"==typeof t.success?t.success:a.noop,t.error="function"==typeof t.error?t.error:Y;var n=t.jsep,i=S[e];if(null===i||void 0===i||null===i.webrtcStuff||void 0===i.webrtcStuff)return a.warn("Invalid handle"),void t.error("Invalid handle");var r=i.webrtcStuff;if(void 0!==n&&null!==n){if(null===r.pc)return a.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");r.pc.setRemoteDescription(n).then((function(){if(a.log("Remote description accepted!"),r.remoteSdp=n.sdp,r.candidates&&r.candidates.length>0){for(var e=0;e<r.candidates.length;e++){var i=r.candidates[e];a.debug("Adding remote candidate:",i),i&&!0!==i.completed?r.pc.addIceCandidate(i):r.pc.addIceCandidate(a.endOfCandidates)}r.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function W(e,t,n){n=n||{},n.success="function"==typeof n.success?n.success:a.noop,n.error="function"==typeof n.error?n.error:a.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:a.noop;var i=S[e];if(null===i||void 0===i||null===i.webrtcStuff||void 0===i.webrtcStuff)return a.warn("Invalid handle"),void n.error("Invalid handle");var r=i.webrtcStuff,o=!0===n.simulcast;o?a.log("Creating offer (iceDone="+r.iceDone+", simulcast="+o+")"):a.log("Creating offer (iceDone="+r.iceDone+")");var s={};if(a.unifiedPlan){var c=null,l=null,d=r.pc.getTransceivers();if(d&&d.length>0)for(var u in d){var p=d[u];p.sender&&p.sender.track&&"audio"===p.sender.track.kind||p.receiver&&p.receiver.track&&"audio"===p.receiver.track.kind?c||(c=p):(p.sender&&p.sender.track&&"video"===p.sender.track.kind||p.receiver&&p.receiver.track&&"video"===p.receiver.track.kind)&&(l||(l=p))}var f=X(t),v=ee(t);f||v?f&&v?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",a.log("Setting audio transceiver to sendrecv:",c)):f&&!v?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",a.log("Setting audio transceiver to sendonly:",c)):!f&&v&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",a.log("Setting audio transceiver to recvonly:",c)):(c=r.pc.addTransceiver("audio",{direction:"recvonly"}),a.log("Adding recvonly audio transceiver:",c))):t.removeAudio&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",a.log("Setting audio transceiver to inactive:",c));var m=te(t),h=ie(t);m||h?m&&h?l&&(l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",a.log("Setting video transceiver to sendrecv:",l)):m&&!h?l&&(l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",a.log("Setting video transceiver to sendonly:",l)):!m&&h&&(l?(l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",a.log("Setting video transceiver to recvonly:",l)):(l=r.pc.addTransceiver("video",{direction:"recvonly"}),a.log("Adding recvonly video transceiver:",l))):t.removeVideo&&l&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive",a.log("Setting video transceiver to inactive:",l))}else s["offerToReceiveAudio"]=ee(t),s["offerToReceiveVideo"]=ie(t);var g=!0===n.iceRestart;g&&(s["iceRestart"]=!0),a.debug(s);var b=te(t);if(b&&o&&"firefox"===a.webRTCAdapter.browserDetails.browser){a.log("Enabling Simulcasting for Firefox (RID)");var w=r.pc.getSenders().find((function(e){return"video"==e.track.kind}));if(w){var _=w.getParameters();_||(_={});var C=y(n.simulcastMaxBitrates);_.encodings=[{rid:"h",active:!0,maxBitrate:C.high},{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:C.low,scaleResolutionDownBy:4}],w.setParameters(_)}}r.pc.createOffer(s).then((function(e){a.debug(e);var t={type:e.type,sdp:e.sdp};n.customizeSdp(t),e.sdp=t.sdp,a.log("Setting local description"),b&&o&&("chrome"===a.webRTCAdapter.browserDetails.browser||"safari"===a.webRTCAdapter.browserDetails.browser?(a.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=Z(e.sdp)):"firefox"!==a.webRTCAdapter.browserDetails.browser&&a.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp=e.sdp,r.pc.setLocalDescription(e).catch(n.error),r.mediaConstraints=s,r.iceDone||r.trickle?(a.log("Offer ready"),a.debug(n),n.success(e)):a.log("Waiting for all candidates...")}),n.error)}function z(e,t,n){n=n||{},n.success="function"==typeof n.success?n.success:a.noop,n.error="function"==typeof n.error?n.error:a.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:a.noop;var i=S[e];if(null===i||void 0===i||null===i.webrtcStuff||void 0===i.webrtcStuff)return a.warn("Invalid handle"),void n.error("Invalid handle");var r=i.webrtcStuff,o=!0===n.simulcast;o?a.log("Creating answer (iceDone="+r.iceDone+", simulcast="+o+")"):a.log("Creating answer (iceDone="+r.iceDone+")");var s=null;if(a.unifiedPlan){s={};var c=null,l=null,d=r.pc.getTransceivers();if(d&&d.length>0)for(var u in d){var p=d[u];p.sender&&p.sender.track&&"audio"===p.sender.track.kind||p.receiver&&p.receiver.track&&"audio"===p.receiver.track.kind?c||(c=p):(p.sender&&p.sender.track&&"video"===p.sender.track.kind||p.receiver&&p.receiver.track&&"video"===p.receiver.track.kind)&&(l||(l=p))}var f=X(t),v=ee(t);if(f||v){if(f&&v){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",a.log("Setting audio transceiver to sendrecv:",c)}catch(C){a.error(C)}}else if(f&&!v)try{c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",a.log("Setting audio transceiver to sendonly:",c))}catch(C){a.error(C)}else if(!f&&v)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",a.log("Setting audio transceiver to recvonly:",c)}catch(C){a.error(C)}else c=r.pc.addTransceiver("audio",{direction:"recvonly"}),a.log("Adding recvonly audio transceiver:",c)}else if(t.removeAudio&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",a.log("Setting audio transceiver to inactive:",c)}catch(C){a.error(C)}var m=te(t),h=ie(t);if(m||h){if(m&&h){if(l)try{l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",a.log("Setting video transceiver to sendrecv:",l)}catch(C){a.error(C)}}else if(m&&!h){if(l)try{l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",a.log("Setting video transceiver to sendonly:",l)}catch(C){a.error(C)}}else if(!m&&h)if(l)try{l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",a.log("Setting video transceiver to recvonly:",l)}catch(C){a.error(C)}else l=r.pc.addTransceiver("video",{direction:"recvonly"}),a.log("Adding recvonly video transceiver:",l)}else if(t.removeVideo&&l)try{l.setDirection?l.setDirection("inactive"):l.direction="inactive",a.log("Setting video transceiver to inactive:",l)}catch(C){a.error(C)}}else s="firefox"==a.webRTCAdapter.browserDetails.browser||"edge"==a.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:ee(t),offerToReceiveVideo:ie(t)}:{mandatory:{OfferToReceiveAudio:ee(t),OfferToReceiveVideo:ie(t)}};a.debug(s);var g=te(t);if(g&&o&&"firefox"===a.webRTCAdapter.browserDetails.browser){a.log("Enabling Simulcasting for Firefox (RID)");var b=r.pc.getSenders()[1];a.log(b);var w=b.getParameters();a.log(w);var _=y(n.simulcastMaxBitrates);b.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:_.high},{rid:"medium",active:!0,priority:"medium",maxBitrate:_.medium},{rid:"low",active:!0,priority:"low",maxBitrate:_.low}]})}r.pc.createAnswer(s).then((function(e){a.debug(e);var t={type:e.type,sdp:e.sdp};n.customizeSdp(t),e.sdp=t.sdp,a.log("Setting local description"),g&&o&&("chrome"===a.webRTCAdapter.browserDetails.browser?a.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==a.webRTCAdapter.browserDetails.browser&&a.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp=e.sdp,r.pc.setLocalDescription(e).catch(n.error),r.mediaConstraints=s,r.iceDone||r.trickle?n.success(e):a.log("Waiting for all candidates...")}),n.error)}function U(e,t){t=t||{},t.success="function"==typeof t.success?t.success:a.noop,t.error="function"==typeof t.error?t.error:a.noop;var n=S[e];if(null!==n&&void 0!==n&&null!==n.webrtcStuff&&void 0!==n.webrtcStuff){var i=n.webrtcStuff;a.log("Sending offer/answer SDP..."),null!==i.mySdp&&void 0!==i.mySdp?(i.mySdp={type:i.pc.localDescription.type,sdp:i.pc.localDescription.sdp},!1===i.trickle&&(i.mySdp["trickle"]=!1),a.debug(t),i.sdpSent=!0,t.success(i.mySdp)):a.warn("Local SDP instance is invalid, not sending anything...")}else a.warn("Invalid handle, not sending anything")}function q(e,t){var n=S[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return a.warn("Invalid handle"),0;var i=t?"remote":"local",r=n.webrtcStuff;return r.volume[i]||(r.volume[i]={value:0}),r.pc.getStats&&"chrome"===a.webRTCAdapter.browserDetails.browser?!t||null!==r.remoteStream&&void 0!==r.remoteStream?t||null!==r.myStream&&void 0!==r.myStream?null===r.volume[i].timer||void 0===r.volume[i].timer?(a.log("Starting "+i+" volume monitor"),r.volume[i].timer=setInterval((function(){r.pc.getStats((function(e){for(var n=e.result(),a=0;a<n.length;a++){var o=n[a];"ssrc"==o.type&&(t&&o.stat("audioOutputLevel")?r.volume[i].value=parseInt(o.stat("audioOutputLevel")):!t&&o.stat("audioInputLevel")&&(r.volume[i].value=parseInt(o.stat("audioInputLevel"))))}}))}),200),0):r.volume[i].value:(a.warn("Local stream unavailable"),0):(a.warn("Remote stream unavailable"),0):(a.warn("Getting the "+i+" volume unsupported by browser"),0)}function G(e,t){var n=S[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return a.warn("Invalid handle"),!0;var i=n.webrtcStuff;return null===i.pc||void 0===i.pc?(a.warn("Invalid PeerConnection"),!0):void 0===i.myStream||null===i.myStream?(a.warn("Invalid local MediaStream"),!0):t?null===i.myStream.getVideoTracks()||void 0===i.myStream.getVideoTracks()||0===i.myStream.getVideoTracks().length?(a.warn("No video track"),!0):!i.myStream.getVideoTracks()[0].enabled:null===i.myStream.getAudioTracks()||void 0===i.myStream.getAudioTracks()||0===i.myStream.getAudioTracks().length?(a.warn("No audio track"),!0):!i.myStream.getAudioTracks()[0].enabled}function J(e,t,n){var i=S[e];if(null===i||void 0===i||null===i.webrtcStuff||void 0===i.webrtcStuff)return a.warn("Invalid handle"),!1;var r=i.webrtcStuff;return null===r.pc||void 0===r.pc?(a.warn("Invalid PeerConnection"),!1):void 0===r.myStream||null===r.myStream?(a.warn("Invalid local MediaStream"),!1):t?null===r.myStream.getVideoTracks()||void 0===r.myStream.getVideoTracks()||0===r.myStream.getVideoTracks().length?(a.warn("No video track"),!1):(r.myStream.getVideoTracks()[0].enabled=!n,!0):null===r.myStream.getAudioTracks()||void 0===r.myStream.getAudioTracks()||0===r.myStream.getAudioTracks().length?(a.warn("No audio track"),!1):(r.myStream.getAudioTracks()[0].enabled=!n,!0)}function H(e){var t=S[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return a.warn("Invalid handle"),"Invalid handle";var n=t.webrtcStuff;return null===n.pc||void 0===n.pc?"Invalid PeerConnection":n.pc.getStats?null===n.bitrate.timer||void 0===n.bitrate.timer?(a.log("Starting bitrate timer (via getStats)"),n.bitrate.timer=setInterval((function(){n.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(n.bitrate.bsnow=e.bytesReceived,n.bitrate.tsnow=e.timestamp,null===n.bitrate.bsbefore||null===n.bitrate.tsbefore)n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow;else{var i=n.bitrate.tsnow-n.bitrate.tsbefore;"safari"==a.webRTCAdapter.browserDetails.browser&&(i/=1e3);var r=Math.round(8*(n.bitrate.bsnow-n.bitrate.bsbefore)/i);"safari"===a.webRTCAdapter.browserDetails.browser&&(r=parseInt(r/1e3)),n.bitrate.value=r+" kbits/sec",n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):n.bitrate.value:(a.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")}function Y(e){a.error("WebRTC error:",e)}function Q(e,i){a.log("Cleaning WebRTC stuff");var r=S[e];if(null!==r&&void 0!==r){var o=r.webrtcStuff;if(null!==o&&void 0!==o){if(!0===i){var s={janus:"hangup",transaction:a.randomString(12)};null!==r.token&&void 0!==r.token&&(s["token"]=r.token),null!==g&&void 0!==g&&(s["apisecret"]=g),a.debug("Sending hangup request (handle="+e+"):"),a.debug(s),t?(s["session_id"]=C,s["handle_id"]=e,n.send(JSON.stringify(s))):a.httpAPICall(l+"/"+C+"/"+e,{verb:"POST",withCredentials:v,body:s})}o.remoteStream=null,o.volume&&(o.volume["local"]&&o.volume["local"].timer&&clearInterval(o.volume["local"].timer),o.volume["remote"]&&o.volume["remote"].timer&&clearInterval(o.volume["remote"].timer)),o.volume={},o.bitrate.timer&&clearInterval(o.bitrate.timer),o.bitrate.timer=null,o.bitrate.bsnow=null,o.bitrate.bsbefore=null,o.bitrate.tsnow=null,o.bitrate.tsbefore=null,o.bitrate.value=null;try{if(!o.streamExternal&&null!==o.myStream&&void 0!==o.myStream){a.log("Stopping local stream tracks");var c=o.myStream.getTracks();for(var d in c){var u=c[d];a.log(u),null!==u&&void 0!==u&&u.stop()}}}catch(p){}o.streamExternal=!1,o.myStream=null;try{o.pc.close()}catch(p){}o.pc=null,o.candidates=null,o.mySdp=null,o.remoteSdp=null,o.iceDone=!1,o.dataChannel={},o.dtmfSender=null}r.oncleanup()}}function Z(e){for(var t=e.split("\r\n"),n=!1,i=[-1],r=[-1],o=null,s=null,c=null,l=null,d=-1,u=0;u<t.length;u++){var p=t[u].match(/m=(\w+) */);if(p){var f=p[1];if("video"===f){if(!(i[0]<0)){d=u;break}n=!0}else if(i[0]>-1){d=u;break}}else if(n){var v=t[u].match(/a=ssrc-group:FID (\d+) (\d+)/);if(v)i[0]=v[1],r[0]=v[2],t.splice(u,1),u--;else{if(i[0]){var m=t[u].match("a=ssrc:"+i[0]+" cname:(.+)");if(m&&(o=m[1]),m=t[u].match("a=ssrc:"+i[0]+" msid:(.+)"),m&&(s=m[1]),m=t[u].match("a=ssrc:"+i[0]+" mslabel:(.+)"),m&&(c=m[1]),m=t[u].match("a=ssrc:"+i[0]+" label:(.+)"),m&&(l=m[1]),0===t[u].indexOf("a=ssrc:"+r[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+i[0])){t.splice(u,1),u--;continue}}0!=t[u].length||(t.splice(u,1),u--)}}}if(i[0]<0){d=-1,n=!1;for(u=0;u<t.length;u++){p=t[u].match(/m=(\w+) */);if(p){f=p[1];if("video"===f){if(!(i[0]<0)){d=u;break}n=!0}else if(i[0]>-1){d=u;break}}else if(n){if(i[0]<0){var h=t[u].match(/a=ssrc:(\d+)/);if(h){i[0]=h[1],t.splice(u,1),u--;continue}}else{m=t[u].match("a=ssrc:"+i[0]+" cname:(.+)");if(m&&(o=m[1]),m=t[u].match("a=ssrc:"+i[0]+" msid:(.+)"),m&&(s=m[1]),m=t[u].match("a=ssrc:"+i[0]+" mslabel:(.+)"),m&&(c=m[1]),m=t[u].match("a=ssrc:"+i[0]+" label:(.+)"),m&&(l=m[1]),0===t[u].indexOf("a=ssrc:"+r[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+i[0])){t.splice(u,1),u--;continue}}0!=t[u].length||(t.splice(u,1),u--)}}}if(i[0]<0)return a.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;d<0&&(d=t.length),i[1]=Math.floor(4294967295*Math.random()),i[2]=Math.floor(4294967295*Math.random()),r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random());for(u=0;u<i.length;u++)o&&(t.splice(d,0,"a=ssrc:"+i[u]+" cname:"+o),d++),s&&(t.splice(d,0,"a=ssrc:"+i[u]+" msid:"+s),d++),c&&(t.splice(d,0,"a=ssrc:"+i[u]+" mslabel:"+c),d++),l&&(t.splice(d,0,"a=ssrc:"+i[u]+" label:"+l),d++),o&&(t.splice(d,0,"a=ssrc:"+r[u]+" cname:"+o),d++),s&&(t.splice(d,0,"a=ssrc:"+r[u]+" msid:"+s),d++),c&&(t.splice(d,0,"a=ssrc:"+r[u]+" mslabel:"+c),d++),l&&(t.splice(d,0,"a=ssrc:"+r[u]+" label:"+l),d++);return t.splice(d,0,"a=ssrc-group:FID "+i[2]+" "+r[2]),t.splice(d,0,"a=ssrc-group:FID "+i[1]+" "+r[1]),t.splice(d,0,"a=ssrc-group:FID "+i[0]+" "+r[0]),t.splice(d,0,"a=ssrc-group:SIM "+i[0]+" "+i[1]+" "+i[2]),e=t.join("\r\n"),e.endsWith("\r\n")||(e+="\r\n"),e}function X(e){return a.debug("isAudioSendEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function K(e){return a.debug("isAudioSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}function ee(e){return a.debug("isAudioRecvEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function te(e){return a.debug("isVideoSendEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function ne(e){return a.debug("isVideoSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}function ie(e){return a.debug("isVideoRecvEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}function re(e){if(a.debug("isScreenSendEnabled:",e),void 0===e||null===e)return!1;if("object"!==Object(i["a"])(e.video)||"object"!==Object(i["a"])(e.video.mandatory))return!1;var t=e.video.mandatory;return t.chromeMediaSource?"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource:t.mozMediaSource?"window"===t.mozMediaSource||"screen"===t.mozMediaSource:!!t.mediaSource&&("window"===t.mediaSource||"screen"===t.mediaSource)}function ae(e){return a.debug("isDataEnabled:",e),"edge"==a.webRTCAdapter.browserDetails.browser?(a.warn("Edge doesn't support data channels yet"),!1):void 0!==e&&null!==e&&!0===e.data}function oe(e){return a.debug("isTrickleEnabled:",e),void 0===e||null===e||!0===e}O(e),this.getServer=function(){return l},this.isConnected=function(){return _},this.reconnect=function(e){e=e||{},e.success="function"==typeof e.success?e.success:a.noop,e.error="function"==typeof e.error?e.error:a.noop,e["reconnect"]=!0,O(e)},this.getSessionId=function(){return C},this.destroy=function(e){E(e)},this.attach=function(e){j(e)}}a.useDefaultDependencies=function(t){var n=t&&t.fetch||fetch,o=t&&t.Promise||Promise,s=t&&t.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new s(e,t)},extension:t&&t.extension||r,isArray:function(e){return Array.isArray(e)},webRTCAdapter:t&&t.adapter||e,httpAPICall:function(e,t){var r={method:t.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===t.verb&&(r.headers["Content-Type"]="application/json"),void 0!==t.withCredentials&&(r.credentials=!0===t.withCredentials?"include":t.withCredentials?t.withCredentials:"omit"),void 0!==t.body&&(r.body=JSON.stringify(t.body));var s=n(e,r).catch((function(e){return o.reject({message:"Probably a network error, is the server down?",error:e})}));if(void 0!==t.timeout){var c=new o((function(e,n){var i=setTimeout((function(){return clearTimeout(i),n({message:"Request timed out",timeout:t.timeout})}),t.timeout)}));s=o.race([s,c])}return s.then((function(e){return e.ok?Object(i["a"])(t.success)===Object(i["a"])(a.noop)?e.json().then((function(e){t.success(e)})).catch((function(t){return o.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:o.reject({message:"API call failed",response:e})})).catch((function(e){Object(i["a"])(t.error)===Object(i["a"])(a.noop)&&t.error(e.message||"<< internal error >>",e)})),s}}},a.useOldDependencies=function(t){var n=t&&t.jQuery||jQuery,o=t&&t.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new o(e,t)},isArray:function(e){return n.isArray(e)},extension:t&&t.extension||r,webRTCAdapter:t&&t.adapter||e,httpAPICall:function(e,t){var r=void 0!==t.body?{contentType:"application/json",data:JSON.stringify(t.body)}:{},o=void 0!==t.withCredentials?{xhrFields:{withCredentials:t.withCredentials}}:{};return n.ajax(n.extend(r,o,{url:e,type:t.verb,cache:!1,dataType:"json",async:t.async,timeout:t.timeout,success:function(e){Object(i["a"])(t.success)===Object(i["a"])(a.noop)&&t.success(e)},error:function(e,n,r){Object(i["a"])(t.error)===Object(i["a"])(a.noop)&&t.error(n,r)}}))}}},a.noop=function(){},a.dataChanDefaultLabel="JanusDataChannel",a.endOfCandidates=null,a.init=function(e){if(e=e||{},e.callback="function"==typeof e.callback?e.callback:a.noop,!0===a.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),a.trace=a.noop,a.debug=a.noop,a.vdebug=a.noop,a.log=a.noop,a.warn=a.noop,a.error=a.noop,!0===e.debug||"all"===e.debug)a.trace=console.trace.bind(console),a.debug=console.debug.bind(console),a.vdebug=console.debug.bind(console),a.log=console.log.bind(console),a.warn=console.warn.bind(console),a.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var t in e.debug){var n=e.debug[t];switch(n){case"trace":a.trace=console.trace.bind(console);break;case"debug":a.debug=console.debug.bind(console);break;case"vdebug":a.vdebug=console.debug.bind(console);break;case"log":a.log=console.log.bind(console);break;case"warn":a.warn=console.warn.bind(console);break;case"error":a.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+n+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')");break}}a.log("Initializing library");var i=e.dependencies||a.useDefaultDependencies();a.isArray=i.isArray,a.webRTCAdapter=i.webRTCAdapter,a.httpAPICall=i.httpAPICall,a.newWebSocket=i.newWebSocket,a.extension=i.extension,a.extension.init(),a.listDevices=function(e,t){e="function"==typeof e?e:a.noop,null==t&&(t={audio:!0,video:!0}),a.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(n){a.debug(n),e(n);try{var i=t.getTracks();for(var r in i){var o=i[r];null!==o&&void 0!==o&&o.stop()}}catch(s){}}))})).catch((function(t){a.error(t),e([])})):(a.warn("navigator.mediaDevices unavailable"),e([]))},a.attachMediaStream=function(e,t){if("chrome"===a.webRTCAdapter.browserDetails.browser){var n=a.webRTCAdapter.browserDetails.version;n>=52?e.srcObject=t:"undefined"!==typeof e.src?e.src=URL.createObjectURL(t):a.error("Error attaching stream to element")}else e.srcObject=t},a.reattachMediaStream=function(e,t){if("chrome"===a.webRTCAdapter.browserDetails.browser){var n=a.webRTCAdapter.browserDetails.version;n>=52?e.srcObject=t.srcObject:"undefined"!==typeof e.src?e.src=t.src:a.error("Error reattaching stream to element")}else e.srcObject=t.srcObject};var r=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0,o=r?"pagehide":"beforeunload",s=window["on"+o];if(window.addEventListener(o,(function(e){for(var t in a.log("Closing window"),a.sessions)null!==a.sessions[t]&&void 0!==a.sessions[t]&&a.sessions[t].destroyOnUnload&&(a.log("Destroying session "+t),a.sessions[t].destroy({asyncRequest:!1,notifyDestroyed:!1}));s&&"function"==typeof s&&s()})),a.safariVp8=!1,"safari"===a.webRTCAdapter.browserDetails.browser&&a.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var t in RTCRtpSender.getCapabilities("video").codecs){var c=RTCRtpSender.getCapabilities("video").codecs[t];if(c&&c.mimeType&&"video/vp8"===c.mimeType.toLowerCase()){a.safariVp8=!0;break}}a.safariVp8?a.log("This version of Safari supports VP8"):a.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var l=new RTCPeerConnection({},{});l.createOffer({offerToReceiveVideo:!0}).then((function(e){a.safariVp8=-1!==e.sdp.indexOf("VP8"),a.safariVp8?a.log("This version of Safari supports VP8"):a.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),l.close(),l=null}))}if(a.unifiedPlan=!1,"firefox"===a.webRTCAdapter.browserDetails.browser&&a.webRTCAdapter.browserDetails.version>=59)a.unifiedPlan=!0;else if("chrome"===a.webRTCAdapter.browserDetails.browser&&a.webRTCAdapter.browserDetails.version<72)a.unifiedPlan=!1;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var d=new RTCPeerConnection;try{d.addTransceiver("audio"),a.unifiedPlan=!0}catch(u){}d.close()}else a.unifiedPlan=!1;a.initDone=!0,e.callback()}},a.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection},a.isGetUserMediaAvailable=function(){return void 0!==navigator.mediaDevices&&null!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&null!==navigator.mediaDevices.getUserMedia},a.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",i=0;i<e;i++){var r=Math.floor(Math.random()*t.length);n+=t.substring(r,r+1)}return n},t["a"]=a}).call(this,n("d093"))},c2fe:function(e,t,n){},c504:function(e,t,n){},cb3d:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"saving-in-progress":e.savingClass,"successfully-saved":e.savingDoneClass,"failed-to-save":e.savingFailedClass,"small-height":e.smallHeightClass}},[e._t("default"),e.errors&&e.errors.length>0?n("small",{staticClass:"text-danger"},[e._v(e._s(e.errorMsg))]):e._e()],2)},r=[],a=(n("a15b"),{name:"SavingAnimation",data:function(){return{savingTimeout:null,savingDoneTimeout:null}},props:{saving:{default:function(){return!1},type:Boolean},errors:{type:Array},height:{default:function(){return"normal"},type:String}},watch:{saving:function(e,t){var n=this;!t&&e?(this.clearSavingTimeout(),this.savingTimeout=setTimeout(this.clearSavingTimeout,15e3)):t&&!e&&(this.clearSavingTimeout(),this.savingDoneTimeout=setTimeout((function(){clearTimeout(n.savingDoneTimeout),n.savingDoneTimeout=null}),2e3))}},computed:{savingClass:function(){return this.saving&&this.savingTimeout},savingDoneClass:function(){return!this.saving&&this.savingDoneTimeout&&!this.errors},savingFailedClass:function(){return!this.saving&&this.savingDoneTimeout&&this.errors&&this.errors.length>0},smallHeightClass:function(){return"small"===this.height},errorMsg:function(){return this.errors.join(" ")}},methods:{clearSavingTimeout:function(){this.savingTimeout&&(clearTimeout(this.savingTimeout),this.savingTimeout=null)}}}),o=a,s=(n("471f"),n("2877")),c=Object(s["a"])(o,i,r,!1,null,"64ab9070",null);t["a"]=c.exports},cd2f:function(e,t,n){"use strict";var i=n("1853"),r=n.n(i);r.a},d039f:function(e,t,n){},d10a:function(e,t,n){},d3a4:function(e,t,n){},d9ae:function(e,t,n){"use strict";var i=n("db4a"),r=n.n(i);r.a},db4a:function(e,t,n){},dd69:function(e,t,n){},e087:function(e,t,n){},e51e:function(e,t,n){},e644:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"row justify-content-center"},[n("pull-to-reveal",[n("navbar",{attrs:{"view-name":"app.views.web_views.edit_printer"}})],1),n("div",{staticClass:"col-sm-11 col-md-10 col-lg-8"},[e.printer?n("div",{staticClass:"form-container"},[n("section",{staticClass:"settings"},[n("h2",{staticClass:"section-title"},[e._v("Settings")]),n("div",{staticClass:"form-group mb-4 mt-4"},[n("div",{staticClass:"form-label text-muted mb-2"},[e._v("Give your shiny new printer a name")]),n("saving-animation",{attrs:{errors:e.errorMessages.name,saving:e.saving.name}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.name,expression:"printer.name"}],staticClass:"form-control field_required",attrs:{id:"id_name",type:"text",name:"name",maxlength:"200",placeholder:"",required:"required"},domProps:{value:e.printer.name},on:{input:function(t){t.target.composing||e.$set(e.printer,"name",t.target.value)}}})])],1),n("div",{staticClass:"failure-notification"},[n("div",{staticClass:"form-group mt-4 mb-4"},[n("div",{staticClass:"form-label text-muted"},[e._v("When a potential failure is detected:")]),n("saving-animation",{attrs:{errors:e.errorMessages.action_on_failure_NONE,saving:e.saving.action_on_failure_NONE}},[n("div",{staticClass:"custom-control custom-radio mt-1 radio"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.action_on_failure,expression:"printer.action_on_failure"}],staticClass:"custom-control-input field_required",attrs:{type:"radio",name:"action_on_failure",id:"id_action_on_failure_0",value:"NONE"},domProps:{checked:e._q(e.printer.action_on_failure,"NONE")},on:{change:[function(t){return e.$set(e.printer,"action_on_failure","NONE")},function(t){return e.updateSetting("action_on_failure")}]}}),n("label",{staticClass:"custom-control-label",attrs:{for:"id_action_on_failure_0"}},[e._v("Just notify me")])])]),n("saving-animation",{attrs:{errors:e.errorMessages.action_on_failure_PAUSE,saving:e.saving.action_on_failure_PAUSE}},[n("div",{staticClass:"custom-control custom-radio mt-1 radio",attrs:{id:"action_on_failure_PAUSE"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.action_on_failure,expression:"printer.action_on_failure"}],staticClass:"custom-control-input field_required",attrs:{type:"radio",name:"action_on_failure",id:"id_action_on_failure_1",value:"PAUSE"},domProps:{checked:e._q(e.printer.action_on_failure,"PAUSE")},on:{change:[function(t){return e.$set(e.printer,"action_on_failure","PAUSE")},function(t){return e.updateSetting("action_on_failure")}]}}),n("label",{staticClass:"custom-control-label",attrs:{for:"id_action_on_failure_1"}},[e._v("Pause the printer and notify me")])])])],1)])]),n("section",{staticClass:"mt-5"},[n("h2",{staticClass:"section-title"},[e._v("Failure Detection")]),n("div",{staticClass:"card-body p-0 pt-3"},[e._m(0),n("div",{staticClass:"form-group mt-4"},[n("div",{staticClass:"form-label text-muted"},[e._v("When print is paused,")]),n("saving-animation",{attrs:{errors:e.errorMessages.tools_off_on_pause,saving:e.saving.tools_off_on_pause}},[n("div",{staticClass:"custom-control custom-checkbox form-check-inline mt-2 checkbox"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.tools_off_on_pause,expression:"printer.tools_off_on_pause"}],staticClass:"custom-control-input",attrs:{type:"checkbox",name:"tools_off_on_pause",id:"id_tools_off_on_pause"},domProps:{checked:Array.isArray(e.printer.tools_off_on_pause)?e._i(e.printer.tools_off_on_pause,null)>-1:e.printer.tools_off_on_pause},on:{change:[function(t){var n=e.printer.tools_off_on_pause,i=t.target,r=!!i.checked;if(Array.isArray(n)){var a=null,o=e._i(n,a);i.checked?o<0&&e.$set(e.printer,"tools_off_on_pause",n.concat([a])):o>-1&&e.$set(e.printer,"tools_off_on_pause",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.printer,"tools_off_on_pause",r)},function(t){return e.updateSetting("tools_off_on_pause")}]}}),n("label",{staticClass:"custom-control-label",attrs:{for:"id_tools_off_on_pause"}},[e._v(" Turn off hotend heater(s) ")])])]),n("saving-animation",{attrs:{errors:e.errorMessages.bed_off_on_pause,saving:e.saving.bed_off_on_pause}},[n("div",{staticClass:"custom-control custom-checkbox form-check-inline mt-2 checkbox"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.bed_off_on_pause,expression:"printer.bed_off_on_pause"}],staticClass:"custom-control-input",attrs:{type:"checkbox",name:"bed_off_on_pause",id:"id_bed_off_on_pause"},domProps:{checked:Array.isArray(e.printer.bed_off_on_pause)?e._i(e.printer.bed_off_on_pause,null)>-1:e.printer.bed_off_on_pause},on:{change:[function(t){var n=e.printer.bed_off_on_pause,i=t.target,r=!!i.checked;if(Array.isArray(n)){var a=null,o=e._i(n,a);i.checked?o<0&&e.$set(e.printer,"bed_off_on_pause",n.concat([a])):o>-1&&e.$set(e.printer,"bed_off_on_pause",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.printer,"bed_off_on_pause",r)},function(t){return e.updateSetting("bed_off_on_pause")}]}}),n("label",{staticClass:"custom-control-label",attrs:{for:"id_bed_off_on_pause"}},[e._v(" Turn off bed heater ")])])]),n("saving-animation",{staticClass:"mobile-full-width",attrs:{errors:e.errorMessages.retract_on_pause,saving:e.saving.retract_on_pause}},[n("div",{staticClass:"form-inline my-1 checkbox-with-input"},[n("div",{staticClass:"custom-control custom-checkbox form-check-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.retractFilamentByEnabled,expression:"retractFilamentByEnabled"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"retract-checkbox"},domProps:{checked:Array.isArray(e.retractFilamentByEnabled)?e._i(e.retractFilamentByEnabled,null)>-1:e.retractFilamentByEnabled},on:{change:function(t){var n=e.retractFilamentByEnabled,i=t.target,r=!!i.checked;if(Array.isArray(n)){var a=null,o=e._i(n,a);i.checked?o<0&&(e.retractFilamentByEnabled=n.concat([a])):o>-1&&(e.retractFilamentByEnabled=n.slice(0,o).concat(n.slice(o+1)))}else e.retractFilamentByEnabled=r}}}),n("label",{staticClass:"custom-control-label",attrs:{for:"retract-checkbox"}},[e._v("Retract filament by")])]),n("number-input",{attrs:{step:.5,disable:!e.retractFilamentByEnabled},model:{value:e.retractOnPause,callback:function(t){e.retractOnPause=t},expression:"retractOnPause"}})],1)]),n("saving-animation",{staticClass:"mobile-full-width",attrs:{errors:e.errorMessages.lift_z_on_pause,saving:e.saving.lift_z_on_pause}},[n("div",{staticClass:"form-inline my-1 checkbox-with-input"},[n("div",{staticClass:"custom-control custom-checkbox form-check-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.liftExtruderByEnabled,expression:"liftExtruderByEnabled"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"lift-z-checkbox"},domProps:{checked:Array.isArray(e.liftExtruderByEnabled)?e._i(e.liftExtruderByEnabled,null)>-1:e.liftExtruderByEnabled},on:{change:function(t){var n=e.liftExtruderByEnabled,i=t.target,r=!!i.checked;if(Array.isArray(n)){var a=null,o=e._i(n,a);i.checked?o<0&&(e.liftExtruderByEnabled=n.concat([a])):o>-1&&(e.liftExtruderByEnabled=n.slice(0,o).concat(n.slice(o+1)))}else e.liftExtruderByEnabled=r}}}),n("label",{staticClass:"custom-control-label",attrs:{for:"lift-z-checkbox"}},[e._v("Lift extruder along Z axis by")])]),n("number-input",{attrs:{step:.5,disable:!e.liftExtruderByEnabled},model:{value:e.liftExtruderBy,callback:function(t){e.liftExtruderBy=t},expression:"liftExtruderBy"}})],1)])],1),n("div",{staticClass:"form-group sensitivity my-4"},[n("div",{staticClass:"form-label text-muted"},[e._v("How sensitive do you want the Detective to be on this printer?")]),n("saving-animation",{attrs:{errors:e.errorMessages.detective_sensitivity,saving:e.saving.detective_sensitivity}},[n("div",{staticClass:"my-2 sensitivity-slider"},[n("input",{attrs:{id:"id_sensitivity",name:"detective_sensitivity","data-slider-id":"sensitivity-slider",type:"text","data-slider-min":"0.8","data-slider-max":"1.2","data-slider-step":"0.05","data-slider-value":e.printer.detective_sensitivity}})])]),n("div",{staticClass:"hint-low"},[e._v(" Low - I don't want a lot of false alarms. Only alert me when you are absolutely sure. ")]),n("div",{staticClass:"hint-medium"},[e._v(" Medium - A few false alarms won't bother me. But some well-disguised spaghetti will be missed. ")]),n("div",{staticClass:"hint-high"},[e._v(" High - Hit me with all the false alarms. I want to catch as many failures as possible. ")])],1)])]),n("section",{staticClass:"danger mt-5"},[n("h2",{staticClass:"section-title"},[e._v("Danger Zone")]),n("div",{staticClass:"mt-4"},[n("a",{staticClass:"btn btn-outline-secondary",attrs:{href:e.printerWizardUrl}},[e._v(" Re-Link OctoPrint ")]),e._m(1)]),n("div",{staticClass:"mt-4"},[n("button",{staticClass:"btn btn-outline-danger",on:{click:e.deletePrinter}},[e._v(" Delete Printer ")]),e._m(2)])])]):n("div",{staticClass:"text-center"},[n("b-spinner",{staticClass:"mt-5",attrs:{label:"Loading..."}})],1)])],1)},r=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",{staticClass:"text-warning"},[n("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" If you are not sure about the settings below, leave the default values to minimize surprises. ")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-muted mt-1"},[n("small",[e._v('If your OctoPrint is always showing as "offline", and you have gone through '),n("a",{attrs:{href:"https://www.thespaghettidetective.com/docs/octoprint-is-offline/"}},[e._v("all the trouble-shooting steps")]),e._v(", you can try to re-link OctoPrint as the last resort.")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-muted mt-1"},[n("small",[e._v("Bye-bye printer. See you next time!")])])}],a=(n("99af"),n("4160"),n("fb6a"),n("b0c0"),n("0122")),o=n("fc11"),s=n("bc3a"),c=n.n(s),l=n("6625"),d=n.n(l),u=n("3a2b"),p=n.n(u),f=(n("2ba8"),n("502a")),v=n("1807"),m=n("cb3d"),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input-group input-group-sm input-wrapper"},[n("div",{staticClass:"input-group-prepend"},[n("button",{staticClass:"btn btn-outline-secondary control-button",attrs:{type:"button",disabled:e.disable},on:{click:function(t){e.inputValue=e.inputValue>0?Math.round(10*(e.inputValue-e.step))/10:0,e.$emit("input",e.inputValue)}}},[e._v("↓")])]),n("input",{staticClass:"form-control text-center field_required",style:{opacity:e.disable?.3:1},attrs:{type:"text",disabled:"","aria-describedby":"basic-addon1"},domProps:{value:e.inputValue+" mm"}}),n("div",{staticClass:"input-group-append"},[n("button",{staticClass:"btn btn-outline-secondary control-button",attrs:{type:"button",disabled:e.disable},on:{click:function(t){e.inputValue=Math.round(10*(e.inputValue+e.step))/10,e.$emit("input",e.inputValue)}}},[e._v("↑")])])])},g=[],b=(n("a9e3"),{name:"NumberInput",props:{value:{type:Number,default:0},step:{type:Number,default:.5},disable:{type:Boolean,default:!1}},data:function(){return{inputValue:this.value}},watch:{value:function(e){this.inputValue=e}}}),w=b,y=(n("a02b"),n("2877")),_=Object(y["a"])(w,h,g,!1,null,"0d181e8e",null),C=_.exports,S=n("b768"),k=n("8ffe"),x={components:{SavingAnimation:m["a"],NumberInput:C,PullToReveal:S["a"],Navbar:k["a"]},data:function(){return{printer:null,printerId:"",saving:{},errorMessages:{},delayedSubmit:{name:{delay:1e3,timeoutId:null},retract_on_pause:{delay:1e3,timeoutId:null},lift_z_on_pause:{delay:1e3,timeoutId:null}}}},computed:{retractFilamentByEnabled:{get:function(){return this.printer.retract_on_pause>0},set:function(e){this.printer.retract_on_pause=e?6.5:0,this.updateSetting("retract_on_pause")}},retractOnPause:{get:function(){return this.printer?this.printer.retract_on_pause:void 0},set:function(e){this.printer&&(this.printer.retract_on_pause=e)}},liftExtruderByEnabled:{get:function(){return this.printer.lift_z_on_pause>0},set:function(e){this.printer.lift_z_on_pause=e?2.5:0,this.updateSetting("lift_z_on_pause")}},liftExtruderBy:{get:function(){return this.printer?this.printer.lift_z_on_pause:void 0},set:function(e){this.printer&&(this.printer.lift_z_on_pause=e)}},printerWizardUrl:function(){return v["a"].printerWizard(this.printer.id)},printerName:{get:function(){return this.printer?this.printer.name:void 0},set:function(e){this.printer.name=e}}},watch:{printerName:function(e,t){void 0!==t&&this.updateSetting("name")},retractOnPause:function(e,t){void 0!==t&&this.changeRetractOnPause(e)},liftExtruderBy:function(e,t){void 0!==t&&this.changeLiftExtruderBy(e)}},created:function(){var e=this;this.printerId=d()(window.location.pathname,"/").slice(-2,-1).pop(),this.fetchPrinter().then((function(){var t=new p.a("#id_sensitivity",{formatter:function(e){return e<.95?"Low":e>1.05?"High":"Medium"}});t.on("slideStop",e.saveSensitivity),t.on("change",e.updateSensitivityHint),e.updateSensitivityHint()}))},mounted:function(){},methods:{fetchPrinter:function(){var e=this;return c.a.get(v["a"].printer(this.printerId)).then((function(t){e.printer=Object(f["d"])(t.data,e.printer)}))},patchPrinter:function(e,t){var n=this,i=this.getSettingsItemInput(e,t);return this.setSavingStatus(i,!0),c.a.patch(v["a"].printer(this.printerId),Object(o["a"])({},e,t)).catch((function(e){if(e.response&&e.response.data&&"object"===Object(a["a"])(e.response.data))if(e.response.data.non_field_errors)n.errorAlert(e.response.data.non_field_errors);else for(var t in e.response.data)n.errorMessages[i]=e.response.data[t];else n.errorAlert()})).then((function(){n.setSavingStatus(i,!1)}))},errorAlert:function(){this.$swal.Toast.fire({icon:"error",html:'<div>Can not update printer settings.</div><div>Get help from <a href="https://discord.com/invite/NcZkQfj">TSD discussion forum</a> if this error persists.</div>'})},updateSetting:function(e){var t=this;if(e in this.delayedSubmit){var n=this.delayedSubmit[e];return n["timeoutId"]&&clearTimeout(n["timeoutId"]),void(this.delayedSubmit[e]["timeoutId"]=setTimeout((function(){t.patchPrinter(e,t.printer[e])}),n["delay"]))}this.patchPrinter(e,this.printer[e])},saveSensitivity:function(e){this.printer.detective_sensitivity=e,this.updateSetting("detective_sensitivity")},updateSensitivityHint:function(){var e=document.querySelectorAll(".sensitivity div[class^=hint]");[].forEach.call(e,(function(e){e.style.display="none"}));var t=parseFloat(document.querySelector("#id_sensitivity").value);t<.95?document.querySelector(".sensitivity .hint-low").style.display="block":t>1.05?document.querySelector(".sensitivity .hint-high").style.display="block":document.querySelector(".sensitivity .hint-medium").style.display="block"},deletePrinter:function(){var e=this;this.$swal.Confirm.fire().then((function(t){t.value&&(window.location.href="/printers/".concat(e.printerId,"/delete/"))}))},getSettingsItemInput:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";switch(e){case"action_on_failure":return"".concat(e,"_").concat(t);default:return"".concat(e)}},setSavingStatus:function(e,t){t&&delete this.errorMessages[e],this.$set(this.saving,e,t)},changeRetractOnPause:function(e){this.printer.retract_on_pause=e,this.updateSetting("retract_on_pause")},changeLiftExtruderBy:function(e){this.printer.lift_z_on_pause=e,this.updateSetting("lift_z_on_pause")}}},T=x,P=(n("e7b4"),Object(y["a"])(T,i,r,!1,null,"3f480c33",null));t["a"]=P.exports},e7b4:function(e,t,n){"use strict";var i=n("0036"),r=n.n(i);r.a},ebff:function(e,t,n){e.exports=n.p+"img/plugin_wizard_websetup.png"},ee6b:function(e,t,n){"use strict";var i=n("d039f"),r=n.n(i);r.a},f357:function(e,t,n){"use strict";var i=n("f3f3"),r=n("a026"),a=n("5886"),o=n("3c33"),s=function(e,t,n){var a=document.createElement("div"),o=new r["default"]({render:function(n){return n(e,{props:t})}}).$mount(a);return r["default"].swal(Object(i["a"])(Object(i["a"])({},n),{},{customClass:{container:"dark-backdrop"},html:'<div id="replace-here">Placeholder</div>',onBeforeOpen:function(e){e.querySelector("#replace-here").replaceWith(o.$el)},onDestroy:function(){o.$destroy(),a.remove()}}))},c=function(e,t,n){return r["default"].swal(Object(i["a"])(Object(i["a"])({},n),{},{customClass:{container:"dark-backdrop"},html:'<div id="replace-here">Placeholder</div>',onBeforeOpen:function(t){t.querySelector("#replace-here").replaceWith(e)}}))},l=function(e,t){e.use(a["a"],t);var n=e.swal.mixin({title:"Are you sure?",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No",customClass:{container:"dark-backdrop"}}),r=e.swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),l=e.swal.mixin({icon:"error",customClass:{container:"dark-backdrop"}}),d=e.swal.mixin({customClass:{container:"dark-backdrop"}}),u=function(t,n){if(!Object(o["a"])(n,!1)){var r=Object(i["a"])(Object(i["a"])({},t),{},{position:"top-end",confirmButtonText:"Gotcha! Don't show this again."});return e.swal(r).then((function(e){e.value&&(Object(o["b"])(n,!0),console.log(e))}))}};e.prototype.$swal["openModalWithComponent"]=s,e.prototype.$swal["openModalWithElement"]=c,e.prototype.$swal["Confirm"]=n,e.prototype.$swal["Toast"]=r,e.prototype.$swal["DismissableToast"]=u,e.prototype.$swal["Reject"]=l,e.prototype.$swal["Prompt"]=d};t["a"]={install:l}}});
//# sourceMappingURL=printers.js.map