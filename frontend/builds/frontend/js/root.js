(function(e){function t(t){for(var s,n,o=t[0],l=t[1],c=t[2],d=0,u=[];d<o.length;d++)n=o[d],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&u.push(r[n][0]),r[n]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);p&&p(t);while(u.length)u.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],s=!0,n=1;n<i.length;n++){var o=i[n];0!==r[o]&&(s=!1)}s&&(a.splice(t--,1),e=l(l.s=i[0]))}return e}var s={},n={root:0},r={root:0},a=[];function o(e){return l.p+"js/"+({}[e]||e)+".js"}function l(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,l),i.l=!0,i.exports}l.e=function(e){var t=[],i={"chunk-09213160":1,"chunk-125ed81f":1,"chunk-21022300":1,"chunk-2c90e8a6":1,"chunk-3b71be8a":1,"chunk-4238a0c5":1,"chunk-715feb0c":1,"chunk-b0f6bd3a":1,"chunk-ba8543c0":1,"chunk-ca3d59de":1};n[e]?t.push(n[e]):0!==n[e]&&i[e]&&t.push(n[e]=new Promise((function(t,i){for(var s="css/"+({}[e]||e)+".css",r=l.p+s,a=document.getElementsByTagName("link"),o=0;o<a.length;o++){var c=a[o],d=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(d===s||d===r))return t()}var u=document.getElementsByTagName("style");for(o=0;o<u.length;o++){c=u[o],d=c.getAttribute("data-href");if(d===s||d===r)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var s=t&&t.target&&t.target.src||r,a=new Error("Loading CSS chunk "+e+" failed.\n("+s+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=s,delete n[e],p.parentNode.removeChild(p),i(a)},p.href=r;var h=document.getElementsByTagName("head")[0];h.appendChild(p)})).then((function(){n[e]=0})));var s=r[e];if(0!==s)if(s)t.push(s[2]);else{var a=new Promise((function(t,i){s=r[e]=[t,i]}));t.push(s[2]=a);var c,d=document.createElement("script");d.charset="utf-8",d.timeout=120,l.nc&&d.setAttribute("nonce",l.nc),d.src=o(e);var u=new Error;c=function(t){d.onerror=d.onload=null,clearTimeout(p);var i=r[e];if(0!==i){if(i){var s=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+s+": "+n+")",u.name="ChunkLoadError",u.type=s,u.request=n,i[1](u)}r[e]=void 0}};var p=setTimeout((function(){c({type:"timeout",target:d})}),12e4);d.onerror=d.onload=c,document.head.appendChild(d)}return Promise.all(t)},l.m=e,l.c=s,l.d=function(e,t,i){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(l.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)l.d(i,s,function(t){return e[t]}.bind(null,s));return i},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/static/frontend/",l.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var p=d;a.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"016d":function(e,t,i){},"03af":function(e,t,i){"use strict";i("90cf")},"0469":function(e,t,i){e.exports=i.p+"img/detective-working.gif"},"04b2":function(e,t,i){},"08fd":function(e,t,i){},"0993":function(e,t,i){},"0c5c":function(e,t,i){"use strict";i("b6d2")},"0dce":function(e,t,i){"use strict";i("5062")},"0ebf":function(e,t,i){"use strict";i("5e59")},"0fb5":function(e,t,i){"use strict";i.d(t,"d",(function(){return a})),i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var s=i("a026"),n=i("6c44"),r=i("59cf");const a=s["default"].observable({value:r["c"]});function o(){return Object(r["b"])(a)}function l(){return Object(r["d"])(o())}function c(e){a.value=e,Object(n["a"])()&&localStorage.setItem("colorTheme",a.value),l()}},"0fcf":function(e,t,i){},1:function(e,t){},1279:function(e,t,i){"use strict";i("30de")},"17ae":function(e,t,i){var s={"./DiscordPlugin":["0f1e","chunk-3b71be8a"],"./DiscordPlugin.vue":["0f1e","chunk-3b71be8a"],"./EmailPlugin":["c308","chunk-2c90e8a6"],"./EmailPlugin.vue":["c308","chunk-2c90e8a6"],"./PushbulletPlugin":["1cfc","chunk-21022300"],"./PushbulletPlugin.vue":["1cfc","chunk-21022300"],"./PushoverPlugin":["46f8","chunk-4238a0c5"],"./PushoverPlugin.vue":["46f8","chunk-4238a0c5"],"./SlackPlugin":["ff58","chunk-ca3d59de"],"./SlackPlugin.vue":["ff58","chunk-ca3d59de"],"./TelegramPlugin":["814e","chunk-715feb0c"],"./TelegramPlugin.vue":["814e","chunk-715feb0c"],"./TwilioPlugin":["e2bc","chunk-125ed81f"],"./TwilioPlugin.vue":["e2bc","chunk-125ed81f"],"./WebhookPlugin":["e920","chunk-b0f6bd3a"],"./WebhookPlugin.vue":["e920","chunk-b0f6bd3a"]};function n(e){if(!i.o(s,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],n=t[0];return i.e(t[1]).then((function(){return i(n)}))}n.keys=function(){return Object.keys(s)},n.id="17ae",e.exports=n},"1a62":function(e,t,i){},"1b34":function(e,t,i){"use strict";i("4024")},"1c3a":function(e,t,i){e.exports=i.p+"img/moonraker_verification_code.png"},"1c9d":function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return n})),i.d(t,"f",(function(){return r})),i.d(t,"e",(function(){return a})),i.d(t,"d",(function(){return o})),i.d(t,"c",(function(){return l}));i("5494");const s=()=>JSON.parse(document.querySelector("#app-platform-json").text)["platform"],n=()=>""!==s(),r=()=>JSON.parse(document.querySelector("#user-json").text),a=()=>JSON.parse(document.querySelector("#settings-json").text),o=()=>"true"===new URLSearchParams(window.location.search).get("onlyNotifications"),l=()=>"true"===new URLSearchParams(window.location.search).get("onlyName")},"1e7a":function(e,t,i){"use strict";i("2ea1")},"1f6a":function(e,t,i){e.exports=i.p+"img/mainsail_logo.png"},"222b":function(e,t,i){e.exports=i.p+"img/octopod.webp"},2814:function(e,t,i){e.exports=i.p+"img/install_plugin.png"},"283d":function(e,t,i){"use strict";i("7902")},"28d5":function(e,t,i){},"2b37":function(e,t,i){"use strict";i("08fd")},"2bcb":function(e,t,i){},"2e7f":function(e,t,i){e.exports=i.p+"img/octoprint_logo.png"},"2ea1":function(e,t,i){},"2ec8":function(e,t,i){"use strict";i("016d")},"2f3f":function(e,t,i){"use strict";i("8a10")},"30c2":function(e,t,i){},"30de":function(e,t,i){},"324d":function(e,t,i){"use strict";i("aad1")},3427:function(e,t,i){"use strict";i("8bf8")},"34a4":function(e,t,i){},3957:function(e,t,i){e.exports=i.p+"img/polymer.webp"},"3c33":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));var s=i("6c44");const n=(e,t)=>{var i=Object(s["a"])()?localStorage.getItem(e):null,n=i||t;try{return JSON.parse(n)}catch(r){return n}},r=(e,t)=>{Object(s["a"])()&&localStorage.setItem(e,t)}},"3d3c":function(e,t,i){},"3d45":function(e,t,i){},"3ee0":function(e,t,i){e.exports=i.p+"img/printoid.webp"},4024:function(e,t,i){},"412b":function(e,t,i){},4463:function(e,t,i){},"44a9":function(e,t,i){"use strict";i("7022")},4580:function(e,t,i){},"47b9":function(e,t,i){},"47bd":function(e,t,i){"use strict";i("2bcb")},"49f2":function(e,t,i){},"4a39":function(e,t,i){},"4b33":function(e,t,i){},"4dac":function(e,t,i){},"4de7":function(e,t,i){e.exports=i.p+"img/webpage-multiple.svg"},"4e03":function(e,t,i){e.exports=i.p+"img/plugin_wizard_websetup.png"},5062:function(e,t,i){},"50b5":function(e,t,i){},5424:function(e,t,i){},"56d7":function(e,t,i){"use strict";i.r(t);var s=i("a026"),n=i("8c4f"),r=i("5886"),a=i("3c33");const o=(e,t,i)=>{let n=document.createElement("div");const r=new s["default"]({render:i=>i(e,{props:t})}).$mount(n);return s["default"].swal({...i,customClass:{container:"dark-backdrop"},html:'<div id="replace-here">Placeholder</div>',onBeforeOpen:e=>{e.querySelector("#replace-here").replaceWith(r.$el)},onDestroy:()=>{r.$destroy(),n.remove()}})},l=(e,t,i)=>s["default"].swal({...i,customClass:{container:"dark-backdrop"},html:'<div id="replace-here">Placeholder</div>',onBeforeOpen:t=>{t.querySelector("#replace-here").replaceWith(e)}}),c=(e,t)=>{e.use(r["a"],t);const i=e.swal.mixin({title:"Are you sure?",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No",customClass:{container:"dark-backdrop"}}),s=e.swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),n=e.swal.mixin({icon:"error",customClass:{container:"dark-backdrop error-alert"}}),c=e.swal.mixin({customClass:{container:"dark-backdrop"}}),d=(t,i)=>{if(!Object(a["a"])(i,!1)){const s={...t,position:"top-end",confirmButtonText:"Gotcha! Don't show this again."};return e.swal(s).then((function(e){e.value&&(Object(a["b"])(i,!0),console.log(e))}))}};e.prototype.$swal["openModalWithComponent"]=o,e.prototype.$swal["openModalWithElement"]=l,e.prototype.$swal["Confirm"]=i,e.prototype.$swal["Toast"]=s,e.prototype.$swal["DismissableToast"]=d,e.prototype.$swal["Reject"]=n,e.prototype.$swal["Prompt"]=c};var d={install:c},u=i("5f5b"),p=i("c0eb"),h=i("2ead"),f=i.n(h);s["default"].filter("floor",e=>Math.floor(e));const m=/(?:^|[-_/])(\w)/g,g="root",v="anonymous component",b=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^/]+?|)(\.[^./]*|))(?:[/]*)$/,_=e=>{const t=b.exec(e);return t?t.slice(1):[]},C=(e,t)=>{let i=_(e)[2];return t&&i.substr(-1*t.length)===t&&(i=i.substr(0,i.length-t.length)),i},w=e=>{if(!e)return v;if(e.$root===e)return g;if(!e.$options)return v;if(e.$options.name)return e.$options.name;if(e.$options._componentTag)return e.$options._componentTag;if(e.$options.__file){const t=e.$options.__file.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"),i=C(t,".vue");return i.replace(m,(e,t)=>t?t.toUpperCase():"")}return v},y=(e,t,i,s,n,r)=>{let a=0;for(let o in t){if(a+=1,a>r)break;"object"==typeof t[o]?n>s&&y(e,t[o],i+"."+o,s+1,n,r):e[i+"."+o]=t[o]}},k=e=>{const t=e.config.errorHandler;e.config.errorHandler=(i,s,n)=>{if(window.Sentry){const e={};let t=s;if(s._original&&(t=s._original),t)try{e.componentName=w(t),y(e,JSON.parse(JSON.stringify(t.$options.propsData)),"props",0,2,10)}catch(r){console.log("Unable to extract metadata from Vue component.")}n&&(e.lifecycleHook=n),setTimeout(()=>{window.Sentry.getCurrentHub().withScope(t=>{t.setContext("vue",e),window.Sentry.getCurrentHub().captureException(i)})})}"function"===typeof t&&t.call(e,i,s,n),e.util&&e.util.warn(`Error in ${n}: "${i.toString()}"`,s),console.error(i)}};var S=k,P=i("0fb5"),x=i("fc02"),T=i.n(x),F=i("eaf3"),D=i("67b0"),O=function(){var e=this,t=e._self._c;return t("div",{staticClass:"wrapper"},[t("b-spinner")],1)},I=[],A={name:"LoadingPlaceholder"},M=A,E=(i("0c5c"),i("2877")),N=Object(E["a"])(M,O,I,!1,null,"26c9d5fe",null),R=N.exports,j=i("c1df"),L=i.n(j),B=i("be33"),$=i("ad3d"),V=i("11ca"),U=i("4ab5"),z=(e,t)=>{Object(P["b"])(),S(s["default"]),s["default"].use(n["a"]),s["default"].use(u["a"]),s["default"].use(d),s["default"].use(p["a"]),s["default"].use(f.a),s["default"].use(T.a),s["default"].use(F["a"]),s["default"].use(D["a"]),s["default"].mixin({methods:{errorDialog:function(e,t){console.error("logError",e),t&&this.$swal.Reject.fire({title:"Error",html:`<p style="line-height: 1.5; max-width: 400px; margin: 0 auto;">\n              ${t}.\n              Get help from <a href="https://obico.io/discord">the Obico app discussion forum</a> if this error persists.\n            </p>`,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"Close"})}}}),s["default"].component("LoadingPlaceholder",R),B["c"].add(V["q"],V["j"],V["b"],V["c"],V["m"],V["g"],V["a"],V["i"],U["a"],V["o"],V["e"],V["f"],V["h"],V["n"],V["k"],V["l"],V["d"],V["p"]),s["default"].component("FontAwesomeIcon",$["a"]),document.getElementById("app")&&new s["default"]({router:e,components:t}).$mount("#app"),L.a.updateLocale("en",{week:{dow:0}})},W=(i("13d5"),{email:{displayName:"Email",componentName:"EmailPlugin"},twilio:{displayName:"SMS",componentName:"TwilioPlugin"},pushbullet:{displayName:"Pushbullet",componentName:"PushbulletPlugin"},discord:{displayName:"Discord",componentName:"DiscordPlugin"},telegram:{displayName:"Telegram",componentName:"TelegramPlugin"},pushover:{displayName:"Pushover",componentName:"PushoverPlugin"},slack:{displayName:"Slack",componentName:"SlackPlugin"},webhook:{displayName:"Webhook",componentName:"WebhookPlugin"}});const G={GeneralPreferences:"/user_preferences/general/",ThemePreferences:"/user_preferences/personalization/",ProfilePreferences:"/user_preferences/profile/",AuthorizedApps:"/user_preferences/authorized_apps/",GeneralNotifications:"/user_preferences/general_notifications/",PushNotifications:"/user_preferences/mobile_push_notifications/"},q=Object.keys(W).reduce((e,t)=>Object.assign(e,{[t]:`/user_preferences/notification_${t}/`}),{});var H={...G,...q};const J={printerWizard:"/printers/wizard/",printerWizardSetup:"/printers/wizard/setup/"};var Y=J,K=function(){var e=this,t=e._self._c;return t("b-container",[t("b-row",{staticClass:"justify-content-center"},[e.user?t("b-col",{staticClass:"mt-3",attrs:{lg:"8"}},[0===e.printersToShow.length?t("div",{staticClass:"wizard-container full-on-mobile"},[t("b-container",[t("b-row",[t("div",{staticClass:"col-sm-12 col-md-8 offset-md-2 col-lg-6 offset-lg-3"},[t("svg",{staticClass:"logo-img",attrs:{viewBox:"0 0 1965 240"}},[t("use",{attrs:{href:"#svg-logo-compact"}})])])]),t("b-row",[t("h1",{staticClass:"mx-auto"},[e._v("Welcome To Obico")])]),t("b-row",[t("b-col",[t("hr")])],1),e.isEnt&&e.trialDaysLeft>0?t("b-row",[t("b-col",[e.trialDaysLeft>=29?t("h3",{staticClass:"py-3"},[e._v(" Your 30-Day "),t("a",{staticClass:"link",attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/upgrade-to-pro/"}},[e._v("Pro Plan")]),e._v(" Free Trial Has Started! ")]):t("h3",{staticClass:"py-3"},[e._v(" "+e._s(e.trialDaysLeft)+" Days Left on Your "),t("a",{staticClass:"link",attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/upgrade-to-pro/"}},[e._v("Pro Plan ")]),e._v("Free Trial! ")]),t("div",{staticClass:"pb-1"},[t("i",{staticClass:"feature-check fas fa-check-circle"}),t("span",{staticClass:"feature-text"},[e._v("Unlimited Secure Tunnel to your OctoPrint/Klipper")])]),t("div",{staticClass:"pb-1"},[t("i",{staticClass:"feature-check fas fa-check-circle"}),t("span",{staticClass:"feature-text"},[e._v("Premium 25 FPS Webcam Streaming")])]),t("div",{staticClass:"pb-1"},[t("i",{staticClass:"feature-check fas fa-check-circle"}),t("span",{staticClass:"feature-text"},[e._v("250 AI Failure Detection Hours")])]),t("div",{staticClass:"pb-1"},[t("i",{staticClass:"feature-check fas fa-check-circle"}),t("span",{staticClass:"feature-text"},[e._v("G-Code Remote Upload and Printing")])]),t("div",{staticClass:"lead py-4"},[e._v("OctoPrint has not been linked to your Obico account.")]),t("div",{staticClass:"d-flex flex-column align-center justify-content-center"},[t("div",[t("a",{staticClass:"btn btn-primary btn-block mx-auto btn-lg",attrs:{href:e.wizardUrl}},[e._v("Link OctoPrint Now")])]),t("div",[t("div",{staticClass:"text-muted mx-auto text-center font-weight-light"},[e._v(" It's as easy as 1-2-3. ")])])])])],1):e._e(),t("div",{staticClass:"footer-note small"},[e._v(" Not ready to start yet? "),t("a",{attrs:{href:"mailto:support@obico.io?subject=Please%20pause%20my%20free%20trial"}},[e._v("Email us")]),e._v(" to pause your free trial. ")])],1)],1):t("div",[t("div",{staticClass:"text-center"},[t("svg",{attrs:{width:"100",height:"30"}},[t("use",{attrs:{href:"#svg-logo-full"}})])]),e.authorized?t("div",{staticClass:"authorization-successful"},[t("h4",{staticClass:"title"},[e._v("Authorization Successful!")]),t("p",[e._v("You can close this page")])]):t("div",[t("div",[t("div",{staticClass:"lead text-center mt-3 mb-5"},[e._v("Tunnel Access Authorization")]),t("h4",{staticClass:"my-4"},[t("span",{staticClass:"font-weight-bold"},[e._v(e._s(e.appName))]),e._v(" is requesting to access you OctoPrint Tunnel. ")]),t("p",{staticClass:"text-muted"},[t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/",target:"_blank"}},[e._v("OctoPrint Tunnel")]),e._v(" is a secure way provided by "),t("a",{attrs:{href:"https://www.obico.io/",target:"_blank"}},[e._v("Obico")]),e._v(" to remotely access your OctoPrint. With the OctoPrint Tunnel, you can use "+e._s(e.appName)+" to access your OctoPrint from anywhere. ")]),e.user.is_pro?e._e():t("b-alert",{staticClass:"my-3",attrs:{variant:"warning",dismissible:"",show:""}},[t("div",[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" Tunnel usage of a free account is "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/#why-is-the-limit-on-free-account-only-100mb",target:"_blank"}},[e._v("capped at 300MB per month")]),e._v(". You can "),t("a",{attrs:{href:"http://app.obico.io/ent_pub/pricing/",target:"_blank"}},[e._v("upgrade to the Obico app Pro plan for 1 Starbucks a month")]),e._v(" to enjoy unlimited tunnel usage. ")])]),e.user.is_pro&&e.trialDaysLeft>0?t("b-alert",{staticClass:"my-3",attrs:{variant:"warning",dismissible:"",show:""}},[t("div",[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" After the Free trial expires, tunnel data usage will be "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/#why-is-the-limit-on-free-account-only-100mb",target:"_blank"}},[e._v("capped at 300MB per month")]),e._v(". You can "),t("a",{attrs:{href:"http://app.obico.io/ent_pub/pricing/",target:"_blank"}},[e._v("upgrade to the Obico app Pro plan for 1 Starbucks a month")]),e._v(" to continue enjoying unlimited tunnel usage. ")])]):e._e(),t("div",{staticClass:"mt-5"},[t("p",{staticClass:"lead"},[e._v(" Tunnel access by "),t("span",{staticClass:"font-weight-bold"},[e._v(e._s(e.appName))]),e._v(" (make sure you trust it): ")]),0===e.printersToShow.length?t("h5",[e._v("You have 0 active printers")]):1===e.printersToShow.length?t("h5",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e.printersToShow[0].name)+" ")]):e.printersToShow.length>1?t("select",{directives:[{name:"model",rawName:"v-model",value:e.printerToAuthorize,expression:"printerToAuthorize"}],staticClass:"custom-select",on:{change:function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.printerToAuthorize=t.target.multiple?i:i[0]}}},[t("option",{attrs:{selected:"",disabled:""},domProps:{value:null}},[e._v("Please select a printer")]),e._l(e.printersToShow,(function(i){return t("option",{key:i.id,domProps:{value:i.id}},[e._v(" "+e._s(i.name)+" ")])}))],2):e._e(),e.printersToShow.length?t("div",{staticClass:"d-flex mt-4 mb-3"},[t("button",{staticClass:"btn btn-primary",staticStyle:{flex:"1"},attrs:{disabled:!e.printerToAuthorize||e.performingAuthRequest},on:{click:e.authorize}},[e.performingAuthRequest?t("b-spinner",{attrs:{small:"",label:"Loading..."}}):t("span",[e._v("Authorize")])],1),t("a",{staticClass:"btn btn-outline-secondary ml-2",staticStyle:{flex:"1"},attrs:{href:"/user_preferences/authorized_apps"}},[e._v("Manage Apps")])]):e._e()])],1),t("div",{staticClass:"mt-4"},[t("p",{staticClass:"text-muted small mb-1"},[e._v("Security notes:")]),t("ul",{staticClass:"text-muted small pl-4"},[t("li",[e._v(" The app can only access the tunnel, not your Obico account info such as your email address. ")]),t("li",[e._v(" The access remains valid until explicitly revoked. You can revoke the access by going to Preferences -> Authorized Apps. ")])])])])])]):t("b-col",{staticClass:"mt-5"},[t("div",[t("b-container",[t("div",{staticClass:"d-flex justify-content-center align-items-center"},[t("img",{staticClass:"logo-icon",attrs:{src:e.appLogo}}),t("h3",[e._v("⇄")]),t("svg",{staticClass:"logo-icon obico"},[t("use",{attrs:{href:"#svg-logo-compact"}})]),t("h3",[e._v("⇄")]),t("img",{staticClass:"logo-icon",attrs:{src:i("2e7f")}})]),t("div",{staticClass:"my-4"},[t("div",{staticClass:"mx-auto text-center"},[t("h4",[e._v("OctoPrint Tunnel")]),t("div",{staticClass:"lead"},[e._v("Powered by Obico")])])]),t("div",{staticClass:"account-details"},[t("p",[e._v(" With the OctoPrint Tunnel by Obico, you can now use "+e._s(e.appName)+" to "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/",target:"_blank"}},[e._v("securely control and monitor your printer from anywhere")]),e._v(". ")]),t("div",{staticClass:"text-muted"},[e._v("Obico Free Account:")]),t("ul",{staticClass:"text-muted"},[t("li",[e._v("Unlimited realtime webcam at 0.1FPS.")]),t("li",[e._v("300MB monthly tunnel data cap (excluding webcam streaming).")]),t("li",[e._v("10 hours/mo AI failure detection.")])]),t("div",{staticClass:"text-muted"},[e._v(" Obico Pro Account ("),t("a",{attrs:{href:"https://app.obico.io/ent_pub/pricing/",target:"_blank"}},[e._v("from $4/mo")]),e._v("): ")]),t("ul",{staticClass:"text-muted"},[t("li",[e._v("Unlimited realtime webcam streaming.")]),t("li",[e._v("Unlimited tunnel data usage.")]),t("li",[e._v("50 hours/mo AI failure detection.")]),t("li",[t("a",{attrs:{href:"https://app.obico.io/ent_pub/pricing/",target:"_blank"}},[e._v("And much more...")])])])]),t("div",[t("div",{staticClass:"my-5 w-100"},[t("a",{staticClass:"btn btn-primary btn-block",attrs:{href:e.loginUrl}},[e._v("SIGN IN ")]),t("div",{staticClass:"text-center pt-3 w-100"},[t("div",{staticClass:"font-weight-light text-muted"},[e._v("- OR -")]),t("a",{staticClass:"btn",attrs:{href:e.signupUrl}},[e._v("SIGN UP")])])])])])],1)])],1)],1)},Z=[],Q=(i("5494"),i("14d9"),i("cee4")),X=i("c7f6"),ee=i("9b02"),te=i.n(ee),ie=i("49d5"),se=i.n(ie),ne=i("0e49"),re=i.n(ne);const ae=e=>{const t=Math.round(e||0),i=oe(t);if(0!==i.days){const e=i.hours+Math.round(i.minutes/60);return 24===e?i.days+1+"d 0h":`${i.days}d ${e}h`}if(0!==i.hours){if(60===i.minutes){const e=i.hours+1;return 24===e?"1d 0h":i.hours+1+"h 0m"}return`${i.hours}h ${i.minutes}m`}return i.minutes+"m"},oe=e=>{const t=L.a.duration(e||0,"seconds"),i=Math.floor(t.asDays()),s=t.hours(),n=t.minutes()+Math.round(t.seconds()/60);return{days:i,hours:s,minutes:n}},le=e=>{const t=(e||0)/1e3,i=Math.round(100*t)/100;return i+"m"},ce=(e,t="MMM D, h:mm a")=>{if(!e)return"-";let i=new Date,s=new Date(i.setSeconds(i.getSeconds()+e));return L()(s).format(t)},de=[{name:"estimated_time",faIcon:"fas fa-clock",title:"Print duration estimate",formatter:ae},{name:"filament_total",faIcon:"fas fa-ruler-horizontal",title:"Filament usage estimate",formatter:le},{name:"first_layer_bed_temp",svgIcon:"bed-temp",title:"First layer bed temperature",formatter:e=>e+"°C"},{name:"first_layer_extr_temp",svgIcon:"extruder",title:"First layer extruder temperature",formatter:e=>e+"°C"},{name:"first_layer_height",faIcon:"fas fa-layer-group",title:"First layer height",formatter:e=>e+"mm"},{name:"layer_height",faIcon:"fas fa-layer-group",title:"Layer height",formatter:e=>e+"mm"},{name:"object_height",faIcon:"fas fa-ruler-vertical",title:"Object height",formatter:e=>Math.round(e)+"mm"},{name:"filament_type",svgIcon:"filament",title:"Filament type",formatter:e=>e},{name:"filament_name",svgIcon:"filament",title:"Filament name",formatter:e=>e},{name:"slicer",svgIcon:"slicer-program",title:"Slicer",formatter:e=>e},{name:"slicer_version",svgIcon:"slicer-version",title:"Slicer version",formatter:e=>e}];var ue=i("6c44");const pe={"G-Code Downloading":{fromStates:["Operational"]},Starting:{fromStates:["Operational"]},Pausing:{fromStates:["Printing"]},Resuming:{fromStates:["Paused"]},Cancelling:{fromStates:["Printing","Paused"]}},he=(e,t)=>{const i=e.id;if(!Object(ue["a"])())return;const s=`printer-${i}-state-transitioning`;localStorage.setItem(s+"-name",t);const n=new Date,r=e.isAgentVersionGte("2.3.7","1.4.2")?15:300,a=new Date(n.getTime()+1e3*r);localStorage.setItem(s+"-timeout",a)},fe=(e,t)=>{var i;const s=e.id;if(!Object(ue["a"])())return t;if(!t)return me(s),null;const n=`printer-${s}-state-transitioning`,r=localStorage.getItem(n+"-name"),a=localStorage.getItem(n+"-timeout"),o=null===(i=pe[r])||void 0===i?void 0:i.fromStates;let l=t;return r&&a&&o&&(o.includes(t)?new Date>new Date(a)?(me(s),ge(e,r,t)):l=r:me(s)),l},me=e=>{Object(ue["a"])()&&(localStorage.removeItem("printer-"+e+"-state-transitioning-name"),localStorage.removeItem("printer-"+e+"-state-transitioning-timeout"))},ge=(e,t,i)=>{var n;null===(n=window.Sentry)||void 0===n||n.captureMessage(`Transient state timeout: "${t}" -> "${i}" (printer ID: ${e.id})`),s["default"].swal.fire({icon:"error",title:"Printer not responding",html:'The printer doesn\'t seem to be responding. Is it powered on and connected to the Internet? Please <a href="mailto:support@obico.io">report the problem to us</a> if this error repeats multiple times.'}).then(()=>{window.location.reload()})},ve=e=>e?L()(e):null,be={Printing:{key:"printing",title:"Printing...",isActive:!0},Paused:{key:"paused",title:"Paused",isActive:!0},Finished:{key:"finished",title:"Finished",isActive:!1},Cancelled:{key:"cancelled",title:"Cancelled",isActive:!1}},_e=e=>{if(e.started_at=ve(e.started_at),e.uploaded_at=ve(e.uploaded_at),e.finished_at=ve(e.finished_at),e.cancelled_at=ve(e.cancelled_at),e.ended_at=ve(e.ended_at),e.ended_at){const t=L.a.duration(e.ended_at.diff(e.started_at));e.duration=ae(t.asSeconds())}return e.has_alerts=Boolean(e.alerted_at),e.printShotFeedbackEligible=e.printshotfeedback_set&&e.printshotfeedback_set.length>0,e.status=e.ended_at?e.cancelled_at?be.Cancelled:be.Finished:e.paused_at?be.Paused:be.Printing,e.printer&&(e.printer=ye(e.printer)),e.g_code_file&&(e.g_code_file=Ce(e.g_code_file)),e},Ce=e=>{if(e){if(e.created_at=ve(e.created_at),e.updated_at=ve(e.updated_at),e.deleted=ve(e.deleted),e.filesize=se()(e.num_bytes),e.print_set&&(e.print_set.map(e=>_e(e)),e.print_set.sort((e,t)=>e.ended_at||t.ended_at?e.ended_at?t.ended_at?e.ended_at>t.ended_at?-1:e.ended_at<t.ended_at?1:0:1:-1:e.started_at>t.started_at?-1:e.started_at<t.started_at?1:0),e.last_print=e.print_set[0],e.failedPrints=e.print_set.filter(e=>e.cancelled_at).length,e.successPrints=e.print_set.filter(e=>e.finished_at).length,e.totalPrints=e.print_set.length),e.metadata={},e.metadata_json)e.metadata=JSON.parse(e.metadata_json);else if(e.analysis){var t;let i;if(e.metadata.object_height=null===(t=e.analysis.dimensions)||void 0===t?void 0:t.height,e.metadata.estimated_time=e.analysis.estimatedPrintTime,e.analysis.filament){const t=Object.keys(e.analysis.filament);t.length&&(i=0,t.forEach(t=>{i+=e.analysis.filament[t].length}))}e.metadata.filament_total=i}else de.forEach(t=>{e[t.name]&&(e.metadata[t.name]=e[t.name])});return Object.keys(e.metadata).forEach(t=>{null!==e.metadata[t]&&void 0!==e.metadata[t]||delete e.metadata[t]}),e.getBigThumbnailUrl=()=>e.thumbnail1_url||e.thumbnail2_url||e.thumbnail3_url,e.getSmallThumbnailUrl=()=>e.thumbnail3_url||e.thumbnail2_url||e.thumbnail1_url,e}},we=e=>(e.created_at=ve(e.created_at),e.updated_at=ve(e.updated_at),e.numItems=e.g_code_file_count+e.g_code_folder_count,e),ye=(e,t)=>{const i={createdAt:function(){return ve(this.created_at)},progressCompletion:function(){return te()(this,"status.progress.completion",0)},isOffline:function(){return null===te()(this,"status",null)},isPaused:function(){return te()(this,"status.state.flags.paused",!1)},isDisconnected:function(){return te()(this,"status.state.flags.closedOrError",!0)},isActive:function(){const e=te()(this,"status.state.flags");return Boolean(e&&e.operational&&(!e.ready||e.paused))||this.inTransientState()},inTransientState:function(){const e=this.calculatedState();return"Downloading G-Code"===e||e&&e.endsWith("ing")&&"Printing"!==e},calculatedState:function(){var e,t;return fe(this,null===(e=this.status)||void 0===e||null===(t=e.state)||void 0===t?void 0:t.text)},calculatedStateColor:function(){const e=this.calculatedState(),t={secondary:["Offline",void 0,null],success:["Operational"],neutral:["Printing","G-Code Downloading","Downloading G-Code","Starting"],warning:["Paused","Pausing","Resuming"],danger:["Cancelling"]};for(const[i,s]of Object.entries(t))if(s.includes(e))return i;return"neutral"},setTransientState:function(e){he(this,e),this.status&&(this.status={...this.status})},inUserInteractionRequired:function(){return te()(this,"status.user_interaction_required",!1)},hasError:function(){return te()(this,"status.state.flags.error")||te()(this,"status.state.text","").toLowerCase().includes("error")},isAgentMoonraker:function(){return"moonraker_obico"===te()(this,"agent_name","")},agentDisplayName:function(){return this.isAgentMoonraker()?"Klipper":"OctoPrint"},isAgentVersionGte:function(e,t){return"octoprint_obico"===te()(this,"settings.agent_name","")&&re()(te()(this,"settings.agent_version","0.0.0"),e)||"moonraker_obico"===te()(this,"settings.agent_name","")&&re()(te()(this,"settings.agent_version","0.0.0"),t)},alertUnacknowledged:function(){return te()(this,"current_print.alerted_at")&&L()(te()(this,"current_print.alerted_at")).isAfter(L()(te()(this,"current_print.alert_acknowledged_at")||0))},isPrintable:function(){return!this.isOffline()&&!this.isDisconnected()&&!this.isActive()&&!this.archived_at},printabilityText:function(){return this.isPrintable()?"Ready":"Unavailable"}};return t?(te()(t,"status._ts",-1)>te()(e,"status._ts",te()(t,"status._ts",0))&&delete e.status,{...t,...e,...i}):{...e,...i}},ke=e=>(e.created_at=ve(e.created_at),e);var Se=i("1c9d"),Pe=i("222b"),xe=i.n(Pe),Te=i("ca14"),Fe=i.n(Te),De=i("3957"),Oe=i.n(De),Ie=i("3ee0"),Ae=i.n(Ie),Me=i("d1d5"),Ee=i.n(Me),Ne={name:"NewOctoPrintTunnelPage",components:{},data(){return{user:null,printers:[],printerId:null,printerToAuthorize:null,performingAuthRequest:!1,authorized:!1}},computed:{printersToShow(){return this.printerId?this.printers.filter(e=>e.id==this.printerId):this.printers},loginUrl(){return"/accounts/login/?hide_navbar=true&next="+encodeURIComponent(window.location.pathname+window.location.search)},signupUrl(){return"/accounts/signup/?hide_navbar=true&next="+encodeURIComponent(window.location.pathname+window.location.search)},wizardUrl(){return"/printers/wizard/?redirectToTunnelCreation="+encodeURIComponent(window.location.pathname+window.location.search)},appName(){return new URLSearchParams(window.location.search).get("app")||"Unknown App"},trialDaysLeft(){var e,t;return"pro-trial"!==(null===(e=this.user)||void 0===e||null===(t=e.subscription)||void 0===t?void 0:t.plan_id)?-1:L()(this.user.subscription.expired_at).diff(L()(),"days")+1},appLogo(){switch(this.appName.toLowerCase()){case"octopod":return xe.a;case"printoid":return Ae.a;case"polymer":return Oe.a;case"octoapp":return Fe.a;default:return Ee.a}}},created(){this.user=Object(Se["f"])();const{IS_ENT:e}=Object(Se["e"])();this.isEnt=!!e,this.printerId=new URLSearchParams(window.location.search).get("printer_id"),this.user&&this.fetchPrinters()},methods:{fetchPrinters(){return Q["a"].get(X["a"].printers()).then(e=>{e.data.forEach(e=>{this.printers.push(ye(e))}),1==this.printersToShow.length&&(this.printerToAuthorize=this.printersToShow[0].id)})},authorize(){this.printersToShow.length&&(this.performingAuthRequest=!0,Q["a"].post(X["a"].tunnels(),{app_name:this.appName,target_printer_id:this.printerToAuthorize||this.printersToShow[0].id}).then(e=>{this.authorized=!0;const t=e.data.tunnel_endpoint,i=new URLSearchParams(window.location.search).get("success_redirect_url")||"/tunnels/succeeded/";window.location.replace(`${i}?tunnel_endpoint=${t}`)}).catch(e=>{this.performingAuthRequest=!1,this.errorDialog(e)}))}}},Re=Ne,je=(i("ade3"),Object(E["a"])(Re,K,Z,!1,null,"2342d2c3",null)),Le=je.exports,Be=function(){var e=this,t=e._self._c;return t("div",[!e.isPro&&e.usageFetched?t("div",{staticClass:"floating-panel"},[e.showDetails?t("div",{on:{click:function(t){e.showDetails=!1},mouseover:function(t){e.showDetails=!0},mouseleave:function(t){e.showDetails=!1}}},[t("div",{staticClass:"text-muted"},[e._v(" Monthly data usage ("),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/#is-octoprint-tunneling-free-to-all-users",target:"_blank"}},[e._v("Resets in "+e._s(e.daysUntilReset)+" days")]),e._v(") ")]),t("div",{class:e.usageClass},[e._v("Used "+e._s(e.usageMTD)+" of "+e._s(e.humanizedUsageCap)+".")]),e.overage?t("div",[e._v(" Your month-to-date tunnel data usage is over the Free plan limit. "),t("a",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button",href:"/ent_pub/pricing/"}},[e._v("Get Unlimited Tunnel Data")])]):e._e()]):t("div",{class:e.usageClass,on:{click:function(t){e.showDetails=!0},mouseover:function(t){e.showDetails=!0},mouseleave:function(t){e.showDetails=!1}}},[e._v(" "+e._s(e.percentage)+"% ")])]):e._e(),t("div",[e.printerId?t("iframe",{staticClass:"tunnel-iframe",attrs:{src:e.iframeUrl()+"#temp"}}):e._e()])])},$e=[],Ve=i("6625"),Ue=i.n(Ve),ze={name:"OctoPrintTunnelPage",components:{},props:{},data:function(){return{bytesMTD:null,usageCap:null,usageFetched:!1,isPro:!0,printerId:null,showDetails:!1}},computed:{usageClass(){return{"text-success":this.bytesMTD<.8*this.usageCap,"text-warning":this.bytesMTD>=.8*this.usageCap&&this.bytesMTD<this.usageCap,"text-danger":this.bytesMTD>=this.usageCap}},usageMTD(){return se()(this.bytesMTD)},humanizedUsageCap(){return se()(this.usageCap)},overage(){return this.bytesMTD>=this.usageCap},percentage(){return Math.round(this.bytesMTD/this.usageCap*100)},daysUntilReset(){const e=L()().endOf("month");return e.diff(L()(),"days")+1}},created(){this.isPro=Object(Se["f"])().is_pro,this.printerId=Ue()(window.location.pathname,"/").slice(-2,-1).pop()},mounted(){const e=Object(ue["a"])()?localStorage.getItem("skip-tunneling-warning"):null;"yes"!==e&&(this.$swal.Prompt.fire({html:'\n          <h4 class="text-center p-2">\n            <svg class="menu-icon" style="height: 1.1em; width: 1em; margin-right: 0.75em;">\n              <use href="#svg-tunnel" />\n            </svg>\n            OctoPrint/Klipper Secure Tunnel\n          </h4>\n          <div class="p-1">\n            It may take long time for OctoPrint/Mainsail/Fluidd page to load as it is securely tunneled via the Obico app server.\n          </div>\n          <div class="p-1">\n            <a target="_blank" href="https://www.obico.io/docs/user-guides/octoprint-tunneling/#is-octoprint-tunneling-free-to-all-users">\n            Learn more about OctoPrint/Klipper tunnel\'s security and page load speed.\n            <i class="fas fa-external-link-alt"></i>\n          </a>\n        </div>\n        ',input:"checkbox",inputPlaceholder:"Don't show again"},"octoprint-tunnel.warning").then(e=>{e.isConfirmed&&e.value&&Object(ue["a"])()&&localStorage.setItem("skip-tunneling-warning","yes")}),window.matchMedia("(pointer:none), (pointer:coarse)")&&document.querySelector(".swal2-popup").classList.add("x150"));const t=this,i=(e=!1)=>{Q["a"].get(X["a"].tunnelUsage()).then(i=>{t.bytesMTD=i.data.total,t.usageCap=i.data.monthly_cap,e&&(t.usageFetched=!0)})};setInterval(i,15e3),setTimeout(()=>{i(!0)},4e3)},methods:{iframeUrl(){return`/octoprint/${this.printerId}/`}}},We=ze,Ge=(i("bcfa"),i("d3f8"),Object(E["a"])(We,Be,$e,!1,null,"28928b3c",null)),qe=Ge.exports,He=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[t("b-container",{staticClass:"feedback-container"},[t("b-row",{staticClass:"justify-content-center"},[t("b-col",{attrs:{lg:"8"}},[t("div",{staticClass:"card"},[t("h5",{staticClass:"card-header text-center"},[e._v(" F "),t("i",{staticClass:"fas fa-search focused-feedback-icon"}),e._v("CUSED FEEDBACK ")]),t("loading",{attrs:{active:null===e.print,"is-full-page":!0}}),null!==e.print?t("div",[e.print.access_consented_at?t("div",[t("div",[t("vue-slick-carousel",{ref:"carousel",attrs:{arrows:!0,dots:!0},on:{afterChange:e.onNextShot},scopedSlots:e._u([{key:"customPaging",fn:function(i){return[t("div",{class:e.pageClass(i)},[e._v("•")])]}}],null,!1,3226812120)},e._l(e.shots,(function(i,s){return t("print-shot-card",{key:s,attrs:{shot:i},on:{shotChanged:e.onShotChanged}})})),1)],1),t("br"),t("div",{staticClass:"card-body p-3"},[t("a",{attrs:{href:`/print_history/${e.print.id}/`}},[t("i",{staticClass:"fas fa-chevron-left"}),e._v(" Print Page ")])])]):t("focused-feedback-consent",{attrs:{print:e.print},on:{"continue-btn-pressed":e.consentBtnPressed}})],1):e._e()],1)])],1)],1)]},proxy:!0}])})},Je=[],Ye=i("c707"),Ke=i.n(Ye),Ze=i("51f5"),Qe=i.n(Ze),Xe=i("a7ab"),et=i.n(Xe),tt=(i("7b8d"),i("6a2c"),i("18fa")),it=i.n(tt),st=(i("e40d"),function(){var e=this,t=e._self._c;return t("div",[t("img",{staticClass:"card-img-top",attrs:{src:e.shot.image_url}}),t("div",{staticClass:"px-3 pt-4"},[t("b-form-group",{attrs:{label:"Do you see any spaghetti in this picture?"}},[t("b-form-radio-group",{attrs:{options:e.options},on:{change:e.updateShot},model:{value:e.answer,callback:function(t){e.answer=t},expression:"answer"}})],1),e._m(0)],1)])}),nt=[function(){var e=this,t=e._self._c;return t("small",{staticClass:"text-muted"},[e._v(" Not sure? Look at "),t("a",{attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/how-does-credits-work#spaghetti-examples"}},[e._v("some examples. "),t("small",[t("i",{staticClass:"fas fa-external-link-alt"})])])])}],rt=i("8226"),at=i("2924"),ot={name:"PrintShotCard",components:{BFormGroup:rt["a"],BFormRadioGroup:at["a"]},props:{shot:{type:Object,required:!0}},data(){return{answer:this.shot.answer,options:[{text:"Yes",value:"LOOKS_BAD"},{text:"No",value:"LOOKS_OK"},{text:"I am not sure",value:"UNDECIDED"}]}},methods:{updateShot:function(e){Q["a"].put(X["a"].printShotFeedback(this.shot.id,this.shot.print_id),{answer:e}).then(e=>{const{instance:t,credited_dhs:i}=e.data;i>0?this.$swal.Prompt.fire({title:"You are awesome!",html:"<p>The AI failure detection just got a little better because of your feedback!</p><p>You just earned 2 non-expirable AI Detection Hours - Yay!</p>",confirmButtonText:"I'm done!",showCancelButton:!0,cancelButtonText:"Change feedback"}).then(e=>{e.isConfirmed?window.location.href="/print_history/":this.$emit("shotChanged",t)}):this.$emit("shotChanged",t)})}}},lt=ot,ct=Object(E["a"])(lt,st,nt,!1,null,null,null),dt=ct.exports,ut=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-wrapper",class:{collapsed:e.collapsed,"is-in-mobile":e.inMobileWebView,"is-in-popup":e.isPopup}},[t("nav",{staticClass:"side-nav"},[t("a",{staticClass:"sidebar-header",attrs:{href:"/"}},[t("svg",{staticClass:"logo-small"},[t("use",{attrs:{href:"#svg-logo-compact"}})])]),t("ul",{staticClass:"list-unstyled m-0"},[e.isEnt&&!e.user.is_pro?t("li",{class:{active:"/ent_pub/pricing/"===e.path}},[t("a",{staticClass:"primary",attrs:{href:"/ent_pub/pricing/"}},[t("font-awesome-icon",{attrs:{icon:"star"}}),e._v(" Upgrade to Pro ")],1)]):e._e(),e.user?t("li",{class:{active:e.path.includes("/printers/")}},[t("a",{attrs:{href:"/printers/"}},[t("svg",{staticStyle:{"margin-bottom":"5px"},attrs:{width:"1.4em",height:"1.4em"}},[t("use",{attrs:{href:"#svg-3d-printer"}})]),t("br"),e._v(" Printers ")])]):e._e(),e.user?t("li",{class:{active:e.path.includes("/g_code_")}},[t("a",{attrs:{href:"/g_code_folders/cloud/"}},[t("font-awesome-icon",{attrs:{icon:"fa-file-code"}}),e._v(" G-Codes ")],1)]):e._e(),e.user?t("li",{class:{active:e.path.includes("/print_history/")||e.path.includes("/prints/")}},[t("a",{attrs:{href:"/print_history/"}},[t("font-awesome-icon",{attrs:{icon:"fa-calendar-days"}}),e._v(" Print History ")],1)]):e._e(),e.user?t("li",{class:{active:e.path.includes("/stats/")}},[t("a",{attrs:{href:"/stats/"}},[t("font-awesome-icon",{attrs:{icon:"fa-chart-pie"}}),e._v(" Statistics ")],1)]):e._e()]),t("div",{staticClass:"side-nav-footer"},[t("ul",{staticClass:"list-unstyled m-0"},[e.isEnt?t("li",{class:{active:"/ent_pub/pricing/"===e.path}},[t("a",{attrs:{href:"/ent_pub/pricing/"}},[t("font-awesome-icon",{attrs:{icon:"fa-money-check-dollar"}}),e._v(" Pricing ")],1)]):e._e(),t("li",[t("a",{attrs:{href:"https://www.obico.io/help/",target:"_blank"}},[t("font-awesome-icon",{attrs:{icon:"fa-circle-question"}}),e._v(" Help ")],1)]),t("li",[t("a",{attrs:{href:"https://obico.io/discord",target:"_blank"}},[t("font-awesome-icon",{attrs:{icon:"fa-brands fa-discord"}}),e._v(" Community ")],1)]),e._m(0),e.user?t("li",{class:{active:"/printer_events/"===e.path}},[t("a",{attrs:{href:"/printer_events/"}},[t("div",{staticClass:"position-relative"},[t("font-awesome-icon",{attrs:{icon:"fas fa-bell"}}),e.hasUnseenPrinterEvents?t("span",{staticClass:"badge"},[e._v(e._s(e.unseenPrinterEventsDisplay))]):e._e()],1),t("span",{staticClass:"trim-text"},[e._v("Notifications")])])]):e._e(),e.user?t("li",{class:{active:e.path.includes("/user_preferences/")}},[t("a",{attrs:{href:"/user_preferences/"}},[t("font-awesome-icon",{attrs:{icon:"fas fa-cog"}}),t("span",{staticClass:"trim-text"},[e._v("Preferences")])],1)]):e._e()])])]),t("div",{staticClass:"content-wrapper",class:{"hide-top-nav":!e.$slots.topBarLeft&&!e.$slots.topBarRight||e.hideHeader}},[t("b-navbar",{staticClass:"top-nav"},[t("div",{staticClass:"d-flex align-items-center"},[t("b-button",{staticClass:"shadow-none p-0 mr-3 position-relative toggle-sidebar",attrs:{variant:"_"},on:{click:function(t){e.collapsed=!e.collapsed}}},[t("i",{staticClass:"fas fa-bars position-relative"},[e.hasUnseenPrinterEvents?t("div",{staticClass:"notification-dot"},[t("svg",{attrs:{width:"8px",height:"8px"}},[t("use",{attrs:{href:"#svg-circle-icon"}})])]):e._e()])]),e._t("topBarLeft")],2),e._t("topBarRight")],2),t("div",{staticClass:"page-content"},[e.layoutSections.contentTop&&!e.path.match("/printers/[0-9]+/control/")?t("content-top"):e._e(),e._t("content")],2)],1),t("div",{staticClass:"content-overlay",on:{click:function(t){e.collapsed=!0}}})])},pt=[function(){var e=this,t=e._self._c;return t("li",[t("hr",{staticClass:"my-0 mx-2"})])}],ht={},ft={name:"PageLayout",components:{...Object.keys(ht).reduce((e,t)=>Object.assign(e,{[t]:ht[t].importComponent}),{})},props:{isPopup:{type:Boolean,default:!1}},data(){return{layoutSections:ht,collapsed:!0,path:window.location.pathname,user:null,allowSignUp:!1,isEnt:!1}},computed:{inMobileWebView(){return Object(Se["a"])()},hideHeader(){const e=new URLSearchParams(window.location.search);return"true"===e.get("hide_header")},hasUnseenPrinterEvents(){return te()(this.user,"unseen_printer_events",0)>0},unseenPrinterEventsDisplay(){const e=te()(this.user,"unseen_printer_events",0);return e>99?"99+":e}},created(){const{ACCOUNT_ALLOW_SIGN_UP:e,IS_ENT:t}=Object(Se["e"])();this.allowSignUp=!!e,this.isEnt=!!t,this.user=Object(Se["f"])()},mounted(){const e=document.querySelector(".message-snippet");e&&this.inMobileWebView&&e.classList.add("is-in-mobile"),this.inMobileWebView&&(document.querySelector("body").style.paddingBottom=0)}},mt=ft,gt=(i("999e"),i("cadd"),Object(E["a"])(mt,ut,pt,!1,null,"3ae90ac2",null)),vt=gt.exports,bt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-body consent-section"},[t("div",[e._v(" Number of snapshots: "),t("span",{staticClass:"feedback-estimate"},[e._v(e._s(e.print.printshotfeedback_set.length))])]),t("p",[e._v(" Estimated time to finish: "),t("span",{staticClass:"feedback-estimate"},[e._v(e._s(e.estimatedFeedbackTime))])]),e._m(0),t("br"),t("button",{staticClass:"btn btn-primary btn-block",attrs:{disabled:!e.consentChecked,type:"button"},on:{click:function(t){return e.$emit("continue-btn-pressed")}}},[e._v(" Start Focused Feedback ")]),t("br"),t("div",{staticClass:"custom-control custom-checkbox form-check-inline"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.consentChecked,expression:"consentChecked"}],staticClass:"custom-control-input",attrs:{id:"consented-checkbox",type:"checkbox",name:"consented"},domProps:{checked:Array.isArray(e.consentChecked)?e._i(e.consentChecked,null)>-1:e.consentChecked},on:{change:function(t){var i=e.consentChecked,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,a=e._i(i,r);s.checked?a<0&&(e.consentChecked=i.concat([r])):a>-1&&(e.consentChecked=i.slice(0,a).concat(i.slice(a+1)))}else e.consentChecked=n}}}),e._m(1)]),t("br"),t("div",[t("span",{staticClass:"text-muted"},[e._v("File:")]),e._v(" "+e._s(e.print.filename)+" ")]),t("div",[t("span",{staticClass:"text-muted"},[e._v("Printed:")]),e._v(" "+e._s(e.print.started_at.fromNow())+" ")]),t("br"),e.print.video_url?t("video-box",{attrs:{"video-url":e.print.video_url,"poster-url":e.print.poster_url,"full-screen-btn":!1}}):t("div",[t("detective-working")],1)],1)},_t=[function(){var e=this,t=e._self._c;return t("p",{staticClass:"font-weight-light"},[e._v(" Help Obi get better at detecting failures by giving her in-depth feedback on the snapshots of the print. You will earn "),t("strong",{staticClass:"text-light"},[e._v("2 non-expirable AI Detection Hours")]),e._v(" after you finish this Focused Feedback. "),t("a",{attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/how-does-credits-work/"}},[e._v("Learn more. "),t("small",[t("i",{staticClass:"fas fa-external-link-alt"})])])])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"16px"},attrs:{for:"consented-checkbox"}},[e._v(" I grant the Obico app team members the permission to review the time-lapse video of the print shown on this page. "),t("a",{attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/how-does-credits-work#you-need-to-grant-permission-to-tsd-team-to-review-your-time-lapse"}},[e._v("Why is this necessary? "),t("small",[t("i",{staticClass:"fas fa-external-link-alt"})])])])}],Ct=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-img-top"},[t("video-player",{ref:"videoPlayer",staticClass:"vjs-default-skin vjs-big-play-centered",attrs:{options:e.playerOptions,playsinline:!0},on:{timeupdate:e.onTimeUpdate}}),t("div",{staticClass:"buttons-container"},[e.downloadBtn?t("a",{staticClass:"action-btn",attrs:{role:"button",title:"Download"},on:{click:function(t){return e.$emit("download")}}},[t("i",{staticClass:"fas fa-download",attrs:{"aria-hidden":"true"}})]):e._e(),e.fullscreenBtn?t("a",{staticClass:"action-btn",attrs:{role:"button",title:"Full screen"},on:{click:function(t){return e.$emit("fullscreen")}}},[t("i",{staticClass:"fa fa-expand",attrs:{"aria-hidden":"true"}})]):e._e(),e.exitFullscreenBtn?t("a",{staticClass:"action-btn",attrs:{role:"button",title:"Exit full screen"},on:{click:function(t){return e.$emit("exitFullscreen")}}},[t("i",{staticClass:"fa fa-times",attrs:{"aria-hidden":"true"}})]):e._e()])],1)},wt=[],yt=(i("fda2"),i("d6d3")),kt={name:"VideoBox",components:{videoPlayer:yt["videoPlayer"]},props:{videoUrl:{type:String,required:!0},posterUrl:{type:String,default:null},fullscreenBtn:{type:Boolean,default:!0},exitFullscreenBtn:{type:Boolean,default:!1},downloadBtn:{type:Boolean,default:!1},fluid:{type:Boolean,default:!0},autoplay:{type:Boolean,default:!1},defaultFullScreenToggle:{type:Boolean,default:!1}},computed:{playerOptions(){return{muted:!0,preload:"none",language:"en",playbackRates:[.5,1,1.5,2],fluid:this.fluid,fill:!this.fluid,autoplay:this.autoplay,sources:[{type:"video/mp4",src:this.videoUrl}],controlBar:{fullscreenToggle:this.defaultFullScreenToggle},poster:this.posterUrl}}},methods:{onTimeUpdate(e){this.$emit("timeupdate",e.currentTime()/e.duration())}}},St=kt,Pt=(i("58d0"),Object(E["a"])(St,Ct,wt,!1,null,"10df198e",null)),xt=Pt.exports,Tt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card bg-dark text-white"},[t("img",{staticClass:"card-img",attrs:{src:i("0469"),alt:"Obi is still working"}}),e._m(0)])},Ft=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-img-overlay",staticStyle:{"background-color":"rgba(0, 0, 0, 0.6)"}},[t("h5",{staticClass:"card-title text-center"},[e._v("Obi is still busy working on your time-lapse")])])}],Dt={name:"DetectiveWorking"},Ot=Dt,It=(i("9675"),Object(E["a"])(Ot,Tt,Ft,!1,null,"f48a916e",null)),At=It.exports,Mt={name:"FocusedFeedbackConsent",components:{VideoBox:xt,DetectiveWorking:At},props:{print:{type:Object,required:!0}},data(){return{consentChecked:!1}},computed:{estimatedFeedbackTime(){const e=12*this.print.printshotfeedback_set.length;return e<60?e+" seconds":L.a.duration(e,"seconds").humanize()}}},Et=Mt,Nt=(i("0ebf"),Object(E["a"])(Et,bt,_t,!1,null,"1bb94a58",null)),Rt=Nt.exports,jt={name:"PrintShotFeedbackApp",components:{FocusedFeedbackConsent:Rt,Loading:it.a,PrintShotCard:dt,VueSlickCarousel:et.a,PageLayout:vt},props:{config:{default:()=>{},type:Object}},data:function(){return{shots:[],currentShot:0,print:null}},computed:{},mounted(){this.fetchData()},methods:{fetchData(){Q["a"].get(X["a"].print(this.config.printId)).then(e=>{this.print=_e(e.data),this.shots=Ke()(this.print.printshotfeedback_set,"id")})},updatePrint(e){Q["a"].patch(X["a"].print(this.print.id),e).then(e=>this.print=e.data)},consentBtnPressed(){this.updatePrint({access_consented_at:L()()})},onShotChanged(e){const t=Qe()(this.shots,t=>t.id==e.id);this.$set(this.shots,t,e),this.$refs.carousel.next()},onNextShot(e){this.currentShot=e},pageClass(e){return e===this.currentShot?"page-visiting":this.shots[e].answered_at?"text-success":"page-unvisited"}}},Lt=jt,Bt=(i("c1e9"),Object(E["a"])(Lt,He,Je,!1,null,"050e065e",null)),$t=Bt.exports,Vt=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"topBarLeft",fn:function(){return[t("div",{staticClass:"actions-with-selected-desktop"},[t("b-form-group",{staticClass:"m-0"},[t("b-form-checkbox",{attrs:{size:"md"},model:{value:e.allPrintsSelected,callback:function(t){e.allPrintsSelected=t},expression:"allPrintsSelected"}})],1),t("div",[t("span",{directives:[{name:"show",rawName:"v-show",value:!e.selectedPrintIds.size,expression:"!selectedPrintIds.size"}],staticClass:"label",on:{click:function(t){e.allPrintsSelected=!e.allPrintsSelected}}},[e._v("Select all")]),t("b-dropdown",{directives:[{name:"show",rawName:"v-show",value:e.selectedPrintIds.size,expression:"selectedPrintIds.size"}],attrs:{"toggle-class":"btn btn-sm actions-with-selected-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[e._v(" "+e._s(e.selectedPrintIds.size)+" item"+e._s(1===e.selectedPrintIds.size?"":"s")+" selected ")]},proxy:!0}])},[t("b-dropdown-item",[t("div",{staticClass:"text-danger",on:{click:e.onDeleteBtnClick}},[t("i",{staticClass:"far fa-trash-alt"}),e._v("Delete ")])])],1)],1)],1)]},proxy:!0},{key:"topBarRight",fn:function(){return[t("div",{staticClass:"action-panel"},[t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn",title:"Sort By"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-sort-amount-down"})]},proxy:!0}])},[t("sorting-dropdown",{attrs:{"local-storage-prefix":e.sortingLocalStoragePrefix,"sorting-options":e.sortingOptions,"sorting-value":e.sortingValue},on:{onSortingUpdated:e.onSortingUpdated}})],1),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn","menu-class":"scrollable",title:"Filter"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-filter"})]},proxy:!0}])},[t("filtering-dropdown",{ref:"filteringDropdown1",attrs:{"local-storage-prefix":e.filterLocalStoragePrefix,"filter-options":e.filterOptions,"filter-values":e.filterValues,"filter-update-mixin":e.filterUpdateMixin},on:{onFilterUpdated:e.onFilterUpdated}})],1),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn d-md-none"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[t("cascaded-dropdown",{ref:"cascadedDropdown",attrs:{"menu-options":[{key:"sorting",icon:"fas fa-sort-amount-down",title:"Sort",expandable:!0},{key:"filtering",icon:"fas fa-filter",title:"Filter",expandable:!0}]},scopedSlots:e._u([{key:"sorting",fn:function(){return[t("sorting-dropdown",{attrs:{"local-storage-prefix":e.sortingLocalStoragePrefix,"sorting-options":e.sortingOptions,"sorting-value":e.sortingValue},on:{onSortingUpdated:e.onSortingUpdated}})]},proxy:!0},{key:"filtering",fn:function(){return[t("filtering-dropdown",{ref:"filteringDropdown2",attrs:{"local-storage-prefix":e.filterLocalStoragePrefix,"filter-options":e.filterOptions,"filter-values":e.filterValues,"filter-update-mixin":e.filterUpdateMixin},on:{onFilterUpdated:e.onFilterUpdated}})]},proxy:!0}])})],1)],1)]},proxy:!0},{key:"content",fn:function(){return[t("active-filter-notice",{attrs:{"filter-values":e.filterValues},on:{onShowAllClicked:e.resetFilters}}),t("b-container",[t("b-row",[t("b-col",[e.prints.length&&!e.loading?t("div",{staticClass:"prints-summary"},[t("div",{staticClass:"summary-item"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-hashtag"})]),t("div",{staticClass:"info"},[t("div",{staticClass:"title"},[e._v("Prints done")]),t("div",{staticClass:"value"},[e._v(" "+e._s(e.stats.total_print_count)+" ("),t("span",{staticClass:"text-success"},[e._v(e._s(e.stats.total_succeeded_print_count))]),e._v(" / "),t("span",{staticClass:"text-danger"},[e._v(e._s(e.stats.total_cancelled_print_count))]),e._v(") ")])])]),t("div",{staticClass:"summary-item"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"far fa-clock"})]),t("div",{staticClass:"info"},[t("div",{staticClass:"title"},[e._v("Total print time")]),t("div",{staticClass:"value"},[e._v(e._s(e.totalPrintTimeFormatted))])])]),t("div",{staticClass:"summary-item"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-ruler-horizontal"})]),t("div",{staticClass:"info"},[t("div",{staticClass:"title"},[t("help-widget",{attrs:{id:"filament-used-may-be-incorrect",highlight:!1,"show-close-button":!1}},[e._v(" Filament used ")])],1),t("div",{staticClass:"value"},[e._v(e._s(e.totalFilamentUsedFormatted))])])]),t("div",{staticClass:"btn-wrapper"},[t("a",{staticClass:"btn btn-secondary",attrs:{href:"/stats/"}},[e._v(" Full Stats "),t("i",{staticClass:"fas fa-arrow-right"})])])]):e._e()])],1),t("b-row",[e.prints.length||e.loading?t("b-col",[e._l(e.prints,(function(i,s){return t("print-history-item",{key:i.id,staticClass:"print-item",attrs:{print:i,index:s,selectable:!0,selected:e.selectedPrintIds.has(i.id)},on:{selectedChanged:e.onSelectedChanged}})})),t("mugen-scroll",{attrs:{handler:e.fetchMoreData,"should-handle":!e.loading}},[e.noMoreData?e._e():t("loading-placeholder")],1)],2):t("b-col",{staticClass:"text-center my-5"},[e._v("No prints found")])],1)],1),t("date-picker-modal",{ref:"datePickerModal",on:{picked:e.onDatesPicked}})]},proxy:!0}])})},Ut=[],zt=i("996c"),Wt=i.n(zt),Gt=function(){var e=this,t=e._self._c;return t("div",[null===e.menuExpanded?e._l(e.menuOptions,(function(i){return t("b-dropdown-item",{key:i.key,attrs:{href:i.href},on:{click:function(t){return e.onClick(i)}}},[i.expandable?t("div",{staticClass:"d-flex justify-content-between clickable-area",on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.menuExpanded=i.key}}},[t("div",[i.icon?t("i",{class:i.icon}):i.svgIcon?t("svg",{staticClass:"custom-svg-icon"},[t("use",{attrs:{href:"#"+i.svgIcon}})]):e._e(),t("span",[e._v(e._s(i.title))])]),t("div",[t("i",{staticClass:"fas fa-chevron-right m-0"})])]):t("div",{staticClass:"d-flex justify-content-between clickable-area"},[t("div",{class:i.customMenuOptionClass},[i.icon?t("i",{class:i.icon}):i.svgIcon?t("svg",{staticClass:"custom-svg-icon"},[t("use",{attrs:{href:"#"+i.svgIcon}})]):e._e(),t("span",[e._v(e._s(i.title))])])])])})):e._e(),null!==e.menuExpanded?[t("b-dropdown-item",[t("div",{staticClass:"clickable-area",on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.menuExpanded=null}}},[t("i",{staticClass:"fas fa-chevron-left"}),e._v("Back ")])]),t("b-dropdown-divider"),"sorting"===e.menuExpanded?t("div",[e._t("sorting")],2):e._e(),"filtering"===e.menuExpanded?t("div",[e._t("filtering")],2):e._e(),"storage"===e.menuExpanded?t("div",[e._t("storage")],2):e._e(),"grouping"===e.menuExpanded?t("div",[e._t("grouping")],2):e._e()]:e._e()],2)},qt=[],Ht={name:"CascadedDropdown",props:{menuOptions:{type:Array,required:!0}},data:function(){return{menuExpanded:null}},methods:{resetMenuExpanded(){this.menuExpanded=null},onClick(e){e.callback&&this.$emit("menuOptionClicked",e.key)}}},Jt=Ht,Yt=(i("fc0f"),Object(E["a"])(Jt,Gt,qt,!1,null,"9005c358",null)),Kt=Yt.exports,Zt=function(){var e=this,t=e._self._c;return t("div",[t("b-dropdown-text",{staticClass:"small text-secondary"},[e._v("SORT BY")]),e._l(e.sortingOptions.options,(function(i){return t("b-dropdown-item",{key:"s_"+i.key,nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.updateSorting({sorting:i})}}},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.sortingValue.sorting.key===i.key?"visible":"hidden"}}),e._v(" "+e._s(i.title)+" ")])})),t("b-dropdown-divider"),t("b-dropdown-text",{staticClass:"small text-secondary"},[e._v("DIRECTION")]),e._l(e.sortingDirections,(function(i){return t("b-dropdown-item",{key:"d_"+i.key,nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.updateSorting({direction:i})}}},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.sortingValue.direction.key===i.key?"visible":"hidden"}}),e._v(" "+e._s(i.title)+" ")])}))],2)},Qt=[];const Xt=[{key:"asc",title:"Ascending"},{key:"desc",title:"Descending"}];var ei={name:"SortingDropdown",props:{localStoragePrefix:{type:String,required:!0},sortingOptions:{type:Object,required:!0},sortingValue:{type:Object,required:!0}},data:function(){return{sortingDirections:Xt}},methods:{updateSorting({sorting:e,direction:t}){return e&&e.key!==this.sortingValue.sorting.key?(Object(a["b"])(this.localStoragePrefix+"-sorting",e.key),void this.$emit("onSortingUpdated",{...this.sortingValue,sorting:e})):t&&t.key!==this.sortingValue.direction.key?(Object(a["b"])(this.localStoragePrefix+"-direction",t.key),void this.$emit("onSortingUpdated",{...this.sortingValue,direction:t})):void 0}}};const ti=(e,t)=>{const i=Object(a["a"])(e+"-sorting",t.default.sorting),s=Object(a["a"])(e+"-direction",t.default.direction);return{sorting:t.options.find(e=>e.key===i),direction:Xt.find(e=>e.key===s)}};var ii=ei,si=Object(E["a"])(ii,Zt,Qt,!1,null,null,null),ni=si.exports,ri=function(){var e=this,t=e._self._c;return t("div",e._l(e.filterOptions,(function(i,s,n){return t("div",{key:s},[0!==n?t("b-dropdown-divider"):e._e(),t("b-dropdown-text",{staticClass:"small text-secondary"},[e._v(e._s(i.title.toUpperCase()))]),e._l(i.values,(function(n){return t("b-dropdown-item",{key:`f_${s}_${n.key}`,nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.updateFiltering({filterOptionKey:s,filterValueKey:n.key})}}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",class:{"checkmark-muted":i.multiple&&!n.includesAll&&(!Array.isArray(e.filterValues[s])||!e.filterValues[s].includes(n.key))},style:{visibility:Array.isArray(e.filterValues[s])&&e.filterValues[s].includes(n.key)||e.filterValues[s]===n.key||i.multiple&&!n.includesAll?"visible":"hidden"}}),t("div",{staticClass:"text"},[e._v(" "+e._s(n.title)+" "),n.subtitle?t("div",{staticClass:"subtitle"},[e._v(" "+e._s(n.subtitle)+" ")]):e._e()])])])}))],2)})),0)},ai=[],oi={name:"FilteringDropdown",props:{localStoragePrefix:{type:String,required:!0},filterOptions:{type:Object,required:!0},filterValues:{type:Object,required:!0},filterUpdateMixin:{type:Function,default:null}},methods:{updateFiltering({filterOptionKey:e,filterValueKey:t}){if(this.filterUpdateMixin){const i=this.filterUpdateMixin(e,t);if(!i)return}const i=this.filterOptions[e],s=i.values.find(e=>e.key===t),n=this.filterValues[e];let r;var o;i.multiple?s.includesAll?r=s.key:Array.isArray(n)?n.includes(t)?(r=n.filter(e=>e!==t),r.length||(r=(null===(o=i.values.find(e=>e.includesAll))||void 0===o?void 0:o.key)||[])):r=[...n,t]:r=[t]:r=t;r!==n&&(Object(a["b"])(`${this.localStoragePrefix}-${e}`,r),this.$emit("onFilterUpdated",e,r))}}};const li=(e,t)=>{let i={};for(const[s,n]of Object.entries(t)){const t=String(Object(a["a"])(`${e}-${s}`,n.default));if(n.multiple){const e=n.values.find(e=>e.includesAll);t===e.key?i[s]=t:i[s]=t.split(",")}else i[s]=t}return i},ci=(e,t,i)=>{let s={};for(const[n,r]of Object.entries(t)){const t=e[n];if(t.buildQueryParam){const e=i&&i(n,r);e&&(s={...s,...e})}else"none"!==r&&(s[t.queryParam]=r)}return s};var di=oi,ui=(i("5fdc"),Object(E["a"])(di,ri,ai,!1,null,"687a0a02",null)),pi=ui.exports,hi=function(){var e=this,t=e._self._c;return e.shouldShowFilterWarning?t("div",{staticClass:"active-filter-notice"},[e._m(0),t("div",{staticClass:"action-btn",on:{click:function(t){return e.$emit("onShowAllClicked")}}},[e._v("SHOW ALL")])]):e._e()},fi=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"filter"},[t("i",{staticClass:"fas fa-filter mr-2"}),e._v(" Filters applied ")])}],mi={name:"ActiveFilterNotice",props:{filterValues:{type:Object,required:!0}},computed:{activeFilters(){return Object.values(this.filterValues).filter(e=>"none"!==e)},shouldShowFilterWarning(){return 0!==this.activeFilters.length}}},gi=mi,vi=(i("b760"),Object(E["a"])(gi,hi,fi,!1,null,"3271445e",null)),bi=vi.exports,_i=function(){var e=this,t=e._self._c;return t("a",{staticClass:"print-container",attrs:{href:`/prints/${e.print.id}/${null!==e.index?"?index="+e.index:""}`}},[t("div",{staticClass:"status-indicator print-status-bg",class:e.print.status.key}),e.selectable?t("div",{staticClass:"checkbox-wrapper",class:{isSelected:e.isSelected}},[t("b-form-checkbox",{attrs:{size:"md"},model:{value:e.isSelected,callback:function(t){e.isSelected=t},expression:"isSelected"}})],1):e._e(),t("div",{staticClass:"main-content truncated-wrapper"},[t("div",{staticClass:"top"},[t("div",{staticClass:"title truncated",attrs:{title:e.fileName}},[e._v(e._s(e.fileName))])]),t("div",{staticClass:"bottom"},[t("div",{staticClass:"info"},[t("svg",{staticClass:"icon",attrs:{width:"1em",height:"1em"}},[t("use",{attrs:{href:"#svg-3d-printer"}})]),t("span",[e._v(e._s(e.print.printer?e.print.printer.name:"Unavailable"))])]),t("div",{staticClass:"info"},[t("i",{staticClass:"fas fa-calendar-alt icon"}),t("span",[e._v(e._s(e.print.started_at.format("MMM D, YYYY")))])])])]),e.print.poster_url?t("div",{staticClass:"poster"},[t("div",{staticClass:"img",style:{backgroundImage:`url(${e.print.poster_url})`}})]):t("div",{staticClass:"poster no-photo"},[t("svg",[t("use",{attrs:{href:"#svg-no-photo"}})])])])},Ci=[],wi={name:"PrintHistoryItem",components:{},props:{print:{type:Object,required:!0},index:{type:Number,default:null},selectable:{type:Boolean,default:!1},selected:{type:Boolean,default:!1}},data:function(){return{PrintStatus:be,isSelected:this.selected}},computed:{fileName(){return null===this.print.g_code_file?this.print.filename:this.print.g_code_file.filename}},watch:{isSelected(e){this.$emit("selectedChanged",this.print.id,e)},selected(e){this.isSelected=e}}},yi=wi,ki=(i("1279"),Object(E["a"])(yi,_i,Ci,!1,null,"11fbb7ad",null)),Si=ki.exports,Pi=function(){var e=this,t=e._self._c;return t("b-modal",{attrs:{id:"b-modal-pick-dates",title:"Select Dates","ok-title":"Apply",centered:""},on:{ok:e.handleOk,hidden:e.resetModal,shown:e.focusInput}},[t("form",{on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("div",{staticClass:"my-2"},[t("b-form-group",{attrs:{label:"Date from","label-for":"date_from",description:"If empty, will default to your registration date"}},[t("b-form-input",{ref:"dateFrom",attrs:{id:"date_from",type:"date",placeholder:"Enter date"},model:{value:e.dateFrom,callback:function(t){e.dateFrom=t},expression:"dateFrom"}})],1),t("b-form-group",{attrs:{label:"Date to","label-for":"date_to",description:"If empty, will default to today"}},[t("b-form-input",{ref:"dateTo",attrs:{id:"date_to",type:"date",placeholder:"Enter date"},model:{value:e.dateTo,callback:function(t){e.dateTo=t},expression:"dateTo"}})],1),e.errorMessage?t("b-alert",{staticClass:"mt-3",attrs:{variant:"danger",show:""}},[e._v(" "+e._s(e.errorMessage)+" ")]):e._e()],1)])])},xi=[],Ti={name:"DatePickerModal",data(){return{dateFrom:"",dateTo:"",isOpen:!1,errorMessage:""}},methods:{show(e,t){this.dateFrom=e||"",this.dateTo=t||"",this.isOpen=!0,this.$bvModal.show("b-modal-pick-dates")},focusInput(){this.$refs.dateFrom.select()},close(){this.$bvModal.hide("b-modal-pick-dates"),this.resetModal()},resetModal(){this.isOpen=!1,this.errorMessage=""},handleOk(e){e.preventDefault(),this.handleSubmit()},async handleSubmit(){this.dateFrom||this.dateTo?(this.$emit("picked",this.dateFrom,this.dateTo),this.$nextTick(()=>{this.close()})):this.errorMessage="At least one date is needed"}}},Fi=Ti,Di=(i("c5c0"),Object(E["a"])(Fi,Pi,xi,!1,null,"1dcebb82",null)),Oi=Di.exports,Ii=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:()=>e.show=!1,expression:"() => (show = false)"}],staticClass:"help-wrapper",class:{highlighted:e.highlight}},[t("div",{staticClass:"text",on:{click:function(t){e.positionWidget(),e.show=!e.show}}},[e._t("default")],2),t("div",{ref:"widgetWrapper",staticClass:"widget-wrapper"},[t("div",{staticClass:"question-mark",on:{click:function(t){e.positionWidget(),e.show=!e.show}}},[t("svg",[t("use",{attrs:{href:"#svg-question-icon"}})])]),t("transition",{attrs:{name:"pop-up"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],ref:"widget",staticClass:"widget",class:[e.xDirection,e.yDirection]},[e.showCloseButton?t("div",{staticClass:"close-button",on:{click:function(t){e.show=!1}}},[t("svg",{attrs:{width:"16",height:"16"}},[t("use",{attrs:{href:"#svg-cross-icon"}})])]):e._e(),t("div",{staticClass:"content"},["basic-streaming-on-pricing-page"===e.id?[t("div",[e._v(" Basic Streaming: "),t("ul",[t("li",[e._v("Up to 5 FPS (frame-per-second)")]),t("li",[e._v("Throttled for 30 seconds every minute")])])]),t("div",[e._v(" Learn more about "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/webcam-streaming-for-human-eyes/",target:"_blank"}},[e._v("the differences between the Premium Streaming and the Basic Streaming "),t("i",{staticClass:"fas fa-external-link-alt"})])])]:e._e(),"detective-hours-free-plan-on-pricing-page"===e.id?[t("h3",[e._v("Yup! Even Free account gets 10 AI Detection Hours for FREE each month.")]),t("ul",[t("li",[e._v("Unused AI Detection Hours roll over month to month.")]),t("li",[e._v(" You can "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work/"}},[e._v("earn free AI Detection Hours by helping her improve")]),e._v(". ")]),t("li",[e._v(" You can also "),t("a",{staticClass:"link",attrs:{href:"#need-more"}},[e._v("purchase additional AI hours")]),e._v(". ")])]),t("p",[e._v(" Learn more about "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-detective-hour-work/",target:"_blank"}},[e._v("how the AI Detection Hour works "),t("i",{staticClass:"fas fa-external-link-alt"})])])]:e._e(),"detective-hours-pro-plan-on-pricing-page"===e.id?[t("h3",[e._v("Pro plan includes 50 AI Detection Hours each month.")]),t("ul",[t("li",[e._v("Unused AI Detection Hours roll over month to month.")]),t("li",[e._v("AI Detection Hours expire when subscription ends.")]),t("li",[e._v(" You can "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work/"}},[e._v("earn more AI Detection Hours by helping her improve")]),e._v(". ")]),t("li",[e._v(" You can also "),t("a",{staticClass:"link",attrs:{href:"#need-more"}},[e._v("purchase additional AI hours")]),e._v(". ")])]),t("p",[e._v(" Learn more about "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-detective-hour-work/",target:"_blank"}},[e._v("how the AI Detection Hour works "),t("i",{staticClass:"fas fa-external-link-alt"})])])]:e._e(),"premium-streaming-on-pricing-page"===e.id?[t("div",[e._v(" Premium Streaming: "),t("ul",[t("li",[e._v("Up to 25 FPS (frame-per-second)")]),t("li",[e._v("Un-throttled")])])]),t("p",[e._v(" Learn more about "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/webcam-streaming-for-human-eyes/",target:"_blank"}},[e._v("the differences between the Premium Streaming and the Basic Streaming "),t("i",{staticClass:"fas fa-external-link-alt"})])])]:e._e(),"tunneling-free-plan-on-pricing-page"===e.id?[t("p",[e._v("Securely tunnel to your OctoPrint/Klipper from anywhere.")]),t("p",[e._v(" Free plan is subject to 300MB/month data cap. Data usage is reset on the 1st day of each month. ")]),t("p",[e._v(" Learn more about "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/",target:"_blank"}},[e._v("OctoPrint/Klipper tunnel "),t("i",{staticClass:"fas fa-external-link-alt"})])])]:e._e(),"tunneling-pro-plan-on-pricing-page"===e.id?[t("div",[e._v("Securely tunnel to your OctoPrint/Klipper from anywhere. Unlimited.")]),t("p",[e._v(" Learn more about "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/",target:"_blank"}},[e._v("OctoPrint/Klipper tunnel "),t("i",{staticClass:"fas fa-external-link-alt"})])])]:e._e(),"3rd-party-app-integration-free-on-pricing-page"===e.id?[t("div",[t("div",[e._v("The monthly cap is shared between 3rd-party app and OctoPrint tunnel:")]),t("ul",[t("li",[e._v("The combined usage can't exceed 300MB per month.")]),t("li",[e._v("Data usage is reset on the 1st day of each month.")])]),t("p",[e._v("Supported 3rd-party mobile apps:")]),t("img",{staticClass:"logo-icon",attrs:{src:i("ca14")}}),t("img",{staticClass:"logo-icon",attrs:{src:i("3ee0")}}),t("img",{staticClass:"logo-icon",attrs:{src:i("222b")}}),t("img",{staticClass:"logo-icon",attrs:{src:i("3957")}})])]:e._e(),"3rd-party-app-integration-pro-on-pricing-page"===e.id?[t("div",[t("p",[e._v("Supported 3rd-party mobile apps:")]),t("img",{staticClass:"logo-icon",attrs:{src:i("ca14")}}),t("img",{staticClass:"logo-icon",attrs:{src:i("3ee0")}}),t("img",{staticClass:"logo-icon",attrs:{src:i("222b")}}),t("img",{staticClass:"logo-icon",attrs:{src:i("3957")}})])]:e._e(),"filament-change-on-notification-preferences"===e.id?[t("i",[t("ul",[e._v(" Required versions: "),t("li",[e._v("OctoPrint 1.7.0 or higher")]),t("li",[e._v("The Obico plugin 1.8.11 or higher")])])]),t("h3",[e._v("Filament Runout Notifications")]),t("p",[e._v(" Host_action_commands must be enabled in your firmware to make it possible for your filament runout sensor to communicate with OctoPrint and the Obico app. If you enable action commands in your firmware, then the filament runout sensor can work properly and the Obico app can notify you when the filament runs out. Unfortunately, without host_action_commands enabled, OctoPrint is unable to communicate with the printer to know that a filament runout was detected. ")]),t("p",[e._v("To enable support, you need to do the following:")]),t("ul",[t("li",[e._v(" Marlin: Uncomment #define HOST_ACTION_COMMANDS in Configuration_adv.h and recompile. See here for more information on host_action_commands. ")])]),t("h3",[e._v("Color Change Notifications")]),t("p",[e._v(" Notifications on color change will work with any printer that has M600 enabled in its firmware. You do not need host_action_commands enabled to get notified when a color change is needed. ")])]:e._e(),"filament-used-may-be-incorrect"===e.id?[t("h3",[e._v("Is filament usage inaccurate?")]),t("p",[e._v(" G-code files uploaded to your Obico account before upgrading to Obico for OctoPrint version 2.3.0 or Obico for Klipper version 1.2.0 do not include filament usage data. ")]),t("p",[t("strong",[e._v("To ensure accurate filament usage and other statistics:")])]),t("ul",[t("li",[e._v(" Upload G-code files and start prints directly through Obico instead of OctoPrint/Klipper. ")]),t("li",[e._v(" Use a slicer that supports filament usage parameters, such as Cura, Prusa Slicer, SuperSlicer, IdeaMaker, or Simplify3D. ")]),t("li",[e._v(" Print statistics for G-code files deleted before 12/20/2022 are not included. For files deleted after 12/20/2022, statistics are preserved. ")])])]:e._e(),"thumbnail-setup-guide"===e.id?[t("p",[t("a",{attrs:{href:"https://obico.io/docs/user-guides/enable-gcode-thumbnails/",target:"_blank"}},[e._v("Learn how to configure G-Code preview generation in your slicer "),t("i",{staticClass:"fas fa-external-link-alt"})])])]:e._e(),"fan-speed-widget-help"===e.id?[t("p",[e._v(" Adjust the speed of the cooling fan by setting a percentage value between 0 and 100. The default value is usually 100, which means the fan will run at full speed. Lowering the fan speed can reduce noise and save energy, but may also affect print quality if the printer gets too hot. ")])]:e._e(),"print-speed-widget-help"===e.id?[t("p",[e._v(" Adjust the speed of your 3D printer by changing the speed of all movement commands by a specified factor. The default value is 100%, meaning that the printer will move at its standard speed. Lowering the print speed factor will slow down your print, while increasing it will speed it up. Value of 200% will double the speed. ")])]:e._e(),"flow-rate-widget-help"===e.id?[t("p",[e._v(" Flow rate is the speed at which the printer extrudes plastic. If the flow rate is too high, the printer may extrude too much plastic and create blobs or stringing, while too low flow rate may result in weak and brittle prints. Adjusting the flow rate can help achieve the optimal balance between speed and quality. The default value is 100%. ")])]:e._e()],2)])])],1)])},Ai=[],Mi=i("e67d"),Ei=i.n(Mi),Ni={name:"HelpWidget",directives:{ClickOutside:Ei.a},props:{id:{type:String,required:!0},highlight:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!1},textBefore:{type:String,default:""}},data(){return{show:!1,xDirection:"left",yDirection:"top"}},methods:{positionWidget(){this.$nextTick(()=>{var e,t;const i=(null===(e=this.$refs.widget)||void 0===e?void 0:e.offsetWidth)||360,s=(null===(t=this.$refs.widget)||void 0===t?void 0:t.offsetHeight)||420,n=i+10,r=s+10,a=this.$refs.widgetWrapper.getBoundingClientRect(),o=window.innerWidth-(a.left+a.width),l=window.innerHeight-(a.top+a.height);this.xDirection=o<n?"right":"left",this.yDirection=l<r?"bottom":"top"})}}},Ri=Ni,ji=(i("af1e"),i("adc8"),Object(E["a"])(Ri,Ii,Ai,!1,null,"15ca1109",null)),Li=ji.exports;const Bi="YYYY-MM-DD",$i=(e,t,i,s)=>({from_date:Vi(e,t,s).format(Bi),to_date:Ui(e,i).format(Bi),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}),Vi=(e,t,i)=>{const s=new Date,n=new Date(s.setDate(s.getDate()-s.getDay())),r=new Date(s.getFullYear(),s.getMonth(),1),a=new Date(s.getFullYear(),0,1);switch(e){case"this_week":return L()(n);case"this_month":return L()(r);case"this_year":return L()(a);case"custom":if(t)return L()(t)}return L()(i.date_joined)},Ui=(e,t)=>{const i=new Date,s=new Date(i.setDate(i.getDate()-i.getDay()+6)),n=new Date(i.getFullYear(),i.getMonth()+1,0),r=new Date(i.getFullYear(),11,31);switch(e){case"this_week":return L()(s);case"this_month":return L()(n);case"this_year":return L()(r);case"custom":if(t)return L()(t)}return L()()},zi=(e,t,i,s)=>{const n=Vi(e,t,s),r=Ui(e,i),a=r.diff(n,"days");return a<=31?"day":a<=95?"week":a<=366?"month":"year"},Wi=24,Gi="printsSorting",qi={options:[{title:"Date",key:"date"}],default:{sorting:"date",direction:"desc"}},Hi="YYYY-MM-DD",Ji="printsFiltering",Yi={timePeriod:{title:"Time Period",buildQueryParam:$i,values:[{key:"none",title:"All"},{key:"this_week",title:"This Week"},{key:"this_month",title:"This Month"},{key:"this_year",title:"This Year"},{key:"custom",title:"Custom"}],default:"none"},printStatus:{title:"Print Status",queryParam:"filter",values:[{key:"none",title:"All"},{key:"finished",title:"Finished"},{key:"cancelled",title:"Cancelled"}],default:"none"},feedbackNeeded:{title:"Feedback Needed",queryParam:"feedback_needed",values:[{key:"none",title:"All"},{key:"need_alert_overwrite",title:"Review Needed"},{key:"need_print_shot_feedback",title:"Focused Feedback Needed"}],default:"none"},printers:{title:"Printers",queryParam:"filter_by_printer_ids",multiple:!0,values:[{key:"none",title:"All",includesAll:!0}],default:"none"}};var Ki={name:"PrintHistoryPage",components:{MugenScroll:Wt.a,PageLayout:vt,CascadedDropdown:Kt,DatePickerModal:Oi,SortingDropdown:ni,FilteringDropdown:pi,ActiveFilterNotice:bi,PrintHistoryItem:Si,HelpWidget:Li},data:function(){return{stats:{},prints:[],loading:!1,noMoreData:!1,user:null,selectedPrintIds:new Set,sortingLocalStoragePrefix:Gi,sortingOptions:qi,sortingValue:ti(Gi,qi),filterLocalStoragePrefix:Ji,filterOptions:Yi,filterValues:li(Ji,Yi)}},computed:{totalPrintTimeFormatted(){return ae(this.stats.total_print_time)},totalFilamentUsedFormatted(){var e;return le(null===(e=this.stats)||void 0===e?void 0:e.total_filament_used)},defaultStatsParams(){return{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,from_date:L()(this.user.date_joined).format(Hi),to_date:L()(new Date).format(Hi),group_by:"year"}},allPrintsSelected:{get:function(){return this.selectedPrintIds.size>=this.prints.length&&0!==this.prints.length},set:function(e){e?this.selectedPrintIds=new Set(this.prints.map(e=>e.id)):this.selectedPrintIds.size===this.prints.length&&(this.selectedPrintIds=new Set)}}},created(){this.user=Object(Se["f"])(),this.updateCustomPeriodFilterSubtitle(),Q["a"].get(X["a"].printers(),{params:{with_archived:!1}}).then(e=>{if(e.data.forEach(e=>{this.filterOptions.printers.values.push({key:String(e.id),title:e.name})}),"none"!==this.filterValues.printers){const t=e.data.map(e=>String(e.id));this.filterValues.printers=this.filterValues.printers.filter(e=>t.includes(e)),Object(a["b"])(Ji+"-printers",this.filterValues.printers)}this.refetchData()})},methods:{fetchMoreData(){this.noMoreData||(this.loading=!0,Q["a"].get(X["a"].prints(),{params:{start:this.prints.length,limit:Wi,...ci(this.filterOptions,this.filterValues,this.customFilterParamsBuilder),sorting:`${this.sortingValue.sorting.key}_${this.sortingValue.direction.key}`}}).then(e=>{this.loading=!1,this.noMoreData=e.data.length<Wi,this.prints.push(...e.data.map(e=>_e(e)))}).catch(e=>{this.errorDialog(e)}))},refetchData(){this.prints=[],this.selectedPrintIds=new Set,this.noMoreData=!1,this.fetchMoreData(),this.fetchStats()},fetchStats(){Q["a"].get(X["a"].stats(),{params:{...this.defaultStatsParams,...ci(this.filterOptions,this.filterValues,this.customFilterParamsBuilder)}}).then(e=>{this.stats=e.data}).catch(e=>{this.errorDialog(e)})},onSelectedChanged(e,t){const i=new Set(this.selectedPrintIds);t?i.add(e):i.delete(e),this.selectedPrintIds=i},onDeleteBtnClick(){const e=Array.from(this.selectedPrintIds);this.$swal.Prompt.fire({title:"Are you sure?",text:`Delete ${this.selectedPrintIds.size} print(s)? This action can not be undone.`,showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&Q["a"].post(X["a"].printsBulkDelete(),{print_ids:e}).then(()=>{this.refetchData()})})},onSortingUpdated(e){this.sortingValue=e,this.refetchData()},onFilterUpdated(e,t){this.filterValues[e]=t,this.refetchData()},resetFilters(){for(const e of Object.keys(this.filterValues))this.filterValues[e]="none",Object(a["b"])(`${Ji}-${e}`,"none");this.updateCustomPeriodFilterSubtitle(),this.refetchData()},getCurrentDateFrom(){return Object(a["a"])(Ji+"-timePeriod-dateFrom")||null},getCurrentDateTo(){return Object(a["a"])(Ji+"-timePeriod-dateTo")||null},filterUpdateMixin(e,t){if("timePeriod"===e){if("custom"===t){if("custom"!==this.filterValues.timePeriod)this.$refs.datePickerModal.show();else{const e=this.getCurrentDateFrom(),t=this.getCurrentDateTo();this.$refs.datePickerModal.show(e,t)}return}this.$nextTick(()=>{this.updateCustomPeriodFilterSubtitle()})}return!0},onDatesPicked(e,t){(e||t)&&(this.filterValues.timePeriod="custom",Object(a["b"])(Ji+"-timePeriod","custom"),Object(a["b"])(Ji+"-timePeriod-dateFrom",e),Object(a["b"])(Ji+"-timePeriod-dateTo",t),this.updateCustomPeriodFilterSubtitle(),this.refetchData())},customFilterParamsBuilder(e,t){if("timePeriod"===e)return this.filterOptions[e].buildQueryParam(t,this.getCurrentDateFrom(),this.getCurrentDateTo(),this.user)},updateCustomPeriodFilterSubtitle(){let e="";if("custom"===this.filterValues.timePeriod){const t="MMM D, YYYY",i=this.getCurrentDateFrom(),s=this.getCurrentDateTo(),n=i?L()(i).format(t):"Until",r=s?L()(s).format(t):"and later";e=`${n}${i&&s?" - ":" "}${r}`}const t=this.filterOptions.timePeriod.values.findIndex(e=>"custom"===e.key);this.filterOptions.timePeriod.values[t].subtitle=e,this.$refs.filteringDropdown1&&this.$refs.filteringDropdown1.$forceUpdate(),this.$refs.filteringDropdown2&&this.$refs.filteringDropdown2.$forceUpdate()}}},Zi=Ki,Qi=(i("c131"),Object(E["a"])(Zi,Vt,Ut,!1,null,"06c62c9e",null)),Xi=Qi.exports,es=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"topBarRight",fn:function(){return[t("div",{staticClass:"action-panel"},[t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-chart-bar"})]},proxy:!0}])},[t("b-dropdown-text",{staticClass:"small text-secondary"},[e._v("GROUP BY")]),e._l(e.groupingOptions,(function(i){return t("b-dropdown-item",{key:i.key,nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),(()=>e.updateChartGrouping(i)).apply(null,arguments)}}},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.activeGrouping===i.key?"visible":"hidden"}}),t("span",[e._v(e._s(i.title))])])}))],2),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn","menu-class":"scrollable",title:"Filter"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-filter"})]},proxy:!0}])},[t("filtering-dropdown",{ref:"filteringDropdown1",attrs:{"local-storage-prefix":e.filterLocalStoragePrefix,"filter-options":e.filterOptions,"filter-values":e.filterValues,"filter-update-mixin":e.filterUpdateMixin},on:{onFilterUpdated:e.onFilterUpdated}})],1),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn d-md-none"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[t("cascaded-dropdown",{ref:"cascadedDropdown",attrs:{"menu-options":[{key:"grouping",icon:"fas fa-chart-bar",title:"Group By",expandable:!0},{key:"filtering",icon:"fas fa-filter",title:"Filter",expandable:!0}]},scopedSlots:e._u([{key:"grouping",fn:function(){return[t("b-dropdown-text",{staticClass:"small text-secondary"},[e._v("GROUP BY")]),e._l(e.groupingOptions,(function(i){return t("b-dropdown-item",{key:i.key,nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),(()=>e.updateChartGrouping(i)).apply(null,arguments)}}},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.activeGrouping===i.key?"visible":"hidden"}}),t("span",[e._v(e._s(i.title))])])}))]},proxy:!0},{key:"filtering",fn:function(){return[t("filtering-dropdown",{ref:"filteringDropdown2",attrs:{"local-storage-prefix":e.filterLocalStoragePrefix,"filter-options":e.filterOptions,"filter-values":e.filterValues,"filter-update-mixin":e.filterUpdateMixin},on:{onFilterUpdated:e.onFilterUpdated}})]},proxy:!0}])})],1)],1)]},proxy:!0},{key:"content",fn:function(){return[t("active-filter-notice",{attrs:{"filter-values":e.filterValues},on:{onShowAllClicked:e.resetFilters}}),e.stats?t("b-container",[t("b-row",[t("b-col",[t("muted-alert",{staticClass:"muted-alert"},[e._v("Statistics include deleted prints")])],1)],1),t("b-row",[t("b-col",{staticClass:"mb-4 mb-lg-0",attrs:{lg:"6"}},[t("div",{staticClass:"stats-block total-prints"},[t("div",{staticClass:"stats-block-title"},[t("i",{staticClass:"fas fa-hashtag"}),t("span",[e._v("Total Prints")])]),t("div",{staticClass:"chart-wrapper"},[t("div",{staticClass:"legend"},[t("div",{staticClass:"line"},[t("div",{staticClass:"square success"}),t("div",{staticClass:"title"},[e._v("Finished:")]),t("div",{staticClass:"value"},[e._v(e._s(e.stats?e.stats.total_succeeded_print_count:""))])]),t("div",{staticClass:"line"},[t("div",{staticClass:"square danger"}),t("div",{staticClass:"title"},[e._v("Cancelled:")]),t("div",{staticClass:"value"},[e._v(e._s(e.stats?e.stats.total_cancelled_print_count:""))])])]),t("div",{ref:"totalPrintsDonutChart"})])])]),t("b-col",{attrs:{lg:"6"}},[t("div",{staticClass:"stats-block print-time"},[t("div",{staticClass:"stats-block-title"},[t("i",{staticClass:"far fa-clock"}),t("span",[e._v("Print Time")])]),t("div",{staticClass:"info total-print-time"},[t("div",{staticClass:"title"},[e._v("Total print time")]),t("div",{staticClass:"value"},[e._v(e._s(e.humanizedDuration(e.stats.total_print_time)))])]),t("div",{staticClass:"other-print-time-numbers"},[t("div",{staticClass:"info"},[t("div",{staticClass:"title"},[e._v("Longest print")]),t("div",{staticClass:"value"},[e._v(e._s(e.humanizedDuration(e.stats.longest_print_time)))])]),t("div",{staticClass:"divider"}),t("div",{staticClass:"info"},[t("div",{staticClass:"title"},[e._v("Average print")]),t("div",{staticClass:"value"},[e._v(e._s(e.humanizedDuration(e.stats.average_print_time)))])])])])])],1),t("b-row",{staticClass:"mt-4"},[t("b-col",[t("div",{staticClass:"stats-block bar-chart"},[t("div",{staticClass:"stats-block-title"},[t("i",{staticClass:"fas fa-hashtag"}),t("span",[e._v("Prints Count")])]),t("div",{ref:"printCountGroupsChart",staticClass:"bar-chart-wrapper"})])])],1),t("b-row",{staticClass:"mt-4"},[t("b-col",[t("div",{staticClass:"stats-block bar-chart"},[t("div",{staticClass:"stats-block-title"},[t("i",{staticClass:"far fa-clock"}),t("span",[e._v("Print Time")])]),t("div",{ref:"printTimeGroupsChart",staticClass:"bar-chart-wrapper"})])])],1),t("b-row",{staticClass:"mt-4"},[t("b-col",[t("div",{staticClass:"stats-block bar-chart filament-used-groups"},[t("div",{staticClass:"stats-block-title"},[t("i",{staticClass:"fas fa-ruler-horizontal"}),t("div",{staticClass:"title-group"},[t("span",[t("help-widget",{attrs:{id:"filament-used-may-be-incorrect",highlight:!1,"show-close-button":!1}},[e._v(" Filament Usage ")])],1),t("div",{staticClass:"divider"}),t("div",{staticClass:"subtitle"},[e._v(e._s(e.totalFilamentUsedFormatted)+" total")])])]),t("div",{ref:"filamentUsedGroupsChart",staticClass:"bar-chart-wrapper"})])])],1)],1):t("loading-placeholder"),t("date-picker-modal",{ref:"datePickerModal",on:{picked:e.onDatesPicked}})]},proxy:!0}])})},ts=[],is=function(){var e=this,t=e._self._c;return t("div",{staticClass:"alert-wrapper"},[e._m(0),t("p",{staticClass:"message"},[e._t("default")],2)])},ss=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-info-circle"})])}],ns={name:"MutedAlert"},rs=ns,as=(i("b5c8"),Object(E["a"])(rs,is,ss,!1,null,"55bd9838",null)),os=as.exports,ls=i("898b");const cs=(e,{name:t=(([e])=>e),value:i=(([,e])=>e),totalValue:s=null,totalValueFormat:n=",",title:r,width:a=180,height:o=180,innerRadius:l=Math.min(a,o)/3.6,outerRadius:c=Math.min(a,o)/2,labelRadius:d=(l+c)/2,format:u=",",names:p,colors:h,stroke:f=(l>0?"none":"white"),strokeWidth:m=10,strokeLinejoin:g="round",padAngle:v=("none"===f?2/c:0),emptyState:b=!1}={})=>{const _=ls["h"](e,t),C=ls["h"](e,i),w=ls["l"](_.length).filter(e=>!isNaN(C[e]));void 0===p&&(p=_),p=new ls["a"](p),void 0===h&&(h=ls["p"][p.size]),void 0===h&&(h=ls["k"](e=>ls["g"](.8*e+.1),p.size));const y=ls["o"](p,h);if(void 0===r){const e=ls["f"](u);r=t=>""+e(C[t])}else{const t=ls["h"](e,e=>e),i=r;r=s=>i(t[s],s,e)}const k=ls["j"]().padAngle(v).sort(null).value(e=>C[e])(w),S=ls["b"]().innerRadius(l).outerRadius(c),P=ls["b"]().innerRadius(d).outerRadius(d),x=ls["e"]("svg").attr("width",a).attr("height",o).attr("viewBox",[-a/2,-o/2,a,o]).attr("style","max-width: 100%; height: auto; height: intrinsic;");if(x.append("g").attr("stroke",f).attr("stroke-width",m).attr("stroke-linejoin",g).selectAll("path").data(k).join("path").attr("fill",e=>y(_[e.data])).attr("d",S).append("title").text(e=>r(e.data)),x.append("g").attr("font-family","sans-serif").attr("font-size",14).attr("text-anchor","middle").selectAll("text").data(k).join("text").attr("transform",e=>`translate(${P.centroid(e)})`).selectAll("tspan").data(e=>{if(b)return["0%"];const t=(""+r(e.data)).split(/\n/);return e.endAngle-e.startAngle>.25?t:t.slice(0,1)}).join("tspan").attr("x",0).attr("y",(e,t)=>"0.3em").attr("font-weight",(e,t)=>t?null:"bold").attr("fill","#fff").text(e=>e),s){x.append("text").attr("font-size",12).attr("dy","-.75em").attr("text-anchor","middle").attr("fill","var(--color-text-secondary)").text("Total");const e=ls["f"](n);x.append("text").attr("dy",".75em").attr("font-size",14).attr("text-anchor","middle").attr("font-weight","bold").attr("fill","var(--color-text-primary)").text(e(s))}return Object.assign(x.node(),{scales:{color:y}})};var ds=i("b279");const us=(e,{x:t=((e,t)=>t),y:i=(e=>e),title:s,marginTop:n=20,marginRight:r=0,marginBottom:a=40,marginLeft:o=40,width:l=640,height:c=210,xDomain:d,xRange:u=[o,l-r],xLabelShow:p=(e=>!0),xLabelRotation:h=0,yType:f=ls["n"],yDomain:m,yRange:g=[c-a,n],yTicks:v=c/40,xPadding:b=.1,yFormat:_,yTickFormat:C=null,yLabel:w,color:y="currentColor"}={})=>{const k=ls["h"](e,t),S=ls["h"](e,i);void 0===d&&(d=k),void 0===m&&(m=[0,ls["i"](S)]),d=new ls["a"](d);const P=ls["l"](k.length).filter(e=>d.has(k[e])),x=ls["m"](d,u).padding(b),T=f(m,g),F=ls["c"](x).tickSizeOuter(0),D=ls["d"](T).ticks(v,_);if(C&&D.tickFormat(C),void 0===s){const e=T.tickFormat(100,_);s=t=>`${k[t]}: ${e(S[t])}`}else{const t=ls["h"](e,e=>e),i=s;s=s=>i(t[s],s,e)}const O=ls["e"]("svg").attr("width",l).attr("height",c).attr("viewBox",[0,0,l,c]).attr("style","max-width: 100%; height: auto; height: intrinsic;");O.append("g").attr("transform",`translate(${o},0)`).call(D).call(e=>e.selectAll(".tick line").clone().attr("x2",l-o-r).attr("stroke-opacity",.1)).call(e=>e.selectAll("text").attr("font-size",11));const I=O.append("g").attr("fill",y).selectAll("rect").data(P).join("rect").attr("x",e=>x(k[e])).attr("y",e=>T(S[e])).attr("height",e=>T(0)-T(S[e])).attr("width",x.bandwidth()).attr("rx",2);return s&&I.append("title").text(s),O.append("g").attr("transform",`translate(0,${c-a})`).call(F).selectAll("text").attr("transform",h?`translate(-10,0)rotate(-${h})`:"").attr("font-size",11).call((function(e){e.each((function(e,t){var i=ls["q"](this),s=i.text().split("\r")[0].split("\n");i.text(""),p(t)&&(i.append("tspan").attr("x",0).attr("dy","1em").attr("text-anchor",h?"end":"middle").text(s[0]),2===s.length&&i.append("tspan").attr("x",0).attr("dy","1.2em").text(s[1]))}))})),O.node()},ps=(e,t,i="day",s)=>{const n=e/t,r="day"===i?30:"week"===i?70:35,a=20;let o,l;return n>=r?(o=1,l=0):(o=Math.ceil(a/n),l=45),{frequency:o,rotation:l,value:e=>{const t=L()(e.key);let n,r="";if("day"===i)n=Object(ds["b"])(t,"M/D"),r=Object(ds["b"])(t,"ddd");else if("week"===i){n=Object(ds["b"])(t,"M/D");const e=t.clone().endOf("week"),i=e.isBefore(s)?e:s;n+="-"+(i.month()===t.month()?i.format("D"):i.format("M/D")),r=6===i.diff(t,"days")?"Week "+t.week():""}else"month"===i?(n=Object(ds["b"])(t,"MMM"),r=Object(ds["b"])(t,"YYYY")):n=Object(ds["b"])(t,"YYYY");let a=n;0===l&&(a+="\n"+r);const o=Object(ds["b"])(t,"M/D/YYYY");return a+="\r"+o,a},shouldShow:e=>e%o===0}},hs="statsGrouping",fs="YYYY-MM-DD",ms="statsFiltering",gs={timePeriod:{title:"Time Period",buildQueryParam:$i,values:[{key:"none",title:"All"},{key:"this_week",title:"This Week"},{key:"this_month",title:"This Month"},{key:"this_year",title:"This Year"},{key:"custom",title:"Custom"}],default:"none"},printStatus:{title:"Print Status",queryParam:"filter",values:[{key:"none",title:"All"},{key:"finished",title:"Finished"},{key:"cancelled",title:"Cancelled"}],default:"none"},printers:{title:"Printers",queryParam:"filter_by_printer_ids",multiple:!0,values:[{key:"none",title:"All",includesAll:!0}],default:"none"}};var vs={name:"StatsPage",components:{PageLayout:vt,MutedAlert:os,CascadedDropdown:Kt,FilteringDropdown:pi,ActiveFilterNotice:bi,DatePickerModal:Oi,HelpWidget:Li},data:function(){return{user:null,stats:null,groupingOptions:[{key:"auto",title:"Auto"},{key:"day",title:"Day"},{key:"week",title:"Week"},{key:"month",title:"Month"},{key:"year",title:"Year"}],activeGrouping:Object(a["a"])(hs,"auto"),filterLocalStoragePrefix:ms,filterOptions:gs,filterValues:li(ms,gs)}},computed:{defaultStatsParams(){return{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,from_date:L()(this.user.date_joined).format(fs),to_date:L()(new Date).format(fs),group_by:this.getActiveGrouping()}},isEmptyState(){var e;return!(null!==(e=this.stats)&&void 0!==e&&e.total_print_count)},finishedPrintsPercentage(){var e,t;const i=null===(e=this.stats)||void 0===e?void 0:e.total_succeeded_print_count,s=null===(t=this.stats)||void 0===t?void 0:t.total_print_count;return i&&s?Math.round(i/s*100):0},cancelledPrintsPercentage(){var e;const t=null===(e=this.stats)||void 0===e?void 0:e.total_print_count;return t?100-this.finishedPrintsPercentage:0},totalFilamentUsedFormatted(){var e;return le(null===(e=this.stats)||void 0===e?void 0:e.total_filament_used)}},created(){this.user=Object(Se["f"])(),this.updateCustomPeriodFilterSubtitle(),Q["a"].get(X["a"].printers(),{params:{with_archived:!1}}).then(e=>{if(e.data.forEach(e=>{this.filterOptions.printers.values.push({key:String(e.id),title:e.name})}),"none"!==this.filterValues.printers){const t=e.data.map(e=>String(e.id));this.filterValues.printers=this.filterValues.printers.filter(e=>t.includes(e)),Object(a["b"])(ms+"-printers",this.filterValues.printers)}this.fetchStats()})},mounted(){addEventListener("resize",this.drawCharts)},unmounted(){removeEventListener("resize",this.drawCharts)},methods:{getFilterParamsFromQuery(){let e={};const t=new URLSearchParams(window.location.search),i=t.entries(),s=["hide_header"];for(const[n,r]of i)n&&r&&!s.includes(n)&&(e[n]=e[n]?Array.isArray(e[n])?[...e[n],r]:[e[n],r]:r);return console.log("params",e),e},fetchStats(){Q["a"].get(X["a"].stats(),{params:{with_deleted:!0,...this.defaultStatsParams,...ci(this.filterOptions,this.filterValues,this.customFilterParamsBuilder),...this.getFilterParamsFromQuery()}}).then(e=>{this.stats=e.data,this.$nextTick(this.drawCharts)}).catch(e=>{this.errorDialog(e,"Failed to fetch statistics")})},updateChartGrouping(e){this.activeGrouping=e.key,Object(a["b"])(hs,e.key),this.fetchStats()},drawCharts(){if(!this.stats)return;this.$refs.totalPrintsDonutChart.replaceChildren(cs([{name:"Finished",value:this.isEmptyState?.5:this.finishedPrintsPercentage/100},{name:"Cancelled",value:this.isEmptyState?.5:this.cancelledPrintsPercentage/100}],{name:e=>e.name,value:e=>e.value,format:".0%",totalValue:this.isEmptyState?"0":this.stats.total_succeeded_print_count+this.stats.total_cancelled_print_count,names:["Finished","Cancelled"],colors:["var(--color-success)","var(--color-danger)"],emptyState:this.isEmptyState}));const e=Math.max(...this.stats.print_count_groups.map(e=>e.value));this.drawBarChart({data:this.stats.print_count_groups,ref:this.$refs.printCountGroupsChart,yFormat:"d",titleValue:e=>e+" print(s)",yDomain:[0,e||1],yTicks:Math.min(e||1,5)});const t=Math.max(...this.stats.print_time_groups.map(e=>e.value)),i=Math.round(t/3600);this.drawBarChart({data:this.stats.print_time_groups.map(e=>({...e,value:e.value/3600})),ref:this.$refs.printTimeGroupsChart,yFormat:"d",yTickFormat:e=>e>8760?Math.round(e/8760)+"y":e>=24?Math.round(e/24)+"d":e+"h",titleValue:e=>this.humanizedDuration(3600*e),yDomain:[0,i||1],yTicks:Math.min(i||1,5)});const s=Math.max(...this.stats.filament_used_groups.map(e=>e.value)),n=Math.round(s/1e3);this.drawBarChart({data:this.stats.filament_used_groups.map(e=>({...e,value:e.value/1e3})),ref:this.$refs.filamentUsedGroupsChart,yFormat:"d",yTickFormat:e=>e+"m",titleValue:e=>e>=1e3?Math.round(e/1e3)+"km":e+"m",yDomain:[0,n||1],yTicks:Math.min(n||1,5)})},drawBarChart({data:e,ref:t,yFormat:i,yTickFormat:s,yTicks:n,yDomain:r,titleValue:a}){var o;const l=t.offsetWidth,c=e.length,d=ps(l,c,(null===(o=this.getFilterParamsFromQuery())||void 0===o?void 0:o.group_by)||this.getActiveGrouping(),Ui(this.filterValues.timePeriod,this.getCurrentDateTo()));t.replaceChildren(us(e,{xLabelRotation:d.rotation,xLabelShow:d.shouldShow,x:d.value,y:e=>e.value,yFormat:i,yTickFormat:s,yDomain:r,yTicks:n,width:l,color:"var(--color-divider)",title:e=>{const t=d.value(e).split("\r")[0].split("\n");return`${t[0]+(t[1]?", "+t[1]:"")} — ${a?a(e.value):e.value}`},marginBottom:55}))},humanizedDuration:ae,onFilterUpdated(e,t){this.filterValues[e]=t,this.fetchStats()},resetFilters(){for(const e of Object.keys(this.filterValues))this.filterValues[e]="none",Object(a["b"])(`${ms}-${e}`,"none");this.updateCustomPeriodFilterSubtitle(),this.fetchStats()},getActiveGrouping(){return"auto"===this.activeGrouping?zi(this.filterValues.timePeriod,this.getCurrentDateFrom(),this.getCurrentDateTo(),this.user):this.activeGrouping},getCurrentDateFrom(){return Object(a["a"])(ms+"-timePeriod-dateFrom")||null},getCurrentDateTo(){return Object(a["a"])(ms+"-timePeriod-dateTo")||null},filterUpdateMixin(e,t){if("timePeriod"===e){if("custom"===t){if("custom"!==this.filterValues.timePeriod)this.$refs.datePickerModal.show();else{const e=this.getCurrentDateFrom(),t=this.getCurrentDateTo();this.$refs.datePickerModal.show(e,t)}return}this.$nextTick(()=>{this.updateCustomPeriodFilterSubtitle()})}return!0},onDatesPicked(e,t){(e||t)&&(this.filterValues.timePeriod="custom",Object(a["b"])(ms+"-timePeriod","custom"),Object(a["b"])(ms+"-timePeriod-dateFrom",e),Object(a["b"])(ms+"-timePeriod-dateTo",t),this.updateCustomPeriodFilterSubtitle(),this.fetchStats())},customFilterParamsBuilder(e,t){if("timePeriod"===e)return this.filterOptions[e].buildQueryParam(t,this.getCurrentDateFrom(),this.getCurrentDateTo(),this.user)},updateCustomPeriodFilterSubtitle(){let e="";if("custom"===this.filterValues.timePeriod){const t="MMM D, YYYY",i=this.getCurrentDateFrom(),s=this.getCurrentDateTo(),n=i?L()(i).format(t):"Until",r=s?L()(s).format(t):"and later";e=`${n}${i&&s?" - ":" "}${r}`}const t=this.filterOptions.timePeriod.values.findIndex(e=>"custom"===e.key);this.filterOptions.timePeriod.values[t].subtitle=e,this.$refs.filteringDropdown1&&this.$refs.filteringDropdown1.$forceUpdate(),this.$refs.filteringDropdown2&&this.$refs.filteringDropdown2.$forceUpdate()}}},bs=vs,_s=(i("b025"),Object(E["a"])(bs,es,ts,!1,null,"6721876c",null)),Cs=_s.exports,ws=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"topBarLeft",fn:function(){return[t("div",{staticClass:"actions-with-selected-desktop"},[t("b-form-group",{staticClass:"m-0"},[t("b-form-checkbox",{attrs:{size:"lg"},model:{value:e.allPrintsSelected,callback:function(t){e.allPrintsSelected=t},expression:"allPrintsSelected"}})],1),t("div",[t("span",{directives:[{name:"show",rawName:"v-show",value:!e.selectedPrintIds.size,expression:"!selectedPrintIds.size"}],staticClass:"label",on:{click:function(t){e.allPrintsSelected=!e.allPrintsSelected}}},[e._v("Select all")]),t("b-dropdown",{directives:[{name:"show",rawName:"v-show",value:e.selectedPrintIds.size,expression:"selectedPrintIds.size"}],attrs:{"toggle-class":"btn btn-sm actions-with-selected-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[e._v(" "+e._s(e.selectedPrintIds.size)+" item"+e._s(1===e.selectedPrintIds.size?"":"s")+" selected... ")]},proxy:!0}])},[t("b-dropdown-item",[t("div",{staticClass:"text-danger",on:{click:e.onDeleteBtnClick}},[t("i",{staticClass:"far fa-trash-alt"}),e._v("Delete ")])])],1)],1)],1)]},proxy:!0},{key:"topBarRight",fn:function(){return[t("div",{staticClass:"action-panel"},[t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn",title:"Sort By"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-sort-amount-down"})]},proxy:!0}])},[t("sorting-dropdown",{attrs:{"local-storage-prefix":e.sortingLocalStoragePrefix,"sorting-options":e.sortingOptions,"sorting-value":e.sortingValue},on:{onSortingUpdated:e.onSortingUpdated}})],1),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn","menu-class":"scrollable",title:"Filter"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-filter"})]},proxy:!0}])},[t("filtering-dropdown",{attrs:{"local-storage-prefix":e.filterLocalStoragePrefix,"filter-options":e.filterOptions,"filter-values":e.filterValues},on:{onFilterUpdated:e.onFilterUpdated}})],1),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn d-md-none"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[t("cascaded-dropdown",{ref:"cascadedDropdown",attrs:{"menu-options":[{key:"sorting",icon:"fas fa-sort-amount-down",title:"Sort",expandable:!0},{key:"filtering",icon:"fas fa-filter",title:"Filter",expandable:!0}]},scopedSlots:e._u([{key:"sorting",fn:function(){return[t("sorting-dropdown",{attrs:{"local-storage-prefix":e.sortingLocalStoragePrefix,"sorting-options":e.sortingOptions,"sorting-value":e.sortingValue},on:{onSortingUpdated:e.onSortingUpdated}})]},proxy:!0},{key:"filtering",fn:function(){return[t("filtering-dropdown",{attrs:{"local-storage-prefix":e.filterLocalStoragePrefix,"filter-options":e.filterOptions,"filter-values":e.filterValues},on:{onFilterUpdated:e.onFilterUpdated}})]},proxy:!0}])})],1)],1)]},proxy:!0},{key:"content",fn:function(){return[t("active-filter-notice",{attrs:{"filter-values":e.filterValues},on:{onShowAllClicked:e.resetFilters}}),t("b-container",[t("b-row",{directives:[{name:"show",rawName:"v-show",value:e.prints.length,expression:"prints.length"}],staticClass:"print-cards"},e._l(e.visiblePrints,(function(i){return t("print-card",{key:i.id,attrs:{print:i,selected:e.selectedPrintIds.has(i.id)},on:{selectedChanged:e.onSelectedChanged,printDeleted:e.onPrintDeleted,printDataChanged:e.printDataChanged,fullscreen:e.openFullScreen}})})),1),t("mugen-scroll",{staticClass:"text-center p-4",attrs:{handler:e.fetchMoreData,"should-handle":!e.loading}},[e.noMoreData?t("div",{staticClass:"text-center p-2"},[e._v("No more time-lapses.")]):e._e(),e.noMoreData?e._e():t("b-spinner",{attrs:{label:"Loading..."}})],1),t("b-modal",{attrs:{id:"tl-fullscreen-modal",size:"full","hide-header":!0,"hide-footer":!0},on:{hidden:e.fullScreenClosed}},[t("FullScreenPrintCard",{attrs:{print:e.fullScreenPrint,"video-url":e.fullScreenPrintVideoUrl,autoplay:!0}})],1)],1)]},proxy:!0}])})},ys=[],ks=i("dd61"),Ss=i.n(ks),Ps=function(){var e=this,t=e._self._c;return t("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 print-card"},[t("div",{staticClass:"card vld-parent"},[e.isPublic?t("div",{staticClass:"card-header"},[e._v("- By "+e._s(e.print.creator_name))]):t("div",{staticClass:"card-header"},[t("div",{style:{visibility:e.hasSelectedChangedListener?"visible":"hidden"}},[t("b-form-checkbox",{staticClass:"text-decoration-none",attrs:{size:"lg"},model:{value:e.isSelected,callback:function(t){e.isSelected=t},expression:"isSelected"}})],1),t("b-form-radio-group",{attrs:{buttons:"","button-variant":"outline-primary",name:"radio-btn-outline"},model:{value:e.selectedCardView,callback:function(t){e.selectedCardView=t},expression:"selectedCardView"}},[t("b-form-radio",{staticClass:"no-corner no-shadow",attrs:{value:"detective",disabled:!e.canShowDetectiveView}},[t("i",{staticClass:"fas fa-balance-scale"})]),t("b-form-radio",{staticClass:"no-corner no-shadow",attrs:{value:"info"}},[t("i",{staticClass:"fas fa-info"})])],1),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[e.print.video_url&&!e.print.video_archived_at?t("b-dropdown-item",{attrs:{href:e.print.video_url,target:"_blank"}},[t("i",{staticClass:"fas fa-download"}),e._v("Download Original Time-lapse ")]):e._e(),e.print.tagged_video_url&&!e.print.video_archived_at?t("b-dropdown-item",{attrs:{href:e.print.tagged_video_url,target:"_blank"}},[t("i",{staticClass:"fas fa-download"}),e._v("Download Detective Time-lapse ")]):e._e(),t("b-dropdown-divider"),t("b-dropdown-item",{on:{click:e.deleteVideo}},[t("span",{staticClass:"text-danger"},[t("i",{staticClass:"fas fa-trash-alt"}),e._v("Delete ")])])],1)],1),t("div",[e.print.video_archived_at?t("div",{staticClass:"position-relative"},[t("div",{staticClass:"poster-placeholder-wrapper"},[t("svg",{staticClass:"poster-placeholder"},[t("use",{attrs:{href:e.posterSrc}})])]),t("div",{staticClass:"archived-info"},[t("div",{staticClass:"text"},[e._v(" Video file is deleted. "),t("a",{attrs:{href:"#"},on:{click:function(t){return e.showVideoArchivedDescription(t)}}},[e._v("Why?")])])])]):t("div",[e.videoUrl?t("video-box",{attrs:{"video-url":e.videoUrl,"poster-url":e.print.poster_url,fluid:!0,"fullscreen-btn":e.hasFullscreenListener},on:{timeupdate:e.onTimeUpdate,fullscreen:function(t){return e.$emit("fullscreen",e.print.id,e.videoUrl)}}}):t("div",[t("detective-working")],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"info"==e.cardView&&!e.isPublic,expression:"cardView == 'info' && !isPublic"}]},[t("div",{staticClass:"card-body"},[t("div",{staticClass:"container"},[t("div",{staticClass:"row"},[e._m(0),t("div",{staticClass:"col-8"},[e._v(e._s(e.print.filename))])]),t("div",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"row",attrs:{title:e.humanizedPrintedOrUploadedTime(e.longFormat=!0)}},[t("div",{staticClass:"text-muted col-4"},[e._v(" "+e._s(e.wasTimelapseUploaded?"Uploaded":"Printed")+" "),t("span",{staticClass:"float-right"},[e._v(":")])]),t("div",{staticClass:"col-8"},[e._v(e._s(e.humanizedPrintedOrUploadedTime())+" "+e._s(e.endStatus))])]),!e.wasTimelapseUploaded&&e.duration?t("div",{staticClass:"row",attrs:{id:"dur-"+e.print.id}},[t("b-tooltip",{attrs:{target:"dur-"+e.print.id,triggers:"hover"}},[e._v(" "+e._s(e._f("floor")(e._f("duration")(e.duration,"asHours")))+":"+e._s(e._f("duration")(e.duration,"minutes"))+":"+e._s(e._f("duration")(e.duration,"seconds"))+" ")]),e._m(1),t("div",{staticClass:"col-8"},[e._v(e._s(e.duration.humanize()))])],1):e._e()])])]),e.isPublic?t("div",{staticClass:"bg-warning alert-banner text-center",style:{opacity:e.normalizedP>.4?1:0}},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" Possible failure detected! ")]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:"detective"==e.cardView||e.isPublic,expression:"cardView == 'detective' || isPublic"}]},[e.print.prediction_json_url?t("failure-detection-gauge",{attrs:{"normalized-p":e.normalizedP}}):e._e(),e.isPublic?e._e():t("div",{staticClass:"feedback-section"},[t("div",{staticClass:"text-center py-2 px-3"},[t("div",{staticClass:"lead",class:[e.print.alerted_at?"text-danger":"text-success"]},[e._v(" "+e._s(e.print.alerted_at?"Failure detected":"No failure detected")+" ")]),t("div",{staticClass:"py-2"},[e._v(" Did we get it right? "),t("b-button",{staticClass:"mx-2 btn-sm",attrs:{variant:e.thumbedUp?"primary":"outline"},on:{click:e.onThumbUpClick}},[e.inflightAlertOverwrite?t("b-spinner",{attrs:{type:"grow",small:""}}):t("i",{staticClass:"fas fa-thumbs-up"})],1),t("b-button",{staticClass:"mx-2 btn-sm",attrs:{variant:e.thumbedDown?"primary":"outline"},on:{click:e.onThumbDownClick}},[e.inflightAlertOverwrite?t("b-spinner",{attrs:{type:"grow",small:""}}):t("i",{staticClass:"fas fa-thumbs-down"})],1)],1),t("transition",{attrs:{name:"bounce"}},[e.print.printShotFeedbackEligible?t("div",{staticClass:"pt-2"},[t("a",{staticClass:"btn btn-sm btn-outline-primary px-4",attrs:{role:"button",href:e.focusedFeedbackLink}},[e._v(" F "),t("i",{staticClass:"fas fa-search focused-feedback-icon"}),e._v("CUSED FEEDBACK "),e.print.need_print_shot_feedback?t("svg",{staticClass:"seg-control-icon ml-1 double-hours-icon"},[t("use",{attrs:{href:"#svg-hour-double"}})]):e._e()])]):e._e()])],1),t("div",{staticClass:"text-muted py-2 px-3 help-text"},[e.print.printShotFeedbackEligible?t("small",[e.print.need_print_shot_feedback?t("span",[e._v(" With Focused Feedback, you can tell us exactly where we got it wrong. This is the most effective way to help us improve. "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work#you-earn-detective-hours-for-giving-focused-feedback"}},[e._v("You will earn 2 AI Detection Hours once you finish the Focused Feedback")]),e._v(". ")]):t("span",[e._v("Thank you for completing the Focused Feedback. You have earned 2 non-expirable AI Detection Hours. You can click the button again to change your feedback.")])]):t("small",[e._v(" Every time you give us feedback, "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work/"}},[e._v("you help us get better at detecting failures")]),e._v(". ")])])])],1)])])])},xs=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-muted col-4"},[e._v(" File "),t("span",{staticClass:"float-right"},[e._v(":")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-muted col-4"},[e._v(" Duration "),t("span",{staticClass:"float-right"},[e._v(":")])])}],Ts=function(){var e=this,t=e._self._c;return t("div",{staticClass:"obico-gauge-container"},[t("span",{style:{color:e.titleColor},attrs:{id:"title"}},[e._v(e._s(e.titleText))]),t("div",{staticClass:"obico-gauge"},[t("radial-gauge",{attrs:{value:e.value,options:e.computedOptions}})],1),t("hr")])},Fs=[],Ds=i("7489"),Os=i("59cf"),Is={name:"FailureDetectionGauge",components:{RadialGauge:Ds["a"]},props:{normalizedP:{type:Number,required:!0},isWatching:{type:Boolean,default:!0},options:{type:Object,default:null}},computed:{computedOptions(){if(null!==this.options)return this.options;const e={highlight1:Object(P["a"])()===Os["a"].Light?"#929292":"#8395a7",highlight2:Object(P["a"])()===Os["a"].Light?"#b7b7b7":"#a8bacc",highlight3:Object(P["a"])()===Os["a"].Light?"#7b7b7b":"#6c7e90",needle:Object(P["a"])()===Os["a"].Light?"#2d3e4f":"#ffffff"};return{valueDec:0,valueInt:0,width:240,height:240,units:!1,box:!1,minValue:0,maxValue:100,majorTicks:["","","",""],minorTicks:4,highlights:[{from:0,to:33,color:this.isWatching?"#5cb85c":e.highlight1},{from:33,to:67,color:this.isWatching?"#f0ad4e":e.highlight2},{from:67,to:100,color:this.isWatching?"#d9534f":e.highlight3}],colorPlate:"rgba(255,255,255,.0)",colorTitle:"#5cb85c",colorStrokeTicks:"#EBEBEB",colorNeedleEnd:this.isWatching?"rgba(255, 160, 122, .9)":e.needle,colorNeedle:this.isWatching?"rgba(240, 128, 128, 1)":e.needle,colorNeedleShadowUp:this.isWatching?"rgba(2,255,255,0.2)":e.needle,valueBox:!1,animationRule:"bounce",animationDuration:500,animatedValue:!0,startAngle:90,ticksAngle:180,borders:!1}},value(){return 100*this.normalizedP},titleText(){if(!this.isWatching)return"Not Watching";switch(this.level()){case 0:return"Looking Good";case 1:return"Fishy...";case 2:return"Failing!";default:return"Looking Good"}},titleColor(){if(!this.isWatching)return"var(--color-text-secondary)";switch(this.level()){case 0:return"#5cb85c";case 1:return"#f0ad4e";case 2:return"#d9534f";default:return"#5cb85c"}}},methods:{level(){return this.value>66?2:this.value>33?1:0}}},As=Is,Ms=(i("bb8b"),Object(E["a"])(As,Ts,Fs,!1,null,"53a506c4",null)),Es=Ms.exports,Ns={name:"PrintCard",components:{VideoBox:xt,FailureDetectionGauge:Es,DetectiveWorking:At},props:{print:{type:Object,required:!0},isPublic:{type:Boolean,default:!1},selected:{type:Boolean,default:!1}},data:function(){return{ALERT_THRESHOLD:.4,currentPosition:0,predictions:[],selectedCardView:"detective",inflightAlertOverwrite:null,isSelected:this.selected}},computed:{wasTimelapseUploaded(){return null!==this.print.uploaded_at},endStatus(){return this.print.cancelled_at?"(Cancelled)":""},duration(){return this.print.ended_at&&this.print.started_at?L.a.duration(this.print.ended_at.diff(this.print.started_at)):null},canShowDetectiveView(){return null!==this.print.prediction_json_url&&null!==this.print.tagged_video_url||!!(this.print.uploaded_at&&L()().diff(this.print.uploaded_at,"hours")<24)},cardView(){return this.canShowDetectiveView?this.selectedCardView:"info"},videoUrl(){return"info"==this.cardView?this.print.video_url:this.print.tagged_video_url},thumbedUp(){return!!this.print.alert_overwrite&&this.print.has_alerts^"NOT_FAILED"===this.print.alert_overwrite},thumbedDown(){return!!this.print.alert_overwrite&&this.print.has_alerts^"FAILED"===this.print.alert_overwrite},focusedFeedbackLink(){return`/prints/shot-feedback/${this.print.id}/`},hasSelectedChangedListener(){return Boolean(this.$listeners&&this.$listeners.selectedChanged)},hasFullscreenListener(){return Boolean(this.$listeners&&this.$listeners.fullscreen)},normalizedP(){return Object(ds["d"])(this.predictions,this.currentPosition,this.isPublic)},posterSrc(){return this.print.poster_url||"#svg-3d-printer"}},watch:{isSelected(e){this.$emit("selectedChanged",this.print.id,e)}},mounted(){this.print.prediction_json_url&&this.fetchPredictions(),this.print.tagged_video_url||(this.selectedCardView="info")},methods:{onTimeUpdate(e){this.currentPosition=e},deleteVideo(){Q["a"].delete(X["a"].print(this.print.id)).then(()=>{this.$emit("printDeleted",this.print.id)})},onThumbUpClick(){this.inflightAlertOverwrite=this.print.has_alerts?"FAILED":"NOT_FAILED",this.alertOverwrite(this.inflightAlertOverwrite)},onThumbDownClick(){this.inflightAlertOverwrite=this.print.has_alerts?"NOT_FAILED":"FAILED",this.alertOverwrite(this.inflightAlertOverwrite)},alertOverwrite(e){Q["a"].patch(X["a"].print(this.print.id),{alert_overwrite:e}).then(e=>{this.$emit("printDataChanged",e.data),this.inflightAlertOverwrite=null})},fetchPredictions(){Q["a"].get(this.print.prediction_json_url).then(e=>{this.predictions=e.data})},humanizedPrintedOrUploadedTime(e=!1){if(!this.print.uploaded_at&&!this.print.ended_at)return"-";const t=this.wasTimelapseUploaded?this.print.uploaded_at:this.print.ended_at;return e?t.format("LLLL"):t.fromNow()},showVideoArchivedDescription(e){e.preventDefault(),this.$swal.Prompt.fire({title:"Time-lapse video deleted",html:'\n          <p>Time-lapse videos older than 6-months are deleted from the Obico app server as they are rarely needed and cost significant amount to store in the cloud.</p>\n          <p>If you are a Pro subscriber and you don\'t want your time-lapse videos to be deleted, please <a href="mailto:support@obico.io?subject=Please%20keep%20my%20timelapse%20videos">contact us</a>.</p>\n          ',showCloseButton:!0})}}},Rs=Ns,js=(i("be61"),Object(E["a"])(Rs,Ps,xs,!1,null,"479b252b",null)),Ls=js.exports,Bs=function(){var e=this,t=e._self._c;return t("div",[t("video-box",{attrs:{"video-url":e.videoUrl,"poster-url":e.print.poster_url,fluid:!1,autoplay:e.autoplay,"fullscreen-btn":!1},on:{timeupdate:e.onTimeUpdate}}),e.isPublic?t("div",{staticClass:"bg-warning alert-banner text-center",style:{opacity:e.normalizedP>.4?1:0}},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" Possible failure detected! ")]):e._e(),t("failure-detection-gauge",{attrs:{"normalized-p":e.normalizedP}})],1)},$s=[],Vs={name:"FullScreenPrintCard",components:{VideoBox:xt,FailureDetectionGauge:Es},props:{print:{type:Object,required:!0},videoUrl:{type:String,required:!0},initialPosition:{type:Number,default:()=>0},autoplay:{type:Boolean,default:()=>!1},isPublic:{type:Boolean,default:!1}},data(){return{currentPosition:0,predictions:[]}},computed:{normalizedP(){return Object(ds["d"])(this.predictions,this.currentPosition,this.isPublic)}},mounted(){this.print.prediction_json_url&&this.fetchPredictions()},methods:{onTimeUpdate(e){this.currentPosition=e},fetchPredictions(){Q["a"].get(this.print.prediction_json_url).then(e=>{this.predictions=e.data})}}},Us=Vs,zs=(i("6892"),Object(E["a"])(Us,Bs,$s,!1,null,"749e3f52",null)),Ws=zs.exports;const Gs=6,qs="printsPageSorting",Hs={options:[{title:"Date",key:"date"}],default:{sorting:"date",direction:"desc"}},Js="printsPageFiltering",Ys={printStatus:{title:"Print Status",queryParam:"filter",values:[{key:"none",title:"All"},{key:"finished",title:"Finished"},{key:"cancelled",title:"Cancelled"}],default:"none"},feedbackNeeded:{title:"Feedback Needed",queryParam:"feedback_needed",values:[{key:"none",title:"All"},{key:"need_alert_overwrite",title:"Review Needed"},{key:"need_print_shot_feedback",title:"Focused Feedback Needed"}],default:"none"}};var Ks={name:"PrintsPage",components:{MugenScroll:Wt.a,PrintCard:Ls,FullScreenPrintCard:Ws,PageLayout:vt,CascadedDropdown:Kt,FilteringDropdown:pi,SortingDropdown:ni,ActiveFilterNotice:bi},data:function(){return{prints:[],selectedPrintIds:new Set,loading:!1,noMoreData:!1,fullScreenPrint:null,fullScreenPrintVideoUrl:null,sortingLocalStoragePrefix:qs,sortingOptions:Hs,sortingValue:ti(qs,Hs),filterLocalStoragePrefix:Js,filterOptions:Ys,filterValues:li(Js,Ys)}},computed:{visiblePrints(){return this.prints.filter(e=>e.ended_at)},allPrintsSelected:{get:function(){return this.selectedPrintIds.size>=this.prints.length&&0!==this.prints.length},set:function(e){this.selectedPrintIds=e?new Set(Ss()(this.prints,"id")):new Set}}},created(){this.refetchData()},methods:{fetchMoreData(){this.noMoreData||(this.loading=!0,Q["a"].get(X["a"].prints(),{params:{start:this.prints.length,limit:Gs,...ci(this.filterOptions,this.filterValues,this.customFilterParamsBuilder),sorting:`${this.sortingValue.sorting.key}_${this.sortingValue.direction.key}`}}).then(e=>{this.loading=!1,this.noMoreData=e.data.length<Gs,this.prints.push(...e.data.map(e=>_e(e)))}))},refetchData(){this.prints=[],this.selectedPrintIds=new Set,this.noMoreData=!1,this.fetchMoreData()},onSelectedChanged(e,t){const i=new Set(this.selectedPrintIds);t?i.add(e):i.delete(e),this.selectedPrintIds=i},onDeleteBtnClick(){const e=Array.from(this.selectedPrintIds);this.$swal.Prompt.fire({title:"Are you sure?",text:`Delete ${this.selectedPrintIds.size} print(s)? This action can not be undone.`,showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&Q["a"].post(X["a"].printsBulkDelete(),{print_ids:e}).then(()=>{e.forEach(e=>this.onPrintDeleted(e,!1)),this.$swal.Toast.fire({title:e.length+" time-lapse(s) deleted!"}),this.selectedPrintIds=new Set})})},onPrintDeleted(e,t=!0){const i=Qe()(this.prints,t=>t.id==e),s=this.prints[i];this.$delete(this.prints,i),t&&this.$swal.Toast.fire({title:`Time-lapse ${s.filename} deleted!`})},printDataChanged(e){const t=Qe()(this.prints,t=>t.id==e.id);this.$set(this.prints,t,_e(e))},openFullScreen(e,t){const i=Qe()(this.prints,t=>t.id==e);-1!=i&&(this.fullScreenPrint=this.prints[i],this.fullScreenPrintVideoUrl=t,this.$bvModal.show("tl-fullscreen-modal"))},fullScreenClosed(){this.fullScreenPrint=null,this.fullScreenPrintVideoUrl=null},onSortingUpdated(e){this.sortingValue=e,this.refetchData()},onFilterUpdated(e,t){this.filterValues[e]=t,this.refetchData()},resetFilters(){for(const e of Object.keys(this.filterValues))this.filterValues[e]="none",Object(a["b"])(`${Js}-${e}`,"none");this.refetchData()}}},Zs=Ks,Qs=(i("f757"),Object(E["a"])(Zs,ws,ys,!1,null,"9569fe6c",null)),Xs=Qs.exports,en=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[e.isLoading?t("loading-placeholder"):t("b-container",{attrs:{fluid:""}},[t("b-row",[t("b-col",{attrs:{lg:"5"}},[t("div",{staticClass:"print-info"},[t("div",{staticClass:"card-container print-details"},[e.currentIndex||0===e.currentIndex?t("div",{staticClass:"navigation-container"},[t("b-button",{attrs:{variant:"outline-secondary",disabled:!e.prevPrint},on:{click:function(t){return t.preventDefault(),e.switchToPrint(e.prevPrint)}}},[t("i",{staticClass:"fas fa-chevron-left"}),e._v("  "+e._s(e.PrevPrintButtonTitle)+" ")]),t("div",{staticClass:"summary truncated-wrapper"},[t("div",{staticClass:"date truncated"},[e._v(" "+e._s(e.print.started_at.format(e.absoluteDateFormat))+" ")])]),t("b-button",{attrs:{variant:"outline-secondary",disabled:!e.nextPrint},on:{click:function(t){return t.preventDefault(),e.switchToPrint(e.nextPrint)}}},[e._v(" "+e._s(e.NextPrintButtonTitle)+"  "),t("i",{staticClass:"fas fa-chevron-right"})])],1):e._e(),t("div",[t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-info"})]),t("div",{staticClass:"title"},[e._v("Status")])]),t("div",{staticClass:"value"},[t("div",{staticClass:"print-status-color",class:e.print.status.key},[e._v(" "+e._s(e.print.status.title)+" ")])])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"far fa-clock"})]),t("div",{staticClass:"title"},[e._v("Start time")])]),t("div",{staticClass:"value"},[e._v(e._s(e.print.started_at.format(e.absoluteDateFormat)))])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"far fa-clock"})]),t("div",{staticClass:"title"},[e._v("End time")])]),t("div",{staticClass:"value"},[e._v(" "+e._s(e.print.ended_at?e.print.ended_at.format(e.absoluteDateFormat):"-")+" ")])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-clock"})]),t("div",{staticClass:"title"},[e._v("Duration")])]),t("div",{staticClass:"value"},[e._v(e._s(e.print.duration||"-"))])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-ruler-horizontal"})]),t("div",{staticClass:"title"},[e._v("Filament used")])]),t("div",{staticClass:"value"},[e._v(" "+e._s(e.print.filament_used?e.humanizedFilamentUsage(e.print.filament_used):"-")+" ")])])])]),t("g-code-details",{attrs:{file:e.print.g_code_file||{filename:e.print.filename},"show-open-button":e.print.g_code_file&&!e.print.g_code_file.resident_printer&&!e.print.g_code_file.deleted}}),t("div",{staticClass:"card-container printer"},[t("div",{staticClass:"icon"},[t("svg",{staticStyle:{"margin-bottom":"5px"},attrs:{width:"1em",height:"1em"}},[t("use",{attrs:{href:"#svg-3d-printer"}})])]),t("div",{staticClass:"info truncated-wrapper"},[t("div",{staticClass:"title truncated",attrs:{title:e.print.printer.name}},[e._v(" "+e._s(e.print.printer.name)+" ")]),t("div",{staticClass:"subtitle truncated",class:[e.printer?e.printer.isPrintable()&&!e.printer.inTransientState()?"text-success":"text-warning":"text-danger"]},[e._v(" "+e._s(e.printer?e.printer.printabilityText():"Deleted")+" ")])]),e.printer&&e.print.g_code_file&&!e.print.g_code_file.deleted&&e.print.g_code_file.url?t("div",{staticClass:"action"},[t("button",{staticClass:"btn btn-primary",attrs:{disabled:!e.printer.isPrintable()||e.printer.inTransientState()},on:{click:e.onRepeatPrintClicked}},[e.isSending?t("b-spinner",{staticClass:"mr-2",attrs:{small:""}}):e._e(),t("span",[e._v("Reprint")])],1)]):e._e()])],1)]),t("b-col",{attrs:{lg:"7"}},[t("div",{staticClass:"time-lapse"},[e.print.video_archived_at?t("div",{staticClass:"card-container"},[t("h2",{staticClass:"title"},[e._v("Time-Lapse video deleted")]),t("p",[e._v(" Time-lapse videos older than 6-months are deleted from the Obico app server as they are rarely needed and cost significant amount to store in the cloud. ")]),t("p",[e._v(" If you are a Pro subscriber and you don't want your time-lapse videos to be deleted, please "),t("a",{attrs:{href:"mailto:support@obico.io?subject=Please%20keep%20my%20timelapse%20videos"}},[e._v("contact us")]),e._v(". ")])]):e.print.video_url||e.print.tagged_video_url?t("div",[t("b-card",{attrs:{"no-body":""}},[t("b-tabs",{attrs:{pills:"",card:""}},[t("b-tab",{attrs:{title:"Detective Time-Lapse",disabled:!e.canShowDetectiveView}},[t("b-card-text",[e.print.tagged_video_url?t("div",{class:{"is-fullscreen":!!e.fullscreenUrl&&e.fullscreenUrl===e.print.tagged_video_url}},[t("div",{staticClass:"video-wrapper"},[t("video-box",{attrs:{"video-url":e.print.tagged_video_url,"poster-url":e.print.poster_url,fluid:!1,"fullscreen-btn":null===e.fullscreenUrl,"exit-fullscreen-btn":null!==e.fullscreenUrl,"download-btn":!0},on:{timeupdate:e.onTimeUpdate,fullscreen:()=>e.enterFullscreen(e.print.tagged_video_url),exitFullscreen:e.exitFullscreen,download:()=>e.downloadFile(e.print.tagged_video_url,e.print.id+"_tagged.mp4")}})],1),t("div",{staticClass:"detective-footer"},[e.print.prediction_json_url?t("failure-detection-gauge",{attrs:{"normalized-p":e.normalizedP}}):e._e(),t("div",{staticClass:"feedback-section"},[t("div",{staticClass:"lead",class:[e.print.alerted_at?"text-danger":"text-success"]},[e._v(" "+e._s(e.print.alerted_at?"Failure detected":"No failure detected")+" ")]),t("div",{staticClass:"py-2"},[e._v(" Did we get it right? "),t("b-button",{staticClass:"mx-2 btn-sm",attrs:{variant:e.thumbedUp?"primary":"outline"},on:{click:e.onThumbUpClick}},[e.inflightAlertOverwrite?t("b-spinner",{attrs:{type:"grow",small:""}}):t("i",{staticClass:"fas fa-thumbs-up"})],1),t("b-button",{staticClass:"mx-2 btn-sm",attrs:{variant:e.thumbedDown?"primary":"outline"},on:{click:e.onThumbDownClick}},[e.inflightAlertOverwrite?t("b-spinner",{attrs:{type:"grow",small:""}}):t("i",{staticClass:"fas fa-thumbs-down"})],1)],1),t("transition",{attrs:{name:"bounce"}},[e.print.printShotFeedbackEligible?t("div",{staticClass:"pt-2"},[t("b-button",{attrs:{variant:"outline-primary",size:"sm",href:`/prints/shot-feedback/${e.print.id}/`}},[e.print.need_print_shot_feedback?e._e():t("i",{staticClass:"fas fa-check mr-2"}),e._v(" FOCUSED FEEDBACK ")])],1):e._e()]),t("div",{staticClass:"about-feedback"},[e.print.printShotFeedbackEligible?t("small",[e.print.need_print_shot_feedback?t("span",[e._v(" With Focused Feedback, you can tell us exactly where we got it wrong. This is the most effective way to help us improve. "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work#you-earn-detective-hours-for-giving-focused-feedback",target:"_blank"}},[e._v(" You will earn 2 AI Detection Hours once you finish the Focused Feedback ")])]):t("span",[e._v(" Thank you for completing the Focused Feedback. You have earned 2 non-expirable AI Detection Hours. You can click the button again to change your feedback. ")])]):t("small",[e._v(" Every time you give us feedback, "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work/",target:"_blank"}},[e._v(" you help us get better at detecting failures ")])])])],1)],1)]):t("div",[t("detective-working",{staticClass:"detective-placeholder"})],1)])],1),e.print.video_url?t("b-tab",{attrs:{active:!e.print.tagged_video_url,title:"Original Time-Lapse"}},[t("b-card-text",[t("div",{class:{"is-fullscreen original":!!e.fullscreenUrl&&e.fullscreenUrl===e.print.video_url}},[t("div",{staticClass:"video-wrapper"},[t("video-box",{attrs:{"video-url":e.print.video_url,"poster-url":e.print.poster_url,fluid:!1,"fullscreen-btn":null===e.fullscreenUrl,"exit-fullscreen-btn":null!==e.fullscreenUrl,"download-btn":!0},on:{timeupdate:e.onTimeUpdate,fullscreen:()=>e.enterFullscreen(e.print.video_url),exitFullscreen:e.exitFullscreen,download:()=>e.downloadFile(e.print.video_url,e.print.id+".mp4")}})],1)])])],1):e._e()],1)],1)],1):t("div",{staticClass:"card-container"},[t("p",{staticClass:"text-secondary mt-3"},[e._v("Time-Lapse video unavailable because:")]),t("ul",[t("li",{staticClass:"text-secondary mt-3"},[e._v(" The Obico server is still processing the time-lapse; ")]),t("li",{staticClass:"text-secondary mt-3"},[e._v(" Or, the print time was shorter than the threshold. You can change the threshold in "),t("a",{attrs:{href:`/printers/${e.print.printer.id}/`}},[e._v("the printer settings.")])])])])])])],1)],1)]},proxy:!0}])})},tn=[],sn=(i("907a"),i("986a"),i("1d02"),i("3c5d"),i("6ce5"),i("2834"),i("4ea1"),i("dce5")),nn=i.n(sn),rn=i("aaa7"),an=i.n(rn),on=i("acff");class ln{constructor(){return ln.instance||(this.printerCommMap=new Map,ln.instance=this),ln.instance}setPrinterComm(e,t){this.printerCommMap.set(e,t)}getPrinterComm(e){return this.printerCommMap.get(e)}getOrCreatePrinterComm(...e){const t=String(e[0]);return this.getPrinterComm(t)||this.setPrinterComm(t,dn(...e)),this.getPrinterComm(t)}closeConnection(e){const t=this.getPrinterComm(e);t&&(t.closeServerWebSocket(),t.webrtc&&t.webrtc.close(),this.printerCommMap.delete(e))}closeAllConnections(){this.printerCommMap.forEach((e,t)=>this.closeConnection(t))}}const cn=new ln;function dn(e,t,i){const n={printerId:e,wsUri:t,...i};return n.ws=null,n.webrtc=null,n.passthruQueue=new Map,an.a.on("blur",(function(){n.closeWebSocket()})),an.a.on("focus",(function(){n.connect()})),n.onPassThruReceived=function(e){const t=e.ref;if(t&&n.passthruQueue.get(t)){const i=n.passthruQueue.get(t);n.passthruQueue.delete(t),i(e.error,e.ret)}else if("terminal_feed"in e)n.onTerminalFeedReceived&&n.onTerminalFeedReceived(e.terminal_feed);else if("printer_event"in e){const t=e.printer_event;s["default"].swal.Toast.fire({icon:t.event_class.toLowerCase(),title:t.event_title,html:t.event_text}).then(e=>{e.isDismissed&&"close"===e.dismiss&&(window.location.href="/printer_events/")})}},n.connect=function(e=null){n.ws&&n.ws.readyState===WebSocket.OPEN?e&&e():(n.ws=new WebSocket(window.location.protocol.replace("http","ws")+"//"+window.location.host+n.wsUri),n.ws.onmessage=function(e){let t={};try{t=JSON.parse(e.data)}catch(i){throw console.log(e.data),i}"passthru"in t?n.onPassThruReceived(t.passthru):n.onPrinterUpdateReceived&&n.onPrinterUpdateReceived(t)},e&&(n.ws.onopen=e),n.ensureWebsocketClosed(),setTimeout((function(){n.heartbeat()}),3e4))},n.setWebRTC=function(e){function t(e){let t={};try{t=JSON.parse(e)}catch(i){return}t&&"ref"in t&&"ret"in t?n.onPassThruReceived(t):n.onStatusReceived&&n.onStatusReceived(t)}n.webrtc=e,n.webrtc.setCallbacks({onData:e=>{"string"===typeof e||e instanceof String?t(e):Object(ds["g"])(e,e=>{t(on["a"].ungzip(new Uint8Array(e),{to:"string"}))})}})},n.passThruToPrinter=function(e,t){if(n.canSend()){var i=Math.random().toString();nn()(e,{ref:i}),t&&(n.passthruQueue.set(i,t),setTimeout((function(){n.passthruQueue.has(i)&&(me(n.printerId),s["default"].swal.Toast.fire({icon:"error",title:"Failed to contact printer. Is it powered on and connected to Internet?"}))}),1e4)),n.webrtc&&n.webrtc.sendData(JSON.stringify(e)),n.ws.send(JSON.stringify({passthru:e}))}else t&&(me(n.printerId),t("Message not passed through. No suitable WebSocket."))},n.ensureWebsocketClosed=function(){n.ws.onclose=function(e){n.ws===e.target&&(n.ws=null)},n.ws.onerror=function(){n.ws&&n.ws.close()}},n.closeWebSocket=function(){n.ws&&n.ws.close()},n.heartbeat=function(){n.canSend()&&(n.ws.send(JSON.stringify({})),setTimeout((function(){n.heartbeat()}),3e4))},n.canSend=function(){return n.ws&&1===n.ws.readyState},n}Object.freeze(cn);var un=i("2ef0"),pn=i.n(un);function hn(e,t,i){const s=e=>{const t=[];for(const i of Object.values(e))i.children?t.push(...s(i.children)):t.push(i);return t};return new Promise((n,r)=>{let a;a=i?{filter:String(i),recursive:!0}:{path:t,recursive:!1,level:1},e.passThruToPrinter({func:"list_files",target:"_file_manager",kwargs:a},(e,t)=>{e&&r(e);let a=[],o=[];if(null===t||void 0===t||!t.local||!Object.keys(t.local).length)return void n();delete t.local.ObicoUpload;const l=i?s(t.local):Object.values(t.local);for(const i of l)"folder"===i.type?a.push({id:i.path,path:i.path,name:i.display,numItems:Object.keys(i.children).length}):o.push({...i,id:i.path,filename:i.name,num_bytes:i.size,filesize:se()(i.size),created_at:ve(new Date(1e3*i.date)),getBigThumbnailUrl:()=>null,getSmallThumbnailUrl:()=>null});n({folders:a,files:o})})})}function fn(e,t,i){return new Promise((s,n)=>{const r=null==t?"":t+"/";e.passThruToPrinter({target:"moonraker_api",func:"server/files/directory",kwargs:{path:"gcodes/"+(t||""),extended:!0}},(e,t)=>{e&&n(e);const a=i?[]:pn.a.map(pn.a.filter(pn.a.get(t,"dirs",[]),e=>!e.dirname.startsWith(".")&&!e.dirname.startsWith("Obico_Upload")),e=>{const t=`${r}${e.dirname}`;return{name:e.dirname,id:t,path:t,children:[]}}),o=pn.a.map(pn.a.filter(pn.a.get(t,"files",[]),e=>!e.filename.startsWith(".")&&(!i||e.filename.toLowerCase().includes(i.toLowerCase()))),e=>({...e,num_bytes:e.size,filesize:se()(e.size),created_at:ve(new Date(1e3*e.modified)),path:`${r}${e.filename}`,getBigThumbnailUrl:()=>null,getSmallThumbnailUrl:()=>null}));s({folders:a,files:o})})})}function mn(e,t){return new Promise((i,s)=>{const n=t.path;e.passThruToPrinter({func:"select_file",target:"_printer",args:[""+n,null],kwargs:{printAfterSelect:"true"}},(e,t)=>{e?s(e):i()})})}function gn(e,t){return new Promise((i,s)=>{const n=t.path;e.passThruToPrinter({target:"moonraker_api",func:"printer/print/start",kwargs:{verb:"post",filename:n}},(e,t)=>{e?s(e):i()})})}function vn(e,t){return new Promise((i,s)=>{e.passThruToPrinter({target:"file_operations",func:"start_printer_local_print",args:[t]},(e,t)=>{e||null!==t&&void 0!==t&&t.error?s(e||(null===t||void 0===t?void 0:t.error)):i()})})}const bn=(e,t)=>new Promise((i,n)=>{s["default"].swal.fire({html:`<h5 style="text-align: center; line-height: 1.5;">Print "${e.filename}" on <b>${t.name}</b>?</h5>`,imageUrl:e.getBigThumbnailUrl&&e.getBigThumbnailUrl(),showCancelButton:!0,confirmButtonText:"Print!",cancelButtonText:"Cancel",reverseButtons:!0}).then(e=>{e.value&&i()})});function _n(e,t){return new Promise((i,s)=>{e.passThruToPrinter({func:"download",target:"file_downloader",args:[{id:t.id,url:t.url,filename:t.filename,safe_filename:t.safe_filename}]},(e,t)=>{e?s(e):i()})})}const Cn=e=>{const{printer:t,gcode:i,isCloud:s,Swal:n,onCommandSent:r,onPrinterStatusChanged:a}=e,o=t.id,l=t.isAgentMoonraker(),c=cn.getOrCreatePrinterComm(o,X["a"].printerWebSocket(o));c.connect(()=>{const e=s?_n:i.path?l?gn:mn:vn;t.setTransientState(s?"G-Code Downloading":"Starting"),e(c,i).catch(e=>{me(o),n.Toast.fire({icon:"error",title:e})})}),r&&r();const d=async()=>{let e;try{e=await Q["a"].get(X["a"].printer(o)),e=e.data}catch(t){return void console.error(t)}"Operational"===te()(e,"status.state.text")||"G-Code Downloading"===te()(e,"status.state.text")||"Downloading G-Code"===te()(e,"status.state.text")?setTimeout(d,1e3):a&&a()};d()},wn=3e3,yn=(e,t,i)=>{let s;e.Prompt.fire({html:`\n      <div class="text-center">\n        <h5 class="py-3">\n          You'll be redirected to printers page in <strong>${Math.round(wn/1e3)}</strong> seconds\n        </h5>\n      </div>\n    `,timer:wn,showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"Redirect now",onOpen:()=>{s=setInterval(()=>{const t=e.getHtmlContainer(),i=null===t||void 0===t?void 0:t.querySelector("strong");t&&i&&(i.textContent=(e.getTimerLeft()/1e3).toFixed(0))},1e3)},onClose:()=>{clearInterval(s),s=null}}).then(e=>{e.isConfirmed||"timer"===e.dismiss?window.location.assign(`/printers/${i}/control/`):t&&t()})};var kn=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-container file"},[t("div",{staticClass:"file-header",class:{"mb-4":e.showDetails&&e.fileDetailsToShow.length>0,compact:e.compactView}},[e.showThumbnail?t("div",[e.bigThumbnailUrl?t("div",{staticClass:"thumbnail"},[t("img",{attrs:{src:e.bigThumbnailUrl}})]):t("div",{staticClass:"thumbnail-placeholder"},[t("span",{staticClass:"help"},[t("help-widget",{attrs:{id:"thumbnail-setup-guide",highlight:!1,"show-close-button":!1}})],1),t("svg",[t("use",{attrs:{href:"#svg-no-photo"}})])])]):t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-file-code"})]),t("div",{staticClass:"info truncated-wrapper"},[t("div",{staticClass:"title truncated",attrs:{title:e.file.filename}},[e._v(" "+e._s(e.file.filename)+" ")]),e.file.filesize||e.file.deleted?t("div",{staticClass:"subtitle text-secondary truncated-wrapper"},[e.file.deleted?t("div",{staticClass:"truncated"},[t("span",{staticClass:"text-danger"},[e._v("Deleted")])]):t("div",{staticClass:"truncated"},[t("span",[e._v(e._s(e.file.filesize))])])]):e._e()]),e.showOpenButton&&e.file.id?t("div",{staticClass:"action"},[t("b-button",{staticClass:"custom-button",attrs:{variant:e.openButtonVariant,href:`/g_code_files/cloud/${e.file.id}/`}},[e._v(" "+e._s(e.openButtonText)+" ")])],1):e._e()]),e.showDetails?[e._l(e.fileDetailsToShow.slice(0,e.numberOfVisibleLines),(function(i){return t("div",{key:i.name},[t("div",{staticClass:"line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[i.faIcon?t("i",{class:i.faIcon}):i.svgIcon?t("svg",{attrs:{width:"16",height:"16"}},[t("use",{attrs:{href:"#"+i.svgIcon}})]):e._e()]),t("div",{staticClass:"title"},[e._v(e._s(i.title))])]),t("div",{staticClass:"value"},[t("span",{domProps:{innerHTML:e._s(i.value)}})])])])})),e.shouldShowDataNotice&&e.fileDetailsToShow.length<=e.numberOfVisibleLines?t("muted-alert",{staticClass:"mt-2 mb-1"},[e._v(" Fields above were embedded in the G-Code file by your slicer. Consult your slicer's manual if some fields are not accurate or missing. ")]):e._e(),e.fileDetailsToShow.length>e.numberOfVisibleLines?t("collapsable-details",[e._l(e.fileDetailsToShow.slice(e.numberOfVisibleLines),(function(i){return t("div",{key:i.name},[t("div",{staticClass:"line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[i.faIcon?t("i",{class:i.faIcon}):i.svgIcon?t("svg",{attrs:{width:"16",height:"16"}},[t("use",{attrs:{href:"#"+i.svgIcon}})]):e._e()]),t("div",{staticClass:"title"},[e._v(e._s(i.title))])]),t("div",{staticClass:"value"},[t("span",{domProps:{innerHTML:e._s(i.value)}})])])])})),e.shouldShowDataNotice&&e.fileDetailsToShow.length>e.numberOfVisibleLines?t("muted-alert",{staticClass:"mt-2 mb-1"},[e._v(" Fields above were embedded in the G-Code file by your slicer. Consult your slicer's manual if some fields are not accurate or missing. ")]):e._e()],2):e._e()]:e._e()],2)},Sn=[],Pn=function(){var e=this,t=e._self._c;return t("div",[t("b-collapse",{model:{value:e.expanded,callback:function(t){e.expanded=t},expression:"expanded"}},[e._t("default")],2),t("button",{staticClass:"collapse-toggle",class:e.expanded?"opened":"closed",on:{click:function(t){e.expanded=!e.expanded}}},[e.expanded?t("span",[e._v("Show less")]):t("span",[e._v("Show more")]),t("font-awesome-icon",{class:{rotated:e.expanded},attrs:{icon:["fas","chevron-down"]}})],1)],1)},xn=[],Tn={name:"CollapsableDetails",data(){return{expanded:!1}}},Fn=Tn,Dn=(i("03af"),Object(E["a"])(Fn,Pn,xn,!1,null,"7c59477d",null)),On=Dn.exports,In={name:"GCodeDetails",components:{MutedAlert:os,HelpWidget:Li,CollapsableDetails:On},props:{file:{type:Object,required:!0},showPrintStats:{type:Boolean,default:!1},showDetails:{type:Boolean,default:!0},showOpenButton:{type:Boolean,default:!1},compactView:{type:Boolean,default:!0},openButtonVariant:{type:String,default:"outline-secondary"},openButtonText:{type:String,default:"Open File"}},data(){return{numberOfVisibleLines:3}},computed:{bigThumbnailUrl(){return this.file.getBigThumbnailUrl&&this.file.getBigThumbnailUrl()},showThumbnail(){return!this.compactView||this.bigThumbnailUrl},fileDetailsToShow(){let e=[];return!this.file.deleted&&this.file.metadata&&(e=de.filter(e=>this.file.metadata[e.name]).map(e=>({...e,value:e.formatter(this.file.metadata[e.name])}))),this.showPrintStats&&e.unshift({name:"total_prints",faIcon:"fas fa-hashtag",title:"Total prints",value:`\n            ${this.file.totalPrints||0}\n            (<span class="text-success">${this.file.successPrints||0}</span> /\n            <span class="text-danger">${this.file.failedPrints||0}</span>)\n          `}),this.file.created_at&&e.unshift({name:"created_at",faIcon:"fas fa-calendar-alt",title:"Uploaded",value:this.file.created_at.fromNow()}),e},shouldShowDataNotice(){return!this.file.analysis&&0!==Object.keys(this.file.metadata||{}).length&&!this.file.deleted}}},An=In,Mn=(i("1e7a"),Object(E["a"])(An,kn,Sn,!1,null,"14574348",null)),En=Mn.exports,Nn={name:"PrintPage",components:{PageLayout:vt,VideoBox:xt,DetectiveWorking:At,FailureDetectionGauge:Es,GCodeDetails:En},props:{printId:{type:Number,required:!0}},data:function(){return{PrintStatus:be,absoluteDateFormat:"MMM D, YYYY h:mm a",print:null,predictions:[],printer:null,isLoading:!0,currentPosition:0,inflightAlertOverwrite:null,fullscreenUrl:null,user:null,currentPrint:null,prevPrint:null,nextPrint:null,sortingValue:ti(Gi,qi),filterLocalStoragePrefix:Ji,filterOptions:Yi,filterValues:li(Ji,Yi),printerStateCheckInterval:null}},computed:{PrevPrintButtonTitle(){return"asc"===this.sortingValue.direction.key?"Older":"Newer"},NextPrintButtonTitle(){return"asc"===this.sortingValue.direction.key?"Newer":"Older"},fileName(){return null===this.print.g_code_file?this.print.filename:this.print.g_code_file.filename},currentPrintId(){var e;return(null===(e=this.currentPrint)||void 0===e?void 0:e.id)||this.printId},currentIndex(){if(this.currentPrint)return this.currentPrint.index;const e=new URLSearchParams(window.location.search);let t=e.get("index");return t?parseInt(t):void 0},normalizedP(){return Object(ds["d"])(this.predictions,this.currentPosition,!1)},canShowDetectiveView(){return null!==this.print.prediction_json_url&&null!==this.print.tagged_video_url||!!(this.print.uploaded_at&&L()().diff(this.print.uploaded_at,"hours")<24)},thumbedUp(){return!!this.print.alert_overwrite&&this.print.has_alerts^"NOT_FAILED"===this.print.alert_overwrite},thumbedDown(){return!!this.print.alert_overwrite&&this.print.has_alerts^"FAILED"===this.print.alert_overwrite},isSending(){var e;const t=null===(e=this.printer)||void 0===e?void 0:e.calculatedState();return t&&["G-Code Downloading","Starting"].includes(t)}},created(){this.user=Object(Se["f"])(),this.fetchData(),this.fetchSiblingPrints()},mounted(){const e=this.exitFullscreen;document.addEventListener("keydown",t=>{"Escape"===t.key&&e()})},unmounted(){clearInterval(this.printerStateCheckInterval)},methods:{downloadFile:ds["a"],humanizedFilamentUsage:le,async fetchData(e=!0){e&&(this.print=null,this.predictions=[],this.printer=null),this.isLoading=!0;try{const e=await Q["a"].get(X["a"].print(this.currentPrintId));this.print=_e(e.data),this.print.prediction_json_url&&Q["a"].get(this.print.prediction_json_url).then(e=>{this.predictions=e.data}),Q["a"].get(X["a"].printer(this.print.printer.id),{params:{with_archived:!0}}).then(e=>{this.printer=ye(e.data),this.printerComm=cn.getOrCreatePrinterComm(this.printer.id,X["a"].printerWebSocket(this.printer.id),{onPrinterUpdateReceived:e=>{this.printer=ye(e,this.printer)}}),this.printerComm.connect()}).catch(e=>{var t;this.printer=null,404!==(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status)&&this.errorDialog(e,"Failed to fetch printer information")}).finally(()=>{this.isLoading=!1})}catch(t){console.log(t)}},switchToPrint(e){this.currentPrint=e;const t=`/prints/${e.id}/?index=${e.index}`;window.history.replaceState({},"",t),this.fetchData(),this.fetchSiblingPrints()},fetchSiblingPrints(){if(!this.currentIndex&&0!==this.currentIndex)return;const e=this.currentIndex>0,t=e?this.currentIndex-1:0,i=e?3:2;Q["a"].get(X["a"].prints(),{params:{start:t,limit:i,...ci(this.filterOptions,this.filterValues,(e,t)=>{if("timePeriod"===e)return this.filterOptions[e].buildQueryParam(t,Object(a["a"])(Ji+"-timePeriod-dateFrom")||null,Object(a["a"])(Ji+"-timePeriod-dateTo")||null,this.user)}),sorting:`${this.sortingValue.sorting.key}_${this.sortingValue.direction.key}`}}).then(t=>{const i=t.data;let s,n;if(e)if(3===i.length&&i[1].id===this.currentPrintId)s=i[0],n=i[2];else{if(2!==i.length||i[1].id!==this.currentPrintId)return;s=i[0]}else{if(2!==i.length||i[0].id!==this.currentPrintId)return;n=i[1]}this.prevPrint=s?{id:s.id,index:this.currentIndex-1}:null,this.nextPrint=n?{id:n.id,index:this.currentIndex+1}:null}).catch(e=>{this.errorDialog(e)})},onTimeUpdate(e){this.currentPosition=e},onThumbUpClick(){this.inflightAlertOverwrite=this.print.has_alerts?"FAILED":"NOT_FAILED",this.alertOverwrite(this.inflightAlertOverwrite)},onThumbDownClick(){this.inflightAlertOverwrite=this.print.has_alerts?"NOT_FAILED":"FAILED",this.alertOverwrite(this.inflightAlertOverwrite)},alertOverwrite(e){Q["a"].patch(X["a"].print(this.print.id),{alert_overwrite:e}).then(e=>{this.inflightAlertOverwrite=null,this.fetchData(!1)})},onRepeatPrintClicked(){bn(this.print.g_code_file,this.printer).then(()=>{var e;Cn({printer:this.printer,gcode:this.print.g_code_file,isCloud:null===(null===(e=this.print.g_code_file)||void 0===e?void 0:e.resident_printer),Swal:this.$swal,onPrinterStatusChanged:()=>{yn(this.$swal,()=>this.fetchData(),this.printer.id)}})})},enterFullscreen(e){this.fullscreenUrl=e},exitFullscreen(){this.fullscreenUrl=null}}},Rn=Nn,jn=(i("8505"),Object(E["a"])(Rn,en,tn,!1,null,"146c3b21",null)),Ln=jn.exports,Bn=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[t("b-container",[t("b-row",{staticClass:"justify-content-center"},[t("b-col",{staticClass:"text-center",attrs:{lg:"8"}},[t("h1",{staticClass:"pb-2"},[e._v("Upload Time-lapse")]),t("p",{staticClass:"pb-2"},[e._v("Upload time-lapse videos to test Obico's AI failure detection.")]),t("vue-dropzone",{staticClass:"upload-box",attrs:{id:"dropzone",options:e.dropzoneOptions,"use-custom-slot":!0},on:{"vdropzone-success":e.printUploadSuccess}},[t("div",{staticClass:"dz-message needsclick"},[t("i",{staticClass:"fas fa-upload fa-2x"}),e._v(" "),t("br"),e._v(" Drop files here or click to upload."),t("br"),e._v(" *.mp4 or *.mpg files only. Up to 100MB each. ")])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.uploaded,expression:"uploaded"}],staticClass:"pt-5"},[t("div",{attrs:{id:"tl-uploaded"}},[t("img",{staticClass:"detective-working",attrs:{src:i("0469")}}),t("div",{staticClass:"py-2 text-center"},[t("div",{staticClass:"py-2"},[e._v(" The Obico Server is running failure detection on the time-lapse video(s) you uploaded. ")]),t("div",[e._v("We will send you email when it is done.")]),t("a",{attrs:{href:"/prints/"}},[e._v("Check status now >>>")])])])])],1)],1)],1)]},proxy:!0}])})},$n=[],Vn=i("92c3"),Un=i.n(Vn),zn=(i("1e3f"),{name:"UploadPrintPage",components:{vueDropzone:Un.a,PageLayout:vt},props:{csrf:{type:String,required:!0}},data(){return{dropzoneOptions:{withCredentials:!0,maxFilesize:100,timeout:36e5,acceptedFiles:"video/mp4, video/mpeg",url:"?",headers:{"X-CSRFToken":this.csrf}},uploaded:!1}},methods:{printUploadSuccess(e){console.log(e),this.uploaded=!0}}}),Wn=zn,Gn=(i("5a0b"),Object(E["a"])(Wn,Bn,$n,!1,null,"7c2ff1dc",null)),qn=Gn.exports,Hn=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"topBarRight",fn:function(){return[t("div",{staticClass:"action-panel"},[e.isEnt?t("a",{staticClass:"btn shadow-none action-btn icon-btn hours-btn",style:{marginRight:.25*String(e.dhBadgeNum).length+"rem"},attrs:{href:"/user_preferences/dh/",title:e.dhBadgeNum+" AI Detection Hours"}},[t("svg",{staticClass:"custom-svg-icon"},[t("use",{attrs:{href:"#svg-hour-glass"}})]),t("span",{staticClass:"badge badge-light",attrs:{id:"user-credits"}},[e._v(e._s(e.dhBadgeNum))]),t("span",{staticClass:"sr-only"},[e._v("AI Detection Hours")])]):e._e(),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn",title:"Sort By"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-sort-amount-down"})]},proxy:!0}])},[t("sorting-dropdown",{attrs:{"local-storage-prefix":e.sortingLocalStoragePrefix,"sorting-options":e.sortingOptions,"sorting-value":e.sortingValue},on:{onSortingUpdated:e.onSortingUpdated}})],1),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn","menu-class":"scrollable",title:"Filter"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-filter"})]},proxy:!0}])},[t("filtering-dropdown",{attrs:{"local-storage-prefix":e.filterLocalStoragePrefix,"filter-options":e.filterOptions,"filter-values":e.filterValues},on:{onFilterUpdated:e.onFilterUpdated}})],1),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn d-md-none"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[t("cascaded-dropdown",{ref:"cascadedDropdown",attrs:{"menu-options":e.mobileMenuOptions},scopedSlots:e._u([{key:"sorting",fn:function(){return[t("sorting-dropdown",{attrs:{"local-storage-prefix":e.sortingLocalStoragePrefix,"sorting-options":e.sortingOptions,"sorting-value":e.sortingValue},on:{onSortingUpdated:e.onSortingUpdated}})]},proxy:!0},{key:"filtering",fn:function(){return[t("filtering-dropdown",{attrs:{"local-storage-prefix":e.filterLocalStoragePrefix,"filter-options":e.filterOptions,"filter-values":e.filterValues},on:{onFilterUpdated:e.onFilterUpdated}})]},proxy:!0}])})],1)],1)]},proxy:!0},{key:"content",fn:function(){return[t("active-filter-notice",{attrs:{"filter-values":e.filterValues},on:{onShowAllClicked:e.resetFilters}}),t("b-container",{staticClass:"printer-list-page"},[e.loading?t("b-row",[t("b-col",{staticClass:"text-center"},[t("b-spinner",{staticClass:"my-5",attrs:{label:"Loading..."}})],1)],1):e._e(),e.visiblePrinters.length?t("b-row",{staticClass:"printer-cards justify-content-center"},e._l(e.visiblePrinters,(function(i){return t("printer-card",{key:i.id,staticClass:"printer-card-wrapper",attrs:{printer:i,"is-pro-account":e.user.is_pro},on:{PrinterUpdated:e.onPrinterUpdated}})})),1):e._e(),e.loading?e._e():t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-sm-12 col-lg-6",attrs:{id:"new-printer"}},[t("div",{staticClass:"new-printer-container"},[t("a",{attrs:{href:"/printers/wizard/"}},[t("svg",{staticClass:"icon"},[t("use",{attrs:{href:"#svg-add-printer"}})]),t("div",[e._v("Link New Printer")])])])])]),e.loading?e._e():t("b-row",{directives:[{name:"show",rawName:"v-show",value:e.shouldShowArchiveWarning,expression:"shouldShowArchiveWarning"}],staticClass:"bottom-messages"},[t("b-col",[t("div",{staticClass:"alert alert-warning alert-dismissible fade show mb-3",attrs:{role:"alert"}},[t("div",{staticClass:"warning"},[t("div",[e._v(" "+e._s(e.archivedPrinterNum)+" "+e._s(e._f("pluralize")("printer",e.archivedPrinterNum))+" have been archived. ")]),t("div",[t("a",{staticClass:"warning-action",attrs:{href:"/ent/printers/archived/"}},[e._v("Show Archived Printers")]),t("a",{staticClass:"warning-action",on:{click:e.handleNeverShowAgain}},[e._v("Never Show Again")])])]),t("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"alert","aria-label":"Close"}},[t("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])])])],1)],1)]},proxy:!0}])})},Jn=[],Yn=function(){var e=this,t=e._self._c;return t("div",{staticClass:"col-sm-12 col-lg-6 printer-card",attrs:{id:e.printer.id}},[t("div",{staticClass:"card"},[t("div",{staticClass:"card-header"},[t("div",{staticClass:"title-box"},[t("div",{staticClass:"printer-name"},[e._v(" "+e._s(e.printer.name)+" ")]),e.hasCurrentPrintFilename?t("div",{staticClass:"secondary-title print-filename"},[e._v(" "+e._s(e.printer.current_print.filename)+" ")]):t("div",{staticClass:"secondary-title",class:e.statusClass},[e._v(e._s(e.statusText))])]),t("div",{staticClass:"d-flex ml-2"},[t("b-button",{staticClass:"px-4 mr-2",attrs:{variant:"outline-secondary",href:`/printers/${e.printer.id}/control/`}},[e._v("Open Details ")]),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[t("b-dropdown-item",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.onSharePrinter()}}},[t("i",{staticClass:"fas fa-share-alt fa-lg"}),e._v("Share ")]),t("b-dropdown-item",{attrs:{href:e.octoPrintTunnelUrl()}},[t("svg",{staticClass:"menu-icon"},[t("use",{attrs:{href:"#svg-tunnel"}})]),e._v(" "+e._s(e.printer.agentDisplayName())+" Tunnel ")]),t("div",{staticClass:"dropdown-divider"}),t("b-dropdown-item",{attrs:{href:e.settingsUrl()}},[t("i",{staticClass:"fas fa-wrench fa-lg"}),e._v("Configure ")])],1)],1)]),t("streaming-box",{attrs:{printer:e.printer,webrtc:e.webrtc,autoplay:e.isProAccount}}),e.printer.alertUnacknowledged()?t("div",{staticClass:"failure-alert card-body bg-warning px-2 py-1"},[t("i",{staticClass:"fas fa-exclamation-triangle align-middle"}),t("span",{staticClass:"align-middle"},[e._v("Failure Detected!")]),t("button",{staticClass:"btn btn-outline-primary btn-sm float-right",attrs:{id:"not-a-failure",type:"button"},on:{click:function(t){return e.onNotAFailureClicked(t,!1)}}},[e._v(" Not a failure? ")])]):e._e(),t("div",{staticClass:"card-body gauge-container",class:{overlay:!e.isWatching}},[e.isWatching?e._e():t("div",{staticClass:"overlay-top text-center",staticStyle:{left:"0",width:"100%",top:"50%","margin-top":"-55px"}},[t("H1",[t("i",{staticClass:"far fa-eye-slash"})]),t("h5",{staticClass:"text-warning"},[e._v("Failure Detection is Off")]),e.printer.not_watching_reason?t("small",[e._v(e._s(e.printer.not_watching_reason)+". "),e._m(0)]):e._e(),t("div")],1),t("failure-detection-gauge",{attrs:{"normalized-p":e.printer.normalized_p,"is-watching":e.isWatching}}),t("hr")],1),t("print-job-control-widget",{attrs:{"inside-card":!0,printer:e.printer,"printer-comm":e.printerComm},on:{notAFailureClicked:e.onNotAFailureClicked,sendPrinterAction:e.sendPrinterAction}}),t("div",{staticClass:"info-section settings"},[t("button",{staticClass:"info-section-toggle btn btn-sm no-corner mx-2",class:{pressed:e.section_toggles.settings},attrs:{type:"button"},on:{click:function(t){return e.onSettingsToggleClicked()}}},[t("i",{staticClass:"fas fa-cog fa-lg"})]),t("button",{staticClass:"info-section-toggle btn btn-sm no-corner mx-2",class:{pressed:e.section_toggles.time},attrs:{type:"button"},on:{click:function(t){return e.onTimeToggleClicked()}}},[t("i",{staticClass:"fas fa-clock fa-lg"})]),t("button",{staticClass:"info-section-toggle btn btn-sm no-corner mx-2",class:{pressed:e.section_toggles.statusTemp},attrs:{type:"button"},on:{click:function(t){return e.onStatusTempToggleClicked()}}},[t("i",{staticClass:"fas fa-thermometer-half fa-lg"})])]),t("div",{staticClass:"info-section",staticStyle:{height:"0.3rem"}}),t("div",[t("div",{staticClass:"info-section container"},[e.section_toggles.settings?t("div",{attrs:{id:"panel-settings"}},[t("div",{staticClass:"pt-2 pb-3"},[t("div",{staticClass:"row justify-content-center px-3"},[t("div",{staticClass:"col-12 setting-item"},[t("label",{staticClass:"toggle-label",attrs:{for:"watching_enabled-toggle-"+e.printer.id}},[e._v("Enable AI failure detection "),e.watchForFailures?e._e():t("div",{staticClass:"text-muted font-weight-light font-size-sm"},[e._v(" AI failure detection is disabled. You are on your own. ")])]),t("div",{staticClass:"custom-control custom-switch"},[t("input",{staticClass:"custom-control-input update-printer",attrs:{id:"watching_enabled-toggle-"+e.printer.id,type:"checkbox",name:"watching_enabled"},domProps:{checked:e.watchForFailures},on:{click:e.onWatchForFailuresToggled}}),t("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"watching_enabled-toggle-"+e.printer.id}})])])]),t("div",{staticClass:"row justify-content-center px-3"},[t("div",{staticClass:"col-12 setting-item"},[t("label",{staticClass:"toggle-label",attrs:{for:"pause-toggle-"+e.printer.id}},[e._v("Pause on detected failures "),e.pauseOnFailure?e._e():t("div",{staticClass:"text-muted font-weight-light font-size-sm"},[e._v(" You will still be alerted via notifications ")])]),t("div",{staticClass:"custom-control custom-switch"},[t("input",{staticClass:"custom-control-input update-printer",attrs:{id:"pause-toggle-"+e.printer.id,type:"checkbox",name:"pause_on_failure"},domProps:{checked:e.pauseOnFailure},on:{click:e.onPauseOnFailureToggled}}),t("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"pause-toggle-"+e.printer.id}})])])])])]):e._e(),e.section_toggles.time?t("div",{attrs:{id:"print-time"}},[t("div",{staticClass:"py-2"},[e._m(1),t("div",{staticClass:"row"},[e._m(2),t("duration-block",e._b({staticClass:"col-5 numbers",attrs:{id:"print-time-remaining"}},"duration-block",e.timeRemaining,!1)),t("duration-block",e._b({staticClass:"col-5 numbers",attrs:{id:"print-time-total"}},"duration-block",e.timeTotal,!1)),t("div",{staticClass:"col-12"},[t("div",{staticClass:"progress",staticStyle:{height:"2px"}},[t("div",{staticClass:"progress-bar",class:{"progress-bar-striped":e.progressPct<100,"progress-bar-animated":e.progressPct<100},style:`width: ${e.progressPct}%;`,attrs:{id:"print-progress",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100"}})])])],1)])]):e._e(),e.section_toggles.statusTemp&&e.tempProps.show?t("status-temp",e._b({attrs:{id:"status_temp_block"},on:{TempEditClicked:e.onTempEditClicked}},"status-temp",e.tempProps,!1)):e._e()],1)])],1)])},Kn=[function(){var e=this,t=e._self._c;return t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/detective-not-watching/",target:"_blank"}},[e._v("Learn more. "),t("small",[t("i",{staticClass:"fas fa-external-link-alt"})])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"row text-muted"},[t("small",{staticClass:"col-5 offset-2"},[e._v(" Remaining ")]),t("small",{staticClass:"col-5"},[e._v(" Total ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"col-2 text-muted"},[t("i",{staticClass:"fas fa-clock"})])}],Zn=i("2769"),Qn=i.n(Zn),Xn=(i("d9e2"),i("d093"));tr.sessions={},tr.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||tr.extension.isInstalled()}return!0};var er={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var i=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var s=new Error("NavigatorUserMediaError");s.name="You cancelled the request for permission, giving up...",i(s)}else i(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function tr(e){if(e=e||{},e.success="function"==typeof e.success?e.success:tr.noop,e.error="function"==typeof e.error?e.error:tr.noop,e.wsopened="function"==typeof e.wsopened?e.wsopened:tr.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:tr.noop,!tr.initDone)return e.error("Library not initialized"),{};if(!tr.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(tr.log("Library initialized: "+tr.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,i=null,s={},n=null,r=null,a=0,o=e.server;tr.isArray(o)?(tr.log("Multiple servers provided ("+o.length+"), will use the first that works"),o=null,r=e.server,tr.debug(r)):0===o.indexOf("ws")?(t=!0,tr.log("Using WebSockets to contact Janus: "+o)):(t=!1,tr.log("Using REST API to contact Janus: "+o));var l=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],c=e.iceTransportPolicy,d=e.bundlePolicy,u=!0===e.ipv6,p=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(p=!0===e.withCredentials);var h=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(h=e.max_poll_events),h<1&&(h=1);var f=null;void 0!==e.token&&null!==e.token&&(f=e.token);var m=null;void 0!==e.apisecret&&null!==e.apisecret&&(m=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var g=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(g=e.keepAlivePeriod),isNaN(g)&&(g=25e3);var v=6e4;function b(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(v=e.longPollTimeout),isNaN(v)&&(v=6e4);var _=!1,C=null,w={},y=this,k=0,S={};function P(){if(null!=C)if(tr.debug("Long poll..."),_){var t=o+"/"+C+"?rid="+(new Date).getTime();h&&(t=t+"&maxev="+h),f&&(t=t+"&token="+encodeURIComponent(f)),m&&(t=t+"&apisecret="+encodeURIComponent(m)),tr.httpAPICall(t,{verb:"GET",withCredentials:p,success:x,timeout:v,error:function(t,i){if(tr.error(t+":",i),k++,k>3)return _=!1,void e.error("Lost connection to the server (is it down?)");P()}})}else tr.warn("Is the server down? (connected=false)")}function x(e,s){if(k=0,t||void 0===C||null===C||!0===s||P(),t||!tr.isArray(e)){if(!e.session_id||e.session_id===C)if("keepalive"!==e["janus"])if("server_info"!==e["janus"])if("ack"!==e["janus"])if("success"!==e["janus"])if("trickle"===e["janus"]){var n=e["sender"];if(!n)return void tr.warn("Missing sender...");var r=w[n];if(!r)return void tr.debug("This handle is not attached to this session");var a=e["candidate"];tr.debug("Got a trickled candidate on session "+C),tr.debug(a);var o=r.webrtcStuff;o.pc&&o.remoteSdp?(tr.debug("Adding remote candidate:",a),a&&!0!==a.completed?o.pc.addIceCandidate(a):o.pc.addIceCandidate(tr.endOfCandidates)):(tr.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),o.candidates||(o.candidates=[]),o.candidates.push(a),tr.debug(o.candidates))}else{if("webrtcup"===e["janus"]){tr.debug("Got a webrtcup event on session "+C),tr.debug(e);n=e["sender"];if(!n)return void tr.warn("Missing sender...");r=w[n];return r?void r.webrtcState(!0):void tr.debug("This handle is not attached to this session")}if("hangup"===e["janus"]){tr.debug("Got a hangup event on session "+C),tr.debug(e);n=e["sender"];if(!n)return void tr.warn("Missing sender...");r=w[n];if(!r)return void tr.debug("This handle is not attached to this session");r.webrtcState(!1,e["reason"]),r.hangup()}else if("detached"===e["janus"]){tr.debug("Got a detached event on session "+C),tr.debug(e);n=e["sender"];if(!n)return void tr.warn("Missing sender...");r=w[n];if(!r)return;r.detached=!0,r.ondetached(),r.detach()}else if("media"===e["janus"]){tr.debug("Got a media event on session "+C),tr.debug(e);n=e["sender"];if(!n)return void tr.warn("Missing sender...");r=w[n];if(!r)return void tr.debug("This handle is not attached to this session");r.mediaState(e["type"],e["receiving"])}else if("slowlink"===e["janus"]){tr.debug("Got a slowlink event on session "+C),tr.debug(e);n=e["sender"];if(!n)return void tr.warn("Missing sender...");r=w[n];if(!r)return void tr.debug("This handle is not attached to this session");r.slowLink(e["uplink"],e["lost"])}else{if("error"===e["janus"]){tr.error("Ooops: "+e["error"].code+" "+e["error"].reason),tr.debug(e);p=e["transaction"];if(p){h=S[p];h&&h(e),delete S[p]}return void(458===e.error.code&&t&&i.close(3505,"No such session"))}if("event"===e["janus"]){tr.debug("Got a plugin event on session "+C),tr.debug(e);n=e["sender"];if(!n)return void tr.warn("Missing sender...");var l=e["plugindata"];if(!l)return void tr.warn("Missing plugindata...");tr.debug("  -- Event is coming from "+n+" ("+l["plugin"]+")");var c=l["data"];tr.debug(c);r=w[n];if(!r)return void tr.warn("This handle is not attached to this session");var d=e["jsep"];d&&(tr.debug("Handling SDP as well..."),tr.debug(d));var u=r.onmessage;u?(tr.debug("Notifying application..."),u(c,d)):tr.debug("No provided notification callback")}else{if("timeout"===e["janus"])return tr.error("Timeout on session "+C),tr.debug(e),void(t&&i.close(3504,"Gateway timeout"));tr.warn("Unknown message/event  '"+e["janus"]+"' on session "+C),tr.debug(e)}}}else{tr.debug("Got a success on session "+C),tr.debug(e);p=e["transaction"];if(p){h=S[p];h&&h(e),delete S[p]}}else{tr.debug("Got an ack on session "+C),tr.debug(e);var p=e["transaction"];if(p){var h=S[p];h&&h(e),delete S[p]}}else{tr.debug("Got info on the Janus instance"),tr.debug(e);var p=e["transaction"];if(p){var h=S[p];h&&h(e),delete S[p]}}else tr.vdebug("Got a keepalive on session "+C)}else for(var f=0;f<e.length;f++)x(e[f],!0)}function T(){if(o&&t&&_){n=setTimeout(T,g);var e={janus:"keepalive",session_id:C,transaction:tr.randomString(12)};f&&(e["token"]=f),m&&(e["apisecret"]=m),i.send(JSON.stringify(e))}}function F(l){var c=tr.randomString(12),d={janus:"create",transaction:c};if(l["reconnect"]&&(_=!1,d["janus"]="claim",d["session_id"]=C,i&&(i.onopen=null,i.onerror=null,i.onclose=null,n&&(clearTimeout(n),n=null))),f&&(d["token"]=f),m&&(d["apisecret"]=m),!o&&tr.isArray(r)&&(o=r[a],0===o.indexOf("ws")?(t=!0,tr.log("Server #"+(a+1)+": trying WebSockets to contact Janus ("+o+")")):(t=!1,tr.log("Server #"+(a+1)+": trying REST API to contact Janus ("+o+")"))),t)for(var u in i=tr.newWebSocket(o,"janus-protocol"),s={error:function(){if(tr.error("Error connecting to the Janus WebSockets server... "+o),tr.isArray(r)&&!l["reconnect"])return a++,a===r.length?void l.error("Error connecting to any of the provided Janus servers: Is the server down?"):(o=null,void setTimeout((function(){F(l)}),200));l.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){l.wsopened(),S[c]=function(e){if(tr.debug(e),"success"!==e["janus"])return tr.error("Ooops: "+e["error"].code+" "+e["error"].reason),void l.error(e["error"].reason);n=setTimeout(T,g),_=!0,C=e["session_id"]?e["session_id"]:e.data["id"],l["reconnect"]?tr.log("Claimed session: "+C):tr.log("Created session: "+C),tr.sessions[C]=y,l.success()},i.send(JSON.stringify(d))},message:function(e){x(JSON.parse(e.data))},close:function(){o&&_&&(_=!1,e.error("Lost connection to the server (is it down?)"))}},s)i.addEventListener(u,s[u]);else tr.httpAPICall(o,{verb:"POST",withCredentials:p,body:d,success:function(e){if(tr.debug(e),"success"!==e["janus"])return tr.error("Ooops: "+e["error"].code+" "+e["error"].reason),void l.error(e["error"].reason);_=!0,C=e["session_id"]?e["session_id"]:e.data["id"],l["reconnect"]?tr.log("Claimed session: "+C):tr.log("Created session: "+C),tr.sessions[C]=y,P(),l.success()},error:function(e,t){if(tr.error(e+":",t),tr.isArray(r)&&!l["reconnect"])return a++,a===r.length?void l.error("Error connecting to any of the provided Janus servers: Is the server down?"):(o=null,void setTimeout((function(){F(l)}),200));""===t?l.error(e+": Is the server down?"):l.error(e+": "+t)}})}function D(e){if(e=e||{},e.success="function"==typeof e.success?e.success:tr.noop,e.error="function"==typeof e.error?e.error:tr.noop,tr.log("Getting info on Janus instance"),!_)return tr.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var s=tr.randomString(12),n={janus:"info",transaction:s};if(f&&(n["token"]=f),m&&(n["apisecret"]=m),t)return S[s]=function(t){tr.log("Server info:"),tr.debug(t),"server_info"!==t["janus"]&&tr.error("Ooops: "+t["error"].code+" "+t["error"].reason),e.success(t)},void i.send(JSON.stringify(n));tr.httpAPICall(o,{verb:"POST",withCredentials:p,body:n,success:function(t){tr.log("Server info:"),tr.debug(t),"server_info"!==t["janus"]&&tr.error("Ooops: "+t["error"].code+" "+t["error"].reason),e.success(t)},error:function(t,i){tr.error(t+":",i),""===i?e.error(t+": Is the server down?"):e.error(t+": "+i)}})}function O(r){r=r||{},r.success="function"==typeof r.success?r.success:tr.noop,r.error="function"==typeof r.error?r.error:tr.noop;var a=!0===r.unload,l=!0;void 0!==r.notifyDestroyed&&null!==r.notifyDestroyed&&(l=!0===r.notifyDestroyed);var c=!0===r.cleanupHandles;if(tr.log("Destroying session "+C+" (unload="+a+")"),!C)return tr.warn("No session to destroy"),r.success(),void(l&&e.destroyed());if(c)for(var d in w)j(d,{noRequest:!0});if(!_)return tr.warn("Is the server down? (connected=false)"),C=null,void r.success();var u={janus:"destroy",transaction:tr.randomString(12)};if(f&&(u["token"]=f),m&&(u["apisecret"]=m),a)return t?(i.onclose=null,i.close(),i=null):navigator.sendBeacon(o+"/"+C,JSON.stringify(u)),tr.log("Destroyed session:"),C=null,_=!1,r.success(),void(l&&e.destroyed());if(t){u["session_id"]=C;var h=function(){for(var e in s)i.removeEventListener(e,s[e]);i.removeEventListener("message",g),i.removeEventListener("error",v),n&&clearTimeout(n),i.close()},g=function(t){var i=JSON.parse(t.data);i.session_id==u.session_id&&i.transaction==u.transaction&&(h(),r.success(),l&&e.destroyed())},v=function(t){h(),r.error("Failed to destroy the server: Is the server down?"),l&&e.destroyed()};return i.addEventListener("message",g),i.addEventListener("error",v),void(1===i.readyState?i.send(JSON.stringify(u)):v())}tr.httpAPICall(o+"/"+C,{verb:"POST",withCredentials:p,body:u,success:function(t){tr.log("Destroyed session:"),tr.debug(t),C=null,_=!1,"success"!==t["janus"]&&tr.error("Ooops: "+t["error"].code+" "+t["error"].reason),r.success(),l&&e.destroyed()},error:function(t,i){tr.error(t+":",i),C=null,_=!1,r.success(),l&&e.destroyed()}})}function I(e){if(e=e||{},e.success="function"==typeof e.success?e.success:tr.noop,e.error="function"==typeof e.error?e.error:tr.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:tr.noop,e.iceState="function"==typeof e.iceState?e.iceState:tr.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:tr.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:tr.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:tr.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:tr.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:tr.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:tr.noop,e.ondata="function"==typeof e.ondata?e.ondata:tr.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:tr.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:tr.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:tr.noop,!_)return tr.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var s=e.plugin;if(!s)return tr.error("Invalid plugin"),void e.error("Invalid plugin");var n=e.opaqueId,r=e.token?e.token:f,a=tr.randomString(12),l={janus:"attach",plugin:s,opaque_id:n,transaction:a};if(r&&(l["token"]=r),m&&(l["apisecret"]=m),t)return S[a]=function(t){if(tr.debug(t),"success"!==t["janus"])return tr.error("Ooops: "+t["error"].code+" "+t["error"].reason),void e.error("Ooops: "+t["error"].code+" "+t["error"].reason);var i=t.data["id"];tr.log("Created handle: "+i);var n={session:y,plugin:s,id:i,token:r,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return i},getPlugin:function(){return s},getVolume:function(){return W(i,!0)},getRemoteVolume:function(){return W(i,!0)},getLocalVolume:function(){return W(i,!1)},isAudioMuted:function(){return G(i,!1)},muteAudio:function(){return q(i,!1,!0)},unmuteAudio:function(){return q(i,!1,!1)},isVideoMuted:function(){return G(i,!0)},muteVideo:function(){return q(i,!0,!0)},unmuteVideo:function(){return q(i,!0,!1)},getBitrate:function(){return H(i)},send:function(e){A(i,e)},data:function(e){N(i,e)},dtmf:function(e){R(i,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){B(i,!0,e)},createAnswer:function(e){B(i,!1,e)},handleRemoteJsep:function(e){$(i,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ontrackmuted:e.ontrackmuted,ontrackunmuted:e.ontrackunmuted,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){Y(i,!0===e)},detach:function(e){j(i,e)}};w[i]=n,e.success(n)},l["session_id"]=C,void i.send(JSON.stringify(l));tr.httpAPICall(o+"/"+C,{verb:"POST",withCredentials:p,body:l,success:function(t){if(tr.debug(t),"success"!==t["janus"])return tr.error("Ooops: "+t["error"].code+" "+t["error"].reason),void e.error("Ooops: "+t["error"].code+" "+t["error"].reason);var i=t.data["id"];tr.log("Created handle: "+i);var n={session:y,plugin:s,id:i,token:r,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return i},getPlugin:function(){return s},getVolume:function(){return W(i,!0)},getRemoteVolume:function(){return W(i,!0)},getLocalVolume:function(){return W(i,!1)},isAudioMuted:function(){return G(i,!1)},muteAudio:function(){return q(i,!1,!0)},unmuteAudio:function(){return q(i,!1,!1)},isVideoMuted:function(){return G(i,!0)},muteVideo:function(){return q(i,!0,!0)},unmuteVideo:function(){return q(i,!0,!1)},getBitrate:function(){return H(i)},send:function(e){A(i,e)},data:function(e){N(i,e)},dtmf:function(e){R(i,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){B(i,!0,e)},createAnswer:function(e){B(i,!1,e)},handleRemoteJsep:function(e){$(i,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ontrackmuted:e.ontrackmuted,ontrackunmuted:e.ontrackunmuted,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){Y(i,!0===e)},detach:function(e){j(i,e)}};w[i]=n,e.success(n)},error:function(t,i){tr.error(t+":",i),""===i?e.error(t+": Is the server down?"):e.error(t+": "+i)}})}function A(e,s){if(s=s||{},s.success="function"==typeof s.success?s.success:tr.noop,s.error="function"==typeof s.error?s.error:tr.noop,!_)return tr.warn("Is the server down? (connected=false)"),void s.error("Is the server down? (connected=false)");var n=w[e];if(!n||!n.webrtcStuff)return tr.warn("Invalid handle"),void s.error("Invalid handle");var r=s.message,a=s.jsep,l=tr.randomString(12),c={janus:"message",body:r,transaction:l};if(n.token&&(c["token"]=n.token),m&&(c["apisecret"]=m),a&&(c.jsep={type:a.type,sdp:a.sdp},a.e2ee&&(c.jsep.e2ee=!0),"hml"!==a.rid_order&&"lmh"!==a.rid_order||(c.jsep.rid_order=a.rid_order)),tr.debug("Sending message to plugin (handle="+e+"):"),tr.debug(c),t)return c["session_id"]=C,c["handle_id"]=e,S[l]=function(e){if(tr.debug("Message sent!"),tr.debug(e),"success"===e["janus"]){var t=e["plugindata"];if(!t)return tr.warn("Request succeeded, but missing plugindata..."),void s.success();tr.log("Synchronous transaction successful ("+t["plugin"]+")");var i=t["data"];return tr.debug(i),void s.success(i)}"ack"===e["janus"]?s.success():e["error"]?(tr.error("Ooops: "+e["error"].code+" "+e["error"].reason),s.error(e["error"].code+" "+e["error"].reason)):(tr.error("Unknown error"),s.error("Unknown error"))},void i.send(JSON.stringify(c));tr.httpAPICall(o+"/"+C+"/"+e,{verb:"POST",withCredentials:p,body:c,success:function(e){if(tr.debug("Message sent!"),tr.debug(e),"success"===e["janus"]){var t=e["plugindata"];if(!t)return tr.warn("Request succeeded, but missing plugindata..."),void s.success();tr.log("Synchronous transaction successful ("+t["plugin"]+")");var i=t["data"];return tr.debug(i),void s.success(i)}"ack"===e["janus"]?s.success():e["error"]?(tr.error("Ooops: "+e["error"].code+" "+e["error"].reason),s.error(e["error"].code+" "+e["error"].reason)):(tr.error("Unknown error"),s.error("Unknown error"))},error:function(e,t){tr.error(e+":",t),s.error(e+": "+t)}})}function M(e,s){if(_){var n=w[e];if(n&&n.webrtcStuff){var r={janus:"trickle",candidate:s,transaction:tr.randomString(12)};if(n.token&&(r["token"]=n.token),m&&(r["apisecret"]=m),tr.vdebug("Sending trickle candidate (handle="+e+"):"),tr.vdebug(r),t)return r["session_id"]=C,r["handle_id"]=e,void i.send(JSON.stringify(r));tr.httpAPICall(o+"/"+C+"/"+e,{verb:"POST",withCredentials:p,body:r,success:function(e){tr.vdebug("Candidate sent!"),tr.vdebug(e),"ack"===e["janus"]||tr.error("Ooops: "+e["error"].code+" "+e["error"].reason)},error:function(e,t){tr.error(e+":",t)}})}else tr.warn("Invalid handle")}else tr.warn("Is the server down? (connected=false)")}function E(e,t,i,s,n){var r=w[e];if(r&&r.webrtcStuff){var a=r.webrtcStuff;if(a.pc){var o=function(e){var t=e.target.label;r.ondata(e.data,t)},l=function(e){tr.log("Received state change on data channel:",e);var t=e.target.label,i=e.target.protocol,s=a.dataChannel[t]?a.dataChannel[t].readyState:"null";if(tr.log("State change on <"+t+"> data channel: "+s),"open"===s){if(a.dataChannel[t].pending&&a.dataChannel[t].pending.length>0){for(var n of(tr.log("Sending pending messages on <"+t+">:",a.dataChannel[t].pending.length),a.dataChannel[t].pending))tr.log("Sending data on data channel <"+t+">"),tr.debug(n),a.dataChannel[t].send(n);a.dataChannel[t].pending=[]}r.ondataopen(t,i)}},c=function(e){tr.error("Got error on data channel:",e)};if(s)a.dataChannel[t]=s;else{var d={ordered:!0};i&&(d.protocol=i),a.dataChannel[t]=a.pc.createDataChannel(t,d)}a.dataChannel[t].onmessage=o,a.dataChannel[t].onopen=l,a.dataChannel[t].onclose=l,a.dataChannel[t].onerror=c,a.dataChannel[t].pending=[],n&&a.dataChannel[t].pending.push(n)}else tr.warn("Invalid PeerConnection")}else tr.warn("Invalid handle")}function N(e,t){t=t||{},t.success="function"==typeof t.success?t.success:tr.noop,t.error="function"==typeof t.error?t.error:tr.noop;var i=w[e];if(!i||!i.webrtcStuff)return tr.warn("Invalid handle"),void t.error("Invalid handle");var s=i.webrtcStuff,n=t.text||t.data;if(!n)return tr.warn("Invalid data"),void t.error("Invalid data");var r=t.label?t.label:tr.dataChanDefaultLabel;return s.dataChannel[r]?"open"!==s.dataChannel[r].readyState?(s.dataChannel[r].pending.push(n),void t.success()):(tr.log("Sending data on data channel <"+r+">"),tr.debug(n),s.dataChannel[r].send(n),void t.success()):(E(e,r,t.protocol,!1,n,t.protocol),void t.success())}function R(e,t){t=t||{},t.success="function"==typeof t.success?t.success:tr.noop,t.error="function"==typeof t.error?t.error:tr.noop;var i=w[e];if(!i||!i.webrtcStuff)return tr.warn("Invalid handle"),void t.error("Invalid handle");var s=i.webrtcStuff;if(!s.dtmfSender){if(s.pc){var n=s.pc.getSenders(),r=n.find((function(e){return e.track&&"audio"===e.track.kind}));if(!r)return tr.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");s.dtmfSender=r.dtmf,s.dtmfSender&&(tr.log("Created DTMF Sender"),s.dtmfSender.ontonechange=function(e){tr.debug("Sent DTMF tone: "+e.tone)})}if(!s.dtmfSender)return tr.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var a=t.dtmf;if(!a)return tr.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var o=a.tones;if(!o)return tr.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var l="number"===typeof a.duration?a.duration:500,c="number"===typeof a.gap?a.gap:50;tr.debug("Sending DTMF string "+o+" (duration "+l+"ms, gap "+c+"ms)"),s.dtmfSender.insertDTMF(o,l,c),t.success()}function j(e,s){s=s||{},s.success="function"==typeof s.success?s.success:tr.noop,s.error="function"==typeof s.error?s.error:tr.noop;var n=!0===s.noRequest;tr.log("Destroying handle "+e+" (only-locally="+n+")"),Y(e);var r=w[e];if(!r||r.detached)return delete w[e],void s.success();if(r.detached=!0,n)return delete w[e],void s.success();if(!_)return tr.warn("Is the server down? (connected=false)"),void s.error("Is the server down? (connected=false)");var a={janus:"detach",transaction:tr.randomString(12)};if(r.token&&(a["token"]=r.token),m&&(a["apisecret"]=m),t)return a["session_id"]=C,a["handle_id"]=e,i.send(JSON.stringify(a)),delete w[e],void s.success();tr.httpAPICall(o+"/"+C+"/"+e,{verb:"POST",withCredentials:p,body:a,success:function(t){tr.log("Destroyed handle:"),tr.debug(t),"success"!==t["janus"]&&tr.error("Ooops: "+t["error"].code+" "+t["error"].reason),delete w[e],s.success()},error:function(t,i){tr.error(t+":",i),delete w[e],s.success()}})}function L(e,t,i,s,n){var r=w[e];if(!r||!r.webrtcStuff)return tr.warn("Invalid handle"),s.stream||tr.stopAllTracks(n),void s.error("Invalid handle");var a=r.webrtcStuff;tr.debug("streamsDone:",n),n&&(tr.debug("  -- Audio tracks:",n.getAudioTracks()),tr.debug("  -- Video tracks:",n.getVideoTracks()));var o=!1;if(a.myStream&&i.update&&(!a.streamExternal||i.replaceAudio||i.replaceVideo)){if((!i.update&&Z(i)||i.update&&(i.addAudio||i.replaceAudio))&&n.getAudioTracks()&&n.getAudioTracks().length)if(a.myStream.addTrack(n.getAudioTracks()[0]),tr.unifiedPlan){tr.log((i.replaceAudio?"Replacing":"Adding")+" audio track:",n.getAudioTracks()[0]);var p=null,h=a.pc.getTransceivers();if(h&&h.length>0)for(var f of h)if(f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind){p=f;break}p&&p.sender?p.sender.replaceTrack(n.getAudioTracks()[0]):a.pc.addTrack(n.getAudioTracks()[0],n)}else tr.log((i.replaceAudio?"Replacing":"Adding")+" audio track:",n.getAudioTracks()[0]),a.pc.addTrack(n.getAudioTracks()[0],n);if((!i.update&&ee(i)||i.update&&(i.addVideo||i.replaceVideo))&&n.getVideoTracks()&&n.getVideoTracks().length)if(a.myStream.addTrack(n.getVideoTracks()[0]),tr.unifiedPlan){tr.log((i.replaceVideo?"Replacing":"Adding")+" video track:",n.getVideoTracks()[0]);var m=null;h=a.pc.getTransceivers();if(h&&h.length>0)for(var f of h)if(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind){m=f;break}m&&m.sender?m.sender.replaceTrack(n.getVideoTracks()[0]):a.pc.addTrack(n.getVideoTracks()[0],n)}else tr.log((i.replaceVideo?"Replacing":"Adding")+" video track:",n.getVideoTracks()[0]),a.pc.addTrack(n.getVideoTracks()[0],n)}else a.myStream=n,o=!0;if(!a.pc){var g={iceServers:l,iceTransportPolicy:c,bundlePolicy:d};"chrome"===tr.webRTCAdapter.browserDetails.browser&&(g["sdpSemantics"]=tr.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var v={optional:[{DtlsSrtpKeyAgreement:!0}]};if(u&&v.optional.push({googIPv6:!0}),s.rtcConstraints&&"object"===typeof s.rtcConstraints)for(var _ in tr.debug("Adding custom PeerConnection constraints:",s.rtcConstraints),s.rtcConstraints)v.optional.push(s.rtcConstraints[_]);"edge"===tr.webRTCAdapter.browserDetails.browser&&(g.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(s.senderTransforms||s.receiverTransforms)&&(a.senderTransforms=s.senderTransforms,a.receiverTransforms=s.receiverTransforms,g["forceEncodedAudioInsertableStreams"]=!0,g["forceEncodedVideoInsertableStreams"]=!0,g["encodedInsertableStreams"]=!0),tr.log("Creating PeerConnection"),tr.debug(v),a.pc=new RTCPeerConnection(g,v),tr.debug(a.pc),a.pc.getStats&&(a.volume={}),tr.log("Preparing local SDP and gathering candidates (trickle="+a.trickle+")"),a.pc.oniceconnectionstatechange=function(e){a.pc&&r.iceState(a.pc.iceConnectionState)},a.pc.onicecandidate=function(t){if(!t.candidate||"edge"===tr.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)tr.log("End of candidates."),a.iceDone=!0,!0===a.trickle?M(e,{completed:!0}):z(e,s);else{var i={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===a.trickle&&M(e,i)}},a.pc.ontrack=function(e){if(tr.log("Handling Remote Track"),tr.debug(e),e.streams&&(a.remoteStream=e.streams[0],r.onremotestream(a.remoteStream),!e.track.onended)){if(a.receiverTransforms){var t=null;RTCRtpSender.prototype.createEncodedStreams?t=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&a.receiverTransforms["audio"]?t=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&a.receiverTransforms["video"]&&(t=e.receiver.createEncodedVideoStreams())),t&&(console.log(t),t.readableStream&&t.writableStream?t.readableStream.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(t.writableStream):t.readable&&t.writable&&t.readable.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(t.writable))}var i=null;tr.log("Adding onended callback to track:",e.track),e.track.onended=function(e){tr.log("Remote track removed:",e),a.remoteStream&&(clearTimeout(i),a.remoteStream.removeTrack(e.target),r.onremotestream(a.remoteStream))},e.track.onmute=function(e){tr.log("Remote track muted:",e),a.remoteStream&&null==i&&(i=setTimeout((function(){tr.log("Removing remote track"),a.remoteStream&&(a.remoteStream.removeTrack(e.target),r.onremotestream(a.remoteStream),r.ontrackmuted()),i=null}),2520))},e.track.onunmute=function(e){if(tr.log("Remote track flowing again:",e),null!=i)clearTimeout(i),i=null;else try{a.remoteStream.addTrack(e.target),r.onremotestream(a.remoteStream),r.ontrackunmuted()}catch(t){tr.error(t)}}}}}if(o&&n){tr.log("Adding local stream");var C=!0===s.simulcast2;n.getTracks().forEach((function(e){tr.log("Adding local track:",e);var t=null;if(C&&"audio"!==e.kind){tr.log("Enabling rid-based simulcasting:",e);var i=b(s.simulcastMaxBitrates),r=a.pc.addTransceiver(e,{direction:"sendrecv",streams:[n],sendEncodings:s.sendEncodings||[{rid:"h",active:!0,maxBitrate:i.high},{rid:"m",active:!0,maxBitrate:i.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:i.low,scaleResolutionDownBy:4}]});r&&(t=r.sender)}else t=a.pc.addTrack(e,n);if(t&&a.senderTransforms){var o=null;RTCRtpSender.prototype.createEncodedStreams?o=t.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===t.track.kind&&a.senderTransforms["audio"]?o=t.createEncodedAudioStreams():"video"===t.track.kind&&a.senderTransforms["video"]&&(o=t.createEncodedVideoStreams())),o&&(console.log(o),o.readableStream&&o.writableStream?o.readableStream.pipeThrough(a.senderTransforms[t.track.kind]).pipeTo(o.writableStream):o.readable&&o.writable&&o.readable.pipeThrough(a.senderTransforms[t.track.kind]).pipeTo(o.writable))}}))}if(ne(i)&&!a.dataChannel[tr.dataChanDefaultLabel]&&(tr.log("Creating default data channel"),E(e,tr.dataChanDefaultLabel,null,!1),a.pc.ondatachannel=function(t){tr.log("Data channel created by Janus:",t),E(e,t.channel.label,t.channel.protocol,t.channel)}),a.myStream&&r.onlocalstream(a.myStream),t){var y=t["sdp"],k=/420029/gi,S=y.replace(k,"42e01f");tr.log(S),t["sdp"]=S,a.pc.setRemoteDescription(t).then((function(){if(tr.log("Remote description accepted!"),a.remoteSdp=t.sdp,a.candidates&&a.candidates.length>0){for(var n=0;n<a.candidates.length;n++){var r=a.candidates[n];tr.debug("Adding remote candidate:",r),r&&!0!==r.completed?a.pc.addIceCandidate(r):a.pc.addIceCandidate(tr.endOfCandidates)}a.candidates=[]}U(e,i,s)}),s.error)}else V(e,i,s)}function B(e,t,i){i=i||{},i.success="function"==typeof i.success?i.success:tr.noop,i.error="function"==typeof i.error?i.error:J;var s=i.jsep;if(t&&s)return tr.error("Provided a JSEP to a createOffer"),void i.error("Provided a JSEP to a createOffer");if(!t&&(!s||!s.type||!s.sdp))return tr.error("A valid JSEP is required for createAnswer"),void i.error("A valid JSEP is required for createAnswer");i.media="object"===typeof i.media&&i.media?i.media:{audio:!0,video:!0};var n=i.media,r=w[e];if(!r||!r.webrtcStuff)return tr.warn("Invalid handle"),void i.error("Invalid handle");var a=r.webrtcStuff;if(a.trickle=re(i.trickle),a.pc){if(tr.log("Updating existing media session"),n.update=!0,i.stream)i.stream!==a.myStream&&tr.log("Renegotiation involves a new external stream");else{if(n.addAudio){if(n.keepAudio=!1,n.replaceAudio=!1,n.removeAudio=!1,n.audioSend=!0,a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length)return tr.error("Can't add audio stream, there already is one"),void i.error("Can't add audio stream, there already is one")}else n.removeAudio?(n.keepAudio=!1,n.replaceAudio=!1,n.addAudio=!1,n.audioSend=!1):n.replaceAudio&&(n.keepAudio=!1,n.addAudio=!1,n.removeAudio=!1,n.audioSend=!0);if(a.myStream&&a.myStream.getAudioTracks()&&0!==a.myStream.getAudioTracks().length?!Z(n)||n.removeAudio||n.replaceAudio||(n.keepAudio=!0):(n.replaceAudio&&(n.keepAudio=!1,n.replaceAudio=!1,n.addAudio=!0,n.audioSend=!0),Z(n)&&(n.keepAudio=!1,n.addAudio=!0)),n.addVideo){if(n.keepVideo=!1,n.replaceVideo=!1,n.removeVideo=!1,n.videoSend=!0,a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length)return tr.error("Can't add video stream, there already is one"),void i.error("Can't add video stream, there already is one")}else n.removeVideo?(n.keepVideo=!1,n.replaceVideo=!1,n.addVideo=!1,n.videoSend=!1):n.replaceVideo&&(n.keepVideo=!1,n.addVideo=!1,n.removeVideo=!1,n.videoSend=!0);a.myStream&&a.myStream.getVideoTracks()&&0!==a.myStream.getVideoTracks().length?!ee(n)||n.removeVideo||n.replaceVideo||(n.keepVideo=!0):(n.replaceVideo&&(n.keepVideo=!1,n.replaceVideo=!1,n.addVideo=!0,n.videoSend=!0),ee(n)&&(n.keepVideo=!1,n.addVideo=!0)),n.addData&&(n.data=!0)}if(Z(n)&&n.keepAudio&&ee(n)&&n.keepVideo)return r.consentDialog(!1),void L(e,s,n,i,a.myStream)}else n.update=!1,n.keepAudio=!1,n.keepVideo=!1;if(n.update&&(!a.streamExternal||a.streamExternal&&(n.replaceAudio||n.replaceVideo))){if(n.removeAudio||n.replaceAudio){if(a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length){var o=a.myStream.getAudioTracks()[0];tr.log("Removing audio track:",o),a.myStream.removeTrack(o);try{o.stop()}catch(T){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var l=!0;if(n.replaceAudio&&tr.unifiedPlan&&(l=!1),l)for(var c of a.pc.getSenders())c&&c.track&&"audio"===c.track.kind&&(tr.log("Removing audio sender:",c),a.pc.removeTrack(c))}}if(n.removeVideo||n.replaceVideo){if(a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length){var d=a.myStream.getVideoTracks()[0];tr.log("Removing video track:",d),a.myStream.removeTrack(d);try{d.stop()}catch(T){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var u=!0;if(n.replaceVideo&&tr.unifiedPlan&&(u=!1),u)for(var p of a.pc.getSenders())p&&p.track&&"video"===p.track.kind&&(tr.log("Removing video sender:",p),a.pc.removeTrack(p))}}}if(i.stream){var h=i.stream;return tr.log("MediaStream provided by the application"),tr.debug(h),!n.update||!a.myStream||a.myStream===i.stream||a.streamExternal||n.replaceAudio||n.replaceVideo||(tr.stopAllTracks(a.myStream),a.myStream=null),a.streamExternal=!0,r.consentDialog(!1),void L(e,s,n,i,h)}if(Z(n)||ee(n)){if(!tr.isGetUserMediaAvailable())return void i.error("getUserMedia not available");var f={mandatory:{},optional:[]};r.consentDialog(!0);var m=Z(n);m&&n&&"object"===typeof n.audio&&(m=n.audio);var g=ee(n);if(g&&n){var v=!0===i.simulcast,b=!0===i.simulcast2;if(!v&&!b||s||n.video||(n.video="hires"),n.video&&"screen"!=n.video&&"window"!=n.video)if("object"===typeof n.video)g=n.video;else{var _=0,C=0;"lowres"===n.video?(C=240,240,_=320):"lowres-16:9"===n.video?(C=180,180,_=320):"hires"===n.video||"hires-16:9"===n.video||"hdres"===n.video?(C=720,720,_=1280):"fhdres"===n.video?(C=1080,1080,_=1920):"4kres"===n.video?(C=2160,2160,_=3840):"stdres"===n.video?(C=480,480,_=640):"stdres-16:9"===n.video?(C=360,360,_=640):(tr.log("Default video setting is stdres 4:3"),C=480,480,_=640),tr.log("Adding media constraint:",n.video),g={height:{ideal:C},width:{ideal:_}},tr.log("Adding video constraint:",g)}else if("screen"===n.video||"window"===n.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return f.video={},n.screenshareFrameRate&&(f.video.frameRate=n.screenshareFrameRate),n.screenshareHeight&&(f.video.height=n.screenshareHeight),n.screenshareWidth&&(f.video.width=n.screenshareWidth),f.audio=n.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(f).then((function(t){r.consentDialog(!1),Z(n)&&!n.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(r){t.addTrack(r.getAudioTracks()[0]),L(e,s,n,i,t)})):L(e,s,n,i,t)}),(function(e){r.consentDialog(!1),i.error(e)}));function y(t,a){r.consentDialog(!1),t?i.error(t):L(e,s,n,i,a)}function k(e,t,i){tr.log("Adding media constraint (screen capture)"),tr.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){i?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){e.addTrack(i.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){r.consentDialog(!1),t(e)}))}if("chrome"===tr.webRTCAdapter.browserDetails.browser){var S=tr.webRTCAdapter.browserDetails.version,P=33;window.navigator.userAgent.match("Linux")&&(P=35),S>=26&&S<=P?(f={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:n.screenshareFrameRate,maxFrameRate:n.screenshareFrameRate,chromeMediaSource:"screen"}},audio:Z(n)&&!n.keepAudio},k(f,y)):tr.extension.getScreen((function(e,t){if(e)return r.consentDialog(!1),i.error(e);f={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:n.screenshareFrameRate,maxFrameRate:n.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},f.video.mandatory.chromeMediaSourceId=t,k(f,y,Z(n)&&!n.keepAudio)}))}else if("firefox"===tr.webRTCAdapter.browserDetails.browser){if(!(tr.webRTCAdapter.browserDetails.version>=33)){var x=new Error("NavigatorUserMediaError");return x.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",r.consentDialog(!1),void i.error(x)}f={video:{mozMediaSource:n.video,mediaSource:n.video},audio:Z(n)&&!n.keepAudio},k(f,(function(e,t){if(y(e,t),!e)var i=t.currentTime,s=window.setInterval((function(){t||window.clearInterval(s),t.currentTime==i&&(window.clearInterval(s),t.onended&&t.onended()),i=t.currentTime}),500)}))}return}}n&&"screen"===n.video||navigator.mediaDevices.enumerateDevices().then((function(t){var a=t.some((function(e){return"audioinput"===e.kind})),o=se(n)||t.some((function(e){return"videoinput"===e.kind})),l=Z(n),c=ee(n),d=Q(n),u=te(n);if(l||c||d||u){var p=!!l&&a,f=!!c&&o;if(!p&&!f)return r.consentDialog(!1),i.error("No capture device found"),!1;if(!p&&d)return r.consentDialog(!1),i.error("Audio capture is required, but no capture device found"),!1;if(!f&&u)return r.consentDialog(!1),i.error("Video capture is required, but no capture device found"),!1}var v={audio:!(!a||n.keepAudio)&&m,video:!(!o||n.keepVideo)&&g};tr.debug("getUserMedia constraints",v),v.audio||v.video?navigator.mediaDevices.getUserMedia(v).then((function(t){r.consentDialog(!1),L(e,s,n,i,t)})).catch((function(e){r.consentDialog(!1),i.error({code:e.code,name:e.name,message:e.message})})):(r.consentDialog(!1),L(e,s,n,i,h))})).catch((function(e){r.consentDialog(!1),i.error(e)}))}else L(e,s,n,i)}function $(e,t){t=t||{},t.success="function"==typeof t.success?t.success:tr.noop,t.error="function"==typeof t.error?t.error:J,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:tr.noop;var i=t.jsep,s=w[e];if(!s||!s.webrtcStuff)return tr.warn("Invalid handle"),void t.error("Invalid handle");var n=s.webrtcStuff;if(i){if(!n.pc)return tr.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");t.customizeSdp(i),n.pc.setRemoteDescription(i).then((function(){if(tr.log("Remote description accepted!"),n.remoteSdp=i.sdp,n.candidates&&n.candidates.length>0){for(var e=0;e<n.candidates.length;e++){var s=n.candidates[e];tr.debug("Adding remote candidate:",s),s&&!0!==s.completed?n.pc.addIceCandidate(s):n.pc.addIceCandidate(tr.endOfCandidates)}n.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function V(e,t,i){i=i||{},i.success="function"==typeof i.success?i.success:tr.noop,i.error="function"==typeof i.error?i.error:tr.noop,i.customizeSdp="function"==typeof i.customizeSdp?i.customizeSdp:tr.noop;var s=w[e];if(!s||!s.webrtcStuff)return tr.warn("Invalid handle"),void i.error("Invalid handle");var n=s.webrtcStuff,r=!0===i.simulcast;r?tr.log("Creating offer (iceDone="+n.iceDone+", simulcast="+r+")"):tr.log("Creating offer (iceDone="+n.iceDone+")");var a={};if(tr.unifiedPlan){var o=null,l=null,c=n.pc.getTransceivers();if(c&&c.length>0)for(var d of c)d.sender&&d.sender.track&&"audio"===d.sender.track.kind||d.receiver&&d.receiver.track&&"audio"===d.receiver.track.kind?o||(o=d):(d.sender&&d.sender.track&&"video"===d.sender.track.kind||d.receiver&&d.receiver.track&&"video"===d.receiver.track.kind)&&(l||(l=d));var u=Z(t),p=X(t);u||p?u&&p?o&&(o.setDirection?o.setDirection("sendrecv"):o.direction="sendrecv",tr.log("Setting audio transceiver to sendrecv:",o)):u&&!p?o&&(o.setDirection?o.setDirection("sendonly"):o.direction="sendonly",tr.log("Setting audio transceiver to sendonly:",o)):!u&&p&&(o?(o.setDirection?o.setDirection("recvonly"):o.direction="recvonly",tr.log("Setting audio transceiver to recvonly:",o)):(o=n.pc.addTransceiver("audio",{direction:"recvonly"}),tr.log("Adding recvonly audio transceiver:",o))):t.removeAudio&&o&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive",tr.log("Setting audio transceiver to inactive:",o));var h=ee(t),f=ie(t);h||f?h&&f?l&&(l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",tr.log("Setting video transceiver to sendrecv:",l)):h&&!f?l&&(l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",tr.log("Setting video transceiver to sendonly:",l)):!h&&f&&(l?(l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",tr.log("Setting video transceiver to recvonly:",l)):(l=n.pc.addTransceiver("video",{direction:"recvonly"}),tr.log("Adding recvonly video transceiver:",l))):t.removeVideo&&l&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive",tr.log("Setting video transceiver to inactive:",l))}else a["offerToReceiveAudio"]=X(t),a["offerToReceiveVideo"]=ie(t);var m=!0===i.iceRestart;m&&(a["iceRestart"]=!0),tr.debug(a);var g=ee(t);if(g&&r&&"firefox"===tr.webRTCAdapter.browserDetails.browser){tr.log("Enabling Simulcasting for Firefox (RID)");var v=n.pc.getSenders().find((function(e){return e.track&&"video"===e.track.kind}));if(v){var _=v.getParameters();_||(_={});var C=b(i.simulcastMaxBitrates);_.encodings=i.sendEncodings||[{rid:"h",active:!0,maxBitrate:C.high},{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:C.low,scaleResolutionDownBy:4}],v.setParameters(_)}}n.pc.createOffer(a).then((function(e){tr.debug(e);var t={type:e.type,sdp:e.sdp};i.customizeSdp(t),e.sdp=t.sdp,tr.log("Setting local description"),g&&r&&("chrome"===tr.webRTCAdapter.browserDetails.browser||"safari"===tr.webRTCAdapter.browserDetails.browser?(tr.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=K(e.sdp)):"firefox"!==tr.webRTCAdapter.browserDetails.browser&&tr.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),n.mySdp={type:"offer",sdp:e.sdp},n.pc.setLocalDescription(e).catch(i.error),n.mediaConstraints=a,n.iceDone||n.trickle?((n.senderTransforms||n.receiverTransforms)&&(e["e2ee"]=!0),i.success(e)):tr.log("Waiting for all candidates...")}),i.error)}function U(e,t,i){i=i||{},i.success="function"==typeof i.success?i.success:tr.noop,i.error="function"==typeof i.error?i.error:tr.noop,i.customizeSdp="function"==typeof i.customizeSdp?i.customizeSdp:tr.noop;var s=w[e];if(!s||!s.webrtcStuff)return tr.warn("Invalid handle"),void i.error("Invalid handle");var n=s.webrtcStuff,r=!0===i.simulcast;r?tr.log("Creating answer (iceDone="+n.iceDone+", simulcast="+r+")"):tr.log("Creating answer (iceDone="+n.iceDone+")");var a=null;if(tr.unifiedPlan){a={};var o=null,l=null,c=n.pc.getTransceivers();if(c&&c.length>0)for(var d of c)d.sender&&d.sender.track&&"audio"===d.sender.track.kind||d.receiver&&d.receiver.track&&"audio"===d.receiver.track.kind?o||(o=d):(d.sender&&d.sender.track&&"video"===d.sender.track.kind||d.receiver&&d.receiver.track&&"video"===d.receiver.track.kind)&&(l||(l=d));var u=Z(t),p=X(t);if(u||p){if(u&&p){if(o)try{o.setDirection?o.setDirection("sendrecv"):o.direction="sendrecv",tr.log("Setting audio transceiver to sendrecv:",o)}catch(C){tr.error(C)}}else if(u&&!p)try{o&&(o.setDirection?o.setDirection("sendonly"):o.direction="sendonly",tr.log("Setting audio transceiver to sendonly:",o))}catch(C){tr.error(C)}else if(!u&&p)if(o)try{o.setDirection?o.setDirection("recvonly"):o.direction="recvonly",tr.log("Setting audio transceiver to recvonly:",o)}catch(C){tr.error(C)}else o=n.pc.addTransceiver("audio",{direction:"recvonly"}),tr.log("Adding recvonly audio transceiver:",o)}else if(t.removeAudio&&o)try{o.setDirection?o.setDirection("inactive"):o.direction="inactive",tr.log("Setting audio transceiver to inactive:",o)}catch(C){tr.error(C)}var h=ee(t),f=ie(t);if(h||f){if(h&&f){if(l)try{l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",tr.log("Setting video transceiver to sendrecv:",l)}catch(C){tr.error(C)}}else if(h&&!f){if(l)try{l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",tr.log("Setting video transceiver to sendonly:",l)}catch(C){tr.error(C)}}else if(!h&&f)if(l)try{l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",tr.log("Setting video transceiver to recvonly:",l)}catch(C){tr.error(C)}else l=n.pc.addTransceiver("video",{direction:"recvonly"}),tr.log("Adding recvonly video transceiver:",l)}else if(t.removeVideo&&l)try{l.setDirection?l.setDirection("inactive"):l.direction="inactive",tr.log("Setting video transceiver to inactive:",l)}catch(C){tr.error(C)}}else a="firefox"===tr.webRTCAdapter.browserDetails.browser||"edge"===tr.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:X(t),offerToReceiveVideo:ie(t)}:{mandatory:{OfferToReceiveAudio:X(t),OfferToReceiveVideo:ie(t)}};tr.debug(a);var m=ee(t);if(m&&r&&"firefox"===tr.webRTCAdapter.browserDetails.browser){tr.log("Enabling Simulcasting for Firefox (RID)");var g=n.pc.getSenders()[1];tr.log(g);var v=g.getParameters();tr.log(v);var _=b(i.simulcastMaxBitrates);g.setParameters({encodings:i.sendEncodings||[{rid:"h",active:!0,maxBitrate:_.high},{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:_.low,scaleResolutionDownBy:4}]})}n.pc.createAnswer(a).then((function(e){tr.debug(e);var t={type:e.type,sdp:e.sdp};i.customizeSdp(t),e.sdp=t.sdp,tr.log("Setting local description"),m&&r&&("chrome"===tr.webRTCAdapter.browserDetails.browser?tr.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==tr.webRTCAdapter.browserDetails.browser&&tr.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),n.mySdp={type:"answer",sdp:e.sdp},n.pc.setLocalDescription(e).catch(i.error),n.mediaConstraints=a,n.iceDone||n.trickle?((n.senderTransforms||n.receiverTransforms)&&(e["e2ee"]=!0),i.success(e)):tr.log("Waiting for all candidates...")}),i.error)}function z(e,t){t=t||{},t.success="function"==typeof t.success?t.success:tr.noop,t.error="function"==typeof t.error?t.error:tr.noop;var i=w[e];if(i&&i.webrtcStuff){var s=i.webrtcStuff;tr.log("Sending offer/answer SDP..."),s.mySdp?(s.mySdp={type:s.pc.localDescription.type,sdp:s.pc.localDescription.sdp},!1===s.trickle&&(s.mySdp["trickle"]=!1),tr.debug(t),s.sdpSent=!0,t.success(s.mySdp)):tr.warn("Local SDP instance is invalid, not sending anything...")}else tr.warn("Invalid handle, not sending anything")}function W(e,t){var i=w[e];if(!i||!i.webrtcStuff)return tr.warn("Invalid handle"),0;var s=t?"remote":"local",n=i.webrtcStuff;return n.volume[s]||(n.volume[s]={value:0}),!n.pc.getStats||"chrome"!==tr.webRTCAdapter.browserDetails.browser&&"safari"!==tr.webRTCAdapter.browserDetails.browser?(tr.warn("Getting the "+s+" volume unsupported by browser"),0):t&&!n.remoteStream?(tr.warn("Remote stream unavailable"),0):t||n.myStream?n.volume[s].timer?n.volume[s].value:(tr.log("Starting "+s+" volume monitor"),n.volume[s].timer=setInterval((function(){n.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(n.volume[s].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(tr.warn("Local stream unavailable"),0)}function G(e,t){var i=w[e];if(!i||!i.webrtcStuff)return tr.warn("Invalid handle"),!0;var s=i.webrtcStuff;return s.pc?s.myStream?t?s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!s.myStream.getVideoTracks()[0].enabled:(tr.warn("No video track"),!0):s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!s.myStream.getAudioTracks()[0].enabled:(tr.warn("No audio track"),!0):(tr.warn("Invalid local MediaStream"),!0):(tr.warn("Invalid PeerConnection"),!0)}function q(e,t,i){var s=w[e];if(!s||!s.webrtcStuff)return tr.warn("Invalid handle"),!1;var n=s.webrtcStuff;return n.pc?n.myStream?t?n.myStream.getVideoTracks()&&0!==n.myStream.getVideoTracks().length?(n.myStream.getVideoTracks()[0].enabled=!i,!0):(tr.warn("No video track"),!1):n.myStream.getAudioTracks()&&0!==n.myStream.getAudioTracks().length?(n.myStream.getAudioTracks()[0].enabled=!i,!0):(tr.warn("No audio track"),!1):(tr.warn("Invalid local MediaStream"),!1):(tr.warn("Invalid PeerConnection"),!1)}function H(e){var t=w[e];if(!t||!t.webrtcStuff)return tr.warn("Invalid handle"),"Invalid handle";var i=t.webrtcStuff;return i.pc?i.pc.getStats?(i.bitrate.timer||(tr.log("Starting bitrate timer (via getStats)"),i.bitrate.timer=setInterval((function(){i.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(i.bitrate.fps=e.framesPerSecond,i.bitrate.bsnow=e.bytesReceived,i.bitrate.tsnow=e.timestamp,null===i.bitrate.bsbefore||null===i.bitrate.tsbefore)i.bitrate.bsbefore=i.bitrate.bsnow,i.bitrate.tsbefore=i.bitrate.tsnow;else{var s=i.bitrate.tsnow-i.bitrate.tsbefore;"safari"===tr.webRTCAdapter.browserDetails.browser&&(s/=1e3);var n=Math.round(8*(i.bitrate.bsnow-i.bitrate.bsbefore)/s);"safari"===tr.webRTCAdapter.browserDetails.browser&&(n=parseInt(n/1e3)),i.bitrate.value=n+" kbps",i.bitrate.bsbefore=i.bitrate.bsnow,i.bitrate.tsbefore=i.bitrate.tsnow}}}))}))}),1e3)),i.bitrate):(tr.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function J(e){tr.error("WebRTC error:",e)}function Y(e,s){tr.log("Cleaning WebRTC stuff");var n=w[e];if(n){var r=n.webrtcStuff;if(r){if(!0===s){var a={janus:"hangup",transaction:tr.randomString(12)};n.token&&(a["token"]=n.token),m&&(a["apisecret"]=m),tr.debug("Sending hangup request (handle="+e+"):"),tr.debug(a),t?(a["session_id"]=C,a["handle_id"]=e,i.send(JSON.stringify(a))):tr.httpAPICall(o+"/"+C+"/"+e,{verb:"POST",withCredentials:p,body:a})}r.remoteStream=null,r.volume&&(r.volume["local"]&&r.volume["local"].timer&&clearInterval(r.volume["local"].timer),r.volume["remote"]&&r.volume["remote"].timer&&clearInterval(r.volume["remote"].timer)),r.volume={},r.bitrate.timer&&clearInterval(r.bitrate.timer),r.bitrate.timer=null,r.bitrate.bsnow=null,r.bitrate.bsbefore=null,r.bitrate.tsnow=null,r.bitrate.tsbefore=null,r.bitrate.value=null,!r.streamExternal&&r.myStream&&(tr.log("Stopping local stream tracks"),tr.stopAllTracks(r.myStream)),r.streamExternal=!1,r.myStream=null;try{r.pc.close()}catch(l){}r.pc=null,r.candidates=null,r.mySdp=null,r.remoteSdp=null,r.iceDone=!1,r.dataChannel={},r.dtmfSender=null,r.senderTransforms=null,r.receiverTransforms=null}n.oncleanup()}}function K(e){for(var t=e.split("\r\n"),i=!1,s=[-1],n=[-1],r=null,a=null,o=null,l=null,c=-1,d=0;d<t.length;d++){var u=t[d].match(/m=(\w+) */);if(u){var p=u[1];if("video"===p){if(!(s[0]<0)){c=d;break}i=!0}else if(s[0]>-1){c=d;break}}else if(i){var h=t[d].match(/a=ssrc-group:SIM (\d+) (\d+) (\d+)/);if(h)return tr.warn("The SDP already contains a SIM attribute, munging will be skipped"),e;var f=t[d].match(/a=ssrc-group:FID (\d+) (\d+)/);if(f)s[0]=f[1],n[0]=f[2],t.splice(d,1),d--;else{if(s[0]){var m=t[d].match("a=ssrc:"+s[0]+" cname:(.+)");if(m&&(r=m[1]),m=t[d].match("a=ssrc:"+s[0]+" msid:(.+)"),m&&(a=m[1]),m=t[d].match("a=ssrc:"+s[0]+" mslabel:(.+)"),m&&(o=m[1]),m=t[d].match("a=ssrc:"+s[0]+" label:(.+)"),m&&(l=m[1]),0===t[d].indexOf("a=ssrc:"+n[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+s[0])){t.splice(d,1),d--;continue}}0!=t[d].length||(t.splice(d,1),d--)}}}if(s[0]<0){c=-1,i=!1;for(d=0;d<t.length;d++){u=t[d].match(/m=(\w+) */);if(u){p=u[1];if("video"===p){if(!(s[0]<0)){c=d;break}i=!0}else if(s[0]>-1){c=d;break}}else if(i){if(s[0]<0){var g=t[d].match(/a=ssrc:(\d+)/);if(g){s[0]=g[1],t.splice(d,1),d--;continue}}else{m=t[d].match("a=ssrc:"+s[0]+" cname:(.+)");if(m&&(r=m[1]),m=t[d].match("a=ssrc:"+s[0]+" msid:(.+)"),m&&(a=m[1]),m=t[d].match("a=ssrc:"+s[0]+" mslabel:(.+)"),m&&(o=m[1]),m=t[d].match("a=ssrc:"+s[0]+" label:(.+)"),m&&(l=m[1]),0===t[d].indexOf("a=ssrc:"+n[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+s[0])){t.splice(d,1),d--;continue}}0!==t[d].length||(t.splice(d,1),d--)}}}if(s[0]<0)return tr.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;c<0&&(c=t.length),s[1]=Math.floor(4294967295*Math.random()),s[2]=Math.floor(4294967295*Math.random()),n[1]=Math.floor(4294967295*Math.random()),n[2]=Math.floor(4294967295*Math.random());for(d=0;d<s.length;d++)r&&(t.splice(c,0,"a=ssrc:"+s[d]+" cname:"+r),c++),a&&(t.splice(c,0,"a=ssrc:"+s[d]+" msid:"+a),c++),o&&(t.splice(c,0,"a=ssrc:"+s[d]+" mslabel:"+o),c++),l&&(t.splice(c,0,"a=ssrc:"+s[d]+" label:"+l),c++),r&&(t.splice(c,0,"a=ssrc:"+n[d]+" cname:"+r),c++),a&&(t.splice(c,0,"a=ssrc:"+n[d]+" msid:"+a),c++),o&&(t.splice(c,0,"a=ssrc:"+n[d]+" mslabel:"+o),c++),l&&(t.splice(c,0,"a=ssrc:"+n[d]+" label:"+l),c++);return t.splice(c,0,"a=ssrc-group:FID "+s[2]+" "+n[2]),t.splice(c,0,"a=ssrc-group:FID "+s[1]+" "+n[1]),t.splice(c,0,"a=ssrc-group:FID "+s[0]+" "+n[0]),t.splice(c,0,"a=ssrc-group:SIM "+s[0]+" "+s[1]+" "+s[2]),e=t.join("\r\n"),e.endsWith("\r\n")||(e+="\r\n"),e}function Z(e){return tr.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function Q(e){return tr.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}function X(e){return tr.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function ee(e){return tr.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function te(e){return tr.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}function ie(e){return tr.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}function se(e){if(tr.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var t=e.video.mandatory;return t.chromeMediaSource?"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource:t.mozMediaSource?"window"===t.mozMediaSource||"screen"===t.mozMediaSource:!!t.mediaSource&&("window"===t.mediaSource||"screen"===t.mediaSource)}function ne(e){return tr.debug("isDataEnabled:",e),"edge"===tr.webRTCAdapter.browserDetails.browser?(tr.warn("Edge doesn't support data channels yet"),!1):void 0!==e&&null!==e&&!0===e.data}function re(e){return tr.debug("isTrickleEnabled:",e),!1!==e}F(e),this.getServer=function(){return o},this.isConnected=function(){return _},this.reconnect=function(e){e=e||{},e.success="function"==typeof e.success?e.success:tr.noop,e.error="function"==typeof e.error?e.error:tr.noop,e["reconnect"]=!0,F(e)},this.getSessionId=function(){return C},this.getInfo=function(e){D(e)},this.destroy=function(e){O(e)},this.attach=function(e){I(e)}}tr.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,i=e&&e.Promise||Promise,s=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new s(e,t)},extension:e&&e.extension||er,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||Xn["a"],httpAPICall:function(e,s){var n={method:s.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===s.verb&&(n.headers["Content-Type"]="application/json"),void 0!==s.withCredentials&&(n.credentials=!0===s.withCredentials?"include":s.withCredentials?s.withCredentials:"omit"),s.body&&(n.body=JSON.stringify(s.body));var r=t(e,n).catch((function(e){return i.reject({message:"Probably a network error, is the server down?",error:e})}));if(s.timeout){var a=new i((function(e,t){var i=setTimeout((function(){return clearTimeout(i),t({message:"Request timed out",timeout:s.timeout})}),s.timeout)}));r=i.race([r,a])}return r.then((function(e){return e.ok?typeof s.success===typeof tr.noop?e.json().then((function(e){try{s.success(e)}catch(t){tr.error("Unhandled httpAPICall success callback error",t)}}),(function(t){return i.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:i.reject({message:"API call failed",response:e})})).catch((function(e){typeof s.error===typeof tr.noop&&s.error(e.message||"<< internal error >>",e)})),r}}},tr.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,i=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new i(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||er,webRTCAdapter:e&&e.adapter||Xn["a"],httpAPICall:function(e,i){var s=void 0!==i.body?{contentType:"application/json",data:JSON.stringify(i.body)}:{},n=void 0!==i.withCredentials?{xhrFields:{withCredentials:i.withCredentials}}:{};return t.ajax(t.extend(s,n,{url:e,type:i.verb,cache:!1,dataType:"json",async:i.async,timeout:i.timeout,success:function(e){typeof i.success===typeof tr.noop&&i.success(e)},error:function(e,t,s){typeof i.error===typeof tr.noop&&i.error(t,s)}}))}}},tr.noop=function(){},tr.dataChanDefaultLabel="JanusDataChannel",tr.endOfCandidates=null,tr.stopAllTracks=function(e){try{var t=e.getTracks();for(var i of t)tr.log(i),i&&i.stop()}catch(s){}},tr.init=function(e){if(e=e||{},e.callback="function"==typeof e.callback?e.callback:tr.noop,tr.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),tr.trace=tr.noop,tr.debug=tr.noop,tr.vdebug=tr.noop,tr.log=tr.noop,tr.warn=tr.noop,tr.error=tr.noop,!0===e.debug||"all"===e.debug)tr.trace=console.trace.bind(console),tr.debug=console.debug.bind(console),tr.vdebug=console.debug.bind(console),tr.log=console.log.bind(console),tr.warn=console.warn.bind(console),tr.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var t of e.debug)switch(t){case"trace":tr.trace=console.trace.bind(console);break;case"debug":tr.debug=console.debug.bind(console);break;case"vdebug":tr.vdebug=console.debug.bind(console);break;case"log":tr.log=console.log.bind(console);break;case"warn":tr.warn=console.warn.bind(console);break;case"error":tr.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+t+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')");break}tr.log("Initializing library");var i=e.dependencies||tr.useDefaultDependencies();tr.isArray=i.isArray,tr.webRTCAdapter=i.webRTCAdapter,tr.httpAPICall=i.httpAPICall,tr.newWebSocket=i.newWebSocket,tr.extension=i.extension,tr.extension.init(),tr.listDevices=function(e,t){e="function"==typeof e?e:tr.noop,null==t&&(t={audio:!0,video:!0}),tr.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(i){tr.debug(i),e(i),tr.stopAllTracks(t)}))})).catch((function(t){tr.error(t),e([])})):(tr.warn("navigator.mediaDevices unavailable"),e([]))},tr.attachMediaStream=function(e,t){try{e.srcObject=t}catch(i){try{e.src=URL.createObjectURL(t)}catch(i){tr.error("Error attaching stream to element")}}},tr.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(i){try{e.src=t.src}catch(i){tr.error("Error reattaching stream to element")}}};var s=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0,n=s?"pagehide":"beforeunload",r=window["on"+n];if(window.addEventListener(n,(function(e){for(var t in tr.log("Closing window"),tr.sessions)tr.sessions[t]&&tr.sessions[t].destroyOnUnload&&(tr.log("Destroying session "+t),tr.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));r&&"function"==typeof r&&r()})),tr.safariVp8=!1,"safari"===tr.webRTCAdapter.browserDetails.browser&&tr.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var a of RTCRtpSender.getCapabilities("video").codecs)if(a&&a.mimeType&&"video/vp8"===a.mimeType.toLowerCase()){tr.safariVp8=!0;break}tr.safariVp8?tr.log("This version of Safari supports VP8"):tr.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var o=new RTCPeerConnection({});o.createOffer({offerToReceiveVideo:!0}).then((function(e){tr.safariVp8=-1!==e.sdp.indexOf("VP8"),tr.safariVp8?tr.log("This version of Safari supports VP8"):tr.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),o.close(),o=null}))}if(tr.unifiedPlan=!1,"firefox"===tr.webRTCAdapter.browserDetails.browser&&tr.webRTCAdapter.browserDetails.version>=59)tr.unifiedPlan=!0;else if("chrome"===tr.webRTCAdapter.browserDetails.browser&&tr.webRTCAdapter.browserDetails.version>=72)tr.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var l=new RTCPeerConnection;try{l.addTransceiver("audio"),tr.unifiedPlan=!0}catch(c){}l.close()}else tr.unifiedPlan=!1;tr.initDone=!0,e.callback()}},tr.isWebrtcSupported=function(){return!!window.RTCPeerConnection},tr.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},tr.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i="",s=0;s<e;s++){var n=Math.floor(Math.random()*t.length);i+=t.substring(n,n+1)}return i};var ir=tr;let sr=e=>`/ws/janus/${e}/`,nr=e=>`/ws/share_token/janus/${e}/`;function rr(e){const t=window.location.hostname.replace("app","turn");return[{urls:["stun:stun.l.google.com:19302"]},{urls:`turn:${t}:80?transport=udp`,credential:e,username:e},{urls:`turn:${t}:80?transport=tcp`,credential:e,username:e}]}function ar(){let e={callbacks:{},initialized:!1,mainWebRTCConn:lr(),mjpegWebRTCConn:or(),openForShareToken(t){e.connect(nr(t),t)},openForPrinter(t,i){e.connect(sr(t),i)},connect(t,i){e.initialized=!0,e.mainWebRTCConn.connect(t,i),e.mjpegWebRTCConn.connect(t,i)},stopStream(){e.mainWebRTCConn.stopStream(),e.mjpegWebRTCConn.stopStream()},sendData(t){e.mainWebRTCConn.sendData(t)},startStream(){e.mainWebRTCConn.startStream(),e.mjpegWebRTCConn.startStream()},setCallbacks(t){e.callbacks={...e.callbacks,...t},e.mainWebRTCConn.callbacks=e.callbacks,e.mjpegWebRTCConn.callbacks=e.callbacks}};return e}function or(){let e={callbacks:{},streamId:void 0,streaming:void 0,bitrateInterval:null,connect(t,i){ir.init({debug:"all",callback:()=>{ir.isWebrtcSupported()&&e.connectJanusWebSocket(t,i)}})},connectJanusWebSocket(t,i){var s=new ir({server:window.location.protocol.replace("http","ws")+"//"+window.location.host+t,iceServers:rr(i),ipv6:!0,success:()=>{s.attach({plugin:"janus.plugin.streaming",opaqueId:"streamingtest-"+ir.randomString(12),success:function(t){ir.log("Plugin attached! ("+t.getPlugin()+", id="+t.getId()+")");const i={request:"info",id:2};ir.debug("Sending message ("+JSON.stringify(i)+")"),t.send({message:i,success:function(i){let n=te()(i,"info");n?(e.streamId=n.id,e.streaming=t,"data"===te()(n,"media[0].type")&&e.callbacks.onStreamAvailable(e)):s.destroy()}})},error:function(e){ir.error("  -- Error attaching plugin... ",e),s.destroy()},onmessage:function(t,i){e.onMessage(t,i)},onremotestream:function(e){},ondataopen:function(){},ondata:function(t){"onMJpegData"in e.callbacks&&e.callbacks.onMJpegData(t)},oncleanup:function(){}})},error(e){ir.error("  -- Error -- ",e),s.destroy()},destroyed(){e.streaming=void 0,e.streamId=void 0}})},onMessage(e,t){let i=this;ir.debug(" ::: Got a message :::"),ir.debug(e);let s=e["result"];if(null!==s&&void 0!==s){if(void 0!==s["status"]&&null!==s["status"]){var n=s["status"];"starting"===n?console.log("Starting"):"started"===n?console.log("Started"):"stopped"===n&&i.stopStream()}}else if(void 0!==e["error"]&&null!==e["error"])return ir.error(e),void i.stopStream();var r;void 0!==t&&null!==t&&(null===(r=i.streaming)||void 0===r||r.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){var t;ir.debug("Got SDP!"),ir.debug(e);var s={request:"start"};null===(t=i.streaming)||void 0===t||t.send({message:s,jsep:e})},error:function(e){ir.error("WebRTC error:",e)}}))},channelOpen(){return!(void 0===e.streamId||void 0===e.streaming)},startStream(){var t;if(!e.channelOpen())return;const i={request:"watch",offer_video:!1,id:parseInt(e.streamId)};null===(t=e.streaming)||void 0===t||t.send({message:i})},stopStream(){var t,i;const s={request:"stop"};null===(t=e.streaming)||void 0===t||t.send({message:s}),null===(i=e.streaming)||void 0===i||i.hangup()}};return e}function lr(){let e={callbacks:{},streamId:void 0,streaming:void 0,bitrateInterval:null,connect(t,i){ir.init({debug:"all",callback:()=>{ir.isWebrtcSupported()&&e.connectJanusWebSocket(t,i)}})},connectJanusWebSocket(t,i){var s=new ir({server:window.location.protocol.replace("http","ws")+"//"+window.location.host+t,iceServers:rr(i),ipv6:!0,success:()=>{s.attach({plugin:"janus.plugin.streaming",opaqueId:"streamingtest-"+ir.randomString(12),success:function(t){[0,1].forEach(i=>{const s={request:"info",id:i};ir.debug("Sending message ("+JSON.stringify(s)+")"),t.send({message:s,success:function(i){let s=te()(i,"info");if(s){e.streamId=s.id,e.streaming=t;const i=te()(s,"video")||Qn()(te()(s,"media",[]),{type:"video"});i&&e.callbacks.onStreamAvailable(e)}}})})},error:function(e){ir.error("  -- Error attaching plugin... ",e),s.destroy()},onmessage:function(t,i){e.onMessage(t,i)},onremotestream:function(t){ir.debug(" ::: Got a remote stream :::"),ir.debug(t),"onRemoteStream"in e.callbacks&&e.callbacks.onRemoteStream(t)},ontrackmuted:function(){"onTrackMuted"in e.callbacks&&e.callbacks.onTrackMuted()},ontrackunmuted:function(){"onTrackUnmuted"in e.callbacks&&e.callbacks.onTrackUnmuted()},slowLink:function(t,i){"onSlowLink"in e.callbacks&&e.callbacks.onSlowLink(i)},ondataopen:function(){},ondata:function(t){"onData"in e.callbacks&&e.callbacks.onData(t)},oncleanup:function(){"onDefaultStreamCleanup"in e.callbacks&&e.callbacks.onDefaultStreamCleanup()}})},error(e){ir.error("  -- Error -- ",e),s.destroy()},destroyed(){e.streaming=void 0,e.streamId=void 0,e.clearBitrateInterval()}})},onMessage(e,t){let i=this;ir.debug(" ::: Got a message :::"),ir.debug(e);let s=e["result"];if(null!==s&&void 0!==s){if(void 0!==s["status"]&&null!==s["status"]){var n=s["status"];"starting"===n?console.log("Starting"):"started"===n?console.log("Started"):"stopped"===n&&i.stopStream()}}else if(void 0!==e["error"]&&null!==e["error"])return ir.error(e),void i.stopStream();var r;void 0!==t&&null!==t&&(null===(r=i.streaming)||void 0===r||r.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){var t;ir.debug("Got SDP!"),ir.debug(e);var s={request:"start"};null===(t=i.streaming)||void 0===t||t.send({message:s,jsep:e})},error:function(e){ir.error("WebRTC error:",e)}}))},channelOpen(){return!(void 0===e.streamId||void 0===e.streaming)},startStream(){var t;if(!e.channelOpen())return;const i={request:"watch",offer_video:!0,id:parseInt(e.streamId)};null===(t=e.streaming)||void 0===t||t.send({message:i}),e.clearBitrateInterval(),e.bitrateInterval=setInterval((function(){if(e.streaming){const t=e.streaming.getBitrate();t&&t.value?e.callbacks.onBitrateUpdated(e.streaming.getBitrate()):e.callbacks.onBitrateUpdated({value:null})}else e.callbacks.onBitrateUpdated({value:null})}),5e3)},stopStream(){var t,i;if(e.clearBitrateInterval(),!e.channelOpen())return;const s={request:"stop"};null===(t=e.streaming)||void 0===t||t.send({message:s}),null===(i=e.streaming)||void 0===i||i.hangup()},sendData(t){var i;e.channelOpen()&&(null===(i=e.streaming)||void 0===i||i.data({text:t,success:()=>{}}))},clearBitrateInterval(){e.bitrateInterval&&(clearInterval(e.bitrateInterval),e.bitrateInterval=null,e.callbacks.onBitrateUpdated({value:null}))}};return e}var cr=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-img-top webcam_container"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.slowLinkLoss>50,expression:"slowLinkLoss > 50"}],ref:"slowLinkWrapper",staticClass:"slow-link-wrapper",on:{click:e.slowLinkClicked,mouseenter:function(t){e.fixSlowLinkTextWidth(),e.slowLinkShowing=!0,e.slowLinkHiding=!1},mouseleave:function(t){e.fixSlowLinkTextWidth(),e.slowLinkShowing=!1,e.slowLinkHiding=!0}}},[e._m(0),t("div",{ref:"slowLinkText",staticClass:"text",class:{"show-and-hide":!e.slowLinkShowing&&!e.slowLinkHiding,showing:e.slowLinkShowing&&!e.slowLinkHiding,hiding:!e.slowLinkShowing&&e.slowLinkHiding}},[e._v(" Video frames dropped ")])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.trackMuted,expression:"trackMuted"}],staticClass:"muted-status-wrapper"},[t("div",{staticClass:"text"},[e._v("Buffering...")]),t("a",{attrs:{href:"#"},on:{click:function(t){return e.showMutedStatusDescription(t)}}},[e._v("Why is it stuck?")])]),e.isVideoAvailable&&!e.autoplay&&(e.isBasicStreamingReadyToPlay||e.isBasicStreamingFrozen)?t("b-button",{staticClass:"centered-element p-0",attrs:{disabled:e.isBasicStreamingFrozen},on:{click:e.onPlayBtnClicked}},[e.isBasicStreamingReadyToPlay?t("i",{staticClass:"fas fa-play ml-1"}):e._e(),e.isBasicStreamingFrozen?t("span",{staticClass:"medium"},[e._v(e._s(e.remainingSecondsUntilNextCycle)+"s")]):e._e()]):e._e(),e.trackMuted||e.videoLoading?t("b-spinner",{staticClass:"centered-element",attrs:{label:"Buffering..."}}):e._e(),e.isVideoAvailable?t("div",[!e.autoplay&&e.isBasicStreamingInProgress||e.currentBitrate?t("div",{staticClass:"streaming-info overlay-info small",class:{clickable:e.isBasicStreamingInProgress},on:{click:e.onInfoClicked}},[e.isBasicStreamingInProgress?t("div",{staticClass:"text-success"},[e._v(" "+e._s(e.remainingSecondsCurrentVideoCycle)+" ")]):e._e(),e.currentBitrate?t("div",[e._v(e._s(e.currentBitrate))]):e._e()]):e._e(),e.autoplay||!e.isBasicStreamingReadyToPlay&&!e.isBasicStreamingFrozen?e._e():t("div",{staticClass:"streaming-guide overlay-info",on:{click:e.onInfoClicked}},[e.isBasicStreamingReadyToPlay?t("div",{staticClass:"message"},[e._v(" Webcam streams up to 5 FPS for Free ")]):e._e(),e.isBasicStreamingFrozen?t("div",{staticClass:"message text-warning"},[e._v(" "+e._s(e.remainingSecondsUntilNextCycle)+"s left in the cooldown period ")]):e._e(),t("a",{staticClass:"learn-more",attrs:{href:"#"}},[e._v("Learn more...")])])]):e._e(),t("div",{class:e.webcamRotateClass},[t("div",{staticClass:"webcam_fixed_ratio",class:e.webcamRatioClass,style:{transform:`rotate(${e.videoRotationDeg}deg)`}},[t("div",{staticClass:"webcam_fixed_ratio_inner"},[e.taggedSrc!==e.printerStockImgSrc?t("img",{staticClass:"tagged-jpg",class:{flipH:e.printer.settings.webcam_flipH,flipV:e.printer.settings.webcam_flipV},attrs:{src:e.taggedSrc,alt:e.printer.name+" current image"}}):t("svg",{staticClass:"poster-placeholder",style:{transform:`rotate(-${e.videoRotationDeg}deg)`}},[t("use",{attrs:{href:e.printerStockImgSrc}})])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showMJpeg,expression:"showMJpeg"}],staticClass:"webcam_fixed_ratio_inner ontop"},[t("img",{staticClass:"tagged-jpg",attrs:{src:e.mjpgSrc}})]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showVideo,expression:"showVideo"}],staticClass:"webcam_fixed_ratio_inner ontop"},[t("video",{ref:"video",staticClass:"remote-video",class:{flipH:e.printer.settings.webcam_flipH,flipV:e.printer.settings.webcam_flipV},attrs:{width:"960",height:e.webcamVideoHeight,poster:e.taggedSrc!==e.printerStockImgSrc?e.taggedSrc:"",autoplay:"",muted:"",playsinline:""},domProps:{muted:!0},on:{loadstart:function(t){return e.onLoadStart()},canplay:function(t){return e.onCanPlay()}}})])])]),t("div",{staticClass:"extra-controls"},[e.showVideo||e.showVideo||e.taggedSrc!==e.printerStockImgSrc?t("div",{staticClass:"video-control-btn",on:{click:e.onRotateRightClicked}},[t("font-awesome-icon",{attrs:{icon:"fa-solid fa-rotate-right"}})],1):e._e()])],1)},dr=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"icon bg-warning"},[t("i",{staticClass:"fas fa-exclamation"})])}];function ur(e,t){const i="tsNextVideoCycle-"+e;let s,n={countDownTimer:null};if(n.startOrResumeVideoCycle=function(){n.countDownTimer||(n.countDownTimer=setInterval(()=>n.countDown(),1e3))},n.resumeVideoCycle=function(){s<60&&!n.countDownTimer&&(n.countDownTimer=setInterval(()=>n.countDown(),1e3))},n.countDown=function(){n.updateRemainingSeconds(s-1),Object(ue["a"])()&&localStorage.setItem(i,(new Date).getTime()/1e3+s),s<0&&(n.updateRemainingSeconds(60),clearInterval(this.countDownTimer),this.countDownTimer=null)},n.updateRemainingSeconds=function(e){s=e;const i=s-30,n=s>30?-1:s;t(i,n)},Object(ue["a"])()){const e=parseFloat(localStorage.getItem(i)),t=(new Date).getTime()/1e3;!e||t>e?n.updateRemainingSeconds(60):n.updateRemainingSeconds(Math.round(e-t))}else n.updateRemainingSeconds(60);return n}function pr(e){const t={onFrame:e,contentLength:NaN,imageBuffer:"",bytesRead:0,originalJpgLength:0,onMJpegChunk:function(e){Object(ds["g"])(e,e=>{const i=new TextDecoder("utf-8").decode(new Uint8Array(e));if(t.contentLength){if(t.imageBuffer+=i,t.bytesRead+=i.length,t.bytesRead>=t.contentLength){const e=t.imageBuffer,i=t.originalJpgLength;t.contentLength=NaN,t.imageBuffer="",t.bytesRead=0,t.originalJpgLength=0,t.onFrame(e,i)}}else if("\r\n"==i.slice(0,2)&&"\r\n"==i.slice(i.length-2)){const e=i.slice(2,i.length-2).split(":");t.contentLength=parseInt(e[0]),t.originalJpgLength=parseInt(e[1])}})}};return t}var hr={name:"StreamingBox",props:{printer:{type:Object,required:!0},webrtc:{type:Object,default:null},autoplay:{type:Boolean,required:!0}},data(){return{stickyStreamingSrc:null,isVideoAvailable:!1,isVideoVisible:!1,remainingSecondsCurrentVideoCycle:30,remainingSecondsUntilNextCycle:-1,currentBitrate:null,slowLinkLoss:0,slowLinkShowing:!1,slowLinkHiding:!1,trackMuted:!1,videoLoading:!1,printerStockImgSrc:"#svg-3d-printer",mjpgSrc:null,customRotationDeg:Object(a["a"])("webcamRotationDeg",0)}},computed:{taggedImgAvailable(){return this.taggedSrc!==this.printerStockImgSrc},showVideo(){return this.isVideoVisible&&"IMAGE"!==this.stickyStreamingSrc},showMJpeg(){return this.mjpgSrc&&"IMAGE"!==this.stickyStreamingSrc},videoRotationDeg(){var e;const t=+(null!==(e=this.printer.settings.webcam_rotation)&&void 0!==e?e:0)+this.customRotationDeg;return t%360},webcamRotateClass(){return"webcam_rotate_"+this.videoRotationDeg},webcamRatioClass(){switch(this.printer.settings.ratio169){case!0:return"ratio169";case!1:return"ratio43";default:return"ratio43"}},webcamVideoHeight(){switch(this.printer.settings.ratio169){case!0:return 540;case!1:return 720;default:return 720}},taggedSrc(){return te()(this.printer,"pic.img_url",this.printerStockImgSrc)},isBasicStreamingInProgress(){return this.remainingSecondsCurrentVideoCycle>0&&this.remainingSecondsCurrentVideoCycle<30},isBasicStreamingReadyToPlay(){return!this.isVideoVisible&&!this.trackMuted&&!this.videoLoading&&(30==this.remainingSecondsCurrentVideoCycle||0==this.remainingSecondsUntilNextCycle)},isBasicStreamingFrozen(){return this.remainingSecondsUntilNextCycle>0&&!this.isVideoVisible},basicStreamingInWebrtc(){return this.printer.isAgentVersionGte("2.1.0","0.3.0")}},created(){this.mjpegStreamDecoder=new pr((e,t)=>{this.mjpgSrc="data:image/jpg;base64, "+e,this.onCanPlay()}),this.webrtc&&(this.webrtc.setCallbacks({onStreamAvailable:this.onStreamAvailable,onRemoteStream:this.onWebRTCRemoteStream,onDefaultStreamCleanup:()=>this.isVideoVisible=!1,onSlowLink:this.onSlowLink,onTrackMuted:()=>this.trackMuted=!0,onTrackUnmuted:()=>this.trackMuted=!1,onBitrateUpdated:e=>{this.currentBitrate=e.value},onMJpegData:this.mjpegStreamDecoder.onMJpegChunk}),this.autoplay||(this.videoLimit=ur(this.printer.id,this.countDownCallback)),an.a.on("blur",()=>{this.webrtc&&this.webrtc.stopStream()}),an.a.on("focus",()=>{this.webrtc&&this.autoplay&&this.webrtc.startStream()}))},methods:{onRotateRightClicked(){this.customRotationDeg=this.customRotationDeg+90,Object(a["b"])("webcamRotationDeg",this.customRotationDeg%360),this.$emit("onRotateRightClicked",this.customRotationDeg)},onCanPlay(){this.videoLoading=!1,this.autoplay||this.videoLimit.startOrResumeVideoCycle()},onLoadStart(){this.videoLoading=!0},onStreamAvailable(e){if(this.autoplay)e.startStream();else{if(!this.basicStreamingInWebrtc)return;!this.autoplay&&this.isBasicStreamingInProgress&&e.startStream(),this.videoLimit.resumeVideoCycle()}this.isVideoAvailable=!0},onWebRTCRemoteStream(e){ir.attachMediaStream(this.$refs.video,e);const t=e.getVideoTracks();null===t||void 0===t||0===t.length?this.isVideoVisible=!1:this.isVideoVisible=!0},countDownCallback(e,t){this.remainingSecondsCurrentVideoCycle>0&&e<=0&&this.webrtc.stopStream(),this.remainingSecondsCurrentVideoCycle=e,this.remainingSecondsUntilNextCycle=t},onInfoClicked(){this.autoplay||this.$swal.Prompt.fire({title:"Upgrade for Better Streaming",html:'\n          <p>Because you are now on the <a target="_blank" href="https://www.obico.io/docs/user-guides/upgrade-to-pro/?source=basic_streaming">Obico Cloud Free plan</a>:</p>\n          <ul>\n            <li>Streaming is limited to 5 FPS (frames per second).</li>\n            <li>After 30 seconds of streaming there is a 30-second cooldown before you can resume streaming.</li>\n          </ul>\n          <p>Support the Obico project by <a href="https://app.obico.io/ent_pub/pricing/?source=basic_streaming">upgrading to the Pro plan for little more than 1 Starbucks a month.</a></p> The Pro plan offers many perks, including the <a target="_blank" href="https://www.obico.io/docs/user-guides/webcam-streaming-for-human-eyes/?source=basic_streaming">Premium Streaming</a>:</p>\n          <ul>\n            <li>Smooth 25 FPS.</li>\n            <li>Unlimited streaming with no cooldowns.</li>\n          </ul>\n\n        ',showCloseButton:!0})},onPlayBtnClicked(){this.webrtc.startStream()},fixSlowLinkTextWidth(){const e=window.getComputedStyle(this.$refs.slowLinkText).width;this.$refs.slowLinkText.style.width=e},onSlowLink(e){this.slowLinkLoss+=e},slowLinkClicked(){this.slowLinkShowing=!1,this.slowLinkHiding=!1,this.slowLinkLoss=0,this.$swal.Prompt.fire({title:"Video frames dropped",html:'\n          <p>The video frames are getting dropped because there is most likely a bandwidth bottleneck along the route they travel from your Raspberry Pi to your computer. The bottleneck can be anywhere, but in most cases, <Text bold>it is either your computer\'s internet connection, or your Raspberry Pi\'s</Text>.</p>\n          <p>Make sure your computer is connected to the same network as your Pi. If you still see this warning, you need to trouble-shoot your computer\'s Wi-Fi connection, probably by moving closer to the Wi-Fi router.</p>\n          <p>If the webcam stream is smooth when your computer is on the same Wi-Fi network as your Pi, the bottleneck is likely with the upload speed of your internet connection. You need to run a speed test to make sure you have high-enough upload speed, as well as <b>low latency (ping)</b>.</p>\n          <p>Check out <a target="_blank" href="https://www.obico.io/docs/user-guides/webcam-feed-is-laggy/">the step-by-step trouble-shooting guide.</a></p>\n        ',showCloseButton:!0})},showMutedStatusDescription(e){e.preventDefault(),this.$swal.Prompt.fire({title:"Webcam stream buffering",html:'\n          <p>When you see the messaging about webcam stream is "buffering" occasionally, you can just reload the page. If this message repeatedly appears, it may indicate one of the problems:</p>\n          <p class="lead">1. A constricted video stream on <strong>your Raspberry Pi. The most common reasons are:</p>\n          <ul>\n            <li>Camera resolution is set too high.</li>\n            <li>Camera framerate is set too high.</li>\n            <li>The upload speed of your Raspberry Pi is too low.</li>\n          </ul>\n          <p class="lead">2. The internet connection of your computer or phone is not fast enough.</p>\n          <p class="lead">3. Your webcam is not properly connected to your Raspberry Pi.</p>\n          <br>\n          <p>Check <a target="_blank" href="https://www.obico.io/docs/user-guides/webcam-feed-is-laggy">this step-by-step troubleshooting guide</a>.</p>\n        ',showCloseButton:!0})}}},fr=hr,mr=(i("9cac"),Object(E["a"])(fr,cr,dr,!1,null,"0f985e50",null)),gr=mr.exports,vr=function(){var e=this,t=e._self._c;return t("div",[e.valid||e.printing?e._e():t("span",[e._v("-")]),!e.valid&&e.printing?t("b-spinner",{attrs:{small:"",type:"grow",label:"Calculating..."}}):e._e(),e.valid&&e.showHours?t("span",[e._v(" "+e._s(e.hours)),t("span",{staticClass:"text-subscript text-muted"},[e._v("h")])]):e._e(),e.valid&&e.showMinutes?t("span",[e._v(" "+e._s(e.minutes)),t("span",{staticClass:"text-subscript text-muted"},[e._v("m")])]):e._e(),e.valid&&e.showSeconds?t("span",[e._v(" "+e._s(e.seconds)),t("span",{staticClass:"text-subscript text-muted"},[e._v("s")])]):e._e()],1)},br=[],_r={name:"DurationBlock",props:{valid:{type:Boolean,required:!0},printing:{type:Boolean,required:!0},hours:{type:Number,default(){return 0}},showHours:{type:Boolean,default(){return!1}},minutes:{type:Number,default(){return 0}},showMinutes:{type:Boolean,default(){return!1}},seconds:{type:Number,default(){return 0}},showSeconds:{type:Boolean,default(){return!1}}}},Cr=_r,wr=Object(E["a"])(Cr,vr,br,!1,null,null,null),yr=wr.exports,kr=function(){var e=this,t=e._self._c;return t("div",{staticClass:"wrapper"},e._l(e.temperatures,(function(i,s){return t("temperature-item",{key:s,attrs:{"temp-key":s,"temp-item":i,"is-plugin-version-sufficient":e.isPluginVersionSufficient},on:{TempEditClicked:function(t){return e.onEditClicked(s,i)}}})})),1)},Sr=[],Pr=function(){var e=this,t=e._self._c;return t("div",{staticClass:"temp-item",class:{editable:e.editable},on:{click:function(t){return e.onEditClicked(e.tempKey,e.tempItem)}}},[t("div",{staticClass:"icon"},[e.heaterIcon?t("svg",[t("use",{attrs:{href:e.heaterIcon}})]):t("i",{staticClass:"fas fa-thermometer-empty"})]),t("div",{staticClass:"title"},[e._v(e._s(e.temperatureDisplayName(e.tempKey)))]),t("div",{staticClass:"value-wrapper"},[t("div",{staticClass:"value"},[e._v(e._s(parseFloat(e.tempItem.actual).toFixed(1))+" °C")]),e.editable?t("div",{staticClass:"target"},[e._v("/ "+e._s(Math.round(e.tempItem.target))+" °C")]):e._e()])])},xr=[],Tr={name:"TemperatureItem",props:{tempItem:{type:Object,required:!0},tempKey:{type:String,required:!0},isPluginVersionSufficient:{type:Boolean,required:!0}},computed:{heaterIcon(){const e=this.tempKey.toLowerCase();return e.includes("bed")?"#bed-temp":e.includes("tool")||e.includes("extruder")?"#extruder":null},editable(){return this.isPluginVersionSufficient&&null!==this.tempItem.target}},methods:{onEditClicked(e,t){this.editable&&this.$emit("TempEditClicked",e,t)},temperatureDisplayName:ds["f"]}},Fr=Tr,Dr=(i("47bd"),Object(E["a"])(Fr,Pr,xr,!1,null,"6371ef1e",null)),Or=Dr.exports,Ir={name:"StatusTemp",components:{TemperatureItem:Or},props:{temperatures:{type:Object,required:!0},isPluginVersionSufficient:{type:Boolean,required:!0}},methods:{onEditClicked(e,t){this.isPluginVersionSufficient&&null!==t.target&&this.$emit("TempEditClicked",e,t)}}},Ar=Ir,Mr=(i("800e"),Object(E["a"])(Ar,kr,Sr,!1,null,"a51f3d38",null)),Er=Mr.exports,Nr=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"text-center"},[e.value>0?t("h1",{staticClass:"target-temp-degree"},[e._v(" "+e._s(e.value)+" "),t("span",{staticClass:"text-subscript text-muted"},[e._v("°C")])]):e._e(),e.value<1?t("h1",{staticClass:"target-temp-degree"},[e._v("OFF")]):e._e()]),t("br"),t("div",{staticClass:"mb-5"},[e._m(0),t("div",[t("b-form-select",{staticClass:"form-control",attrs:{id:"id_preset"},on:{change:e.onPresetChanged},model:{value:e.preset,callback:function(t){e.preset=t},expression:"preset"}},e._l(e.allPresets,(function(i){return t("b-form-select-option",{key:i.name,attrs:{value:parseInt(i.value)}},[e._v(" "+e._s(i.title)+" ")])})),1)],1),t("br"),t("h5",[e._v("Manual:")]),t("div",[t("slider-input",{attrs:{min:0,max:e.maxTemp,step:1},on:{change:e.onSliderChanged},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],attrs:{id:"target-temp",type:"hidden"},domProps:{value:e.value},on:{input:function(t){t.target.composing||(e.value=t.target.value)}}})],1)])])},Rr=[function(){var e=this,t=e._self._c;return t("div",[t("h5",[e._v("Presets:")])])}],jr=function(){var e=this,t=e._self._c;return t("div",{staticClass:"slidecontainer"},[t("input",{staticClass:"slider",attrs:{type:"range",min:e.min,max:e.max,step:e.step},domProps:{value:e.value},on:{change:function(t){return e.$emit("change",t.target.value)}}})])},Lr=[],Br={name:"SliderInput",props:{value:{type:Number,default:0},max:{type:Number,default:100},min:{type:Number,default:0},step:{type:Number,default:1}},computed:{},methods:{}},$r=Br,Vr=(i("a413"),Object(E["a"])($r,jr,Lr,!1,null,"a2fa57a4",null)),Ur=Vr.exports,zr={name:"TempTargetEditor",components:{SliderInput:Ur},props:{presets:{type:Array,required:!0},maxTemp:{type:Number,required:!0},curTarget:{type:Number,required:!0}},data(){let e=this.presets.find(e=>e.target==this.curTarget)||{target:0!=this.curTarget?-1:0};return{value:this.curTarget,preset:e.target}},computed:{allPresets(){let e=[];return e.push({value:-1,title:"Manual",name:"manual"}),e.push({value:0,title:"OFF",name:"off"}),this.presets.forEach(t=>{t.target&&e.push({value:t.target,name:t.name,title:`${t.name} (${t.target}°C)`})}),e}},methods:{onPresetChanged(){this.preset>-1&&(this.value=this.preset)},onSliderChanged(){0==this.value?this.preset=0:this.preset=-1}}},Wr=zr,Gr=Object(E["a"])(Wr,Nr,Rr,!1,null,null,null),qr=Gr.exports,Hr=function(){var e=this,t=e._self._c;return t("div",[t("h2",{staticClass:"text-center"},[e._v("Printer Feed Sharing")]),t("hr"),e.isProAccount?t("div",[t("div",{staticClass:"py-3"},[t("div",{staticClass:"custom-control custom-switch"},[t("input",{staticClass:"custom-control-input update-printer",attrs:{id:"sharing_enabled-toggle-"+e.printer.id,type:"checkbox"},domProps:{checked:e.sharedResource},on:{click:e.onSharingToggled}}),t("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"sharing_enabled-toggle-"+e.printer.id}},[e._v('Share live feed for printer "'),t("b",[e._v(e._s(e.printer.name))]),e._v('"')])]),t("div",{staticClass:"form-group"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.sharedLink,expression:"sharedLink"}]},[t("div",{staticClass:"input-group mt-4 mb-2"},[t("input",{ref:"sharedLink",staticClass:"form-control shared-link-text",attrs:{id:"secret-token-input",type:"text","aria-label":"Secret token",readonly:""},domProps:{value:e.sharedLink}}),t("div",{staticClass:"input-group-append"},[t("div",{staticClass:"copy-button",attrs:{id:"copy-link","data-clipboard-target":"#secret-token-input","aria-label":"Copy secure link to clipboard"},on:{click:e.copyToClipboard}},[t("i",{staticClass:"fas fa-clipboard"})]),t("b-tooltip",{attrs:{show:e.copyStatus,target:"copy-link",triggers:"click",placement:"bottom"},on:{"update:show":function(t){e.copyStatus=t}}},[e._v(e._s(e.copyMessage))])],1)]),t("div",{staticClass:"my-1"},[e._v(" Click the clipboard icon above to copy the secure shareable link to your clipboard. ")]),t("div",{staticClass:"my-1"},[e._v(" You can test the shareable link by right-clicking "),t("a",{attrs:{href:e.sharedLink}},[e._v("here")]),e._v(' and select "Open Link in Incognito Window". ')]),t("br"),e._m(3)])]),t("br")])]):t("div",[e._m(0),t("p",[e._v("Printer feed sharing is a Pro feature.")]),e._m(1),e._m(2)])])},Jr=[function(){var e=this,t=e._self._c;return t("h5",{staticClass:"mb-5"},[e._v(" Wait! You need to "),t("a",{attrs:{href:"/ent_pub/pricing/"}},[e._v("upgrade to the Pro plan")]),e._v(" to enable Printer feed. ")])},function(){var e=this,t=e._self._c;return t("p",[t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/upgrade-to-pro#why-cant-the-detective-just-work-for-free-people-love-free-you-know"}},[e._v("Running the Obico app incurs non-trivial amount of costs")]),e._v(". With little more than 1 Starbucks per month, you can upgrade to a Pro account and help us run the Obico app smoothly. ")])},function(){var e=this,t=e._self._c;return t("p",[t("a",{attrs:{href:"/ent_pub/pricing/"}},[e._v("Check out Pro pricing >>>")])])},function(){var e=this,t=e._self._c;return t("em",{staticClass:"text-muted"},[t("small",[t("div",[e._v("Notes:")]),t("ul",[t("li",[e._v(" Send the secure link to anyone you want to share your printer feed with. They do NOT need the Obico account to see your printer feed. ")]),t("li",[e._v(" Anyone with this shareable link will be able to see your printer feed. "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/printer-feed-sharing/"}},[e._v("Learn more about what they can see.")])])])])])}],Yr={props:{isProAccount:{type:Boolean,default:!1},printer:{type:Object,required:!0}},data(){return{share:!1,sharedResource:null,copyStatus:!1,copyMessage:""}},computed:{sharedLink(){if(this.sharedResource){const e=window.location;return`${e.protocol}//${e.host}/printers/share_token/${this.sharedResource.share_token}/`}return""}},created(){this.fetchSharedResources()},methods:{fetchSharedResources(){return Q["a"].get(X["a"].sharedResources({printer_id:this.printer.id})).then(e=>{e.data.length>0&&(this.sharedResource=e.data[0])})},postSharedResources(){return Q["a"].post(X["a"].sharedResources({printer_id:this.printer.id})).then(e=>{e.data.length>0&&(this.sharedResource=e.data[0])})},deleteSharedResources(){return Q["a"].delete(X["a"].sharedResource(this.sharedResource.id)).then(()=>{this.sharedResource=null})},onSharingToggled(){this.sharedResource?this.deleteSharedResources():this.postSharedResources()},copyToClipboard(){this.copyStatus=!0,this.$refs.sharedLink.focus(),this.$refs.sharedLink.select();try{document.execCommand("copy"),this.copyMessage="Copied!"}catch(e){console.error("Fallback: Oops, unable to copy",e),this.copyMessage="Failed!"}}}},Kr=Yr,Zr=(i("d764"),Object(E["a"])(Kr,Hr,Jr,!1,null,"6f5a9b6b",null)),Qr=Zr.exports,Xr=function(){var e=this,t=e._self._c;return t("widget-template",{attrs:{"inside-card":e.insideCard},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("Print Job Control")]},proxy:!0},{key:"content",fn:function(){return[t("div",{staticClass:"wrapper"},[!e.printer.isOffline()&&e.printer.hasError()?t("div",{staticClass:"error-container"},[t("div",{staticClass:"title"},[e._v(e._s(e.printer.agentDisplayName())+" Error")]),t("p",{staticClass:"text"},[e._v(" "+e._s(e.printer.status.state.error)+" ")])]):e._e(),e.printer.inUserInteractionRequired()?t("div",{staticClass:"warning-container"},[t("p",{staticClass:"text"},[e._v("Filament Change or User Interaction Required")])]):e._e(),e.printer.inTransientState()?[t("b-spinner",{attrs:{label:"Processing..."}}),t("p",[e._v(e._s(e.printer.calculatedState())+"...")])]:[e.printer.isOffline()||e.printer.isDisconnected()||!e.printer.isActive()?e._e():[t("p",[e.printer.isPaused()?t("span",[e._v("Print is Paused")]):t("span",[e._v("Printer is Currently Printing")])]),t("div",{staticClass:"buttons"},[e.printer.isPaused()?t("b-button",{staticClass:"custom-button",attrs:{variant:"success"},on:{click:function(t){return e.onPauseToggled(t)}}},[t("font-awesome-icon",{attrs:{icon:"fa-solid fa-circle-play"}}),e._v(" Resume ")],1):t("b-button",{staticClass:"custom-button",attrs:{variant:"warning"},on:{click:function(t){return e.onPauseToggled(t)}}},[t("font-awesome-icon",{attrs:{icon:"fa-solid fa-circle-pause"}}),e._v(" Pause ")],1),t("b-button",{staticClass:"custom-button",attrs:{variant:"danger"},on:{click:e.onCancelClicked}},[t("font-awesome-icon",{attrs:{icon:"fa-solid fa-circle-xmark"}}),e._v(" Cancel ")],1)],1)],e.printer.isOffline()||e.printer.isDisconnected()||e.printer.isActive()?e._e():[t("p",[e._v("Open G-Code File to Start Printing")]),t("div",{staticClass:"buttons"},[t("b-button",{staticClass:"custom-button",attrs:{variant:"outline-primary"},on:{click:e.openObicoFiles}},[t("svg",{staticClass:"logo-small custom-svg-icon"},[t("use",{attrs:{href:"#svg-logo-compact"}})]),e._v(" Obico Files ")]),e.printer.isAgentMoonraker()?t("b-button",{staticClass:"custom-button",attrs:{variant:"outline-secondary"},on:{click:e.openPrinterFiles}},[e._v("   "),t("svg",{staticClass:"logo-small custom-svg-icon"},[t("use",{attrs:{href:"#svg-klipper-logo"}})]),t("svg",{staticClass:"logo-small custom-svg-icon"},[t("use",{attrs:{href:"#svg-fluidd-logo"}})]),t("svg",{staticClass:"logo-small custom-svg-icon"},[t("use",{attrs:{href:"#svg-mainsail-logo"}})]),e._v("   ")]):t("b-button",{staticClass:"custom-button",attrs:{variant:"outline-secondary"},on:{click:e.openPrinterFiles}},[t("svg",{staticClass:"logo-small custom-svg-icon"},[t("use",{attrs:{href:"#svg-octoprint-logo"}})]),e._v(" OctoPrint ")])],1)]],!e.printer.isOffline()&&e.printer.isDisconnected()?[t("p",[e._v("Printer Not Connected at the Serial Port")]),t("div",{staticClass:"buttons"},[e.printer.isAgentMoonraker()?e._e():t("b-button",{attrs:{variant:"outline-primary",disabled:e.connecting},on:{click:e.onConnectClicked}},[e.connecting?t("b-spinner",{attrs:{small:""}}):t("i",{staticClass:"fab fa-usb"}),e._v(" "+e._s(e.connecting?"Contacting OctoPrint":"Connect")+" ")],1)],1)]:e.printer.isOffline()?[t("i",{staticClass:"fas fa-exclamation-triangle big-icon warning"}),t("p",[e._v(" Obico for "+e._s(e.printer.isAgentMoonraker()?"Klipper":"OctoPrint")+" is Offline. "),t("a",{attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/troubleshoot-server-connection-issues/"}},[e._v("Why?")])])]:e._e(),e.printer?t("b-modal",{attrs:{id:e.modalId,size:"lg"},on:{hidden:e.resetGcodesModal}},[e.selectedGcodeId?t("g-code-file-page",{attrs:{"is-popup":!0,"target-printer-id":e.printer.id,"route-params":{fileId:e.selectedGcodeId,printerId:e.printerFiles?e.printer.id:null},"on-close":()=>e.$bvModal.hide(e.modalId)},on:{goBack:()=>{e.selectedGcodeId=null,e.scrollToTop()}}}):t("g-code-folders-page",{attrs:{"is-popup":!0,"target-printer":e.printer,"route-params":{printerId:e.printerFiles?e.printer.id:null,parentFolder:null},"on-close":()=>e.$bvModal.hide(e.modalId),"saved-path":e.savedPath,"scroll-container-id":e.modalId},on:{openFile:(t,i,s)=>{e.selectedGcodeId=t,e.savedPath=s,e.scrollToTop()}}})],1):e._e()],2)]},proxy:!0}])})},ea=[],ta=function(){var e=this,t=e._self._c;return t("div",{staticClass:"widget",class:{insideCard:e.insideCard}},[t("div",{staticClass:"widget-title"},[e._t("title")],2),t("div",{staticClass:"widget-content"},[e._t("content")],2)])},ia=[],sa={name:"WidgetTemplate",props:{insideCard:{type:Boolean,default:!1}}},na=sa,ra=(i("0dce"),Object(E["a"])(na,ta,ia,!1,null,"922c39c0",null)),aa=ra.exports,oa=function(){var e=this,t=e._self._c;return t("page-layout",{attrs:{"is-popup":e.isPopup},scopedSlots:e._u([{key:"topBarLeft",fn:function(){return[e.isPopup&&null!==e.parentFolder?t("a",{staticClass:"btn shadow-none icon-btn d-inline",attrs:{href:"#",title:"Go Back"},on:{click:function(t){return t.preventDefault(),e.goBack.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-chevron-left"})]):e._e(),!e.isPopup&&e.isCloud?t("div",{staticClass:"actions-with-selected-desktop"},[t("b-form-group",{staticClass:"m-0"},[t("b-form-checkbox",{attrs:{checked:e.allSelected,size:"md"},nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.toggleSelectAll.apply(null,arguments)}}})],1),t("div",[t("span",{directives:[{name:"show",rawName:"v-show",value:!e.selectedItemsCount,expression:"!selectedItemsCount"}],staticClass:"label",on:{click:e.toggleSelectAll}},[e._v("Select all")]),t("b-dropdown",{directives:[{name:"show",rawName:"v-show",value:e.selectedItemsCount,expression:"selectedItemsCount"}],attrs:{"toggle-class":"btn btn-sm actions-with-selected-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[e._v(" "+e._s(e.selectedItemsCount)+" item"+e._s(1===e.selectedItemsCount?"":"s")+" selected ")]},proxy:!0}],null,!1,1725758185)},[t("b-dropdown-item",[t("div",{on:{click:e.moveSelectedItems}},[t("i",{staticClass:"fas fa-arrows-alt"}),e._v("Move")])]),t("b-dropdown-item",[t("div",{staticClass:"text-danger",on:{click:e.deleteSelectedItems}},[t("i",{staticClass:"far fa-trash-alt"}),e._v("Delete ")])])],1)],1)],1):e._e(),t("search-input",{staticClass:"search-input mr-3",on:{input:e.updateSearch}})]},proxy:!0},{key:"topBarRight",fn:function(){return[t("div",{staticClass:"action-panel"},[e.isCloud?t("a",{staticClass:"btn shadow-none icon-btn d-none d-md-inline",attrs:{href:"#",title:"Create folder"},on:{click:function(t){return t.preventDefault(),e.createFolder.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-folder-plus"})]):e._e(),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-server"})]},proxy:!0}])},[t("b-dropdown-text",{staticClass:"small text-secondary"},[e._v("STORAGE")]),t("b-dropdown-item",{on:{click:e.switchToCloudStorage}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.isCloud?"visible":"hidden"}}),t("div",{staticClass:"text"},[t("div",{staticClass:"title"},[e._v("Obico Cloud")])])])]),e._l(e.printers,(function(i){return t("b-dropdown-item",{key:i.id,on:{click:()=>e.switchToPrinterStorage(i)}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.selectedPrinterId===i.id?"visible":"hidden"}}),t("div",{staticClass:"text"},[t("div",{staticClass:"title"},[e._v(e._s(i.name))]),t("div",{staticClass:"subtitle",class:[e.isPrinterBrowsable(i)?"text-success":"text-warning"]},[e._v(" "+e._s(e.printerBrowsabilityText(i))+" ")])])])])}))],2),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn",title:"Sort By"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-sort-amount-down"})]},proxy:!0}])},[t("sorting-dropdown",{attrs:{"local-storage-prefix":e.sortingLocalStoragePrefix,"sorting-options":e.sortingOptions,"sorting-value":e.sortingValue},on:{onSortingUpdated:e.onSortingUpdated}})],1),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn d-md-none"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[t("cascaded-dropdown",{ref:"cascadedDropdown",attrs:{"menu-options":e.mobileMenuOptions},on:{menuOptionClicked:e.onMenuOptionClicked},scopedSlots:e._u([{key:"sorting",fn:function(){return[t("sorting-dropdown",{attrs:{"local-storage-prefix":e.sortingLocalStoragePrefix,"sorting-options":e.sortingOptions,"sorting-value":e.sortingValue},on:{onSortingUpdated:e.onSortingUpdated}})]},proxy:!0},{key:"storage",fn:function(){return[t("b-dropdown-text",{staticClass:"small text-secondary"},[e._v("STORAGE")]),t("b-dropdown-item",{on:{click:()=>{e.switchToCloudStorage(),e.$refs.cascadedDropdown.resetMenuExpanded()}}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.isCloud?"visible":"hidden"}}),t("div",{staticClass:"text"},[t("div",{staticClass:"title"},[e._v("Obico Cloud")])])])]),e._l(e.printers,(function(i){return t("b-dropdown-item",{key:i.id,on:{click:()=>{e.switchToPrinterStorage(i),e.$refs.cascadedDropdown.resetMenuExpanded()}}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.selectedPrinterId===i.id?"visible":"hidden"}}),t("div",{staticClass:"text"},[t("div",{staticClass:"title"},[e._v(e._s(i.name))]),t("div",{staticClass:"subtitle",class:[e.isPrinterBrowsable(i)?"text-success":"text-warning"]},[e._v(" "+e._s(e.printerBrowsabilityText(i))+" ")])])])])}))]},proxy:!0}])})],1),e.onClose?t("a",{staticClass:"btn shadow-none icon-btn d-inline",attrs:{href:"#",title:"Close"},on:{click:function(t){return t.preventDefault(),e.onClose.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-times text-danger"})]):e._e()],1)]},proxy:!0},{key:"content",fn:function(){return[t("b-container",[t("b-row",[t("b-col",[e.isCloud?t("vue-dropzone",{ref:"gcodesDropzone",staticClass:"upload-box",attrs:{id:"dropzone",options:e.dropzoneOptions,"use-custom-slot":!0},on:{"vdropzone-queue-complete":e.gcodeUploadSuccess,"vdropzone-error":e.gcodeUploadError,"vdropzone-sending":e.addParentFolderParam}},[t("div",{staticClass:"dz-message needsclick"},[t("i",{staticClass:"fas fa-upload fa-2x"}),e._v(" "),t("br"),t("div",[e._v("G-Code file (*.gcode, *.gco, or *.g) only.")]),t("div",[e._v("Up to "+e._s(e.maxFilesize)+" MB each file, "+e._s(e.maxTotalFilesize)+" GB total.")])])]):e._e(),!e.isCloud&&e.isAgentMoonraker&&e.searchStateIsActive?t("div",{staticClass:"notice-block"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-info"})]),t("p",{staticClass:"message"},[e._v("Search in Klipper printers works only for current directory")])]):e._e(),t("g-code-file-structure",{ref:"gCodeFileStructure",attrs:{"is-cloud":e.isCloud,"is-popup":e.isPopup,"search-state-is-active":e.searchStateIsActive,"search-in-progress":e.searchInProgress,folders:e.folders,files:e.files,"target-printer":e.targetPrinter,"nothing-found":e.nothingFound,loading:e.loading,"scroll-container-id":e.scrollContainerId,"no-more-folders":e.noMoreFolders,"no-more-files":e.noMoreFiles,"local-files-loading":e.localFilesLoading},on:{openFolder:e.openFolder,openFile:e.openFile,renameItem:e.renameItem,moveItem:e.moveItem,deleteItem:e.deleteItem,print:e.onPrintClicked,fetchMore:e.fetchFilesAndFolders,selectFiles:e.onSelectFiles,selectFolders:e.onSelectFolders}})],1)],1)],1),t("rename-modal",{ref:"renameModal",attrs:{item:e.activeItem,"pre-confirm":e.verifyItemRename},on:{renamed:e.onItemRenamed}}),t("move-modal",{ref:"moveModal",attrs:{item:e.activeItem,items:e.activeItems,"item-parent-folder-id":e.parentFolder,"target-printer":e.targetPrinter,"scroll-container-id":e.scrollContainerId,"sorting-value":e.sortingValue},on:{moved:e.onItemMoved}}),t("delete-confirmation-modal",{ref:"deleteConfirmationModal",attrs:{item:e.activeItem},on:{deleted:e.onItemDeleted}}),t("new-folder-modal",{ref:"newFolderModal",attrs:{"pre-confirm":e.verifyNewFolder,"parent-folder-id":e.parentFolder},on:{created:e.onFolderCreated}})]},proxy:!0}])})},la=[],ca=(i("33d1"),i("ea98"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"search-wrapper"},[e._m(0),t("input",{staticClass:"dark",attrs:{type:"text",placeholder:"Search"},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)},focus:function(t){return e.$emit("focus")},blur:function(t){return e.$emit("blur")}}})])}),da=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"search-icon"},[t("i",{staticClass:"fas fa-search"})])}],ua={name:"SearchInput",props:{value:{type:String,default:""}}},pa=ua,ha=(i("a21a"),Object(E["a"])(pa,ca,da,!1,null,"46c9927d",null)),fa=ha.exports,ma=function(){var e=this,t=e._self._c;return t("b-modal",{attrs:{id:"b-modal-new-folder",title:"Enter new folder name","ok-title":"Create","ok-disabled":!e.newFolderName.length,centered:""},on:{ok:e.handleOk,hidden:e.resetModal,shown:e.focusInput}},[t("form",{on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("div",{staticClass:"my-2"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newFolderName,expression:"newFolderName"}],ref:"input",staticClass:"input-lg",attrs:{type:"text",name:"name",placeholder:"Folder name",required:"required"},domProps:{value:e.newFolderName},on:{input:function(t){t.target.composing||(e.newFolderName=t.target.value)}}}),e.errorMessage?t("b-alert",{staticClass:"mt-3",attrs:{variant:"danger",show:""}},[e._v(" "+e._s(e.errorMessage)+" ")]):e._e()],1)])])},ga=[],va={name:"NewFolderModal",props:{preConfirm:{type:Function,default:null},parentFolderId:{type:String,default:null}},data(){return{newFolderName:"",errorMessage:"",isOpen:!1}},methods:{show(){this.isOpen=!0,this.$bvModal.show("b-modal-new-folder")},focusInput(){this.$refs.input.select()},resetModal(){this.isOpen=!1,this.newFolderName="",this.errorMessage=""},handleOk(e){e.preventDefault(),this.handleSubmit()},async handleSubmit(){if(this.newFolderName){if(this.preConfirm){const e=this.preConfirm(this.newFolderName);if(!0!==e)return void(this.errorMessage=e)}try{const e=await Q["a"].post(X["a"].gcodeFolders(),{name:this.newFolderName,parent_folder:this.parentFolderId});this.$emit("created",e.data.id),this.$bvModal.hide("b-modal-new-folder")}catch(e){return void console.log(e)}}}}},ba=va,_a=(i("2f3f"),Object(E["a"])(ba,ma,ga,!1,null,"48c8816c",null)),Ca=_a.exports,wa=function(){var e=this,t=e._self._c;return t("b-modal",{attrs:{id:"b-modal-rename",title:"Enter new name","ok-title":"Rename",centered:""},on:{ok:e.handleOk,hidden:e.resetModal,shown:e.focusInput}},[t("form",{on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("div",{staticClass:"my-2"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newItemName,expression:"newItemName"}],ref:"input",staticClass:"input-lg",attrs:{type:"text",name:"name",placeholder:"New name",required:"required"},domProps:{value:e.newItemName},on:{input:function(t){t.target.composing||(e.newItemName=t.target.value)}}}),e.errorMessage?t("b-alert",{staticClass:"mt-3",attrs:{variant:"danger",show:""}},[e._v(" "+e._s(e.errorMessage)+" ")]):e._e()],1)])])},ya=[],ka={name:"RenameModal",components:{},props:{item:{type:Object,default:null},preConfirm:{type:Function,default:null}},data(){return{newItemName:"",errorMessage:"",isOpen:!1}},computed:{itemType(){return this.item.filename?"file":"folder"},fullName(){return"file"===this.itemType?`${this.newItemName}.${this.fileExt}`:this.newItemName},fileExt(){return"folder"===this.itemType?null:this.item.filename.split(".").at(-1)},nameWithoutExt(){if("folder"===this.itemType)return this.item.name;{const e=this.item.filename;return e.slice(0,e.length-this.fileExt.length-1)}},newNameWithExt(){return"folder"===this.itemType?this.newItemName:`${this.newItemName}.${this.fileExt}`}},methods:{show(){this.isOpen=!0,this.$nextTick(()=>{this.item?(this.newItemName=this.nameWithoutExt,this.$bvModal.show("b-modal-rename")):this.isOpen=!1})},focusInput(){this.$refs.input.select()},close(){this.$bvModal.hide("b-modal-rename"),this.resetModal()},resetModal(){this.isOpen=!1,this.newItemName="",this.errorMessage=""},handleOk(e){this.newNameWithExt!==(this.item.filename||this.item.name)?(e.preventDefault(),this.handleSubmit()):this.close()},async handleSubmit(){const e=this.item.id;if(this.newItemName)if(this.newNameWithExt!==(this.item.filename||this.item.name)){if(this.preConfirm){const e=this.preConfirm(this.newNameWithExt);if(!0!==e)return void(this.errorMessage=e)}try{const t="file"===this.itemType?X["a"].gcodeFile(e):X["a"].gcodeFolder(e);await Q["a"].patch(t,`${"file"===this.itemType?"filename":"name"}=${this.newNameWithExt}`)}catch(t){return this.errorMessage="Server error",void console.log(t)}this.$emit("renamed",this.newNameWithExt),this.close()}else this.close()}}},Sa=ka,Pa=(i("b4a7"),Object(E["a"])(Sa,wa,ya,!1,null,"647aff5e",null)),xa=Pa.exports,Ta=function(){var e=this,t=e._self._c;return t("b-modal",{attrs:{id:"b-modal-move",title:"Move item","ok-title":"Place Here","ok-disabled":e.isSameDir||e.patchLoading,scrollable:""},on:{ok:e.handleOk,hidden:e.resetModal},scopedSlots:e._u([{key:"modal-title",fn:function(){return[t("div",{staticClass:"title"},[null!==e.parentFolder?t("a",{staticClass:"btn shadow-none icon-btn d-inline",attrs:{href:"#",title:"Go Back"},on:{click:function(t){return t.preventDefault(),e.goBack.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-chevron-left"})]):e._e(),t("h5",{staticClass:"modal-title"},[e._v("Move item")])])]},proxy:!0}])},[t("form",{on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("g-code-file-structure",{attrs:{folders:e.folders,files:e.files,"target-printer":e.targetPrinter,loading:e.loading,"scroll-container-id":"b-modal-move___BV_modal_body_","no-more-folders":e.noMoreFolders,"no-more-files":!0,"is-move-modal":!0,"disabled-items":e.disabledItems},on:{openFolder:e.openFolder,fetchMore:e.fetchFilesAndFolders}})],1)])},Fa=[],Da=function(){var e=this,t=e._self._c;return t("div",{staticClass:"gcodes-wrapper",class:{"is-move-modal":e.isMoveModal}},[e.isMoveModal?e._e():t("div",{staticClass:"header-panel",class:{"without-action-buttons":!e.isCloud&&!e.targetPrinter}},[t("div",{staticClass:"text"},[e._v("Name")]),t("div",{staticClass:"text"},[e._v("Size")]),t("div",{staticClass:"text"},[e._v("Created")]),e.isCloud?t("div",{staticClass:"text"},[e._v("Last Printed")]):e._e()]),t("div",{staticClass:"gcode-items-wrapper"},[t("div",e._l([...e.folders,...e.files],(function(i,s){return t("file-structure-item",{directives:[{name:"show",rawName:"v-show",value:e.isFolder(i)&&!e.searchStateIsActive||!e.isFolder(i)&&!e.searchInProgress,expression:"\n          (isFolder(item) && !searchStateIsActive) || (!isFolder(item) && !searchInProgress)\n        "}],key:`${e.isFolder(i)?"folder":"file"}_${s}`,attrs:{item:i,"is-cloud":e.isCloud,"target-printer":e.targetPrinter,"is-move-modal":e.isMoveModal,disabled:e.isFolder(i)?e.disabledItems.folders.includes(i.id):e.disabledItems.files.includes(i.id),selectable:!e.isMoveModal&&e.isCloud&&!e.isPopup,selected:e.isFolder(i)?e.selectedFolders.has(i.id):e.selectedFiles.has(i.id)},on:{click:function(t){e.isFolder(i)?e.$emit("openFolder",i):e.$emit("openFile",i)},renameItem:function(t){return e.$emit("renameItem",i)},moveItem:function(t){return e.$emit("moveItem",i)},deleteItem:function(t){return e.$emit("deleteItem",i)},print:function(t){return e.$emit("print",i)},selectedChanged:e.onSelectedChanged}})})),1),e.isCloud?t("mugen-scroll",{staticClass:"text-center",attrs:{"v-show":!e.isFolderEmpty,handler:()=>e.$emit("fetchMore"),"should-handle":!e.loading,"scroll-container":e.scrollContainerId}},[e.noMoreFolders&&e.noMoreFiles&&!e.searchInProgress?e._e():t("div",{staticClass:"py-5"},[t("b-spinner",{attrs:{label:"Loading..."}})],1)]):e._e(),e.isCloud||!e.localFilesLoading&&!e.searchInProgress?t("div",[e.isFolderEmpty?t("div",{staticClass:"placeholder text-secondary"},[t("span",[e._v("Nothing here yet")])]):e.nothingFound?t("div",{staticClass:"placeholder text-secondary"},[t("span",[e._v("Nothing found")])]):e._e()]):t("div",{staticClass:"text-center py-5"},[t("b-spinner",{attrs:{label:"Loading..."}})],1)],1)])},Oa=[],Ia=function(){var e=this,t=e._self._c;return t("div",{staticClass:"item",class:{disabled:e.isDisabled,"move-modal":e.isMoveModal},on:{click:()=>!e.isDisabled&&e.$emit("click")}},[e.selectable?t("div",{staticClass:"checkbox-wrapper",class:{isSelected:e.isSelected}},[t("b-form-checkbox",{attrs:{size:"md",checked:e.isSelected},nativeOn:{"!click":function(t){t.stopPropagation(),t.preventDefault(),e.isSelected=!e.isSelected}}})],1):e._e(),t("div",{staticClass:"item-info"},[t("div",{staticClass:"filename"},[t("div",{staticClass:"thumbnail-wrapper",class:{folder:e.isFolder}},[!e.isFolder&&e.item.getSmallThumbnailUrl()?t("div",{staticClass:"thumbnail"},[t("img",{attrs:{src:e.item.getSmallThumbnailUrl()}})]):t("div",{staticClass:"placeholder"},[e.isFolder?t("i",{staticClass:"fas fa-folder"}):t("i",{staticClass:"fas fa-file-code"})])]),t("span",{staticClass:"truncated"},[e._v(e._s(e.isFolder?e.item.name:e.item.filename))])]),t("div",{staticClass:"size"},[e.isFolder?e._e():t("span",[e._v(e._s(e.item.filesize))]),e.isFolder?t("span",[e._v(e._s(e.item.numItems)+" item(s)")]):e._e()]),e.isMoveModal?e._e():t("div",{staticClass:"created"},[e._v(" "+e._s(e.item.created_at?e.item.created_at.fromNow():"-")+" ")]),e.isMoveModal?e._e():[!e.isFolder&&e.isCloud?t("div",{staticClass:"last-printed"},[e.item.print_set?e.item.print_set.length?e.item.last_print?t("span",[e._v(e._s(e.item.last_print.ended_at?e.item.last_print.ended_at.fromNow():"Printing..."))]):e._e():t("span",[e._v("No prints yet")]):t("span",[e._v("-")]),e.item.last_print&&e.item.last_print.ended_at?t("div",{staticClass:"circle-indicator",class:{cancelled:e.item.last_print.cancelled_at,finished:e.item.last_print.finished_at}}):e._e()]):e._e(),e.isFolder&&e.isCloud?t("div",{staticClass:"d-none d-md-block"}):e._e()]],2),!e.isMoveModal&&(!e.isFolder&&(e.isCloud||e.targetPrinter)||e.isFolder&&e.isCloud)?t("div",[t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn py-0"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}],null,!1,3452768261)},[!e.isFolder&&e.targetPrinter?t("b-dropdown-item",{on:{click:function(t){return t.stopPropagation(),e.$emit("print",e.item)}}},[t("span",{staticClass:"text-primary"},[t("i",{staticClass:"fas fa-play-circle"}),e._v("Print on "+e._s(e.targetPrinter.name)+" ")])]):e._e(),e.isCloud?t("b-dropdown-item",{on:{click:function(t){return t.stopPropagation(),e.$emit("renameItem",e.item)}}},[t("i",{staticClass:"fas fa-edit"}),e._v("Rename ")]):e._e(),e.isCloud?t("b-dropdown-item",{on:{click:function(t){return t.stopPropagation(),e.$emit("moveItem",e.item)}}},[t("i",{staticClass:"fas fa-arrows-alt"}),e._v("Move ")]):e._e(),e.isCloud?t("b-dropdown-item",{on:{click:function(t){return t.stopPropagation(),e.$emit("deleteItem",e.item)}}},[t("span",{staticClass:"text-danger"},[t("i",{staticClass:"fas fa-trash-alt"}),e._v("Delete ")])]):e._e()],1)],1):e._e()])},Aa=[],Ma={name:"FileStructureItem",props:{item:{type:Object,required:!0},isCloud:{type:Boolean,default:!0},targetPrinter:{type:Object,default:null},isMoveModal:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},selectable:{type:Boolean,default:!1}},data:function(){return{isSelected:this.selected}},computed:{isFolder(){return!this.item.filename},isDisabled(){return this.isMoveModal&&!this.isFolder||this.disabled}},watch:{isSelected(e){this.$emit("selectedChanged",this.item,e)},selected(e){this.isSelected=e}}},Ea=Ma,Na=(i("e7bf"),Object(E["a"])(Ea,Ia,Aa,!1,null,"3e243ba5",null)),Ra=Na.exports,ja={name:"GCodeFileStructure",components:{MugenScroll:Wt.a,FileStructureItem:Ra},props:{folders:{type:Array,default:()=>[]},files:{type:Array,default:()=>[]},noMoreFolders:{type:Boolean,default:!1},noMoreFiles:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},localFilesLoading:{type:Boolean,default:!1},isCloud:{type:Boolean,default:!0},isPopup:{type:Boolean,default:!1},searchStateIsActive:{type:Boolean,default:!1},searchInProgress:{type:Boolean,default:!1},nothingFound:{type:Boolean,default:!1},targetPrinter:{type:Object,default:null},scrollContainerId:{type:String,default:null},isMoveModal:{type:Boolean,default:!1},disabledItems:{type:Object,default:()=>({folders:[],files:[]})}},data:function(){return{selectedFiles:new Set,selectedFolders:new Set}},computed:{isFolderEmpty(){return!this.searchStateIsActive&&!this.loading&&!this.files.length&&!this.folders.length}},methods:{onSelectedChanged(e,t){const i=this.isFolder(e)?new Set(this.selectedFolders):new Set(this.selectedFiles);t?i.add(e.id):i.delete(e.id),this.isFolder(e)?(this.selectedFolders=i,this.$emit("selectFolders",this.selectedFolders)):(this.selectedFiles=i,this.$emit("selectFiles",this.selectedFiles))},isFolder(e){return!e.filename},selectAll(){this.selectedFolders=new Set(this.folders.map(e=>e.id)),this.selectedFiles=new Set(this.files.map(e=>e.id)),this.$emit("selectFolders",this.selectedFolders),this.$emit("selectFiles",this.selectedFiles)},unselectAll(){this.selectedFolders=new Set,this.selectedFiles=new Set,this.$emit("selectFolders",this.selectedFolders),this.$emit("selectFiles",this.selectedFiles)}}},La=ja,Ba=(i("283d"),Object(E["a"])(La,Da,Oa,!1,null,"2fced1c8",null)),$a=Ba.exports;const Va=24;var Ua={name:"MoveModal",components:{GCodeFileStructure:$a},props:{item:{type:Object,default:null},items:{type:Object,default:null},targetPrinter:{type:Object,default:null},scrollContainerId:{type:String,default:null},sortingValue:{type:Object,required:!0},itemParentFolderId:{type:String,default:""}},data(){return{path:[],isOpen:!1,loading:!1,patchLoading:!1,folders:[],files:[],noMoreFolders:!1,currentFoldersPage:1,currentFilesPage:1}},computed:{disabledItems(){const e={files:[],folders:[]};return this.item&&"file"===this.itemType?e.files=[this.item.id]:this.item&&"folder"===this.itemType?e.folders=[this.item.id]:this.items&&(e.files=this.items.files,e.folders=this.items.folders),e},itemType(){return this.item?this.item.filename?"file":"folder":null},parentFolder(){return this.path&&this.path.length>0?this.path.at(-1):null},isSameDir(){return null===this.parentFolder&&!this.itemParentFolderId||parseInt(this.itemParentFolderId)===this.parentFolder}},methods:{goBack(){this.path.pop(),this.fetchFilesAndFolders(!0)},openFolder(e){this.path.push(e.id),this.fetchFilesAndFolders(!0)},resetFiles(){this.folders=[],this.files=[],this.noMoreFolders=!1,this.currentFoldersPage=1,this.currentFilesPage=1},async fetchFilesAndFolders(e=!1){if(this.loading)return;if(e&&this.resetFiles(),this.noMoreFolders)return;this.loading=!0;let t=[];if(!this.noMoreFolders){try{var i,s;const e={parent_folder:this.parentFolder||"null",page:this.currentFoldersPage,page_size:Va};this.sortingValue.sorting.folderKey&&(e.sorting=`${this.sortingValue.sorting.folderKey}_${this.sortingValue.direction.key}`);let n=await Q["a"].get(X["a"].gcodeFolders(),{params:e});n=n.data,this.noMoreFolders=null===(null===(i=n)||void 0===i?void 0:i.next),t=(null===(s=n)||void 0===s?void 0:s.results)||[]}catch(n){this.loading=!1,this.errorDialog(n)}this.folders.push(...t.map(e=>we(e))),this.currentFoldersPage+=1}this.loading=!1},show(){this.isOpen=!0,this.fetchFilesAndFolders(),this.$nextTick(()=>{this.item||this.items?this.$bvModal.show("b-modal-move"):this.isOpen=!1})},close(){this.$bvModal.hide("b-modal-move"),this.resetModal()},resetModal(){this.isOpen=!1,this.path=[],this.resetFiles()},handleOk(e){e.preventDefault(),this.handleSubmit()},async handleSubmit(){this.patchLoading=!0;const e=this.parentFolder||"";try{if(this.item){const t=this.item.id,i="file"===this.itemType?X["a"].gcodeFile(t):X["a"].gcodeFolder(t);await Q["a"].patch(i,"parent_folder="+e)}else this.items&&(this.items.folders.length&&await Q["a"].post(X["a"].gcodeFolderBulkMove(),{folder_ids:this.items.folders,parent_folder:e}),this.items.files.length&&await Q["a"].post(X["a"].gcodeFileBulkMove(),{file_ids:this.items.files,parent_folder:e}))}catch(t){this.errorDialog(t,"Failed to move item(s)")}this.patchLoading=!1,this.$emit("moved"),this.close()}}},za=Ua,Wa=(i("fcb3"),Object(E["a"])(za,Ta,Fa,!1,null,"0ce6204a",null)),Ga=Wa.exports,qa=function(){var e=this,t=e._self._c;return t("div")},Ha=[],Ja={name:"RenameModal",props:{item:{type:Object,default:null}},data(){return{isOpen:!1}},created(){},mounted(){},methods:{show(){this.isOpen=!0,this.$bvModal.msgBoxConfirm("Are you sure?",{id:"b-modal-confirm-delete",centered:!0,okTitle:"Delete",okVariant:"danger",size:"sm",autoFocusButton:"ok"}).then(async e=>{if(this.isOpen=!1,e){try{const e=this.item.filename?X["a"].gcodeFile(this.item.id):X["a"].gcodeFolder(this.item.id);await Q["a"].delete(e)}catch(t){return void console.log(t)}this.$emit("deleted")}}).catch(e=>{this.errorDialog(e,"Failed to delete item")})}}},Ya=Ja,Ka=(i("664d"),Object(E["a"])(Ya,qa,Ha,!1,null,null,null)),Za=Ka.exports;const Qa=1e3,Xa=24,eo="gcodesSorting",to={options:[{title:"Name",key:"filename",folderKey:"name"},{title:"Size",key:"num_bytes"},{title:"Created",key:"created_at",folderKey:"created_at"}],default:{sorting:"created_at",direction:"desc"}};var io={name:"GCodeFoldersPage",components:{PageLayout:vt,SearchInput:fa,vueDropzone:Un.a,GCodeFileStructure:$a,RenameModal:xa,MoveModal:Ga,DeleteConfirmationModal:Za,NewFolderModal:Ca,SortingDropdown:ni,CascadedDropdown:Kt},props:{isPopup:{type:Boolean,default:!1},onClose:{type:Function,default:null},scrollContainerId:{type:String,default:null},targetPrinter:{type:Object,default:null},savedPath:{type:Array,default:()=>[]},routeParams:{type:Object,default:()=>({printerId:null,parentFolder:null})}},data(){return{PrintStatus:be,csrf:null,user:null,loading:!1,parentFolder:null,path:[],files:[],folders:[],noMoreFolders:!1,noMoreFiles:!1,currentFoldersPage:1,currentFilesPage:1,sortingLocalStoragePrefix:eo,sortingOptions:to,sortingValue:ti(eo,to),searchQuery:null,searchStateIsActive:!1,searchTimeoutId:null,activeItem:null,activeItems:null,printers:[],selectedPrinterId:void 0,selectedPrinterComm:void 0,localFilesLoading:!1,selectedFolders:new Set,selectedFiles:new Set}},computed:{selectedItemsCount(){return this.selectedFiles.size+this.selectedFolders.size},allSelected(){const e=this.files.length+this.folders.length;return this.selectedItemsCount===e&&0!==e},mobileMenuOptions(){const e=[{key:"storage",icon:"fas fa-server",title:"File storage",expandable:!0},{key:"sorting",icon:"fas fa-sort-amount-down",title:"Sort",expandable:!0}];return this.isCloud&&e.unshift({key:"createFolder",icon:"fas fa-folder-plus",title:"Create folder",callback:!0}),e},isAgentMoonraker(){const e=this.printers.find(e=>e.id===this.selectedPrinterId);return!e||e.isAgentMoonraker()},isCloud(){return!this.selectedPrinterId},nothingFound(){return this.searchStateIsActive&&!this.searchTimeoutId&&!this.files.length},searchInProgress(){return this.searchStateIsActive&&!!this.searchTimeoutId},maxFilesize(){return this.user.is_pro?500:50},maxTotalFilesize(){return this.user.is_pro?50:1},dropzoneOptions(){return{withCredentials:!0,maxFilesize:this.maxFilesize,timeout:36e5,acceptedFiles:".g,.gcode,.gco",url:X["a"].gcodeFiles(),headers:{"X-CSRFToken":this.csrf}}}},async created(){this.csrf=Object(ds["c"])(),this.user=Object(Se["f"])(),this.savedPath&&this.savedPath.length>=1?(this.parentFolder=this.savedPath.at(-1),this.path=this.savedPath.slice(0,this.savedPath.length-1)):this.parentFolder=this.getRouteParam("parentFolder")||null,this.selectedPrinterId=Number(this.getRouteParam("printerId"))||null,this.isPopup||this.$watch(()=>this.$route.params,(e,t)=>{this.parentFolder=e.parentFolder||null,this.selectedPrinterId=Number(this.getRouteParam("printerId"))||null,this.fetchFilesAndFolders(!0)}),await this.fetchPrinters(),this.fetchFilesAndFolders(!0)},methods:{isPrinterBrowsable(e){return!(e.isOffline()||!e.isAgentVersionGte("2.3.0","1.2.0"))},printerBrowsabilityText(e){return this.isPrinterBrowsable(e)?"Available to browse files":"Unable to browse files"},toggleSelectAll(){this.allSelected?this.$refs.gCodeFileStructure.unselectAll():this.$refs.gCodeFileStructure.selectAll()},onSelectFiles(e){this.selectedFiles=e},onSelectFolders(e){this.selectedFolders=e},moveSelectedItems(){this.activeItems={files:Array.from(this.selectedFiles),folders:Array.from(this.selectedFolders)},this.$refs.moveModal.show()},deleteSelectedItems(){const e=Array.from(this.selectedFolders),t=Array.from(this.selectedFiles);this.$swal.Prompt.fire({title:"Are you sure?",text:`Delete ${e.length+t.length} item(s)? This action can not be undone.`,showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No"}).then(async i=>{if(i.isConfirmed)try{e.length&&await Q["a"].post(X["a"].gcodeFolderBulkDelete(),{folder_ids:e}),t.length&&await Q["a"].post(X["a"].gcodeFileBulkDelete(),{file_ids:t})}catch(s){this.errorDialog(s,"Failed to delete files and folders")}finally{this.fetchFilesAndFolders(!0)}})},switchToCloudStorage(){this.parentFolder=null,this.path=[],this.selectedPrinterId=null,this.selectedPrinterComm=null,this.isPopup?this.fetchFilesAndFolders(!0):"/g_code_folders/cloud/"!==this.$route.path&&this.$router.replace("/g_code_folders/cloud/")},switchToPrinterStorage(e){this.isPrinterBrowsable(e)?(this.parentFolder=null,this.path=[],this.selectedPrinterId=e.id,this.selectedPrinterComm=null,this.isPopup?this.fetchFilesAndFolders(!0):Number(this.getRouteParam("printerId"))!==e.id&&this.$router.replace(`/g_code_folders/local/${e.id}/`)):this.$swal.Reject.fire({title:e.name+" isn't available for browsing files for one of the following reasons:",html:`<ul style="text-align: left">\n            <li>${e.agentDisplayName()} is powered off or not connected to the Internet</li>\n            <li>Printer is not connected to ${e.agentDisplayName()}</li>\n            <li>Obico for ${e.agentDisplayName()} plugin is outdated (you need version ${e.browsabilityMinPluginVersion()} or later)</li>\n          </ul>`})},getRouteParam(e){return this.isPopup?this.routeParams[e]:this.$route.params[e]},goBack(){this.path.length&&(this.parentFolder=this.path.pop(),this.fetchFilesAndFolders(!0))},resetFiles(){this.folders=[],this.files=[],this.$refs.gCodeFileStructure.unselectAll(),this.noMoreFolders=!1,this.noMoreFiles=!1,this.currentFoldersPage=1,this.currentFilesPage=1},async fetchPrinters(){let e;try{e=await Q["a"].get(X["a"].printers()),e=e.data}catch(t){console.error(t)}e&&(e=e.map(e=>ye(e)),e=e.sort((e,t)=>Number(this.isPrinterBrowsable(t))-Number(this.isPrinterBrowsable(e))),this.printers=this.targetPrinter?e.filter(e=>e.id===this.targetPrinter.id):e)},async fetchLocalFiles(){if(!this.selectedPrinterComm)return;this.localFilesLoading=!0;const e=this.isAgentMoonraker?fn:hn;e(this.selectedPrinterComm,this.parentFolder?decodeURIComponent(this.parentFolder):null,this.searchQuery).then(e=>{if(this.localFilesLoading=!1,e){const{folders:t,files:i}=e;this.folders=t,this.files=i}})},async fetchFilesAndFolders(e=!1,t=!1){if(this.loading)return;if(e&&this.resetFiles(),this.selectedPrinterId)return this.printers.find(e=>e.id===this.selectedPrinterId)||this.$swal.Reject.fire({title:"Error",text:"Printer not found or unavailable"}).then(()=>{this.isPopup&&this.onClose?this.onClose():window.location.assign("/g_code_folders/cloud/")}),this.localFilesLoading=!0,void(this.selectedPrinterComm?this.fetchLocalFiles():(this.selectedPrinterComm=cn.getOrCreatePrinterComm(this.selectedPrinterId,X["a"].printerWebSocket(this.selectedPrinterId)),this.selectedPrinterComm.connect(this.fetchLocalFiles)));if(this.searchQuery&&(this.noMoreFolders=!0),this.noMoreFolders&&this.noMoreFiles)return;this.loading=!0;let i=[],s=[];if(!this.noMoreFolders){try{var n,r;const e={parent_folder:this.parentFolder||"null",page:this.currentFoldersPage,page_size:Xa};this.sortingValue.sorting.folderKey&&(e.sorting=`${this.sortingValue.sorting.folderKey}_${this.sortingValue.direction.key}`);let t=await Q["a"].get(X["a"].gcodeFolders(),{params:e});t=t.data,this.noMoreFolders=null===(null===(n=t)||void 0===n?void 0:n.next),i=(null===(r=t)||void 0===r?void 0:r.results)||[]}catch(c){this.loading=!1,this.errorDialog(c)}this.currentFoldersPage+=1}if(!this.noMoreFiles&&i.length<Xa){try{var a,o;let e=await Q["a"].get(X["a"].gcodeFiles(),{headers:{"Cache-Control":"no-cache"},params:{parent_folder:this.searchQuery?void 0:this.parentFolder||"null",page:this.currentFilesPage,page_size:Xa,sorting:`${this.sortingValue.sorting.key}_${this.sortingValue.direction.key}`,q:this.searchQuery}});e=e.data,this.noMoreFiles=null===(null===(a=e)||void 0===a?void 0:a.next),s=(null===(o=e)||void 0===o?void 0:o.results)||[]}catch(c){this.loading=!1,this.errorDialog(c)}if(this.currentFilesPage+=1,t)try{var l;let e=await Q["a"].get(X["a"].gcodeFiles(),{params:{parent_folder:this.parentFolder||"null",page_size:1,sorting:"created_at_desc"}});e=e.data,null!==(l=e)&&void 0!==l&&l.results&&e.results[0]&&this.onPrintClicked(e.results[0])}catch(c){this.loading=!1,this.errorDialog(c)}}this.folders.push(...i.map(e=>we(e))),this.files.push(...s.map(e=>Ce(e))),this.loading=!1},updateSearch(e){if(clearTimeout(this.searchTimeoutId),this.searchTimeoutId=null,this.searchStateIsActive=!!e,!this.searchStateIsActive)return this.searchQuery=null,void this.fetchFilesAndFolders(!0);this.searchTimeoutId=setTimeout(async()=>{this.searchQuery=e,this.fetchFilesAndFolders(!0),this.searchTimeoutId=null},Qa)},addParentFolderParam(e,t,i){i.append("filename",e.name),null!==this.parentFolder&&i.append("parent_folder",this.parentFolder)},gcodeUploadSuccess(){const e=this.targetPrinter&&1===this.$refs.gcodesDropzone.getAcceptedFiles().length&&0===this.$refs.gcodesDropzone.getRejectedFiles().length;this.$refs.gcodesDropzone.removeAllFiles(),this.files=[],this.fetchFilesAndFolders(!0,e)},gcodeUploadError(e,t){this.$swal.Reject.fire({html:`<p class="text-center">${t}</p>`})},renameItem(e){this.activeItem=e,this.$refs.renameModal.show()},verifyItemRename(e){return!(!this.activeItem.filename&&this.folders.find(t=>t.name===e))||"Folder with this name already exists"},onItemRenamed(e){if(!this.activeItem)return;const t=this.activeItem.filename?this.files:this.folders;for(let i in t)if(t[i].id===this.activeItem.id){if(this.activeItem.filename){this.files[i].filename=e;break}this.folders[i].name=e;break}this.activeItem=null},moveItem(e){this.activeItem=e,this.$refs.moveModal.show()},onItemMoved(){(this.activeItem||this.activeItems)&&(this.activeItem=null,this.activeItems=null,this.fetchFilesAndFolders(!0))},deleteItem(e){this.activeItem=e,this.$refs.deleteConfirmationModal.show()},onItemDeleted(){if(!this.activeItem)return;const e=this.activeItem.filename?this.files:this.folders;for(let t in e)if(e[t].id===this.activeItem.id){if(this.activeItem.filename){this.files.splice(t,1);break}this.folders.splice(t,1);break}this.activeItem=null},createFolder(){this.$refs.newFolderModal.show()},onMenuOptionClicked(e){"createFolder"===e&&this.createFolder()},verifyNewFolder(e){return!this.folders.find(t=>t.name===e)||"Folder with this name already exists"},onFolderCreated(e){this.fetchFilesAndFolders(!0)},openFolder(e){this.isPopup?(this.path.push(this.parentFolder),this.parentFolder=String(e.id),this.fetchFilesAndFolders(!0)):this.selectedPrinterId?this.$router.push(`/g_code_folders/local/${this.selectedPrinterId}/${encodeURIComponent(e.path)}/`):this.$router.push(`/g_code_folders/cloud/${e.id}/`)},openFile(e){this.isPopup?this.$emit("openFile",this.selectedPrinterId?encodeURIComponent(e.path):e.id,this.selectedPrinterId,[...this.path,this.parentFolder]):this.selectedPrinterId?window.location.assign(`/g_code_files/local/${this.selectedPrinterId}/${encodeURIComponent(e.path)}/`):window.location.assign(`/g_code_files/cloud/${e.id}/`)},onPrintClicked(e){bn(e,this.targetPrinter).then(()=>{Cn({printer:this.targetPrinter,gcode:e,isCloud:this.isCloud,Swal:this.$swal,onCommandSent:()=>{this.isPopup&&this.$bvModal.hide("b-modal-gcodes"+this.targetPrinter.id)}})})},onSortingUpdated(e){this.sortingValue=e,this.fetchFilesAndFolders(!0)}}},so=io,no=(i("1b34"),Object(E["a"])(so,oa,la,!1,null,"79cb4ff4",null)),ro=no.exports,ao=function(){var e=this,t=e._self._c;return t("page-layout",{attrs:{"is-popup":e.isPopup},scopedSlots:e._u([{key:"topBarLeft",fn:function(){return[e.isPopup?t("a",{staticClass:"btn shadow-none icon-btn d-inline",attrs:{href:"#",title:"Go Back"},on:{click:function(t){return t.preventDefault(),e.goBack.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-chevron-left"})]):e._e()]},proxy:!0},{key:"topBarRight",fn:function(){return[t("div",{staticClass:"action-panel"},[e.isCloud?t("a",{staticClass:"btn shadow-none icon-btn action-btn",attrs:{href:"#",title:"Rename file"},on:{click:function(t){return t.preventDefault(),e.renameFile.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-edit"})]):e._e(),e.isCloud?t("a",{staticClass:"text-danger btn shadow-none icon-btn action-btn",attrs:{href:"#",title:"Delete file"},on:{click:function(t){return t.preventDefault(),e.deleteFile.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-trash-alt"})]):e._e(),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn d-md-none"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[t("cascaded-dropdown",{ref:"cascadedDropdown",attrs:{"menu-options":[{key:"renameFile",icon:"fas fa-edit",title:"Rename file",callback:!0},{key:"deleteFile",icon:"fas fa-trash-alt",customMenuOptionClass:"text-danger",title:"Delete file",callback:!0}]},on:{menuOptionClicked:e.onMenuOptionClicked}})],1),e.onClose?t("a",{staticClass:"btn shadow-none icon-btn d-inline",attrs:{href:"#",title:"Close"},on:{click:function(t){return t.preventDefault(),e.onClose.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-times text-danger"})]):e._e()],1)]},proxy:!0},{key:"content",fn:function(){return[e.loading||e.gcodeNotFound?t("b-container",[t("b-row",[t("b-col",{staticClass:"text-center mt-5"},[e.gcodeNotFound?t("div",[t("p",[e._v("This G-Code file doesn't exists")])]):t("div",[t("b-spinner")],1)])],1)],1):t("b-container",{attrs:{fluid:""}},[t("b-row",[t("b-col",{attrs:{lg:e.isPopup?12:5}},[t("b-alert",{attrs:{show:e.isDeleted,variant:"warning warning-block"}},[e._v(" This file is deleted and unavailable for print ")]),t("g-code-details",{attrs:{file:e.gcode,"show-print-stats":!0,"compact-view":!1}}),e.isDeleted?e._e():t("available-printers",{staticClass:"card-container available-printers",class:{"full-width":e.isPopup},attrs:{"is-popup":e.isPopup,"target-printer-id":e.targetPrinterId||e.selectedPrinterId,gcode:e.gcode,"is-cloud":e.isCloud},on:{refresh:e.onRefresh}})],1),t("b-col",{attrs:{lg:e.isPopup?12:7}},[t("div",{staticClass:"print-history",class:{"full-width":e.isPopup||e.isDeleted}},[t("h2",{staticClass:"section-title mb-3"},[e._v("Print History")]),e.gcode.print_set.length?t("div",e._l(e.gcode.print_set,(function(e){return t("print-history-item",{key:"print_"+e.id,staticClass:"print-item",attrs:{print:e}})})),1):t("div",[t("div",{staticClass:"card-container p-4 justify-content-center text-secondary"},[e._v(" This file doesn't have any prints yet ")])])])])],1)],1),t("rename-modal",{ref:"renameModal",attrs:{item:e.gcode},on:{renamed:e.onItemRenamed}}),t("delete-confirmation-modal",{ref:"deleteConfirmationModal",attrs:{item:e.gcode},on:{deleted:e.onItemDeleted}})]},proxy:!0}])})},oo=[],lo=i("9380"),co=i.n(lo),uo=function(){var e=this,t=e._self._c;return t("div",[e.printersLoading||!e.gcode?t("div",{staticClass:"my-5 text-center"},[t("b-spinner")],1):t("div",{staticClass:"text-center"},[e.targetPrinterId?e._e():t("div",{staticClass:"mb-3"},[e._l(e.printers,(function(i){return t("div",{key:"printer_"+i.id,staticClass:"printer-item",class:{active:e.selectedPrinter&&i.id===e.selectedPrinter.id},on:{click:function(t){return e.selectPrinter(i)}}},[t("div",{staticClass:"selected-indicator"}),t("div",{staticClass:"printer-name truncated",attrs:{title:i.name}},[e._v(e._s(i.name))]),t("div",{staticClass:"printer-status",class:[i.isPrintable()?"text-success":"text-warning"]},[e._v(" "+e._s(i.printabilityText())+" ")])])})),e.printersLoading||e.printers.length?e._e():t("p",{staticClass:"text-center text-secondary mt-3 mb-3"},[e._v(" No available printers ")])],2),t("button",{staticClass:"btn btn-primary d-inline-flex align-items-center justify-content-center",attrs:{disabled:!e.selectedPrinter||e.isSending||!e.selectedPrinter.isPrintable()},on:{click:e.onPrintClicked}},[e.isSending?t("b-spinner",{staticClass:"mr-1",attrs:{small:""}}):e._e(),e.selectedPrinter?t("div",{staticClass:"truncated"},[e._v("Print on "+e._s(e.selectedPrinter.name))]):t("div",{staticClass:"truncated"},[e._v("Print")])],1)])])},po=[],ho={name:"AvailablePrinters",components:{},props:{isPopup:{type:Boolean,default:!1},targetPrinterId:{type:Number,required:!1,default:null},gcode:{type:Object,default:null},isCloud:{type:Boolean,default:!0}},data(){return{printers:[],selectedPrinter:null,printersLoading:!0,printerStateCheckInterval:null,printerComms:{}}},computed:{isSending(){return this.printers.some(e=>"Starting"===e.calculatedState()||"G-Code Downloading"===e.calculatedState())}},created(){this.fetchPrinters()},methods:{async fetchPrinters(){this.printersLoading=!0;const e=await Q["a"].get(X["a"].printers());if(null===e||void 0===e||!e.data)return void(this.printersLoading=!1);const t=null===e||void 0===e?void 0:e.data.map(e=>ye(e));if(this.targetPrinterId){const e=t.find(e=>e.id===this.targetPrinterId);this.printers=[e],e.isPrintable()&&(this.selectedPrinter=e)}else this.printers=t,this.selectedPrinter=t.find(e=>e.isPrintable())||null;for(const i of this.printers)this.printerComms[i.id]=cn.getOrCreatePrinterComm(i.id,X["a"].printerWebSocket(i.id),{onPrinterUpdateReceived:e=>{const t=this.printers.findIndex(e=>e.id===i.id);this.$set(this.printers,t,ye(e,this.printers[t]))}}),this.printerComms[i.id].connect();this.printersLoading=!1},selectPrinter(e){e.isPrintable()?this.selectedPrinter=e:this.$swal.Reject.fire({title:e.name+" isn't ready for print for one of the following reasons:",html:`<ul style="text-align: left">\n            <li>${e.agentDisplayName()} is powered off or not connected to the Internet</li>\n            <li>Printer is not connected to ${e.agentDisplayName()}</li>\n            <li>Printer is currently busy</li>\n          </ul>`})},onPrintClicked(){var e;null!==(e=this.selectedPrinter)&&void 0!==e&&e.id&&bn(this.gcode,this.selectedPrinter).then(()=>{Cn({printer:this.selectedPrinter,gcode:this.gcode,isCloud:this.isCloud,Swal:this.$swal,onCommandSent:()=>{this.isPopup&&this.$bvModal.hide("b-modal-gcodes"+this.selectedPrinter.id)},onPrinterStatusChanged:()=>{this.isPopup||yn(this.$swal,()=>this.$emit("refresh"),this.selectedPrinter.id),this.fetchPrinters()}})})}}},fo=ho,mo=(i("7f6b"),Object(E["a"])(fo,uo,po,!1,null,"434a5f54",null)),go=mo.exports,vo={name:"GCodeFilePage",components:{PageLayout:vt,RenameModal:xa,DeleteConfirmationModal:Za,availablePrinters:go,PrintHistoryItem:Si,CascadedDropdown:Kt,GCodeDetails:En},props:{isPopup:{type:Boolean,default:!1},targetPrinterId:{type:Number,default:null},onClose:{type:Function,default:null},routeParams:{type:Object,default:()=>({fileId:null,printerId:null})}},data(){return{gcode:null,printer:null,loading:!0,gcodeNotFound:!1}},computed:{isCloud(){return!this.selectedPrinterId},isDeleted(){var e;return!(null===(e=this.gcode)||void 0===e||!e.deleted)}},async created(){this.selectedPrinterId=Number(this.getRouteParam("printerId"))||null,this.selectedPrinterId&&await this.fetchPrinter(),this.gcodeId=this.getRouteParam("fileId"),this.fetchGcode()},methods:{onMenuOptionClicked(e){"renameFile"===e?this.renameFile():"deleteFile"===e&&this.deleteFile()},getRouteParam(e){return this.isPopup?this.routeParams[e]:this.$route.params[e]},goBack(){this.$emit("goBack")},async fetchPrinter(){return Q["a"].get(X["a"].printer(this.selectedPrinterId)).then(e=>{this.printer=ye(e.data)}).catch(e=>{this.errorDialog(e,"Host printer for this gcode not found")})},async fetchLocalFile(){if(!this.printerComm)return;this.loading=!0;const e=decodeURIComponent(this.gcodeId),t=e.split("/").at(-1),i=t===e?"":e.slice(0,e.length-t.length-1),s=this.printer.isAgentMoonraker()?fn:hn;s(this.printerComm,i,null).then(e=>({files:co()(te()(e,"files",[]),e=>e.filename==t)})).then(async e=>{var t;if(this.loading=!1,0===(null===e||void 0===e||null===(t=e.files)||void 0===t?void 0:t.length))return void(this.gcodeNotFound=!0);const i=null===e||void 0===e?void 0:e.files[0];if(this.gcode={...Ce(i),print_set:[]},i.path&&i.hash&&this.getRouteParam("printerId")){const e=i.path.replace(/^.*[\\/]/,"");try{let t=await Q["a"].get(X["a"].gcodeFiles(),{params:{resident_printer:this.getRouteParam("printerId"),safe_filename:e,agent_signature:"md5:"+i.hash}});const s=te()(t,"data.results[0]");if(s){const e=Ce(s);this.gcode.print_set=e.print_set}}catch(s){console.error(s)}}}).catch(e=>{this.gcodeNotFound=!0})},async fetchGcode(){var e,t;if(this.selectedPrinterId)return this.printerComm=cn.getOrCreatePrinterComm(this.selectedPrinterId,X["a"].printerWebSocket(this.selectedPrinterId)),void this.printerComm.connect(this.fetchLocalFile);this.loading=!0;const i=this.getRouteParam("fileId");let s;try{s=await Q["a"].get(X["a"].gcodeFile(i))}catch(n){this.loading=!1,console.error(n)}if(null===(e=s)||void 0===e||!e.data)return this.loading=!1,void(this.gcodeNotFound=!0);s=null===(t=s)||void 0===t?void 0:t.data,this.gcode=Ce(s),this.loading=!1},renameFile(){this.$refs.renameModal.show()},onItemRenamed(e){this.gcode.filename=e},deleteFile(){this.$refs.deleteConfirmationModal.show()},onItemDeleted(){this.isPopup?this.$emit("goBack"):window.location.replace("/g_code_folders/cloud/")},onRefresh(){this.$router.go()}}},bo=vo,_o=(i("44a9"),Object(E["a"])(bo,ao,oo,!1,null,"a72436b6",null)),Co=_o.exports,wo=function(){var e=this,t=e._self._c;return t("div",[e._m(0),t("div",[t("b-form-select",{staticClass:"form-control",attrs:{id:"connect-port"},model:{value:e.selectedPort,callback:function(t){e.selectedPort=t},expression:"selectedPort"}},e._l(e.connectionOptions.ports,(function(i){return t("b-form-select-option",{key:i,attrs:{value:i}},[e._v(" "+e._s(i)+" ")])})),1)],1),t("br"),e._m(1),t("div",[t("b-form-select",{staticClass:"form-control",attrs:{id:"connect-baudrate"},model:{value:e.selectedBaudrate,callback:function(t){e.selectedBaudrate=t},expression:"selectedBaudrate"}},[t("b-form-select-option",{attrs:{value:""}},[e._v(" Auto ")]),e._l(e.connectionOptions.baudrates,(function(i){return t("b-form-select-option",{key:i,attrs:{value:i}},[e._v(" "+e._s(i)+" ")])}))],2)],1)])},yo=[function(){var e=this,t=e._self._c;return t("div",[t("h5",[e._v("Serial Port:")])])},function(){var e=this,t=e._self._c;return t("div",[t("h5",[e._v("Baudrate:")])])}],ko={name:"ConnectPrinter",props:{connectionOptions:{type:Object,required:!0}},data(){return{selectedPort:this.connectionOptions.ports[0],selectedBaudrate:""}}},So=ko,Po=Object(E["a"])(So,wo,yo,!1,null,null,null),xo=Po.exports;const To="/pause_print/",Fo="/resume_print/",Do="/cancel_print/";var Oo={name:"PrintJobControlWidget",components:{WidgetTemplate:aa,GCodeFoldersPage:ro,GCodeFilePage:Co},props:{printer:{type:Object,required:!0},printerComm:{type:Object,required:!0},insideCard:{type:Boolean,default:!1}},data(){return{connectBtnClicked:!1,selectedGcodeId:null,savedPath:[null],printerFiles:!1}},computed:{connecting(){return this.connectBtnClicked&&this.printer.isDisconnected()},modalId(){return"b-modal-gcodes"+this.printer.id}},methods:{openObicoFiles(){this.printerFiles=!1,this.$bvModal.show(this.modalId)},openPrinterFiles(){this.printerFiles=!0,this.$bvModal.show(this.modalId)},scrollToTop(){document.querySelector("#"+this.modalId).scrollTo(0,0)},resetGcodesModal(){this.selectedGcodeId=null},onConnectClicked(){this.printerComm.passThruToPrinter({func:"get_connection_options",target:"_printer"},(e,t)=>{e?this.$swal.Toast.fire({icon:"error",title:e}):t.ports.length<1?this.$swal.Toast.fire({icon:"error",title:"Uh-Oh. No printer is found on the serial port."}):this.$swal.openModalWithComponent(xo,{connectionOptions:t},{confirmButtonText:"Connect",showCancelButton:!0,preConfirm:()=>({port:document.getElementById("connect-port").value,baudrate:document.getElementById("connect-baudrate").value})}).then(e=>{if(e.value){let t=[e.value.port,e.value.baudrate];this.printerComm.passThruToPrinter({func:"connect",target:"_printer",args:t})}})}),this.connectBtnClicked=!0,setTimeout(()=>{this.connectBtnClicked=!1},1e4)},onPauseToggled(e){this.printer.isPaused()?this.printer.alertUnacknowledged()?this.$emit("notAFailureClicked",e,!0):(this.$emit("sendPrinterAction",this.printer.id,Fo),this.printer.setTransientState("Resuming")):this.$swal.Confirm.fire({html:'If you haven\'t changed the default configuration, the heaters will be turned off, and the print head will be z-lifted. The reversed will be performed before the print is resumed. <a target="_blank" href="https://www.obico.io/docs/user-guides/detection-print-job-settings#when-print-is-paused">Learn more. <small><i class="fas fa-external-link-alt"></i></small></a>'}).then(e=>{e.value&&(this.$emit("sendPrinterAction",this.printer.id,To),this.printer.setTransientState("Pausing"))})},onCancelClicked(){this.$swal.Confirm.fire({text:"Once cancelled, the print can no longer be resumed."}).then(e=>{e.value&&(this.$emit("sendPrinterAction",this.printer.id,Do),this.printer.setTransientState("Cancelling"))})}}},Io=Oo,Ao=(i("95bd"),Object(E["a"])(Io,Xr,ea,!1,null,"b1f78d2c",null)),Mo=Ao.exports;const Eo="/resume_print/",No="/mute_current_print/?mute_alert=true",Ro="/acknowledge_alert/?alert_overwrite=NOT_FAILED",jo=!0,Lo=!1,Bo={Settings:"panel-settings",Time:"print-time",StatusTemp:"status_temp_block"};var $o={name:"PrinterCard",components:{StreamingBox:gr,FailureDetectionGauge:Es,DurationBlock:yr,StatusTemp:Er,PrintJobControlWidget:Mo},props:{printer:{type:Object,required:!0},isProAccount:{type:Boolean,required:!0}},data(){return{section_toggles:{settings:Object(a["a"])(Bo.Settings+String(this.printer.id),jo),time:Object(a["a"])(Bo.Time+String(this.printer.id),Lo),statusTemp:Object(a["a"])(Bo.StatusTemp+String(this.printer.id),jo)},webrtc:ar()}},computed:{isWatching(){return!this.printer.not_watching_reason},timeRemaining(){return this.toDuration(this.secondsLeft,this.printer.isActive())},timeTotal(){let e=null;return this.secondsPrinted&&this.secondsLeft&&(e=this.secondsPrinted+this.secondsLeft),this.toDuration(e,this.printer.isActive())},secondsLeft(){return te()(this.printer,"status.progress.printTimeLeft")},secondsPrinted(){return te()(this.printer,"status.progress.printTime")},watchForFailures(){return this.printer.watching_enabled},pauseOnFailure(){return"PAUSE"==this.printer.action_on_failure},hasCurrentPrintFilename(){return!(!this.printer.current_print||!this.printer.current_print.filename)},actionsProps(){return{printer:this.printer}},progressPct(){return te()(this.printer,"status.progress.completion")||0},tempProps(){let e=void 0!=te()(this.printer,"settings.temp_profiles");const t={};for(const[i,s]of Object.entries(te()(this.printer,"status.temperatures",{})))Boolean(s.actual)&&!isNaN(s.actual)&&(t[i]=s);return{temperatures:t,show:Object.keys(t).length>0,isPluginVersionSufficient:e}},statusText(){return this.printer.calculatedState()||"Offline"},statusClass(){return this.printer.hasError()?"text-danger":this.printer.isOffline()||this.printer.isDisconnected()||this.printer.inTransientState()?"text-warning":"text-success"}},created(){this.printerComm=cn.getOrCreatePrinterComm(this.printer.id,X["a"].printerWebSocket(this.printer.id),{onPrinterUpdateReceived:e=>{this.$emit("PrinterUpdated",this.updatedPrinter(e))},onStatusReceived:e=>{const t=e.status||e.octoprint_data;this.$emit("PrinterUpdated",this.updatedPrinter({status:t}))}}),this.printerComm.connect(),this.webrtc.openForPrinter(this.printer.id,this.printer.auth_token),this.printerComm.setWebRTC(this.webrtc)},methods:{updatedPrinter(e){return ye(e,this.printer)},settingsUrl(){return`/printers/${this.printer.id}/`},octoPrintTunnelUrl(){return`/tunnels/${this.printer.id}/`},onSettingsToggleClicked(){this.section_toggles.settings=!this.section_toggles.settings,Object(a["b"])(Bo.Settings+String(this.printer.id),this.section_toggles.settings)},onTimeToggleClicked(){this.section_toggles.time=!this.section_toggles.time,Object(a["b"])(Bo.Time+String(this.printer.id),this.section_toggles.time)},onStatusTempToggleClicked(){this.section_toggles.statusTemp=!this.section_toggles.statusTemp,Object(a["b"])(Bo.StatusTemp+String(this.printer.id),this.section_toggles.statusTemp)},onNotAFailureClicked(e,t){this.$swal.Confirm.fire({title:"Noted!",html:'<p>Do you want to mute failure detection on for this print?</p><small>If you select "Mute", failure detection will be turned off for this print, but will be automatically turned on for your next print.</small>',confirmButtonText:"Mute",cancelButtonText:"Cancel"}).then(e=>{e.isConfirmed&&setTimeout(()=>{this.sendPrinterAction(this.printer.id,No)},1e3),t?(this.printer.setTransientState("Resuming"),this.sendPrinterAction(this.printer.id,Eo)):this.sendPrinterAction(this.printer.id,Ro)}),e.preventDefault()},onWatchForFailuresToggled(){this.printer.watching_enabled=!this.printer.watching_enabled,this.updatePrinter(this.printer)},onPauseOnFailureToggled(){this.printer.action_on_failure="PAUSE"==this.printer.action_on_failure?"NONE":"PAUSE",this.updatePrinter(this.printer)},onTempEditClicked(e,t){let i,s=te()(this.printer,"settings.temp_profiles",[]),n=350;e.search(/bed|chamber/)>-1&&(n=140),i=e.search(/tool/)>-1?s.map(e=>({name:e.name,target:e["extruder"]})):s.map(t=>({name:t.name,target:t[e]})),this.$swal.openModalWithComponent(qr,{presets:i,maxTemp:n,curTarget:t.target},{title:"Set "+Object(ds["f"])(e)+" Temperature",confirmButtonText:"Confirm",showCancelButton:!0,preConfirm:()=>({target:parseInt(document.getElementById("target-temp").value)})}).then(t=>{if(t.value){let i=t.value.target;this.printerComm.passThruToPrinter({func:"set_temperature",target:"_printer",args:[e,i]})}})},updatePrinter(e){return Q["a"].patch(X["a"].printer(e.id),{watching_enabled:e.watching_enabled,action_on_failure:e.action_on_failure}).then(e=>{if(!e.data.succeeded)throw e;this.$emit("PrinterUpdated",ye(e.data.printer,this.printer))}).catch(e=>{this.errorDialog(e,"Failed to update printer")})},sendPrinterAction(e,t){Q["a"].post(X["a"].printerAction(e,t))},shouldVideoBeFull(e){let t=te()(e,"pic.img_url"),i=e.alertUnacknowledged()&&t;return!i},toDuration(e,t){if(null==e||0==e)return{valid:!1,printing:Boolean(t)};var i=L.a.duration(e,"seconds"),s=Math.floor(i.asHours()),n=i.minutes(),r=i.seconds();return{valid:!0,printing:Boolean(t),hours:s,showHours:s>0,minutes:n,showMinutes:s>0||n>0,seconds:r,showSeconds:0==s&&0==n}},onSharePrinter(){this.$swal.openModalWithComponent(Qr,{isProAccount:this.isProAccount,printer:this.printer},{confirmButtonText:"Close"})}}},Vo=$o,Uo=(i("807a"),Object(E["a"])(Vo,Yn,Kn,!1,null,"05cb99d2",null)),zo=Uo.exports;const Wo="printersSorting",Go={options:[{title:"Name",key:"name"},{title:"Created at",key:"created_at"}],default:{sorting:"created_at",direction:"desc"}},qo="printersFiltering",Ho={status:{title:"Print Status",queryParam:"status",values:[{key:"none",title:"All Printers"},{key:"online",title:"Online Printers"},{key:"active",title:"Active Printers"}],default:"none"}};var Jo={name:"PrinterListPage",components:{PrinterCard:zo,PageLayout:vt,CascadedDropdown:Kt,SortingDropdown:ni,FilteringDropdown:pi,ActiveFilterNotice:bi},data:function(){return{user:null,printers:[],loading:!0,isEnt:!1,archivedPrinterNum:0,shouldShowArchiveWarning:!1,sortingLocalStoragePrefix:Wo,sortingOptions:Go,sortingValue:ti(Wo,Go),filterLocalStoragePrefix:qo,filterOptions:Ho,filterValues:li(qo,Ho)}},computed:{dhBadgeNum(){return this.user&&this.user.is_dh_unlimited?"∞":Math.round(this.user.dh_balance)},mobileMenuOptions(){const e=[{key:"sorting",icon:"fas fa-sort-amount-down",title:"Sort",expandable:!0},{key:"filtering",icon:"fas fa-filter",title:"Filter",expandable:!0}];return this.isEnt&&e.unshift({key:"dh",svgIcon:"svg-hour-glass",title:this.dhBadgeNum+" AI Detection Hours",href:"/user_preferences/dh/"}),e},visiblePrinters(){let e=this.printers;switch(this.filterValues.status){case"online":e=e.filter(e=>!e.isDisconnected());break;case"active":e=e.filter(e=>e.isActive());break;case"none":break}return"created_at"===this.sortingValue.sorting.key?e=Ke()(e,e=>e.createdAt()):"name"===this.sortingValue.sorting.key&&(e=Ke()(e,e=>e.name)),"desc"===this.sortingValue.direction.key&&e.reverse(),e},hiddenPrinterCount(){return this.printers.length-this.visiblePrinters.length}},created(){const{IS_ENT:e}=Object(Se["e"])();this.isEnt=!!e,this.user=Object(Se["f"])(),this.fetchPrinters()},methods:{fetchPrinters(){return this.loading=!0,Q["a"].get(X["a"].printers(),{params:{with_archived:!0}}).then(e=>{const t=e.data;!Object(a["a"])("single-printer-redirect-enabled",!0)||1!=t.length||t[0].archived_at?(this.loading=!1,e.data.forEach(e=>{e.archived_at?this.archivedPrinterNum+=1:this.insertPrinter(ye(e))}),this.shouldShowArchiveWarningFunc()):window.location.href=`/printers/${t[0].id}/control/`})},insertPrinter(e){this.printers.push(e)},onPrinterUpdated(e){let t=this.printers.findIndex(t=>t.id==e.id);t<0||this.$set(this.printers,t,e)},resetGcodesModal(){this.selectedGcodeId=null,this.targetPrinter=null},onSortingUpdated(e){this.sortingValue=e},onFilterUpdated(e,t){this.filterValues[e]=t},resetFilters(){for(const e of Object.keys(this.filterValues))this.filterValues[e]="none",Object(a["b"])(`${qo}-${e}`,"none")},handleNeverShowAgain(){this.$swal.Prompt.fire({title:"Are you sure?",html:'<p style="text-align: center">You can always view your archived printers in by navigating to the General tab within Preferences.</p>',showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No"}).then(e=>{e.isConfirmed&&(localStorage.setItem("shouldNeverShowArchived",JSON.stringify(!0)),this.shouldShowArchiveWarning=!1)})},shouldShowArchiveWarningFunc(){const e=localStorage.getItem("shouldNeverShowArchived");!0===JSON.parse(e)?this.shouldShowArchiveWarning=!1:this.shouldShowArchiveWarning=this.archivedPrinterNum>0}}},Yo=Jo,Ko=(i("2ec8"),i("5b32"),Object(E["a"])(Yo,Hn,Jn,!1,null,"41f249e5",null)),Zo=Ko.exports,Qo=function(){var e=this,t=e._self._c;return t("div",[t("nav-bar",{attrs:{"view-name":"printer_shared"}}),t("div",{staticClass:"row justify-content-center"},[e.loading?t("b-spinner",{staticClass:"mt-5",attrs:{label:"Loading..."}}):e._e(),e.printer?t("div",{staticClass:"col-sm-12 col-lg-6 printer-card"},[t("div",{staticClass:"card"},[t("div",{staticClass:"card-header"},[t("div",[e._v(e._s(e.printer.name))])]),t("streaming-box",{attrs:{printer:e.printer,webrtc:e.webrtc,autoplay:!0}}),t("div",{staticClass:"p-3 p-md-5"},[t("p",{staticClass:"text-center"},[e._v(" You are viewing an awesome 3D print your friend shared specifically with you on ")]),t("a",{attrs:{href:"https://www.obico.io/"}},[t("svg",{staticClass:"logo-img",attrs:{width:"100%"}},[t("use",{attrs:{href:"#svg-logo-full"}})])]),t("hr"),t("br"),t("br"),t("p",{staticClass:"text-center"},[e._v(" Obico lets you monitor and control your printer from anywhere, on your phone. ")]),t("a",{staticClass:"btn btn-block btn-primary",attrs:{href:"/accounts/signup/"}},[e._v("Sign up for a free Obico account")])])],1)]):e._e()],1)],1)},Xo=[],el=function(){var e=this,t=e._self._c;return t("div",[e.inMobileWebView?e._e():t("b-navbar",{class:{"navbar-dark":e.theme===e.themes.Dark,"navbar-light":e.theme===e.themes.Light},attrs:{toggleable:"xl"}},[t("b-container",{staticClass:"p-0"},[t("b-navbar-brand",{attrs:{href:"/"}},[t("svg",{attrs:{width:"100",height:"30"}},[t("use",{attrs:{href:"#svg-logo-full"}})])]),t("b-navbar-toggle",{attrs:{target:"navbar-toggle-collapse"}},[t("span",{staticClass:"navbar-toggler-icon"})]),t("b-collapse",{attrs:{id:"navbar-toggle-collapse","is-nav":""},model:{value:e.showMainMenu,callback:function(t){e.showMainMenu=t},expression:"showMainMenu"}},[t("b-navbar-nav",[e.user?t("b-nav-item",{class:{active:e.viewName.includes("printers")},attrs:{href:"/printers/"}},[e._v("Printers")]):e._e(),e.user?t("b-nav-item",{class:{active:e.viewName.includes("print_history")},attrs:{href:"/print_history/"}},[e._v("Print History")]):e._e(),e.user?t("b-nav-item",{class:{active:e.viewName.includes("g_code_folders")},attrs:{href:"/g_code_folders/cloud/"}},[e._v("G-Codes")]):e._e(),e.isEnt&&!e.user?t("b-nav-item",{staticClass:"glowing",class:{active:"publictimelapse_list"===e.viewName},attrs:{href:"/ent_pub/publictimelapses/"}},[e._v("Spaghetti Gallery")]):e._e(),e.isEnt?t("b-nav-item",{class:{active:"pricing"===e.viewName},attrs:{href:"/ent_pub/pricing/"}},[e._v("Pricing")]):e._e(),t("b-nav-item",{attrs:{href:"https://www.obico.io/help/"}},[e._v("Help")]),t("b-nav-item",{attrs:{href:"https://obico.io/discord"}},[e._v("Community")])],1),t("b-navbar-nav",{staticClass:"ml-auto"},[e.user?e._e():t("b-nav-item",{attrs:{href:"/accounts/login/"}},[e._v("SIGN IN")]),!e.user&&e.allowSignUp?t("b-nav-item",{attrs:{href:"/accounts/signup/"}},[e._v("SIGN UP")]):e._e(),e.user?t("b-nav-item-dropdown",{ref:"accountDropdown",attrs:{right:"","toggle-class":"user-menu",text:e.user.first_name||e.user.email}},[t("b-dropdown-item",{attrs:{href:"/user_preferences/"}},[t("i",{staticClass:"fas fa-cog mr-2"}),e._v("Preferences ")]),t("b-dropdown-divider"),t("b-dropdown-item",{attrs:{href:"/accounts/logout/"}},[t("i",{staticClass:"fas fa-sign-out-alt mr-2"}),e._v("Log out ")])],1):e._e()],1)],1)],1)],1)],1)},tl=[],il={name:"NavBar",components:{},props:{viewName:{default(){return""},type:String}},data(){return{user:null,allowSignUp:!1,isEnt:!1,themes:Os["a"],showMainMenu:!1}},computed:{inMobileWebView(){return Object(Se["a"])()},theme(){return Object(P["a"])()}},created(){const{ACCOUNT_ALLOW_SIGN_UP:e,IS_ENT:t}=Object(Se["e"])();this.allowSignUp=!!e,this.isEnt=!!t,this.user=Object(Se["f"])()},methods:{hideDropdowns(){this.showMainMenu=!1;const e=this.$refs.accountDropdown;e&&e.hide()}}},sl=il,nl=(i("e8c1"),Object(E["a"])(sl,el,tl,!1,null,"0b681d89",null)),rl=nl.exports,al={name:"SharedPrinterPage",components:{StreamingBox:gr,NavBar:rl},data:function(){return{printer:null,shareToken:null,videoAvailable:{},loading:!0,isWebrtcOpened:!1,webrtc:ar()}},created(){this.shareToken=Ue()(window.location.pathname,"/").slice(-2,-1).pop(),this.printerComm=cn.getOrCreatePrinterComm(this.shareToken,X["a"].printerSharedWebSocket(this.shareToken),{onPrinterUpdateReceived:e=>{this.printer=ye(e,this.printer),this.loading=!1,this.isWebrtcOpened||(this.webrtc.openForShareToken(this.shareToken),this.isWebrtcOpened=!0)}}),this.printerComm.connect()}},ol=al,ll=(i("740f"),Object(E["a"])(ol,Qo,Xo,!1,null,"8b3b89ae",null)),cl=ll.exports,dl=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[t("b-container",[t("b-row",{staticClass:"justify-content-center"},[t("b-col",{attrs:{lg:"8"}},[e.printer?t("div",{staticClass:"surface with-loading-animation full-on-mobile"},[t("section",{staticClass:"settings"},[t("h2",{staticClass:"section-title"},[e._v("Settings")]),t("div",{staticClass:"form-group mb-4 mt-4"},[t("div",{staticClass:"form-label text-muted mb-2"},[e._v("Give your shiny new printer a name")]),t("saving-animation",{attrs:{errors:e.errorMessages.name,saving:e.saving.name}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.name,expression:"printer.name"}],staticClass:"form-control field_required",attrs:{id:"id_name",type:"text",name:"name",maxlength:"200",placeholder:"",required:"required"},domProps:{value:e.printer.name},on:{input:function(t){t.target.composing||e.$set(e.printer,"name",t.target.value)}}})])],1),t("div",{staticClass:"failure-notification"},[t("div",{staticClass:"form-group mt-4 mb-4"},[t("div",{staticClass:"form-label text-muted"},[e._v("When a potential failure is detected:")]),t("saving-animation",{attrs:{errors:e.errorMessages.action_on_failure_NONE,saving:e.saving.action_on_failure_NONE}},[t("div",{staticClass:"custom-control custom-radio mt-1 radio"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.action_on_failure,expression:"printer.action_on_failure"}],staticClass:"custom-control-input field_required",attrs:{id:"id_action_on_failure_0",type:"radio",name:"action_on_failure",value:"NONE"},domProps:{checked:e._q(e.printer.action_on_failure,"NONE")},on:{change:[function(t){return e.$set(e.printer,"action_on_failure","NONE")},function(t){return e.updateSetting("action_on_failure")}]}}),t("label",{staticClass:"custom-control-label",attrs:{for:"id_action_on_failure_0"}},[e._v("Just notify me")])])]),t("saving-animation",{attrs:{errors:e.errorMessages.action_on_failure_PAUSE,saving:e.saving.action_on_failure_PAUSE}},[t("div",{staticClass:"custom-control custom-radio mt-1 radio",attrs:{id:"action_on_failure_PAUSE"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.action_on_failure,expression:"printer.action_on_failure"}],staticClass:"custom-control-input field_required",attrs:{id:"id_action_on_failure_1",type:"radio",name:"action_on_failure",value:"PAUSE"},domProps:{checked:e._q(e.printer.action_on_failure,"PAUSE")},on:{change:[function(t){return e.$set(e.printer,"action_on_failure","PAUSE")},function(t){return e.updateSetting("action_on_failure")}]}}),t("label",{staticClass:"custom-control-label",attrs:{for:"id_action_on_failure_1"}},[e._v("Pause the printer and notify me")])])])],1)])]),t("section",{staticClass:"mt-5"},[t("h2",{staticClass:"section-title"},[e._v("Failure Detection")]),t("div",{staticClass:"card-body p-0 pt-3"},[t("p",{staticClass:"text-warning"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" If you are not sure about the settings below, leave the default values to minimize surprises. ")]),t("div",{staticClass:"form-group mt-4"},[t("div",{staticClass:"form-label text-muted"},[e._v("When print is paused,")]),t("saving-animation",{attrs:{errors:e.errorMessages.tools_off_on_pause,saving:e.saving.tools_off_on_pause}},[t("div",{staticClass:"custom-control custom-checkbox mt-2 checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.tools_off_on_pause,expression:"printer.tools_off_on_pause"}],staticClass:"custom-control-input",attrs:{id:"id_tools_off_on_pause",type:"checkbox",name:"tools_off_on_pause"},domProps:{checked:Array.isArray(e.printer.tools_off_on_pause)?e._i(e.printer.tools_off_on_pause,null)>-1:e.printer.tools_off_on_pause},on:{change:[function(t){var i=e.printer.tools_off_on_pause,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,a=e._i(i,r);s.checked?a<0&&e.$set(e.printer,"tools_off_on_pause",i.concat([r])):a>-1&&e.$set(e.printer,"tools_off_on_pause",i.slice(0,a).concat(i.slice(a+1)))}else e.$set(e.printer,"tools_off_on_pause",n)},function(t){return e.updateSetting("tools_off_on_pause")}]}}),t("label",{staticClass:"custom-control-label",attrs:{for:"id_tools_off_on_pause"}},[e._v(" Turn off hotend heater(s) ")])])]),t("saving-animation",{attrs:{errors:e.errorMessages.bed_off_on_pause,saving:e.saving.bed_off_on_pause}},[t("div",{staticClass:"custom-control custom-checkbox mt-2 checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.bed_off_on_pause,expression:"printer.bed_off_on_pause"}],staticClass:"custom-control-input",attrs:{id:"id_bed_off_on_pause",type:"checkbox",name:"bed_off_on_pause"},domProps:{checked:Array.isArray(e.printer.bed_off_on_pause)?e._i(e.printer.bed_off_on_pause,null)>-1:e.printer.bed_off_on_pause},on:{change:[function(t){var i=e.printer.bed_off_on_pause,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,a=e._i(i,r);s.checked?a<0&&e.$set(e.printer,"bed_off_on_pause",i.concat([r])):a>-1&&e.$set(e.printer,"bed_off_on_pause",i.slice(0,a).concat(i.slice(a+1)))}else e.$set(e.printer,"bed_off_on_pause",n)},function(t){return e.updateSetting("bed_off_on_pause")}]}}),t("label",{staticClass:"custom-control-label",attrs:{for:"id_bed_off_on_pause"}},[e._v(" Turn off bed heater ")])])]),t("saving-animation",{staticClass:"mobile-full-width",attrs:{errors:e.errorMessages.retract_on_pause,saving:e.saving.retract_on_pause}},[t("div",{staticClass:"form-inline my-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.retractFilamentByEnabled,expression:"retractFilamentByEnabled"}],staticClass:"custom-control-input",attrs:{id:"retract-checkbox",type:"checkbox"},domProps:{checked:Array.isArray(e.retractFilamentByEnabled)?e._i(e.retractFilamentByEnabled,null)>-1:e.retractFilamentByEnabled},on:{change:function(t){var i=e.retractFilamentByEnabled,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,a=e._i(i,r);s.checked?a<0&&(e.retractFilamentByEnabled=i.concat([r])):a>-1&&(e.retractFilamentByEnabled=i.slice(0,a).concat(i.slice(a+1)))}else e.retractFilamentByEnabled=n}}}),t("label",{staticClass:"custom-control-label",attrs:{for:"retract-checkbox"}},[e._v("Retract filament by")])]),t("number-input",{staticClass:"wrappable-field",attrs:{step:.5,disable:!e.retractFilamentByEnabled},model:{value:e.retractOnPause,callback:function(t){e.retractOnPause=t},expression:"retractOnPause"}})],1)]),t("saving-animation",{staticClass:"mobile-full-width",attrs:{errors:e.errorMessages.lift_z_on_pause,saving:e.saving.lift_z_on_pause}},[t("div",{staticClass:"form-inline my-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.liftExtruderByEnabled,expression:"liftExtruderByEnabled"}],staticClass:"custom-control-input",attrs:{id:"lift-z-checkbox",type:"checkbox"},domProps:{checked:Array.isArray(e.liftExtruderByEnabled)?e._i(e.liftExtruderByEnabled,null)>-1:e.liftExtruderByEnabled},on:{change:function(t){var i=e.liftExtruderByEnabled,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,a=e._i(i,r);s.checked?a<0&&(e.liftExtruderByEnabled=i.concat([r])):a>-1&&(e.liftExtruderByEnabled=i.slice(0,a).concat(i.slice(a+1)))}else e.liftExtruderByEnabled=n}}}),t("label",{staticClass:"custom-control-label",attrs:{for:"lift-z-checkbox"}},[e._v("Lift extruder along Z axis by")])]),t("number-input",{staticClass:"wrappable-field",attrs:{step:.5,disable:!e.liftExtruderByEnabled},model:{value:e.liftExtruderBy,callback:function(t){e.liftExtruderBy=t},expression:"liftExtruderBy"}})],1)])],1),t("div",{staticClass:"form-group sensitivity my-4"},[t("div",{staticClass:"form-label text-muted"},[e._v("AI failure detection sensitivity")]),t("saving-animation",{attrs:{errors:e.errorMessages.detective_sensitivity,saving:e.saving.detective_sensitivity}},[t("div",{staticClass:"my-2 sensitivity-slider"},[t("vue-slider",{attrs:{lazy:!0,min:.8,max:1.2,interval:.05,"tooltip-formatter":e.sensitivityTooltipFormatter},model:{value:e.detectiveSensitivity,callback:function(t){e.detectiveSensitivity=t},expression:"detectiveSensitivity"}})],1)]),"Low"===e.sensitivityTooltipFormatter(e.printer.detective_sensitivity)?t("div",[e._v(" Low - I don't want a lot of false alarms. Only alert me when you are absolutely sure. ")]):"Medium"===e.sensitivityTooltipFormatter(e.printer.detective_sensitivity)?t("div",[e._v(" Medium - A few false alarms won't bother me. But some well-disguised spaghetti will be missed. ")]):t("div",[e._v(" High - Hit me with all the false alarms. I want to catch as many failures as possible. ")])],1)])]),t("section",{staticClass:"mt-5"},[t("h2",{staticClass:"section-title"},[e._v("Time-lapse")]),e.timelapseOnFinishEnabled&&e.timelapseOnCancelEnabled?e._e():t("p",{staticClass:"text-warning"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" Focused Feedback won't be available when time-lapse recording is turned off. You won't be able to "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work/"}},[e._v("help us get better while earning AI Detection Hours for yourself")]),e._v(". ")]),t("div",{staticClass:"form-group mt-4"},[t("saving-animation",{staticClass:"mobile-full-width",attrs:{errors:e.errorMessages.min_timelapse_secs_on_finish,saving:e.saving.min_timelapse_secs_on_finish}},[t("div",{staticClass:"form-inline my-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.timelapseOnFinishEnabled,expression:"timelapseOnFinishEnabled"}],staticClass:"custom-control-input",attrs:{id:"timelapseOnFinishEnabled",type:"checkbox"},domProps:{checked:Array.isArray(e.timelapseOnFinishEnabled)?e._i(e.timelapseOnFinishEnabled,null)>-1:e.timelapseOnFinishEnabled},on:{change:function(t){var i=e.timelapseOnFinishEnabled,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,a=e._i(i,r);s.checked?a<0&&(e.timelapseOnFinishEnabled=i.concat([r])):a>-1&&(e.timelapseOnFinishEnabled=i.slice(0,a).concat(i.slice(a+1)))}else e.timelapseOnFinishEnabled=n}}}),t("label",{staticClass:"custom-control-label",attrs:{for:"timelapseOnFinishEnabled"}},[e._v("Record time-lapse when a print finishes successfully.")])])]),e.timelapseOnFinishEnabled?t("div",{staticClass:"form-inline my-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[e._v(" Skip if the print is finished in less than ")]),t("number-input",{staticClass:"wrappable-field",attrs:{step:5,unit:"minutes"},model:{value:e.minTimelapseMinutesOnFinish,callback:function(t){e.minTimelapseMinutesOnFinish=t},expression:"minTimelapseMinutesOnFinish"}})],1):e._e()]),t("saving-animation",{staticClass:"mobile-full-width",attrs:{errors:e.errorMessages.min_timelapse_secs_on_cancel,saving:e.saving.min_timelapse_secs_on_cancel}},[t("div",{staticClass:"form-inline mt-3 mb-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.timelapseOnCancelEnabled,expression:"timelapseOnCancelEnabled"}],staticClass:"custom-control-input",attrs:{id:"timelapseOnCancelEnabled",type:"checkbox"},domProps:{checked:Array.isArray(e.timelapseOnCancelEnabled)?e._i(e.timelapseOnCancelEnabled,null)>-1:e.timelapseOnCancelEnabled},on:{change:function(t){var i=e.timelapseOnCancelEnabled,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,a=e._i(i,r);s.checked?a<0&&(e.timelapseOnCancelEnabled=i.concat([r])):a>-1&&(e.timelapseOnCancelEnabled=i.slice(0,a).concat(i.slice(a+1)))}else e.timelapseOnCancelEnabled=n}}}),t("label",{staticClass:"custom-control-label",attrs:{for:"timelapseOnCancelEnabled"}},[e._v("Record time-lapse when a print is cancelled.")])])]),e.timelapseOnCancelEnabled?t("div",{staticClass:"form-inline my-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[e._v(" Skip if the print is cancelled in less than ")]),t("number-input",{staticClass:"wrappable-field",attrs:{step:5,unit:"minutes"},model:{value:e.minTimelapseMinutesOnCancel,callback:function(t){e.minTimelapseMinutesOnCancel=t},expression:"minTimelapseMinutesOnCancel"}})],1):e._e()])],1)]),t("section",{staticClass:"danger mt-5"},[t("h2",{staticClass:"section-title"},[e._v("Danger Zone")]),t("div",{staticClass:"mt-4"},[t("a",{staticClass:"btn btn-outline-secondary",attrs:{href:e.printerWizardUrl}},[e._v(" Re-Link Printer ")]),t("div",{staticClass:"text-muted mt-1"},[t("small",[e._v('If your printer is always showing as "offline", and you have gone through '),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/troubleshoot-server-connection-issues/"}},[e._v("all the trouble-shooting steps")]),e._v(", you can try to re-link printer as the last resort.")])])]),e.isEnt?t("div",{staticClass:"mt-4"},[t("button",{staticClass:"btn btn-outline-warning",on:{click:e.archivePrinter}},[e._v(" Archive Printer ")]),t("div",{staticClass:"text-muted mt-1"},[t("small",[e._v("Archived printers are not counted toward your subscription plan. You won't see them in the app either. Go to "),t("a",{attrs:{href:"/ent/printers/archived/"}},[e._v("this page")]),e._v(" to find all archived printers and/or un-archive them.")])])]):e._e(),t("div",{staticClass:"mt-4"},[t("button",{staticClass:"btn btn-outline-danger",on:{click:e.deletePrinter}},[e._v(" Delete Printer ")]),t("div",{staticClass:"text-muted mt-1"},[t("small",[e._v("Bye-bye printer.")])])])])]):t("loading-placeholder")],1)],1)],1)]},proxy:!0}])})},ul=[],pl=i("4971"),hl=i.n(pl),fl=i("847e"),ml=function(){var e=this,t=e._self._c;return t("div",{staticClass:"input-group input-group-sm input-wrapper"},[t("div",{staticClass:"input-group-prepend"},[t("button",{staticClass:"btn btn-outline-secondary control-button",attrs:{type:"button",disabled:e.disable},on:{click:function(t){e.inputValue=e.inputValue>0?Math.round(10*(e.inputValue-e.step))/10:0,e.$emit("input",e.inputValue)}}},[e._v(" ↓ ")])]),t("input",{staticClass:"form-control text-center field_required",style:{opacity:e.disable?.3:1},attrs:{type:"text",disabled:"","aria-describedby":"basic-addon1"},domProps:{value:e.inputValue+" "+e.unit}}),t("div",{staticClass:"input-group-append"},[t("button",{staticClass:"btn btn-outline-secondary control-button",attrs:{type:"button",disabled:e.disable},on:{click:function(t){e.inputValue=Math.round(10*(e.inputValue+e.step))/10,e.$emit("input",e.inputValue)}}},[e._v(" ↑ ")])])])},gl=[],vl={name:"NumberInput",props:{value:{type:Number,default:0},step:{type:Number,default:.5},disable:{type:Boolean,default:!1},unit:{type:String,default:"mm"}},data(){return{inputValue:this.value}},watch:{value(e){this.inputValue=e}}},bl=vl,_l=(i("587d"),Object(E["a"])(bl,ml,gl,!1,null,"66233dc0",null)),Cl=_l.exports,wl={components:{SavingAnimation:fl["a"],NumberInput:Cl,PageLayout:vt,VueSlider:hl.a},data(){return{isEnt:!1,printer:null,printerId:"",saving:{},errorMessages:{},delayedSubmit:{name:{delay:1e3,timeoutId:null},retract_on_pause:{delay:1e3,timeoutId:null},lift_z_on_pause:{delay:1e3,timeoutId:null},min_timelapse_secs_on_finish:{delay:1e3,timeoutId:null},min_timelapse_secs_on_cancel:{delay:1e3,timeoutId:null}}}},computed:{retractFilamentByEnabled:{get(){return this.printer.retract_on_pause>0},set(e){this.printer.retract_on_pause=e?6.5:0}},retractOnPause:{get(){return this.printer?this.printer.retract_on_pause:void 0},set(e){this.printer&&(this.printer.retract_on_pause=e)}},liftExtruderByEnabled:{get(){return this.printer.lift_z_on_pause>0},set(e){this.printer.lift_z_on_pause=e?2.5:0}},liftExtruderBy:{get(){return this.printer?this.printer.lift_z_on_pause:void 0},set(e){this.printer&&(this.printer.lift_z_on_pause=e)}},timelapseOnFinishEnabled:{get(){return this.printer.min_timelapse_secs_on_finish>=0},set(e){this.printer.min_timelapse_secs_on_finish=e?600:-1}},minTimelapseMinutesOnFinish:{get(){return this.printer?this.printer.min_timelapse_secs_on_finish/60:void 0},set(e){this.printer&&(this.printer.min_timelapse_secs_on_finish=60*e)}},timelapseOnCancelEnabled:{get(){return this.printer.min_timelapse_secs_on_cancel>=0},set(e){this.printer.min_timelapse_secs_on_cancel=e?300:-1}},minTimelapseMinutesOnCancel:{get(){return this.printer?this.printer.min_timelapse_secs_on_cancel/60:void 0},set(e){this.printer&&(this.printer.min_timelapse_secs_on_cancel=60*e)}},printerWizardUrl(){return X["a"].printerWizard(this.printer.id)},printerName:{get:function(){return this.printer?this.printer.name:void 0},set:function(e){this.printer.name=e}},detectiveSensitivity:{get(){return this.printer.detective_sensitivity},set(e){this.printer.detective_sensitivity=e,this.updateSetting("detective_sensitivity")}}},watch:{printerName:function(e,t){void 0!==t&&this.updateSetting("name")},retractOnPause:function(e,t){void 0!==t&&this.changeRetractOnPause(e)},liftExtruderBy:function(e,t){void 0!==t&&this.changeLiftExtruderBy(e)},minTimelapseMinutesOnFinish:function(e,t){void 0!==t&&this.updateSetting("min_timelapse_secs_on_finish")},minTimelapseMinutesOnCancel:function(e,t){void 0!==t&&this.updateSetting("min_timelapse_secs_on_cancel")}},created(){const{IS_ENT:e}=Object(Se["e"])();this.isEnt=!!e,this.printerId=Ue()(window.location.pathname,"/").slice(-2,-1).pop(),this.fetchPrinter()},methods:{fetchPrinter(){return Q["a"].get(X["a"].printer(this.printerId)).then(e=>{this.printer=ye(e.data,this.printer)}).catch(e=>{this.errorDialog(e,"Printer not found")})},patchPrinter(e,t){const i=this.getSettingsItemInput(e,t);return this.setSavingStatus(i,!0),Q["a"].patch(X["a"].printer(this.printerId),{[e]:t}).catch(e=>{if(e.response&&e.response.data&&"object"===typeof e.response.data)if(e.response.data.non_field_errors)this.errorAlert(e.response.data.non_field_errors);else for(const t in e.response.data)this.errorMessages[i]=e.response.data[t];else this.errorAlert()}).then(()=>{this.setSavingStatus(i,!1)})},errorAlert(){this.$swal.Toast.fire({icon:"error",html:'<div>Can not update printer settings.</div><div>Get help from <a href="https://obico.io/discord">the Obico app discussion forum</a> if this error persists.</div>'})},updateSetting(e){if(e in this.delayedSubmit){const t=this.delayedSubmit[e];return t["timeoutId"]&&clearTimeout(t["timeoutId"]),void(this.delayedSubmit[e]["timeoutId"]=setTimeout(()=>{this.patchPrinter(e,this.printer[e])},t["delay"]))}this.patchPrinter(e,this.printer[e])},sensitivityTooltipFormatter:function(e){return e<.95?"Low":e>1.05?"High":"Medium"},deletePrinter(e){this.$swal.Prompt.fire({title:"Are you sure?",text:`Delete ${this.printer.name} printer? This action can not be undone.`,showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No"}).then(e=>{e.isConfirmed&&Q["a"].delete(X["a"].printer(this.printerId)+"?with_archived=true").then(()=>{window.location.href="/printers/"})})},archivePrinter(){this.$swal.Confirm.fire().then(e=>{e.isConfirmed&&Q["a"].post(X["a"].printerAction(this.printerId,"/archive/")).then(()=>{this.$swal.Prompt.fire({title:"Printer archived",html:`<p>${this.printer.name} is archived.</p><p>You can find it on <a href="/ent/printers/archived/">this page</a> and un-archive it.</p>`,confirmButtonText:"Go to the printer page"}).then(()=>{window.location.href="/printers/"})})})},getSettingsItemInput:function(e,t=""){switch(e){case"action_on_failure":return`${e}_${t}`;default:return""+e}},setSavingStatus(e,t){t&&delete this.errorMessages[e],this.$set(this.saving,e,t)},changeRetractOnPause(e){this.printer.retract_on_pause=e,this.updateSetting("retract_on_pause")},changeLiftExtruderBy(e){this.printer.lift_z_on_pause=e,this.updateSetting("lift_z_on_pause")}}},yl=wl,kl=(i("bd96"),Object(E["a"])(yl,dl,ul,!1,null,"6721b34d",null)),Sl=kl.exports,Pl=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[t("b-container",[t("b-row",[t("b-col",[t("div",{staticClass:"wizard-container form-container full-on-mobile"},[e.verifiedPrinter?t("div",{staticClass:"text-center py-5"},[t("svg",{staticClass:"success-checkmark"},[t("use",{attrs:{href:"#svg-success-checkmark"}})]),t("h3",{staticClass:"pb-4"},[e._v("Successfully linked to your account!")]),t("div",{staticClass:"col-sm-12 col-md-8 offset-md-2 col-lg-6 offset-lg-3 d-flex flex-column align-center justify-content-center"},[t("saving-animation",{attrs:{errors:e.errorMessages.printer_name,saving:e.saving.printer_name}},[t("div",{staticClass:"printer-name-input"},[t("div",{staticClass:"edit-icon"},[t("i",{staticClass:"fas fa-pen"})]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.verifiedPrinter.name,expression:"verifiedPrinter.name"}],staticClass:"dark",attrs:{type:"text",placeholder:"Printer name"},domProps:{value:e.verifiedPrinter.name},on:{input:[function(t){t.target.composing||e.$set(e.verifiedPrinter,"name",t.target.value)},e.updatePrinterName]}})])]),t("div",[t("div",{staticClass:"text-muted mx-auto text-center font-weight-light"},[e._v(" Give your printer a shiny name. ")])])],1),t("br"),t("br"),t("div",{staticClass:"col-sm-12 col-md-8 offset-md-2 col-lg-6 offset-lg-3 d-flex flex-column align-center justify-content-center"},[e.redirectToTunnelCreation?t("div",{staticClass:"mt-4"},[t("a",{staticClass:"btn btn-primary btn-block mx-auto btn-lg",attrs:{href:e.redirectToTunnelCreation}},[e._v("Authorize App Access")])]):t("div",[t("div",{staticClass:"mt-4"},[t("a",{staticClass:"btn btn-primary btn-block mx-auto btn-lg",attrs:{href:"/printers/"}},[e._v("Go Check Out Printer Feed!")])]),t("div",{staticClass:"mt-5"},[t("a",{staticClass:"btn btn-outline-secondary btn-block mx-auto",attrs:{href:"/user_preferences/notification_twilio/"}},[e._v("Add Phone Number")])]),t("div",[t("div",{staticClass:"text-muted mx-auto text-center font-weight-light"},[e._v(" Receive text (SMS) in case of print failures. ")])]),t("div",{staticClass:"mt-4"},[t("a",{staticClass:"btn btn-outline-secondary btn-block mx-auto",attrs:{href:e.editPrinterUrl}},[e._v("Change Printer Settings")])]),t("div",[t("div",{staticClass:"text-muted mx-auto text-center font-weight-light"},[e._v(" You can always change it later. ")])])])])]):t("div",[e.$route.path===e.routes.printerWizardSetup?t("div",[t("form-wizard",{attrs:{color:"var(--color-primary)","step-size":"sm"},scopedSlots:e._u([{key:"footer",fn:function(i){return[t("div",{staticClass:"wizard-footer-left"},[i.activeTabIndex>0?t("wizard-button",{staticClass:"btn btn-link btn-back",nativeOn:{click:function(t){i.prevTab(),e.prevTab(i.activeTabIndex)}}},[e._v("< Back")]):e._e()],1),t("div",{staticClass:"wizard-footer-right"},[i.isLastStep?e._e():t("wizard-button",{staticClass:"wizard-footer-right wizard-btn",style:{...i.fillButtonStyle,color:"var(--color-on-primary)"},nativeOn:{click:function(t){i.nextTab(),e.nextTab(i.activeTabIndex)}}},[e._v("Next >")])],1)]}}],null,!1,2853193433)},[t("h3",{attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.title)+" ")]),e.targetMoonraker?t("tab-content",{attrs:{title:"Install Obico for Klipper"}},[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center pb-3"},[t("div",{staticClass:"col-sm-12 col-lg-8"},[t("ol",[t("li",[e._v("SSH to the Raspberry Pi your Klipper runs on.")]),t("li",[t("div",[e._v("Run:")]),t("pre",{staticClass:"mt-2"},[e._v("cd ~\ngit clone https://github.com/TheSpaghettiDetective/moonraker-obico.git\ncd moonraker-obico\n./install.sh\n                              ")])]),t("li",[e._v("Follow the installation steps.")]),t("li",[e._v(" At the end, you will be asked to enter a 6-digit verification code. ")])])])])])]):e._e(),e.printerIdToLink&&e.targetOctoPrint?t("tab-content",{attrs:{title:"Open Plugin Settings"}},[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center pb-3"},[t("div",{staticClass:"col-sm-12 col-lg-8"},[t("div",{staticClass:"text-warning"},[e._v(" Warning: Re-Linking OctoPrint should be your last resort to solve issues. Please make sure you have exhausted all options on "),t("a",{attrs:{href:"https://www.obico.io/help/"}},[e._v("Obico's help website")]),e._v(". ")]),t("ol",[t("li",[e._v("Open OctoPrint in another browser tab.")]),t("li",[e._v(" Select "),t("em",[e._v('"OctoPrint settings menu → Obico for OctoPrint"')]),e._v(". ")]),t("li",[e._v("Select "),t("em",[e._v('"Troubleshooting → Re-run Wizard"')]),e._v(".")])])])]),t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[t("img",{staticClass:"mx-auto",attrs:{src:i("b231")}})])])])]):e._e(),!e.printerIdToLink&&e.targetOctoPrint?t("tab-content",{attrs:{title:"Install Plugin"}},[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center pb-3"},[t("div",{staticClass:"col-sm-12 col-lg-8"},[t("ol",[t("li",[e._v("Open OctoPrint in another browser tab.")]),t("li",[e._v(" Select "),t("em",[e._v('"OctoPrint settings menu → Plugin Manager → Get More..."')]),e._v(". ")]),t("li",[e._v('Enter "Obico" to locate the plugin. Click '),t("em",[e._v('"Install"')]),e._v(".")]),t("li",[e._v("Restart OctoPrint when prompted.")])])])]),t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[t("img",{staticClass:"mx-auto screenshot",attrs:{src:i("2814")},on:{click:function(t){return e.zoomIn(t)}}})])])])]):e._e(),e.discoveryEnabled?[e.targetOctoPrint?t("tab-content",{attrs:{title:"Link It!"}},[t("loading",{attrs:{active:null!=e.chosenDeviceId,"can-cancel":!1}}),t("div",{staticClass:"discover"},[t("div",{staticClass:"discover-body"},[e.canStartLinking?t("div",[t("div",{staticClass:"lead my-3"},[t("div",{staticClass:"spinner-border",attrs:{role:"status"}},[t("span",{staticClass:"sr-only"})]),t("span",{staticClass:"sr-only"}),e._v("Scanning..., "+e._s(e.discoveredPrinters.length)+" OctoPrint(s) found on your local network: ")]),e._l(e.discoveredPrinters,(function(i){return t("discovered-printer",{key:i.device_id,attrs:{"discovered-printer":i},on:{"auto-link-printer":e.autoLinkPrinter}})}))],2):t("div",{staticStyle:{"text-align":"center"}},[t("div",{staticClass:"spinner-border big",attrs:{role:"status"}},[t("span",{staticClass:"sr-only"})]),t("div",{staticClass:"lead"},[e._v("Scanning...")])]),t("div",{staticClass:"mt-5 mb-3"},[e._v(" Can't find the OctoPrint you want to link? Switch to "),t("a",{staticClass:"link",on:{click:function(t){e.discoveryEnabled=!1}}},[e._v("Manual Setup")]),e._v(" instead. ")]),e.discoveryCount>=2?t("div",{staticClass:"text-muted"},[t("div",[e._v("To link your OctoPrint, please make sure:")]),t("ul",[t("li",[e._v("The Raspberry Pi is powered on.")]),t("li",[e._v(" The Raspberry Pi is connected to the same local network as your phone/computer. ")]),t("li",[e._v("The Obico plugin version is 1.8.0 or above.")])])]):e._e()])])],1):e._e()]:[e.targetOctoPrint?t("tab-content",{attrs:{title:"Plugin Wizard"}},[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center pb-3"},[t("div",{staticClass:"col-sm-12 col-lg-8"},[t("ol",[t("li",[e._v("Wait for "),t("em",[e._v('"Obico for OctoPrint"')]),e._v(" wizard to popup.")]),t("li",[e._v("Follow the instructions in the wizard.")]),t("li",[e._v("Select "),t("em",[e._v('"Web Setup"')]),e._v(" when asked.")])])])]),t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[t("img",{staticClass:"mx-auto screenshot",attrs:{src:i("4e03")},on:{click:function(t){return e.zoomIn(t)}}})])])])]):e._e(),t("tab-content",{attrs:{title:"Enter Code"}},[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center pb-3"},[t("div",{staticClass:"col-sm-12 col-lg-8 d-flex flex-column align-items-center"},[t("input",{ref:"code",staticClass:"code-btn",attrs:{disabled:""},domProps:{value:""+(e.verificationCode&&e.verificationCode.code)}}),t("small",{staticClass:"mx-auto py-1",class:{"text-muted":!e.copied}},[e._v(e._s(e.copied?"Code copied to system clipboard":"Ctrl-C/Cmd-C to copy the code"))]),t("div",{staticClass:"mx-auto pt-1 pb-4"},[t("span",{staticClass:"text-muted"},[e._v("Code will expire in ")]),e._v(e._s(e.timeToExpire)+" ")]),t("div",{staticClass:"lead"},[e._v(" Enter the "),t("strong",[e._v("6-digit verification code")])])])]),t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[e.targetOctoPrint?t("img",{staticClass:"screenshot",attrs:{src:i("f1f6")},on:{click:function(t){return e.zoomIn(t)}}}):e._e(),e.targetMoonraker?t("img",{staticClass:"screenshot",attrs:{src:i("1c3a")},on:{click:function(t){return e.zoomIn(t)}}}):e._e(),t("div",{staticClass:"helper mx-auto py-2"},[t("a",{staticClass:"link font-weight-bold",on:{click:e.showVerificationCodeHelpModal}},[e._v("Can't find the page to enter the 6-digit code?")])])])])])])]],2),t("div",{staticClass:"row"},[t("div",{staticClass:"helper col-sm-12"},[e._v(" Need help? Check out the "),t("a",{attrs:{target:"_blank",href:e.targetMoonraker?"https://www.obico.io/docs/user-guides/klipper-setup/":"https://www.obico.io/docs/user-guides/octoprint-plugin-setup/"}},[e._v("step-by-step set up guide.")])])])],1):t("div",{staticClass:"container"},[t("div",{staticClass:"row"},[t("h3",{staticClass:"col-sm-12 text-center p-3"},[e._v("Which platform are you using?")])]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-12 col-lg-6 p-4"},[t("div",{staticClass:"wizard-card",on:{click:function(t){return e.setTargetPlatform("octoprint")}}},[t("img",{attrs:{src:i("2e7f")}}),t("h3",{staticClass:"mt-4"},[e._v("OctoPrint")]),t("div",[e._v("Including OctoPrint for Klipper such as OctoKlipper.")])])]),t("div",{staticClass:"col-sm-12 col-lg-6 p-4"},[t("div",{staticClass:"wizard-card",on:{click:function(t){return e.setTargetPlatform("moonraker")}}},[t("div",[t("img",{attrs:{src:i("886f")}}),t("img",{attrs:{src:i("1f6a")}}),t("img",{attrs:{src:i("a085")}})]),t("h3",{staticClass:"mt-4"},[e._v("Klipper")]),t("h5",[e._v("with Mainsail/Fluidd/Moonraker")])])])])])])])])],1)],1)]},proxy:!0}])})},xl=[],Tl=i("ccf6"),Fl=i("2ee4"),Dl=(i("da93"),i("767e")),Ol=i.n(Dl),Il=function(){var e=this,t=e._self._c;return t("div",{staticClass:"discovered-printers mt-4"},[t("div",{staticClass:"flex-grow-0 pt-1 mr-2"},[e.discoveredPrinter.rpi_model?t("img",{staticClass:"logo-img",attrs:{src:i("9605")}}):t("img",{staticClass:"logo-img",attrs:{src:i("2e7f")}})]),t("div",{staticClass:"row flex-grow-1 ml-1 link-action"},[t("div",{staticClass:"col-sm-12 col-md-10 pb-2"},[e.discoveredPrinter.rpi_model?t("div",[e._v(" "+e._s(e.discoveredPrinter.rpi_model)+" ")]):e._e(),e.discoveredPrinter.machine_type?t("div",[e._v(" "+e._s(e.discoveredPrinter.machine_type)+" ")]):e._e(),e.discoveredPrinter.agent?t("div",{staticClass:"text-muted small"},[e._v(" Platform: "+e._s(e.discoveredPrinter.agent)+" ")]):e._e(),e.discoveredPrinter.host_or_ip?t("div",{staticClass:"text-muted small"},[e._v(" IP address: "+e._s(e.discoveredPrinter.host_or_ip)+" ")]):e._e(),e.discoveredPrinter.hostname?t("div",{staticClass:"text-muted small"},[e._v(" Hostname: "+e._s(e.discoveredPrinter.hostname)+" ")]):e._e(),e.discoveredPrinter.octopi_version?t("div",{staticClass:"text-muted small"},[e._v(" OctoPi: "+e._s(e.discoveredPrinter.octopi_version)+" ")]):e._e(),!e.discoveredPrinter.octopi_version&&e.discoveredPrinter.os?t("div",{staticClass:"text-muted small"},[e._v(" OS: "+e._s(e.discoveredPrinter.os)+" ")]):e._e()]),t("div",{staticClass:"col-sm-12 col-md-2 center px-3"},[t("button",{staticClass:"btn btn-block btn-primary",on:{click:function(t){return e.$emit("auto-link-printer",{...e.discoveredPrinter})}}},[e._v(" Link ")])])])])},Al=[],Ml={name:"DiscoveredPrinter",props:{discoveredPrinter:{type:Object,required:!0}}},El=Ml,Nl=(i("6727"),Object(E["a"])(El,Il,Al,!1,null,null,null)),Rl=Nl.exports,jl=function(){var e=this,t=e._self._c;return t("div",{staticClass:"px-2"},[t("div",{staticClass:"title-pic"},[t("img",{staticClass:"pic-item",attrs:{src:i("4de7")}}),e._m(0),t("img",{staticClass:"pic-item",attrs:{src:i("2e7f")}})]),e._m(1),t("div",[t("div",{staticClass:"row my-2"},[t("div",{staticClass:"col-sm-6"},[t("button",{staticClass:"btn btn-block btn-primary mt-2",attrs:{disabled:e.linking},on:{click:e.autoLinkPrinter}},[e.linking?t("b-spinner",{attrs:{small:""}}):e._e(),e._v("Link Now "),t("i",{staticClass:"fas fa-external-link-alt"})],1)]),t("div",{staticClass:"col-sm-6"},[t("button",{staticClass:"btn btn-block btn-secondary mt-2",on:{click:e.cancel}},[e._v("Cancel")])])])])])},Ll=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"pic-item"},[t("i",{staticClass:"fas fa-ellipsis-h fa-2x"}),t("i",{staticClass:"fas fa-ellipsis-h fa-2x"})])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-4"},[t("p",[e._v("The Obico app needs to make sure you have access to selected OctoPrint.")]),t("p",[e._v(' When you press "Link Now" button below, a new browser window will pop up to finish a handshake with this OctoPrint. ')])])}],Bl={name:"AutoLinkPopup",props:{discoveredPrinter:{type:Object,required:!0},switchToManualLinking:{type:Function,required:!0},secretObtained:{type:Function,required:!0}},data(){return{linking:!1}},mounted(){window.addEventListener("message",this.gotWindowMessage)},beforeDestroy(){window.removeEventListener("message",this.gotWindowMessage)},methods:{autoLinkPrinter(){if(this.linking=!0,this.gotSecret=null,this.obicoDiscoveryPopup=window.open(this.destUrl(),"_blank","toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=500,height=100"),!this.obicoDiscoveryPopup)return this.cancel(),void this.$swal.Prompt.fire({icon:"error",title:"Oops!",html:"<p>Handshake failed because the pop-up was blcoked.</p><p>Please unblock the pop-up in your browser and try it again.</p>",confirmButtonText:"Okay!",showCancelButton:!0,cancelButtonText:"Switch to Manual Setup"}).then(e=>{e.isDismissed&&"cancel"===e.dismiss&&this.switchToManualLinking()});setTimeout(()=>{this.closeDiscoveryPopup(),this.gotSecret||(this.cancel(),this.$swal.Prompt.fire({icon:"error",title:"Handshake failed!",html:`<p>Please make sure:</p>\n              <ul>\n                <li>The OctoPrint you want to link is at ${this.discoveredPrinter.host_or_ip}:${this.discoveredPrinter.port}, and it's connected to the same local network as your computer/phone.</li>\n                <li>The version of plugin is 1.8.0 or above.</li>\n              </ul>`,confirmButtonText:"Okay!",showCancelButton:!0,cancelButtonText:"Switch to Manual Setup"}).then(e=>{e.isDismissed&&"cancel"===e.dismiss&&this.switchToManualLinking()}))},5e3)},destUrl(){const e=this.discoveredPrinter.agent?"obico":"thespaghettidetective";return`http://${this.discoveredPrinter.host_or_ip}:${this.discoveredPrinter.port||"80"}/plugin/${e}/grab-discovery-secret?device_id=${this.discoveredPrinter.device_id}`},switchToManual(){this.cancel(),this.switchToManualLinking()},closeDiscoveryPopup(){this.obicoDiscoveryPopup&&(this.obicoDiscoveryPopup.close(),this.obicoDiscoveryPopup=null)},gotWindowMessage(e){const t={...(null===e||void 0===e?void 0:e.data)||{}};!this.gotSecret&&this.discoveredPrinter.device_id&&t.device_secret?(this.gotSecret=t,this.secretObtained(this.discoveredPrinter.device_id,t.device_secret),this.cancel()):console.log("Ignored message",e)},cancel(){this.closeDiscoveryPopup(),this.$swal.close()}}},$l=Bl,Vl=(i("c49c"),Object(E["a"])($l,jl,Ll,!1,null,"7fccd11b",null)),Ul=Vl.exports;const zl=60;var Wl={components:{FormWizard:Fl["FormWizard"],TabContent:Fl["TabContent"],WizardButton:Fl["WizardButton"],Loading:it.a,PageLayout:vt,SavingAnimation:fl["a"],DiscoveredPrinter:Rl},data(){return{theme:Ol.a,verificationCode:null,verifiedPrinter:null,onVerificationStep:!1,copied:!1,saving:{},errorMessages:{},delayedSubmit:{printer_name:{delay:1e3,timeoutId:null}},discoveryEnabled:!0,discoveryCount:0,discoveredPrinters:[],chosenDeviceId:null,gotSecret:null,obicoDiscoveryPopup:null,apiCallIntervalId:null,targetPlatform:null,routes:Y}},computed:{printerIdToLink(){return new URLSearchParams(window.location.search.substring(1)).get("printerId")},title(){return this.printerIdToLink?"Re-Link Printer":"Link Printer"},editPrinterUrl(){return`/printers/${this.verifiedPrinter.id}/`},expiryMoment(){return this.verificationCode?L()(this.verificationCode.expired_at):null},timeToExpire(){return this.expiryMoment?L.a.duration(this.expiryMoment.diff(L()())).humanize():"-"},canStartLinking(){var e,t;return(null===(e=this.verificationCode)||void 0===e?void 0:e.code)&&(null===(t=this.discoveredPrinters)||void 0===t?void 0:t.length)>0},redirectToTunnelCreation(){return new URLSearchParams(window.location.search).get("redirectToTunnelCreation")},targetOctoPrint(){return"octoprint"===this.targetPlatform},targetMoonraker(){return"moonraker"===this.targetPlatform}},created(){this.printerIdToLink&&(this.discoveryEnabled=!1),this.getVerificationCode(),this.$route.path!==Y.printerWizard&&this.$router.push(Y.printerWizard+"?"+window.location.search)},methods:{setTargetPlatform(e){this.targetPlatform=e,"moonraker"===e&&(this.discoveryEnabled=!1),this.$router.push(Y.printerWizardSetup+"?"+window.location.search)},setSavingStatus(e,t){t&&delete this.errorMessages[e],this.$set(this.saving,e,t)},updatePrinterName(){if("name"in this.verifiedPrinter&&this.verifiedPrinter.name){const e=this.delayedSubmit["printer_name"];return e["timeoutId"]&&clearTimeout(e["timeoutId"]),void(this.delayedSubmit["printer_name"]["timeoutId"]=setTimeout(()=>(this.setSavingStatus("printer_name",!0),Q["a"].patch(X["a"].printer(this.verifiedPrinter.id),{name:this.verifiedPrinter.name}).then(()=>{this.setSavingStatus("printer_name",!1)}).catch(e=>{this.errorDialog(e,"Failed to update printer name")})),e["delay"]))}{const e=this.delayedSubmit["printer_name"];e["timeoutId"]&&clearTimeout(e["timeoutId"])}},prevTab(){document.querySelector(".wizard-nav.wizard-nav-pills li.active .wizard-icon-circle").classList.remove("checked"),this.onVerificationStep=!1},nextTab(e){if(document.querySelector(".wizard-nav.wizard-nav-pills li.active .wizard-icon-circle").classList.add("checked"),this.onVerificationStep=1==e,0==e&&this.discoveryEnabled&&0==this.discoveryCount&&this.discoverPrinter(),this.onVerificationStep){const e=this.copyCode;let t=!1,i=17,s=91,n=67;document.addEventListener("keydown",(function(e){e.keyCode!=i&&e.keyCode!=s||(t=!0)})),document.addEventListener("keyup",(function(e){e.keyCode!=i&&e.keyCode!=s||(t=!1)})),document.addEventListener("keydown",(function(i){t&&i.keyCode==n&&e()}))}},verificationCodeUrl(){const e=X["a"].verificationCode();return this.verificationCode?this.verificationCode.verified_at||L()().isBefore(this.expiryMoment)?`${e}${this.verificationCode.id}/`:e:this.printerIdToLink?`${e}?printer_id=${this.printerIdToLink}`:e},copyCode(){if(this.onVerificationStep&&this.verificationCode){let t=document.createElement("textarea");t.value=this.verificationCode.code,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),this.copied=!0}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)}},callVerificationCodeApi(){Q["a"].get(this.verificationCodeUrl()).then(e=>{e.data&&(this.verificationCode=e.data,this.verificationCode.verified_at&&(this.verifiedPrinter=e.data.printer,Tl["onPrinterLinked"]&&Object(Tl["onPrinterLinked"])()))})},getVerificationCode(){this.callVerificationCodeApi(),this.apiCallIntervalId=setInterval(()=>{this.verifiedPrinter?clearInterval(this.apiCallIntervalId):this.callVerificationCodeApi()},5e3)},showVerificationCodeHelpModal(){let e='<p>The 6-digit code needs to be entered in the Obico plugin in OctoPrint. There are a few reasons why you can\'t find this page:</p>\n        <p><ul>\n        <li style="margin: 10px 0;">You don\'t have the plugin installed or you haven\'t restarted OctoPrint after installation. Click <a href="/printers/wizard/">here</a> to walk through the process again.</li>\n        <li style="margin: 10px 0;">The installed plugin is on a version earlier than 1.5.0. You need to upgrade the plugin to <b>1.5.0</b> or later.</li>\n        <li style="margin: 10px 0;">Still no dice? Check out the step-by-step <a target="_blank" href="https://www.obico.io/docs/user-guides/octoprint-plugin-setup/">set up guide</a>.</li>\n        </ul></p>';this.targetOctoPrint||(e='<p>The 6-digit code needs to be entered to the <em>Obico for OctoPrint</em> installation script.</p>\n        <p>Check <a target="_blank" href="https://www.obico.io/docs/user-guides/klipper-setup/">this set up guide</a> for detailed instructions.</p>'),this.$swal.fire({title:"Can't find the page to enter the 6-digit code?",html:e,customClass:{container:"dark-backdrop"}})},zoomIn(e){e.target.classList.toggle("zoomedIn")},callPrinterDiscoveryApi(){this.discoveryEnabled&&(this.discoveryCount>=zl&&0===this.discoveredPrinters.length&&(this.discoveryEnabled=!1,this.$swal.Toast.fire({title:"No OctoPrint discovered on your local network. Switched to manual linking."})),this.discoveryCount+=1,Q["a"].get(X["a"].printerDiscovery()).then(e=>{this.discoveredPrinters=Ke()(e.data,e=>e.device_id)}))},discoverPrinter(){this.discoveryEnabled&&!this.verifiedPrinter&&(this.callPrinterDiscoveryApi(),setTimeout(()=>{this.discoverPrinter()},5e3))},autoLinkPrinter(e){this.$swal.openModalWithComponent(Ul,{discoveredPrinter:e,switchToManualLinking:()=>this.discoveryEnabled=!1,secretObtained:(e,t)=>this.secretObtained(e,t)},{title:"Browser Pop-up",showConfirmButton:!1,allowOutsideClick:!1})},secretObtained(e,t){this.chosenDeviceId=e,Q["a"].post(X["a"].printerDiscovery(),{code:this.verificationCode.code,device_id:this.chosenDeviceId,device_secret:t}),setTimeout(()=>{this.chosenDeviceId&&!this.verifiedPrinter&&(this.chosenDeviceId=null,this.$swal.Toast.fire({icon:"error",title:"Something went wrong. Switched to using 6-digit code to link OctoPrint."}),this.discoveryEnabled=!1),this.chosenDeviceId=null},2e4)}}},Gl=Wl,ql=(i("d112"),i("2b37"),Object(E["a"])(Gl,Pl,xl,!1,null,"04c70dde",null)),Hl=ql.exports,Jl=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"topBarLeft",fn:function(){return[t("div",{staticClass:"printer-name truncated"},[e._v(" "+e._s(e.printer?e.printer.name:"")+" ")])]},proxy:!0},{key:"topBarRight",fn:function(){return[e.printer?t("div",{staticClass:"action-panel"},[t("a",{staticClass:"btn shadow-none action-btn icon-btn",attrs:{href:"#",title:"Share"},on:{click:function(t){return t.preventDefault(),e.onSharePrinter()}}},[t("i",{staticClass:"fas fa-share-alt fa-lg"}),t("span",{staticClass:"sr-only"},[e._v("Share")])]),t("a",{staticClass:"btn shadow-none action-btn icon-btn",attrs:{href:`/tunnels/${e.printer.id}/`,title:"OctoPrint Tunnel"}},[t("svg",{staticClass:"custom-svg-icon"},[t("use",{attrs:{href:"#svg-tunnel"}})]),t("span",{staticClass:"sr-only"},[e._v("OctoPrint Tunnel")])]),t("a",{staticClass:"btn shadow-none action-btn icon-btn",attrs:{href:`/printers/${e.printer.id}/`,title:"Configure"}},[t("i",{staticClass:"fas fa-wrench"}),t("span",{staticClass:"sr-only"},[e._v("Configure")])]),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn d-md-none"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}],null,!1,3452768261)},[t("cascaded-dropdown",{ref:"cascadedDropdown",attrs:{"menu-options":[{key:"share",icon:"fas fa-share-alt fa-lg",title:"Share",callback:!0},{key:"tunnel",svgIcon:"svg-tunnel",title:"OctoPrint Tunnel",href:`/tunnels/${e.printer.id}/`},{key:"settings",icon:"fas fa-wrench",title:"Configure",href:`/printers/${e.printer.id}/`}]},on:{menuOptionClicked:e.onMenuOptionClicked}})],1)],1):e._e()]},proxy:!0},{key:"content",fn:function(){return[e.printer?t("div",{staticClass:"page-container",attrs:{fluid:""}},[t("div",{staticClass:"widgets-container"},[e._l(e.widgets,(function(i){return[!i.enabled||(e.printer.isOffline()||e.printer.isDisconnected())&&"PrintJobControlWidget"!==i.component?e._e():t(i.component,{key:i.id,tag:"component",attrs:{printer:e.printer,"printer-comm":e.printerComm,print:e.lastPrint},on:{sendPrinterAction:e.onSendPrinterAction,notAFailureClicked:e.onNotAFailureClicked,updateSettings:e.onUpdateSettings}})]})),t("div",{staticClass:"extra-actions"},[t("h2",{staticClass:"section-title"},[e._v("Additional Actions")]),t("b-button",{staticClass:"custom-button",attrs:{variant:"outline-secondary"},on:{click:e.onReorderClicked}},[t("i",{staticClass:"fas fa-arrows-alt-v"}),e._v(" Reorder & Hide ")]),t("div",{staticClass:"text-muted extra-actions-explanation"},[t("small",[e._v("Customize this page for each of your printers by reodering or hiding cards above.")])]),t("b-button",{staticClass:"custom-button",attrs:{variant:"outline-primary",href:"/printers/wizard/"}},[t("i",{staticClass:"fas fa-plus"}),e._v(" Add Printer ")]),t("div",{staticClass:"text-muted extra-actions-explanation"},[t("small",[e._v("Link another printer to Obico.")])])],1)],2),t("div",{staticClass:"stream-container"},[t("div",{ref:"streamInner",staticClass:"stream-inner"},[t("streaming-box",{attrs:{printer:e.printer,webrtc:e.webrtc,autoplay:e.user.is_pro},on:{onRotateRightClicked:t=>{e.customRotationDeg=t}}})],1)])]):t("loading-placeholder")]},proxy:!0}])})},Yl=[],Kl=function(){var e=this,t=e._self._c;return t("widget-template",{scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.isPrinting?"Print Progress":"Last Print"))]},proxy:!0},{key:"content",fn:function(){return[t("div",{staticClass:"wrapper"},[e.print?[t("div",{staticClass:"header"},[t("g-code-details",{staticClass:"g-code-details",attrs:{file:e.print.g_code_file||{filename:e.print.filename},"show-open-button":e.print.g_code_file&&!e.print.g_code_file.resident_printer&&!e.print.g_code_file.deleted,"show-details":!1}})],1),t("div",{staticClass:"content"},[t("div",{staticClass:"details"},[e.isPrinting?[e.isPrinting?t("div",{staticClass:"progress-container"},[t("div",{staticClass:"progress-bar-wrapper"},[t("div",{staticClass:"progress-bar-inner",style:`width: ${e.printProgressPercentage}%`})]),t("div",{staticClass:"percentage-progress"},[e._v(e._s(e.printProgressPercentage)+"%")])]):e._e(),t("div",{staticClass:"info-line no-border"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-info"})]),t("div",{staticClass:"title"},[e._v("Status")])]),t("div",{staticClass:"value",class:"text-"+e.printer.calculatedStateColor()},[e._v(" "+e._s(e.printer.calculatedState())+" ")])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("font-awesome-icon",{attrs:{icon:["fas","layer-group"]}})],1),t("div",{staticClass:"title"},[e._v("Layer")])]),t("div",{staticClass:"value"},[e._v(" "+e._s(e.layerProgress)+" ")])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-stopwatch"})]),t("div",{staticClass:"title"},[e._v("Remaining")])]),t("div",{staticClass:"value"},[e.secondsLeft?t("span",[e._v(e._s(e.humanizedDuration(e.secondsLeft)))]):t("span",{staticClass:"text-secondary"},[e._v("Calculating...")])])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-flag-checkered"})]),t("div",{staticClass:"title"},[e._v("Finishing at")])]),t("div",{staticClass:"value"},[e.finishingAt?t("span",[e._v(e._s(e.finishingAt))]):t("span",{staticClass:"text-secondary"},[e._v("Calculating...")])])]),t("collapsable-details",[t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-clock"})]),t("div",{staticClass:"title"},[e._v("Started")])]),t("div",{staticClass:"value"},[e._v(" "+e._s(e.print.started_at.format(e.DATE_TIME_FORMAT))+" ")])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-stopwatch"})]),t("div",{staticClass:"title"},[e._v("Elapsed")])]),t("div",{staticClass:"value"},[e.timeElapsed?t("span",[e._v(e._s(e.timeElapsed))]):t("b-spinner",{attrs:{small:""}})],1)]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("font-awesome-icon",{attrs:{icon:["fas","ruler-vertical"]}})],1),t("div",{staticClass:"title"},[e._v("Z-height")])]),t("div",{staticClass:"value"},[e._v(" "+e._s(e.mmProgress)+" ")])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-stopwatch"})]),t("div",{staticClass:"title"},[e._v("Total time")])]),e.timeTotal?t("div",{staticClass:"value"},[e._v(" "+e._s(e.timeTotal)+" ")]):t("span",{staticClass:"text-secondary"},[e._v("Calculating...")])]),e.print.filament_used?t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("font-awesome-icon",{attrs:{icon:["fas","ruler-vertical"]}})],1),t("div",{staticClass:"title"},[e._v("Total filament")])]),t("div",{staticClass:"value"},[e._v(" "+e._s(e.humanizedFilamentUsage(e.print.filament_used))+" ")])]):e._e()])]:[t("div",{staticClass:"info-line no-border"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-info"})]),t("div",{staticClass:"title"},[e._v("Status")])]),t("div",{staticClass:"value"},[e.print.status.isActive?t("b-spinner",{attrs:{small:""}}):t("div",{staticClass:"print-status-color",class:e.print.status.key},[e._v(" "+e._s(e.print.status.title)+" ")])],1)]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"far fa-clock"})]),t("div",{staticClass:"title"},[e._v("Started")])]),t("div",{staticClass:"value"},[e._v(e._s(e.print.started_at.format("MMM D, YYYY h:mm a")))])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"label"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-clock"})]),t("div",{staticClass:"title"},[e._v("Duration")])]),e.print.status.isActive?t("b-spinner",{attrs:{small:""}}):t("div",{staticClass:"value"},[e._v(" "+e._s(e.print.duration||"-")+" ")])],1)]],2),e.isPrinting?e._e():t("div",{staticClass:"actions"},[t("b-button",{staticClass:"custom-button",attrs:{variant:"outline-secondary",href:"/prints/"+e.print.id}},[e._v(" Open Print ")]),e.file.url?t("b-button",{staticClass:"custom-button",attrs:{variant:"secondary",disabled:e.isPrintStarting},on:{click:e.onRepeatClicked}},[e.isPrintStarting?t("b-spinner",{attrs:{small:""}}):t("i",{staticClass:"fas fa-redo"}),e._v(" Reprint ")],1):e._e()],1)])]:[t("p",{staticClass:"empty-state-text"},[e._v("No prints found")])]],2)]},proxy:!0}])})},Zl=[];const Ql="MMM D, h:mm a";var Xl={name:"PrintProgressWidget",components:{WidgetTemplate:aa,GCodeDetails:En,CollapsableDetails:On},props:{printer:{type:Object,required:!0},print:{type:Object,default:null}},data(){return{DATE_TIME_FORMAT:Ql,timeElapsed:null,finishingAt:null,startedAt:null,printProgressPercentage:0,extraVisible:!1}},computed:{file(){var e;return(null===(e=this.print)||void 0===e?void 0:e.g_code_file)||{}},isPrinting(){return this.printer.isActive()&&this.printer.progressCompletion()<100},isPrintStarting(){return this.printer.inTransientState()},mmProgress(){var e,t,i,s,n;let r;const a=null===(e=this.printer.status)||void 0===e?void 0:e.currentZ,o=null===(t=this.printer.status)||void 0===t||null===(i=t.file_metadata)||void 0===i||null===(s=i.analysis)||void 0===s||null===(n=s.printingArea)||void 0===n?void 0:n.maxZ;return(a||0==a)&&o&&(r=`${a.toFixed(2)}/${o.toFixed(2)} mm`),r||"--/--"},layerProgress(){var e,t,i,s;let n;const r=null===(e=this.printer.status)||void 0===e?void 0:e.currentLayerHeight,a=null===(t=this.printer.status)||void 0===t||null===(i=t.file_metadata)||void 0===i||null===(s=i.obico)||void 0===s?void 0:s.totalLayerCount;return(r||0==r)&&a&&(n=`${Math.round(r)}/${Math.round(a)}`),n||"--/--"},timeTotal(){let e=null;return this.secondsPrinted&&this.secondsLeft?(e=this.secondsPrinted+this.secondsLeft,ae(e)):null},secondsPrinted(){var e,t,i,s;return null!==(e=null===(t=this.printer)||void 0===t||null===(i=t.status)||void 0===i||null===(s=i.progress)||void 0===s?void 0:s.printTime)&&void 0!==e?e:null},secondsLeft(){var e,t,i,s;return null!==(e=null===(t=this.printer)||void 0===t||null===(i=t.status)||void 0===i||null===(s=i.progress)||void 0===s?void 0:s.printTimeLeft)&&void 0!==e?e:null}},watch:{printer:{handler:function(e,t){this.isPrinting&&this.updatePrintProgress()},deep:!0}},mounted(){this.isPrinting&&this.updatePrintProgress()},unmounted(){clearInterval(this.printerStateCheckInterval)},methods:{humanizedDuration:ae,humanizedFilamentUsage:le,toggleZHeightProgressType(){this.preferZHeightProgressInLayers=!this.preferZHeightProgressInLayers,Object(a["b"])("preferZHeightProgressInLayers",this.preferZHeightProgressInLayers)},updatePrintProgress(){var e,t,i,s,n;if(!this.isPrinting)return;if(!this.print)return;const r=L.a.duration(L()().diff(this.print.started_at));this.timeElapsed=this.print.status.isActive?ae(r.asSeconds()):null,this.finishingAt="number"===typeof this.secondsLeft?ce(this.secondsLeft,Ql):null,this.printProgressPercentage=Math.round(this.printer.progressCompletion()),this.printProgressMillimeters=Math.round((null===(e=this.printer.status)||void 0===e?void 0:e.currentZ)||0),this.printMillimetersTotal=Math.round((null===(t=this.printer.status)||void 0===t||null===(i=t.file_metadata)||void 0===i||null===(s=i.analysis)||void 0===s||null===(n=s.printingArea)||void 0===n?void 0:n.maxZ)||0)},onRepeatClicked(){this.isPrinting||(this.print?this.print.g_code_file.deleted?console.error("Can't repeat last print: G-Code deleted"):this.print.g_code_file.url?bn(this.print.g_code_file,this.printer).then(()=>{var e;Cn({printer:this.printer,gcode:this.print.g_code_file,isCloud:null===(null===(e=this.print.g_code_file)||void 0===e?void 0:e.resident_printer),Swal:this.$swal})}):console.error("Can't repeat last print: no G-Code file in storage"):console.error("Can't repeat last print: no last print"))}}},ec=Xl,tc=(i("ea64"),Object(E["a"])(ec,Kl,Zl,!1,null,"3efcb618",null)),ic=tc.exports,sc=function(){var e=this,t=e._self._c;return t("widget-template",{scopedSlots:e._u([{key:"title",fn:function(){return[e._v("Failure Detection")]},proxy:!0},{key:"content",fn:function(){return[t("div",{staticClass:"wrapper"},[e.isEnt?t("div",{staticClass:"dh-balance-wrapper"},[t("a",{staticClass:"btn shadow-none action-btn icon-btn hours-btn",style:{marginRight:.25*String(e.dhBadgeNum).length+"rem"},attrs:{href:"/user_preferences/dh/",title:e.dhBadgeNum+" AI Detection Hours"}},[t("svg",{staticClass:"custom-svg-icon"},[t("use",{attrs:{href:"#svg-hour-glass"}})]),t("span",{staticClass:"badge badge-light",attrs:{id:"user-credits"}},[e._v(e._s(e.dhBadgeNum))]),t("span",{staticClass:"sr-only"},[e._v("AI Detection Hours")])])]):e._e(),t("div",{staticClass:"header"},[t("div",{staticClass:"gauge-wrapper"},[t("failure-detection-gauge",{attrs:{"normalized-p":e.printer.normalized_p,"is-watching":e.isWatching}})],1),e.printer.not_watching_reason?t("div",{staticClass:"overlay-info"},[t("muted-alert",{staticClass:"muted-alert"},[t("span",[e._v("Not watching ("+e._s(e.printer.not_watching_reason)+"). "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/detective-not-watching/",target:"_blank"}},[e._v("Learn all possible reasons "),t("small",[t("i",{staticClass:"fas fa-external-link-alt"})])])])])],1):e._e()]),t("div",{staticClass:"controls"},[t("div",{staticClass:"line"},[t("label",{staticClass:"label",attrs:{for:"watching_enabled-toggle-"+e.printer.id}},[e._v(" Enable AI failure detection "),e.enableFailureDetection?e._e():t("div",{staticClass:"text-muted"},[e._v(" AI failure detection is disabled. You are on your own. ")])]),t("div",{staticClass:"switch"},[t("div",{staticClass:"custom-control custom-switch"},[t("input",{staticClass:"custom-control-input update-printer",attrs:{id:"watching_enabled-toggle-"+e.printer.id,type:"checkbox",name:"watching_enabled"},domProps:{checked:e.enableFailureDetection},on:{click:e.onFailureDetectionToggled}}),t("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"watching_enabled-toggle-"+e.printer.id}})])])]),t("div",{staticClass:"line"},[t("label",{staticClass:"label",attrs:{for:"pause_on_failure-toggle-"+e.printer.id}},[e._v(" Pause on detected failures "),e.pauseOnFailure?e._e():t("div",{staticClass:"text-muted"},[e._v(" You will still be alerted via notifications. ")])]),t("div",{staticClass:"switch"},[t("div",{staticClass:"custom-control custom-switch"},[t("input",{staticClass:"custom-control-input update-printer",attrs:{id:"pause_on_failure-toggle-"+e.printer.id,type:"checkbox",name:"pause_on_failure"},domProps:{checked:e.pauseOnFailure},on:{click:e.onPauseOnFailureToggled}}),t("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"pause_on_failure-toggle-"+e.printer.id}})])])])]),e.printer.alertUnacknowledged()?t("div",{staticClass:"failure-detected-message"},[t("div",{staticClass:"warning-message"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" Failure Detected! ")]),t("b-button",{attrs:{variant:"outline-warning custom-button"},on:{click:function(t){return e.onNotAFailureClicked(t)}}},[e._v("Not a Failure?")])],1):e._e()])]},proxy:!0}])})},nc=[],rc={name:"FailureDetectionWidget",components:{WidgetTemplate:aa,FailureDetectionGauge:Es,MutedAlert:os},props:{printer:{type:Object,required:!0}},data(){return{user:null,enableFailureDetection:!1,pauseOnFailure:!1,isEnt:!1}},computed:{dhBadgeNum(){return this.user&&this.user.is_dh_unlimited?"Unlimited":Math.round(this.user.dh_balance)},isWatching(){return!this.printer.not_watching_reason},notWatchingExplanation(){if(this.isWatching)return"";let e=this.printer.not_watching_reason;return""+e}},created(){this.user=Object(Se["f"])();const{IS_ENT:e}=Object(Se["e"])();this.isEnt=!!e,this.enableFailureDetection=this.printer.watching_enabled,this.pauseOnFailure="PAUSE"===this.printer.action_on_failure},methods:{onFailureDetectionToggled(){this.enableFailureDetection=!this.enableFailureDetection,this.$emit("updateSettings",{settingName:"watching_enabled",settingValue:this.enableFailureDetection})},onPauseOnFailureToggled(){this.pauseOnFailure=!this.pauseOnFailure,this.$emit("updateSettings",{settingName:"action_on_failure",settingValue:this.pauseOnFailure?"PAUSE":"NONE"})},onNotAFailureClicked(e){this.$emit("notAFailureClicked",e,!1)}}},ac=rc,oc=(i("d721"),Object(E["a"])(ac,sc,nc,!1,null,"cc70af70",null)),lc=oc.exports,cc=function(){var e=this,t=e._self._c;return t("widget-template",{scopedSlots:e._u([{key:"title",fn:function(){return[e._v("Temperature Controls")]},proxy:!0},{key:"content",fn:function(){return[e._t("content",(function(){return[t("div",{staticClass:"wrapper"},[e.show?[e._l(e.temperatures,(function(i,s){return t("temperature-item",{key:s,attrs:{"temp-key":s,"temp-item":i,"is-plugin-version-sufficient":e.isPluginVersionSufficient},on:{TempEditClicked:function(t){return e.onEditClicked(s,i)}}})})),e.isPluginVersionSufficient?t("b-button",{staticClass:"custom-button",attrs:{variant:"outline-primary"},on:{click:e.onTemperaturePresetsClicked}},[e._v(" Temperature Presets ")]):e._e()]:[t("div",{staticClass:"text-center mt-4"},[t("b-spinner"),t("p",{staticClass:"mt-2"},[e._v("Loading temperature...")])],1)]],2)]}))]},proxy:!0}],null,!0)})},dc=[],uc=function(){var e=this,t=e._self._c;return t("div",[e._m(0),t("div",[t("b-form-select",{staticClass:"form-control",attrs:{id:"id_preset"},model:{value:e.currentPreset,callback:function(t){e.currentPreset=t},expression:"currentPreset"}},e._l(e.allPresets,(function(i){return t("b-form-select-option",{key:i.name,attrs:{value:i.name}},[e._v(" "+e._s(i.name)+" ")])})),1)],1),t("muted-alert",{staticClass:"mt-4 mb-1"},[e._v(" Temperature presets can be edited or added in "+e._s(e.agentName)+" settings. ")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentPreset,expression:"currentPreset"}],attrs:{id:"selected-preset",type:"hidden"},domProps:{value:e.currentPreset},on:{input:function(t){t.target.composing||(e.currentPreset=t.target.value)}}})],1)},pc=[function(){var e=this,t=e._self._c;return t("div",[t("h5",[e._v("Presets:")])])}],hc={name:"TempPresets",components:{MutedAlert:os},props:{presets:{type:Array,required:!0},printer:{type:Object,required:!0}},data:function(){return{currentPreset:null}},computed:{allPresets(){let e=[...this.presets];return e.push({value:0,name:"OFF"}),e},agentName(){return this.printer.agentDisplayName()}},mounted(){this.currentPreset=this.allPresets[0].name},methods:{}},fc=hc,mc=Object(E["a"])(fc,uc,pc,!1,null,null,null),gc=mc.exports,vc={name:"TemperatureWidget",components:{WidgetTemplate:aa,TemperatureItem:Or},props:{printer:{type:Object,required:!0},printerComm:{type:Object,required:!0}},computed:{temperatures(){const e={};for(const[t,i]of Object.entries(te()(this.printer,"status.temperatures",{})))Boolean(i.actual)&&!isNaN(i.actual)&&(e[t]=i);return e},isPluginVersionSufficient(){return void 0!=te()(this.printer,"settings.temp_profiles")},show(){return Object.keys(this.temperatures).length>0}},methods:{temperatureDisplayName:ds["f"],onEditClicked(e,t){if(!this.isPluginVersionSufficient||null===t.target)return;let i,s=te()(this.printer,"settings.temp_profiles",[]),n=350;e.search(/bed|chamber/)>-1&&(n=140),i=e.search(/tool/)>-1?s.map(e=>({name:e.name,target:e["extruder"]})):s.map(t=>({name:t.name,target:t[e]})),this.$swal.openModalWithComponent(qr,{presets:i,maxTemp:n,curTarget:t.target},{title:"Set "+Object(ds["f"])(e)+" Temperature",confirmButtonText:"Confirm",showCancelButton:!0,preConfirm:()=>({target:parseInt(document.getElementById("target-temp").value)})}).then(t=>{if(t.value){let i=t.value.target;this.handleSetTemp(e,i)}})},onTemperaturePresetsClicked(){let e=te()(this.printer,"settings.temp_profiles",[]);this.$swal.openModalWithComponent(gc,{presets:e,printer:this.printer},{title:"Temperature Presets",confirmButtonText:"Apply",showCancelButton:!0,preConfirm:()=>({preset:document.getElementById("selected-preset").value})}).then(e=>{var t;null!==(t=e.value)&&void 0!==t&&t.preset&&this.applyTempPreset(e.value.preset)})},applyTempPreset(e){const t=te()(this.printer,"settings.temp_profiles",[]);let i=t.find(t=>t.name===e);const s={};if(i)Object.entries(i).forEach(e=>{const t=e[0];t.toLowerCase().includes("bed")?s.bed=e[1]:t.toLowerCase().includes("tool")||t.toLowerCase().includes("extruder")?s.extruder=e[1]:t.toLowerCase().includes("chamber")&&(s.chamber=e[1])});else{if("OFF"!==e)return;s.bed=0,s.extruder=0,s.chamber=0}const n=te()(this.printer,"status.temperatures",[]);Object.entries(n).forEach(e=>{const t=e[0];t.toLowerCase().includes("bed")?this.handleSetTemp(t,s.bed):t.toLowerCase().includes("tool")||t.toLowerCase().includes("extruder")?this.handleSetTemp(t,s.extruder):t.toLowerCase().includes("chamber")&&s.chamber&&this.handleSetTemp(t,s.chamber)})},handleSetTemp(e,t){this.printerComm.passThruToPrinter({func:"set_temperature",target:"_printer",args:[e,t]})}}},bc=vc,_c=(i("5d5f"),Object(E["a"])(bc,cc,dc,!1,null,"18eb9ce2",null)),Cc=_c.exports,wc=function(){var e=this,t=e._self._c;return t("widget-template",{scopedSlots:e._u([{key:"title",fn:function(){return[e.activeMenu?t("div",{staticClass:"nav-btn",on:{click:function(t){e.activeMenu=null}}},[t("i",{staticClass:"fas fa-arrow-left"}),e._v("  Back ")]):t("span",[e._v("Printer Controls")])]},proxy:!0},{key:"content",fn:function(){return[t("div",{staticClass:"wrapper"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.activeMenu,expression:"!activeMenu"}],staticClass:"home-menu"},[t("button",{staticClass:"menu-button",attrs:{disabled:e.printer.isActive()},on:{click:function(t){e.activeMenu="move-head"}}},[t("svg",{staticClass:"icon move-xy"},[t("use",{attrs:{href:"#svg-move-xy"}})]),t("div",{staticClass:"title"},[e._v("Move Head")])]),t("button",{staticClass:"menu-button",attrs:{disabled:e.printer.isActive()},on:{click:function(t){e.activeMenu="extrude"}}},[t("svg",{staticClass:"icon extruder"},[t("use",{attrs:{href:"#extruder"}})]),t("div",{staticClass:"title"},[e._v("Extrude")])]),e.printer.isAgentMoonraker()?t("button",{staticClass:"menu-button",on:{click:function(t){e.activeMenu="baby-step-z"}}},[t("svg",{staticClass:"icon move-z"},[t("use",{attrs:{href:"#svg-move-z"}})]),t("div",{staticClass:"title"},[e._v("Baby Step Z")])]):e._e(),e.hideTunePrinter?e._e():t("button",{staticClass:"menu-button",on:{click:function(t){e.activeMenu="tune-printer"}}},[t("font-awesome-icon",{attrs:{icon:["fas","gear"]}}),t("div",{staticClass:"title"},[e._v("Tune Printer")])],1),e.powerDevices.length?t("button",{staticClass:"menu-button",on:{click:function(t){e.activeMenu="power-control"}}},[t("font-awesome-icon",{attrs:{icon:["fas","power-off"]}}),t("div",{staticClass:"title"},[e._v("Power")])],1):e._e()]),t("div",{directives:[{name:"show",rawName:"v-show",value:"move-head"===e.activeMenu,expression:"activeMenu === 'move-head'"}],staticClass:"control-panel move-head"},[t("div",{staticClass:"main"},[t("div",{staticClass:"toggles"},e._l(e.xyzJogDistance.options,(function(i){return t("div",{key:"xyz-"+i,staticClass:"pill",class:{active:i===e.xyzJogDistance.value},on:{click:function(t){e.xyzJogDistance.value=i}}},[e._v(" "+e._s(i)+" ")])})),0),t("div",{staticClass:"xy-move"},[t("div",{staticClass:"left",on:{click:function(t){return e.xyzControl(e.axis.x,e.directions.down)}}},[t("i",{staticClass:"fas fa-arrow-left"})]),t("div",{staticClass:"right",on:{click:function(t){return e.xyzControl(e.axis.x,e.directions.up)}}},[t("i",{staticClass:"fas fa-arrow-right"})]),t("div",{staticClass:"up",on:{click:function(t){return e.xyzControl(e.axis.y,e.directions.up)}}},[t("i",{staticClass:"fas fa-arrow-up"})]),t("div",{staticClass:"down",on:{click:function(t){return e.xyzControl(e.axis.y,e.directions.down)}}},[t("i",{staticClass:"fas fa-arrow-down"})]),t("div",{staticClass:"home",on:{click:function(t){return e.xyzControl(e.axis.xy,e.directions.home)}}},[t("i",{staticClass:"fas fa-home"})])]),t("div",{staticClass:"z-move"},[t("div",{staticClass:"up",on:{click:function(t){return e.xyzControl(e.axis.z,e.directions.up)}}},[t("i",{staticClass:"fas fa-arrow-up"})]),t("div",{staticClass:"down",on:{click:function(t){return e.xyzControl(e.axis.z,e.directions.down)}}},[t("i",{staticClass:"fas fa-arrow-down"})]),t("div",{staticClass:"home",on:{click:function(t){return e.xyzControl(e.axis.z,e.directions.home)}}},[t("i",{staticClass:"fas fa-home"})])])]),t("div",{staticClass:"additional"},[t("div",{staticClass:"control-btn",on:{click:e.homeAll}},[t("i",{staticClass:"fas fa-home"}),e._v(" Home All")]),t("div",{staticClass:"control-btn",on:{click:e.disableSteppers}},[t("i",{staticClass:"fas fa-power-off"}),e._v(" Disable Steppers ")])])]),t("div",{directives:[{name:"show",rawName:"v-show",value:"extrude"===e.activeMenu,expression:"activeMenu === 'extrude'"}],staticClass:"control-panel extrude"},[t("div",{staticClass:"main"},[e.showExtrudeControl?[t("div",{staticClass:"toggles"},e._l(e.extrudeJogDistance.options,(function(i){return t("div",{key:"xyz-"+i,staticClass:"pill",class:{active:i===e.extrudeJogDistance.value},on:{click:function(t){e.extrudeJogDistance.value=i}}},[e._v(" "+e._s(i)+" ")])})),0),t("div",{staticClass:"main-buttons"},[t("div",{staticClass:"control-btn",on:{click:function(t){return e.handleFilament(e.filamentDirections.retract)}}},[t("i",{staticClass:"fas fa-minus"}),e._v(" Retract ")]),t("div",{staticClass:"control-btn",on:{click:function(t){return e.handleFilament(e.filamentDirections.extrude)}}},[t("i",{staticClass:"fas fa-plus"}),e._v(" Extrude ")])])]:[t("div",{staticClass:"text-center mt-4"},[t("b-spinner"),t("p",{staticClass:"mt-2"},[e._v("Loading tools...")])],1)]],2),e.showToolsSelector?t("div",{staticClass:"additional"},[t("b-form-select",{staticClass:"form-control tool-select",model:{value:e.activeTool,callback:function(t){e.activeTool=t},expression:"activeTool"}},e._l(e.tools,(function(i,s){return t("b-form-select-option",{key:s,attrs:{value:s}},[e._v(" "+e._s(e.temperatureDisplayName(s))+" ")])})),1)],1):e._e()]),t("div",{directives:[{name:"show",rawName:"v-show",value:"baby-step-z"===e.activeMenu,expression:"activeMenu === 'baby-step-z'"}],staticClass:"control-panel baby-step-z"},[t("div",{staticClass:"main"},[t("div",{staticClass:"toggles"},e._l(e.zOffsetJogDistance.options,(function(i){return t("div",{key:"xyz-"+i,staticClass:"pill",class:{active:i===e.zOffsetJogDistance.value},on:{click:function(t){e.zOffsetJogDistance.value=i}}},[e._v(" "+e._s(i)+" ")])})),0),t("div",{staticClass:"z-move"},[t("div",{staticClass:"up",on:{click:function(t){return e.controlZOffset(e.directions.up)}}},[t("i",{staticClass:"fas fa-arrow-up"})]),t("div",{staticClass:"down",on:{click:function(t){return e.controlZOffset(e.directions.down)}}},[t("i",{staticClass:"fas fa-arrow-down"})])])]),t("div",{staticClass:"additional"},[t("div",{staticClass:"current-offset"},[t("div",{staticClass:"label"},[e._v("Current Offset")]),t("div",{staticClass:"value"},[e.currentZOffset||"number"===typeof e.currentZOffset?t("span",[e._v(" "+e._s(e.currentZOffset)+" ")]):t("span",[t("b-spinner",{attrs:{small:""}})],1)])])])]),t("div",{directives:[{name:"show",rawName:"v-show",value:"tune-printer"===e.activeMenu,expression:"activeMenu === 'tune-printer'"}],staticClass:"control-panel tune-printer"},[e.printer.isAgentMoonraker()&&null===e.currentFeedRate?e._e():[t("div",{staticClass:"controls-title"},[t("span",[e._v("Feed Rate / Speed")]),t("help-widget",{staticClass:"help-message",attrs:{id:"print-speed-widget-help"}})],1),t("div",{staticClass:"controls"},[t("div",{staticClass:"custom"},[t("b-input-group",{attrs:{prepend:"%"},scopedSlots:e._u([{key:"append",fn:function(){return[t("b-button",{attrs:{variant:"background",disabled:null===e.customFeedRateFactor||parseInt(e.customFeedRateFactor)<1},on:{click:function(t){return e.setPrintSpeed(e.customFeedRateFactor)}}},[e._v("Apply")])]},proxy:!0}],null,!1,3322237375)},[t("b-form-input",{attrs:{placeholder:"100",type:"number"},on:{focus:function(e){return e.target.select()}},model:{value:e.customFeedRateFactor,callback:function(t){e.customFeedRateFactor=t},expression:"customFeedRateFactor"}})],1)],1)])],e.printer.isAgentMoonraker()&&null===e.currentFlowRate?e._e():[t("div",{staticClass:"controls-title"},[t("span",[e._v("Flow Rate")]),t("help-widget",{staticClass:"help-message",attrs:{id:"flow-rate-widget-help"}})],1),t("div",{staticClass:"controls"},[t("div",{staticClass:"custom"},[t("b-input-group",{attrs:{prepend:"%"},scopedSlots:e._u([{key:"append",fn:function(){return[t("b-button",{attrs:{variant:"background",disabled:null===e.customFlowRateFactor||parseInt(e.customFlowRateFactor)<1},on:{click:function(t){return e.setFlowRate(e.customFlowRateFactor)}}},[e._v("Apply")])]},proxy:!0}],null,!1,4218969417)},[t("b-form-input",{attrs:{placeholder:"100",type:"number"},on:{focus:function(e){return e.target.select()}},model:{value:e.customFlowRateFactor,callback:function(t){e.customFlowRateFactor=t},expression:"customFlowRateFactor"}})],1)],1)])],e.printer.isAgentMoonraker()&&null===e.currentFanSpeed?e._e():[t("div",{staticClass:"controls-title"},[t("span",[e._v("Fan Speed")]),t("help-widget",{staticClass:"help-message",attrs:{id:"fan-speed-widget-help"}})],1),t("div",{staticClass:"controls"},[t("b-button",{staticClass:"off",attrs:{variant:"background",small:""},on:{click:function(t){e.customFanSpeed=0,e.setFanSpeed(0)}}},[e._v("0% (Off)")]),t("div",{staticClass:"custom"},[t("b-input-group",{attrs:{prepend:"%"},scopedSlots:e._u([{key:"append",fn:function(){return[t("b-button",{attrs:{variant:"background",disabled:null===e.customFanSpeed||parseInt(e.customFanSpeed)>100||parseInt(e.customFanSpeed)<0},on:{click:function(t){return e.setFanSpeed(e.customFanSpeed)}}},[e._v("Apply")])]},proxy:!0}],null,!1,407241168)},[t("b-form-input",{attrs:{placeholder:"0-100",type:"number"},on:{focus:function(e){return e.target.select()}},model:{value:e.customFanSpeed,callback:function(t){e.customFanSpeed=t},expression:"customFanSpeed"}})],1)],1),t("b-button",{staticClass:"btn",attrs:{variant:"background",small:""},on:{click:function(t){e.customFanSpeed=100,e.setFanSpeed(100)}}},[e._v("100%")])],1)],e.printer.isAgentMoonraker()?e._e():t("muted-alert",{staticClass:"info-block"},[e._v(" These settings can only be set. They can't be read back from the firmware due to a limitation of the communication protocol. ")])],2),t("div",{directives:[{name:"show",rawName:"v-show",value:"power-control"===e.activeMenu,expression:"activeMenu === 'power-control'"}],staticClass:"control-panel power-control"},[e._l(e.powerDevices,(function(i,s){return t("div",{key:s,staticClass:"power-item"},[t("div",{staticClass:"title"},[t("div",{staticClass:"name"},[e._v(e._s(i.device))]),t("div",{staticClass:"status text-danger",class:{"text-success":"ON"===i.status.toUpperCase()}},[e._v(" • "+e._s(i.status.toUpperCase())+" ")])]),t("b-button",{attrs:{variant:"outline-primary"},on:{click:function(t){return e.togglePower(i)}}},[e._v(" Toggle Power ")])],1)})),e.powerDevices.length>1?t("div",{staticClass:"bulk-actions"},[t("b-button",{attrs:{variant:"success"},on:{click:function(t){return e.batchPowerControl("on")}}},[e._v(" Power On All ")]),t("b-button",{attrs:{variant:"danger"},on:{click:function(t){return e.batchPowerControl("off")}}},[e._v(" Power Off All ")])],1):e._e(),t("muted-alert",{staticClass:"info-block"},[e._v(" Rapid toggling power may result in error. Please allow a cooldown period. ")])],2)])]},proxy:!0}])})},yc=[];const kc={x:"x",y:"y",z:"z",xy:["x","y"]},Sc={up:1,down:-1,home:0},Pc={retract:-1,extrude:1};var xc={name:"PrinterControlWidget",components:{WidgetTemplate:aa,HelpWidget:Li,MutedAlert:os},props:{printer:{type:Object,required:!0},printerComm:{type:Object,required:!0}},data(){return{activeMenu:null,axis:kc,directions:Sc,filamentDirections:Pc,xyzJogDistance:{value:10,options:[1,10,50,100]},extrudeJogDistance:{value:10,options:[1,10,50]},zOffsetJogDistance:{value:.01,options:[.005,.01,.05,.1]},activeTool:null,currentZOffset:null,customFeedRateFactor:null,customFlowRateFactor:null,customFanSpeed:null,powerDevices:[]}},computed:{tools(){const e={};for(const[t,i]of Object.entries(te()(this.printer,"status.temperatures",{})))Boolean(i.actual)&&!isNaN(i.actual)&&(t.toLowerCase().includes("tool")||t.toLowerCase().includes("extruder"))&&(e[t]=i);return e},showExtrudeControl(){return Object.keys(this.tools).length>0},showToolsSelector(){return Object.keys(this.tools).length>1},currentFeedRate(){var e;const t=null===(e=this.printer.status)||void 0===e?void 0:e.currentFeedRate;return void 0!==t?t:null},currentFlowRate(){var e;const t=null===(e=this.printer.status)||void 0===e?void 0:e.currentFlowRate;return void 0!==t?t:null},currentFanSpeed(){var e;const t=null===(e=this.printer.status)||void 0===e?void 0:e.currentFanSpeed;return void 0!==t?t:null},hideTunePrinter(){return this.printer.isAgentMoonraker()&&null===this.currentFlowRate&&null===this.currentFanSpeed&&null===this.currentFeedRate}},watch:{tools:{handler:function(e,t){e&&(this.activeTool=Object.keys(e)[0])},immediate:!0},printer:{handler:function(e,t){e.isActive()&&["move-head","extrude"].includes(this.activeMenu)&&(this.activeMenu=null)},deep:!0},xyzJogDistance:{handler:function(e,t){Object(ue["a"])()&&localStorage.setItem("xyz-mm-per-step-"+this.printer.id,e.value)},deep:!0},extrudeJogDistance:{handler:function(e,t){Object(ue["a"])()&&localStorage.setItem("extrude-mm-per-step-"+this.printer.id,e.value)},deep:!0},zOffsetJogDistance:{handler:function(e,t){Object(ue["a"])()&&localStorage.setItem("z-offset-mm-per-step-"+this.printer.id,e.value)},deep:!0},activeMenu(e,t){"baby-step-z"===e?this.getCurrentZOffset():"tune-printer"===e&&(this.customFeedRateFactor=null!==this.currentFeedRate?Math.round(100*this.currentFeedRate):null,this.customFlowRateFactor=null!==this.currentFlowRate?Math.round(100*this.currentFlowRate):null,this.customFanSpeed=null!==this.currentFanSpeed?Math.round(100*this.currentFanSpeed):null)}},created(){this.getPowerDevices(),Object(ue["a"])()&&(this.xyzJogDistance.value=+localStorage.getItem("xyz-mm-per-step-"+this.printer.id)||this.xyzJogDistance.value,this.extrudeJogDistance.value=+localStorage.getItem("extrude-mm-per-step-"+this.printer.id)||this.extrudeJogDistance.value,this.zOffsetJogDistance.value=+localStorage.getItem("z-offset-mm-per-step-"+this.printer.id)||this.zOffsetJogDistance.value);const e=e=>{27===e.keyCode&&(this.activeMenu=null)};document.addEventListener("keydown",e),this.$once("hook:destroyed",()=>{document.removeEventListener("keydown",e)})},methods:{xyzControl(e,t){let i=[],s="jog";t===this.directions.home?(i.push(e),s="home"):i.push({[e]:t*this.xyzJogDistance.value});const n={func:s,target:"_printer",args:i};this.printerComm.passThruToPrinter(n,(e,t)=>{e&&this.$swal.Toast.fire({icon:"error",title:e})})},getCurrentZOffset(){const e={func:"printer/objects/query?gcode_move",target:"moonraker_api"};this.printerComm.passThruToPrinter(e,(e,t)=>{if(e)this.currentZOffset="no reading";else{const e=t.status.gcode_move.homing_origin[2],i=parseFloat(e.toFixed(3));this.currentZOffset=i}})},homeAll(){this.xyzControl(this.axis.z,this.directions.home),this.xyzControl(this.axis.xy,this.directions.home)},disableSteppers(){const e={func:"commands",target:"_printer",args:["M18"]},t={func:"printer/gcode/script",target:"moonraker_api",kwargs:{script:"M18"}},i=this.printer.isAgentMoonraker()?t:e;this.printerComm.passThruToPrinter(i,(e,t)=>{e&&this.$swal.Toast.fire({icon:"error",title:e})})},temperatureDisplayName:ds["f"],handleFilament(e){const t=this.tools[this.activeTool].actual;if(t<179)return void this.$swal.Confirm.fire({title:"Unable to extrude / retract",html:'<p class="text-center">The hotend is below the minimum temperature</p>',confirmButtonText:"Heat to 180°C",cancelButtonText:"Cancel"}).then(e=>{e.isConfirmed&&this.printerComm.passThruToPrinter({func:"set_temperature",target:"_printer",args:[this.activeTool,180]},(e,t)=>{e&&this.$swal.Toast.fire({icon:"error",title:e})})});const i=Object.entries(this.tools).findIndex(e=>e[0]===this.activeTool),s=e*this.extrudeJogDistance.value,n=`M83\nT${i}\nG1 E${s} F300`,r={func:"commands",target:"_printer",args:[n]},a={func:"printer/gcode/script",target:"moonraker_api",kwargs:{script:n}},o=this.printer.isAgentMoonraker()?a:r;this.printerComm.passThruToPrinter(o,(e,t)=>{e&&this.$swal.Toast.fire({icon:"error",title:e})})},controlZOffset(e){const t=this.zOffsetJogDistance.value*e,i=Math.round(1e4*t)/1e4,s=i>0?"+"+i:""+i,n={func:"commands",target:"_printer",args:["M290 Z "+i],force:!0},r={func:"printer/gcode/script",target:"moonraker_api",kwargs:{script:"SET_GCODE_OFFSET Z_ADJUST="+s}},a=this.printer.isAgentMoonraker()?r:n;this.currentZOffset=null,this.printerComm.passThruToPrinter(a,(e,t)=>{e?this.$swal.Toast.fire({icon:"error",title:e}):this.getCurrentZOffset()})},setPrintSpeed(e){null===e||e<1||this.sendCommandToPrinter("M220 S"+Math.round(e))},setFlowRate(e){null===e||e<1||this.sendCommandToPrinter("M221 S"+Math.round(e))},setFanSpeed(e){if(null===e||e<0||e>100)return;let t=0===e?"M107":"M106 S"+Math.round(e/100*255);this.sendCommandToPrinter(t)},sendCommandToPrinter(e,{onError:t,onSuccess:i}={}){const s=this.printer.isAgentMoonraker()?{func:"printer/gcode/script",target:"moonraker_api",kwargs:{script:e}}:{func:"commands",target:"_printer",args:[e]};this.printerComm.passThruToPrinter(s,(e,s)=>{e?t?t(e,s):this.$swal.Toast.fire({icon:"error",title:e}):i?i(e,s):this.$swal.Toast.fire({icon:"success",title:"Command successfully sent!"})})},getPowerDevices(){if(!this.printer.isAgentMoonraker())return;const e={func:"machine/device_power/devices",target:"moonraker_api",args:[]};this.printerComm.passThruToPrinter(e,(e,t)=>{e?this.$swal.Toast.fire({icon:"error",title:e}):this.powerDevices=(null===t||void 0===t?void 0:t.devices)||[]})},togglePower(e){const t="ON"===e.status.toUpperCase()?"off":"on",i=`device=${e.device}&action=${t}`,s={func:"machine/device_power/device?"+i,target:"moonraker_api",kwargs:{verb:"post"}};this.printerComm.passThruToPrinter(s,(e,t)=>{this.getPowerDevices(),e&&this.$swal.Toast.fire({icon:"error",title:e})})},batchPowerControl(e){if(!this.powerDevices.length)return;const t=""+this.powerDevices.map(e=>e.device).join("&"),i={func:`machine/device_power/${e}?${t}`,target:"moonraker_api",kwargs:{verb:"post"}};this.printerComm.passThruToPrinter(i,(e,t)=>{this.getPowerDevices(),e&&this.$swal.Toast.fire({icon:"error",title:e})})}}},Tc=xc,Fc=(i("cc8e"),Object(E["a"])(Tc,wc,yc,!1,null,"14741622",null)),Dc=Fc.exports,Oc=function(){var e=this,t=e._self._c;return t("div",{staticClass:"wrapper"},[t("draggable",{attrs:{"ghost-class":"ghost",handle:".handle"},on:{start:function(t){e.dragging=!0},end:function(t){e.dragging=!1}},model:{value:e.currentItems,callback:function(t){e.currentItems=t},expression:"currentItems"}},e._l(e.currentItems,(function(i){return t("div",{key:i.id,staticClass:"item"},[t("div",{staticClass:"handle"},[t("i",{staticClass:"fas fa-grip-lines"})]),t("div",{staticClass:"title"},[t("span",[e._v(e._s(e.getTitle(i.id)))])]),t("div",{staticClass:"switch"},[t("div",{staticClass:"custom-control custom-switch"},[t("input",{staticClass:"custom-control-input update-printer",attrs:{id:"widget-toggle-"+i.id,type:"checkbox",name:"pause_on_failure"},domProps:{checked:i.enabled},on:{click:function(t){return e.toggleItemEnabled(i)}}}),t("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"widget-toggle-"+i.id}})])])])})),0),t("input",{ref:"sortingConfig",attrs:{id:"sorting-config",type:"hidden"}})],1)},Ic=[],Ac=i("b76a"),Mc=i.n(Ac),Ec={name:"ReorderModal",components:{draggable:Mc.a},props:{items:{type:Array,required:!0},extraInfo:{type:Array,required:!0}},data(){return{dragging:!1,currentItems:[]}},watch:{dragging(e,t){e||this.saveNewOrder()}},created(){this.currentItems=JSON.parse(JSON.stringify(this.items))},mounted(){},methods:{getTitle(e){return this.extraInfo.find(t=>t.id===e).title},toggleItemEnabled(e){e.enabled=!e.enabled,this.saveNewOrder()},saveNewOrder(){this.$refs.sortingConfig.value=JSON.stringify(this.currentItems)}}},Nc=Ec,Rc=(i("89d8"),Object(E["a"])(Nc,Oc,Ic,!1,null,"825483f2",null)),jc=Rc.exports,Lc=function(){var e=this,t=e._self._c;return t("widget-template",{scopedSlots:e._u([{key:"title",fn:function(){return[e._v("Printer Terminal")]},proxy:!0},{key:"content",fn:function(){return[t("div",{staticClass:"actionWrap"},[t("a",{attrs:{href:`/printers/${e.printer.id}/terminal/`}},[t("div",{staticClass:"actionBtn"},[t("i",{staticClass:"fas fa-expand actionIcon"})])]),t("div",{staticClass:"actionBtn",on:{click:e.clearFeed}},[t("i",{staticClass:"fas fa-trash actionIcon"})]),t("b-dropdown",{staticClass:"actionBtnNoP",attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn","menu-class":"scrollable",title:"Filter"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-filter"})]},proxy:!0}])},[t("div",[t("div",[t("b-dropdown-text",{staticClass:"small text-secondary"},[e._v("Filter")]),t("b-dropdown-item",{nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.updateFilterPrefs("temperature",!e.hideTempMessages)}}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.hideTempMessages?"visible":"hidden"}}),t("div",{staticClass:"filterItemH"},[t("i",{staticClass:"fas fa-fire"}),t("div",{staticClass:"text"},[e._v("Suppress Temperature")])])])]),t("b-dropdown-item",{nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.updateFilterPrefs("sd",!e.hideSDMessages)}}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.hideSDMessages?"visible":"hidden"}}),t("div",{staticClass:"filterItemH"},[t("i",{staticClass:"fas fa-sd-card"}),t("div",{staticClass:"text"},[e._v("Suppress SD Status Messages")])])])]),t("b-dropdown-item",{nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.updateFilterPrefs("gcode",!e.hideGCodeMessages)}}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.hideGCodeMessages?"visible":"hidden"}}),t("div",{staticClass:"filterItemH"},[t("i",{staticClass:"fas fa-code"}),t("div",{staticClass:"text"},[e._v("Suppress Position Messages")])])])]),t("b-dropdown-item",{nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.updateFilterPrefs("ok",!e.hideOKMessages)}}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.hideOKMessages?"visible":"hidden"}}),t("div",{staticClass:"filterItemH"},[t("i",{staticClass:"fas fa-thumbs-up"}),t("div",{staticClass:"text"},[e._v("Suppress 'OK' Messages")])])])])],1)])])],1),t("div",{staticClass:"wrapper"},[t("terminal-window",{staticClass:"feedWrap",attrs:{"terminal-feed-array":e.terminalFeedArray}}),t("div",{staticClass:"inputWrap"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputValue,expression:"inputValue"}],staticClass:"textInput",attrs:{type:"text",placeholder:"Enter code..."},domProps:{value:e.inputValue},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage.apply(null,arguments)},input:function(t){t.target.composing||(e.inputValue=t.target.value)}}}),t("b-button",{staticClass:"sendBtn",attrs:{variant:"outline-primary"},on:{click:e.sendMessage}},[e._v(" Send ")])],1)],1)]},proxy:!0}])})},Bc=[],$c={data(){return{oldTerminalFeed:null,terminalFeedArray:[],inputValue:"",hideTempMessages:!0,hideSDMessages:!0,hideOKMessages:!0,hideGCodeMessages:!0}},mounted(){const e=localStorage.getItem("printer-terminal-filter-prefs-temperature"),t=localStorage.getItem("printer-terminal-filter-prefs-sd"),i=localStorage.getItem("printer-terminal-filter-prefs-ok"),s=localStorage.getItem("printer-terminal-filter-prefs-gcode");e&&(this.hideTempMessages=JSON.parse(e)),t&&(this.hideSDMessages=JSON.parse(t)),s&&(this.hideGCodeMessages=JSON.parse(s)),i&&(this.hideOKMessages=JSON.parse(i))},methods:{onNextTerminalFeed(e){var t,i;const s=(null===e||void 0===e?void 0:e.msg)===(null===(t=this.oldTerminalFeed)||void 0===t?void 0:t.msg),n=(null===e||void 0===e?void 0:e._ts)===(null===(i=this.oldTerminalFeed)||void 0===i?void 0:i._ts),r=null===e||void 0===e?void 0:e.msg;this.oldTerminalFeed=e;const a=/((N\d+\s+)?M105)|((ok\s+([PBN]\d+\s+)*)?([BCLPR]|T\d*):-?\d+)/g,o=/((N\d+\s+)?M27)|(SD printing byte)|(Not SD printing)/g,l=/^G[0-3].*$/g;this.hideSDMessages&&o.test(r)||this.hideTempMessages&&a.test(r)||this.hideGCodeMessages&&l.test(r)||this.hideOKMessages&&"ok"===r.toLowerCase().trim()||s||n||(e.normalTimeStamp=L()().format("h:mm:ssa"),e.msg=r.trim(),this.terminalFeedArray.unshift(e))},sendMessage(){if(!this.inputValue.length)return;const e=this.inputValue.toUpperCase();this.printer.isAgentMoonraker()&&this.onNextTerminalFeed({msg:e,_ts:new Date});const t={func:"printer/gcode/script",target:"moonraker_api",kwargs:{script:""+e}},i={func:"commands",target:"_printer",args:[""+e],force:!0},s=this.printer.isAgentMoonraker()?t:i;this.printerComm.passThruToPrinter(s,(e,t)=>{e&&this.$swal.Toast.fire({icon:"error",title:e})}),this.inputValue=""},clearFeed(){this.terminalFeedArray=[]},updateFilterPrefs(e,t){localStorage.setItem("printer-terminal-filter-prefs-"+e,JSON.stringify(t)),"temperature"===e?this.hideTempMessages=t:"gcode"===e?this.hideGCodeMessages=t:"ok"===e?this.hideOKMessages=t:this.hideSDMessages=t}}},Vc=function(){var e=this,t=e._self._c;return t("div",{staticClass:"feedWrap",attrs:{colorScheme:"background"}},e._l(e.terminalFeedArray,(function(i,s){return t("div",{key:s,staticClass:"itemWrap"},[null!==i&&void 0!==i&&i.msg?t("div",{staticClass:"terminalText"},[t("p",{staticClass:"messageTimeStamp"},[e._v(" "+e._s(i.normalTimeStamp)+" ")]),t("p",{staticClass:"messageText"},[e._v(" "+e._s(i.msg)+" ")])]):e._e(),t("div",{staticClass:"divider"})])})),0)},Uc=[],zc={name:"TerminalWindow",components:{},props:{terminalFeedArray:{type:Array,required:!0}},methods:{onMenuOptionClicked(e){"share"===e&&this.onSharePrinter()}}},Wc=zc,Gc=(i("a7af"),Object(E["a"])(Wc,Vc,Uc,!1,null,"4d59d029",null)),qc=Gc.exports,Hc={name:"TerminalWidget",components:{WidgetTemplate:aa,TerminalWindow:qc},mixins:[$c],props:{printer:{type:Object,required:!0},printerComm:{type:Object,required:!0}},created(){this.printerComm.onTerminalFeedReceived=this.onNextTerminalFeed}},Jc=Hc,Yc=(i("3427"),Object(E["a"])(Jc,Lc,Bc,!1,null,"1b939f6e",null)),Kc=Yc.exports;const Zc="/resume_print/",Qc="/mute_current_print/?mute_alert=true",Xc="/acknowledge_alert/?alert_overwrite=NOT_FAILED",ed=[{id:1,title:"Print Job Control",component:"PrintJobControlWidget"},{id:2,title:"Last Print / Progress",component:"PrintProgressWidget"},{id:3,title:"Failure Detection",component:"FailureDetectionWidget"},{id:4,title:"Temperature Controls",component:"TemperatureWidget"},{id:5,title:"Printer Controls",component:"PrinterControlWidget"},{id:6,title:"Terminal Widget",component:"TerminalWidget"}];var td={name:"PrinterControlPage",components:{StreamingBox:gr,PageLayout:vt,CascadedDropdown:Kt,PrintJobControlWidget:Mo,PrintProgressWidget:ic,FailureDetectionWidget:lc,TemperatureWidget:Cc,PrinterControlWidget:Dc,TerminalWidget:Kc},data(){return{user:null,printerId:null,printer:null,webrtc:null,currentBitrate:null,lastPrint:null,lastPrintFetchCounter:0,widgetsConfig:null,customRotationDeg:Object(a["a"])("webcamRotationDeg",0)}},computed:{widgets(){if(this.widgetsConfig)return this.widgetsConfig.map(e=>{const t=ed.find(t=>t.id===e.id);return{...e,...t}})},videoRotationDeg(){var e,t,i;const s=+(null!==(e=null===(t=this.printer)||void 0===t||null===(i=t.settings)||void 0===i?void 0:i.webcam_rotation)&&void 0!==e?e:0)+this.customRotationDeg;return s%360}},watch:{printer:{handler(e,t){var i,s;e&&null===t?(this.$nextTick(this.resizeStream),this.widgetsConfig=this.restoreWidgets()):(null===e||void 0===e?void 0:e.isActive())===(null===t||void 0===t?void 0:t.isActive())&&(null===e||void 0===e||null===(i=e.current_print)||void 0===i?void 0:i.started_at)===(null===t||void 0===t||null===(s=t.current_print)||void 0===s?void 0:s.started_at)||this.fetchLastPrint({pollForCorrect:!0})},deep:!0},videoRotationDeg(){this.resizeStream()}},created(){this.user=Object(Se["f"])(),this.printerId=Ue()(window.location.pathname,"/").slice(-3,-2).pop(),this.fetchLastPrint(),this.webrtc=ar(),this.printerComm=cn.getOrCreatePrinterComm(this.printerId,X["a"].printerWebSocket(this.printerId),{onPrinterUpdateReceived:e=>{this.printer=ye(e,this.printer),this.webrtc&&!this.webrtc.initialized&&(this.webrtc.openForPrinter(this.printer.id,this.printer.auth_token),this.printerComm.setWebRTC(this.webrtc))}}),this.printerComm.connect()},mounted(){document.querySelector("body").style.paddingBottom=0,addEventListener("resize",this.resizeStream)},methods:{onMenuOptionClicked(e){"share"===e&&this.onSharePrinter()},onSharePrinter(){this.$swal.openModalWithComponent(Qr,{isProAccount:this.user.is_pro,printer:this.printer},{confirmButtonText:"Close"})},restoreWidgets(){let e=ed.map(e=>({id:e.id,enabled:!0}));Object(ue["a"])()&&(e=JSON.parse(localStorage.getItem("printer-control-widgets-"+this.printer.id))||e);for(const i of ed)e.find(e=>e.id===i.id)||e.push({id:i.id,enabled:!0});for(const i of e)ed.find(e=>e.id===i.id)||e.splice(e.indexOf(i),1);const t=e.find(e=>6===e.id);return t&&!this.printer.isAgentVersionGte("2.3.11","1.4.4")&&e.splice(e.indexOf(t),1),Object(ue["a"])()&&localStorage.setItem("printer-control-widgets-"+this.printer.id,JSON.stringify(e)),e},onUpdateSettings(e){const{settingName:t,settingValue:i}=e;this.printer[t]=i,Q["a"].patch(X["a"].printer(this.printer.id),{[t]:i}).catch(e=>{console.error("Failed to update printer settings: ",e)})},fetchLastPrint(e){const t={pollForCorrect:!1},{pollForCorrect:i}=e||t;Q["a"].get(X["a"].prints(),{params:{start:0,limit:1,filter_by_printer_ids:[this.printerId],sorting:"date_desc"}}).then(e=>{if(e.data.length&&(this.lastPrint=_e(e.data[0])),i){let e=!1;if(this.lastPrint&&this.printer.isActive()===this.lastPrint.status.isActive||(e=!0),e&&this.lastPrintFetchCounter<5){const e=1e3*(this.lastPrintFetchCounter+1);setTimeout(()=>this.fetchLastPrint({pollForCorrect:!0}),e),this.lastPrintFetchCounter+=1}else this.lastPrintFetchCounter=0}}).catch(e=>{console.error("Error fetching last print: ",e)})},resizeStream(){const e=this.$refs.streamInner;if(!e)return;const t=e.parentElement,i=window.getComputedStyle(t),s=i.getPropertyValue("position");if("fixed"!==s)return e.style.width="100%",void(e.style.height="auto");const n=t.getBoundingClientRect(),r=n.width,a=n.height,o=this.videoRotationDeg%180!==0,l=this.printer.settings.ratio169,c=l?o?16/9:9/16:o?4/3:3/4;let d=r,u=d*c;u>a&&(u=a,d=u/c),o&&(d=Math.max(d,u),u=Math.max(d,u)),e.style.width=d+"px",e.style.height=u+"px"},onNotAFailureClicked(e,t){this.$swal.Confirm.fire({title:"Noted!",html:'<p>Do you want to mute failure detection on for this print?</p><small>If you select "Mute", failure detection will be turned off for this print, but will be automatically turned on for your next print.</small>',confirmButtonText:"Mute",cancelButtonText:"Cancel"}).then(e=>{e.isConfirmed&&setTimeout(()=>{this.onSendPrinterAction(this.printer.id,Qc)},1e3),t?(this.printer.setTransientState("Resuming"),this.onSendPrinterAction(this.printer.id,Zc)):this.onSendPrinterAction(this.printer.id,Xc)}),e.preventDefault()},onSendPrinterAction(e,t,i){Q["a"].post(X["a"].printerAction(e,t))},onReorderClicked(){this.$swal.openModalWithComponent(jc,{items:[...this.widgetsConfig],extraInfo:ed},{confirmButtonText:"Save",showCancelButton:!0,preConfirm:()=>({config:document.getElementById("sorting-config").value})}).then(e=>{var t;if(null!==(t=e.value)&&void 0!==t&&t.config){const t=JSON.parse(e.value.config);this.widgetsConfig=t,Object(ue["a"])()&&localStorage.setItem("printer-control-widgets-"+this.printer.id,JSON.stringify(t))}})}}},id=td,sd=(i("a17f"),Object(E["a"])(id,Jl,Yl,!1,null,"784f4dc8",null)),nd=sd.exports,rd=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[t("b-container",{staticClass:"flex-full-size",class:{"is-in-mobile":e.useMobileLayout},attrs:{fluid:"xl"}},[t("b-row",{staticClass:"flex-full-size"},[t("b-col",{staticClass:"flex-full-size"},[e.user?t("div",{staticClass:"flex-full-size"},[e.useMobileLayout?t("div",{staticClass:"mobile-settings-wrapper full-on-mobile"},["/user_preferences/"===e.$route.path?t("div",{staticClass:"mobile-settings-categories"},[t("h2",{directives:[{name:"show",rawName:"v-show",value:!e.onlyNotifications(),expression:"!onlyNotifications()"}],staticClass:"categories-title section-title"},[e._v(" Account ")]),e._l(e.sections,(function(i,s){return[i.isHidden?e._e():t("router-link",{key:s,class:i.isSubcategory?"subcategory":"",attrs:{to:i.route}},[t("span",[i.faIcon?t("i",{class:[i.faIcon,"mr-2"],staticStyle:{"font-size":"1.125rem"}}):e._e(),t("span",[e._v(e._s(i.title))])]),t("i",{staticClass:"fas fa-arrow-right"})])]})),e.onlyNotifications()?e._e():t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.logout.apply(null,arguments)}}},[t("span",[t("i",{class:["fas fa-sign-out-alt","mr-2"],staticStyle:{"font-size":"1.125rem"}}),e._v(" Logout ")])])],2):t("div",{staticClass:"mobile-settings-content",class:{"is-in-mobile":e.useMobileLayout}},[!e.currentSection||e.currentSection.isNotificationChannel&&!e.availableNotificationPlugins?e._e():t(e.currentRouteComponent,{tag:"component",attrs:{user:e.user,"error-messages":e.errorMessages,saving:e.saving,config:e.config,"notification-channel":e.currentSection&&e.currentSection.isNotificationChannel?e.currentSection:{}},on:{createNotificationChannel:e.createNotificationChannel,updateNotificationChannel:e.patchNotificationChannel,deleteNotificationChannel:e.deleteNotificationChannel,clearErrorMessages:e.clearErrorMessages,addErrorMessage:e.addErrorMessage,updateSetting:e.updateSetting}})],1)]):t("b-tabs",{staticClass:"desktop-settings-wrapper",attrs:{vertical:!0,"nav-wrapper-class":"settings-nav","active-nav-item-class":"","content-class":"desktop-settings-content"},on:{"activate-tab":e.updateRoute},scopedSlots:e._u([{key:"tabs-end",fn:function(){return[t("li",{staticClass:"nav-item"},[t("a",{staticClass:"nav-link",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.logout.apply(null,arguments)}}},[t("i",{class:["fas fa-sign-out-alt","mr-2"]}),e._v(" Logout ")])])]},proxy:!0}],null,!1,1810625595)},[e._l(e.sections,(function(i,s){return[i.isHidden?e._e():t("b-tab",{key:s,attrs:{"title-item-class":i.isSubcategory?"subcategory":"",active:e.$route.path===i.route,disabled:i.isNotificationChannel&&!e.user.notification_enabled},scopedSlots:e._u([{key:"title",fn:function(){return[i.faIcon?t("i",{class:[i.faIcon,"mr-2"]}):e._e(),e._v(" "+e._s(i.title)+" ")]},proxy:!0}],null,!0)},[!i.isNotificationChannel||e.availableNotificationPlugins?t(s,{tag:"component",attrs:{user:e.user,"error-messages":e.errorMessages,saving:e.saving,config:e.config,"notification-channel":i.isNotificationChannel?i:{}},on:{createNotificationChannel:e.createNotificationChannel,updateNotificationChannel:e.patchNotificationChannel,deleteNotificationChannel:e.deleteNotificationChannel,clearErrorMessages:e.clearErrorMessages,addErrorMessage:e.addErrorMessage,updateSetting:e.updateSetting}}):e._e()],1)]}))],2)],1):t("div",{staticClass:"text-center"},[t("b-spinner",{staticClass:"mt-5",attrs:{label:"Loading..."}})],1)])],1)],1)]},proxy:!0}])})},ad=[];const od={GeneralPreferences:{title:"General",faIcon:"fas fa-cog",importComponent:()=>i.e("chunk-2d0d5f72").then(i.bind(null,"7113")),route:H.GeneralPreferences,isHidden:Object(Se["a"])()||Object(Se["d"])()},ThemePreferences:{title:"Appearance",faIcon:"fas fa-magic",importComponent:()=>i.e("chunk-ba8543c0").then(i.bind(null,"3922")),route:H.ThemePreferences,isHidden:Object(Se["a"])()&&!("true"===new URLSearchParams(window.location.search).get("themeable"))||Object(Se["d"])()},ProfilePreferences:{title:"Profile",faIcon:"fas fa-user-edit",importComponent:()=>i.e("chunk-2d22c522").then(i.bind(null,"f376")),route:H.ProfilePreferences,isHidden:Object(Se["d"])()},AuthorizedApps:{title:"Authorized Apps",faIcon:"fas fa-check-circle",importComponent:()=>i.e("chunk-2d21a9b7").then(i.bind(null,"bbde")),route:H.AuthorizedApps,isHidden:Object(Se["d"])()},GeneralNotifications:{title:"Notifications",faIcon:"fas fa-bell",importComponent:()=>i.e("chunk-09213160").then(i.bind(null,"9c95")),route:H.GeneralNotifications},PushNotifications:{title:"Push Notification",isSubcategory:!0,isNotificationChannel:!0,importComponent:()=>({}),route:H.PushNotifications,isHidden:!Object(Se["a"])()}},ld=Object.keys(W).reduce((e,t)=>Object.assign(e,{[t]:{title:W[t].displayName,channelName:t,isSubcategory:!0,isNotificationChannel:!0,route:H[t],importComponent:()=>i("17ae")("./"+W[t].componentName)}}),{});var cd={...od,...ld},dd={name:"UserPreferencesPage",components:{PageLayout:vt,...Object.keys(cd).reduce((e,t)=>Object.assign(e,{[t]:cd[t].importComponent}),{})},props:{config:{default(){return{}},type:Object}},data(){return{sections:cd,availableNotificationPlugins:null,configuredNotificationChannels:null,onlyNotifications:Se["d"],user:null,saving:{},errorMessages:{},delayedSubmit:{first_name:{delay:1e3,timeoutId:null},last_name:{delay:1e3,timeoutId:null}},combinedInputs:{},useMobileLayout:!1}},computed:{visibleSections(){return Object.values(cd).filter(e=>!e.isHidden)},currentRouteComponent(){for(const[e,t]of Object.entries(H))if(this.$route.path===t)return e;return null},currentSection(){for(const e of Object.values(this.sections))if(e.route===this.$route.path)return e;return null},inMobileWebView(){return Object(Se["a"])()},clientIsThemeable(){return!Object(Se["a"])()||"true"===new URLSearchParams(window.location.search).get("themeable")}},created(){this.fetchNotificationPlugins(),this.fetchNotificationChannels(),this.fetchUser()},mounted(){this.checkMobileLayout(),window.onresize=this.checkMobileLayout,this.useMobileLayout&&(document.querySelector("body").style.paddingTop="0px")},methods:{updateRoute(e){const t=Object.values(this.visibleSections)[e];this.$router.replace({path:t.route})},logout(){this.$swal.Confirm.fire({title:"Confirmation",html:'<p class="text-center">You a going to logout from your account</p>',confirmButtonText:"Logout",cancelButtonText:"Cancel"}).then(e=>{e.isConfirmed&&window.location.replace("/accounts/logout/")})},checkMobileLayout(){const e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);this.useMobileLayout=Object(Se["a"])()||e<1140},fetchUser(){return Q["a"].get(X["a"].user()).then(e=>{this.user=e.data})},fetchNotificationPlugins(){return Q["a"].get(X["a"].notificationPlugins()).then(e=>{const t=e.data.plugins||{};this.availableNotificationPlugins=t;for(const[i,s]of Object.entries(this.sections))s.isNotificationChannel&&(this.sections[i].pluginInfo=t[s.channelName])})},fetchNotificationChannels(){return Q["a"].get(X["a"].notificationChannels()).then(e=>{const t=e.data;this.configuredNotificationChannels=t;for(const[i,s]of Object.entries(this.sections))s.isNotificationChannel&&(this.sections[i].channelInfo=t.find(e=>e.name===s.channelName))})},createNotificationChannel({section:e,config:t,opts:i={}}){const s={user:this.user.id,name:e.channelName,config:t,...i},n=Object(ds["e"])(e,"config");return this.setSavingStatus(n,!0),Q["a"].post(X["a"].notificationChannels(),s).then(()=>{this.setSavingStatus(n,!1),this.$router.go()}).catch(t=>{if(this.setSavingStatus(n,!1),t.response&&t.response.data&&"object"===typeof t.response.data){let i=[];for(const e of Object.values(t.response.data))if("object"===typeof e)for(const t of Object.values(e))i.push(t);else"string"===typeof e?i.push(e):(console.warn("Undefined error object structure"),console.log(t.response));const s=Object(ds["e"])(e,"config");this.$set(this.errorMessages,s,i)}else this.errorDialog(t,"Can not update your preferences")})},patchNotificationChannel({section:e,propNames:t,propValues:i}){void 0!==i&&i.forEach((i,s)=>{const n=t[s];this.sections[e.channelName].channelInfo[n]=i});let s={name:e.channelName};for(const n of t)s[n]=e.channelInfo[n];for(const n of t){const t=Object(ds["e"])(e,n);this.setSavingStatus(t,!0)}return Q["a"].patch(X["a"].updateNotificationChannel(e.channelInfo.id),s).then(()=>{for(const i of t){const t=Object(ds["e"])(e,i);this.setSavingStatus(t,!1)}}).catch(i=>{for(const s of t){const t=Object(ds["e"])(e,s);this.setSavingStatus(t,!1)}if(i.response&&i.response.data&&"object"===typeof i.response.data){let s=[];for(const e of Object.values(i.response.data))if("object"===typeof e)for(const t of Object.values(e))s.push(t);else"string"===typeof e?s.push(e):(console.warn("Undefined error object structure"),console.log(i.response));for(const i of t){const t=Object(ds["e"])(e,i);this.$set(this.errorMessages,t,s)}}else this.errorDialog(i,"Can not update your preferences")})},deleteNotificationChannel(e){return Q["a"].delete(X["a"].updateNotificationChannel(e.channelInfo.id)).then(()=>{this.$router.go()}).catch(e=>{this.errorDialog(e,"Can not update your preferences")})},clearErrorMessages(e){this.errorMessages[e]=[]},addErrorMessage(e,t){this.errorMessages[e]?this.errorMessages[e].push(t):this.errorMessages[e]=[t]},patchUser(e,t){let i={},s=e;const n=this.checkForCombinedValues(e);if(n){for(const r of n.inputs){s=n.key;const e=this.user[r];i[r]=e}const e=Object.values(i),t=e.filter(e=>!e);if(t.length!==e.length&&0!==t.length)return}else i={[e]:t};return this.setSavingStatus(s,!0),Q["a"].patch(X["a"].user(),i).catch(e=>{if(e.response&&e.response.data&&"object"===typeof e.response.data)if(e.response.data.non_field_errors)this.errorDialog(e,e.response.data.non_field_errors);else for(const t in e.response.data)this.errorMessages[s]=e.response.data[t];else this.errorDialog(e,"Can not update your preferences")}).then(()=>{window.ReactNativeWebView&&("first_name"===s?window.ReactNativeWebView.postMessage(JSON.stringify({firstName:this.user.first_name})):"last_name"===s&&window.ReactNativeWebView.postMessage(JSON.stringify({lastName:this.user.last_name}))),this.setSavingStatus(s,!1)})},checkForCombinedValues(e){for(const[t,i]of Object.entries(this.combinedInputs))if(i.includes(e))return{inputs:i,key:t};return null},setSavingStatus(e,t){t&&delete this.errorMessages[e],this.$set(this.saving,e,t)},updateSetting(e,t){if(void 0!==t&&(this.user[e]=t),e in this.delayedSubmit){const t=this.delayedSubmit[e];return t["timeoutId"]&&clearTimeout(t["timeoutId"]),void(this.delayedSubmit[e]["timeoutId"]=setTimeout(()=>{this.patchUser(e,this.user[e])},t["delay"]))}this.patchUser(e,this.user[e])}}},ud=dd,pd=(i("324d"),Object(E["a"])(ud,rd,ad,!1,null,"2359dcc0",null)),hd=pd.exports,fd=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"topBarRight",fn:function(){return[t("div",[t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-filter"})]},proxy:!0}])},[e._l(e.eventClassFiltering,(function(i){return t("b-dropdown-item",{key:i.key,on:{click:function(t){return e.toggleEventFiltering("eventClassFiltering",i.key)}}},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:i.selected?"visible":"hidden"}}),t("span",{class:e.cssClassFromEventClass(i.key)},[e._v(e._s(i.title))])])})),t("b-dropdown-divider"),e._l(e.eventTypeFiltering,(function(i){return t("b-dropdown-item",{key:i.key,on:{click:function(t){return e.toggleEventFiltering("eventTypeFiltering",i.key)}}},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:i.selected?"visible":"hidden"}}),e._v(e._s(i.title)+" ")])}))],2)],1)]},proxy:!0},{key:"content",fn:function(){return[t("b-container",[t("b-row",{staticClass:"justify-content-center"},[t("div",{staticClass:"col-sm-12 col-md-10 col-lg-8"},[e.loading||0!==e.printerEvents.length?t("div",[e._l(e.printerEvents,(function(e){return t("printer-event-card",{key:e.id,attrs:{"printer-event":e}})})),t("mugen-scroll",{staticClass:"text-center p-4",attrs:{handler:e.fetchMoreData,"should-handle":!e.loading}},[e.noMoreData?t("div",{staticClass:"text-center p-2"},[e._v("No more notifications.")]):e._e(),e.noMoreData?e._e():t("b-spinner",{attrs:{label:"Loading..."}})],1)],2):t("div",{staticClass:"text-center"},[t("img",{staticClass:"w-25 my-4",attrs:{src:i("f23d")}}),t("h5",{staticClass:"text-primary"},[e._v("Nothing to look here. Enjoy your vacation!")])])])])],1)]},proxy:!0}])})},md=[],gd=function(){var e=this,t=e._self._c;return t("div",{staticClass:"printer-event-card my-3",class:e.tintBorderClass},[t("div",{staticClass:"printer-event-text",class:{link:e.printerEvent.info_url},on:{click:e.onTextClick}},[t("div",{staticClass:"title font-weight-bold my-2",class:e.tintClass},[e._v(" "+e._s(e.eventTitle)+" "),e.printerEvent.info_url?t("i",{staticClass:"fas fa-external-link-alt"}):e._e()]),t("div",{staticClass:"description",domProps:{innerHTML:e._s(e.printerEvent.event_text)}}),t("div",{staticClass:"my-2 text-muted font-weight-light small"},[e._v(" "+e._s(e.printerEvent.created_at.format("LLLL"))+" ")])]),e.printerEvent.image_url?t("div",{staticClass:"printer-event-snapshot",style:{backgroundImage:`url(${e.printerEvent.image_url})`}}):e._e()])},vd=[],bd={name:"PrinterEventCard",components:{},props:{printerEvent:{type:Object,required:!0}},computed:{eventTitle(){return this.printerEvent.event_title||"Unknown event"},tintClass(){switch(this.printerEvent.event_class){case"ERROR":return"text-danger";case"WARNING":return"text-warning";case"SUCCESS":return"text-success";default:return""}},tintBorderClass(){switch(this.printerEvent.event_class){case"ERROR":return"border-danger";case"WARNING":return"border-warning";case"SUCCESS":return"border-success";default:return""}}},methods:{onTextClick(){this.printerEvent.info_url&&window.open(this.printerEvent.info_url,"_blank")}}},_d=bd,Cd=(i("86d5"),Object(E["a"])(_d,gd,vd,!1,null,"0f7e8e5e",null)),wd=Cd.exports;const yd={eventClassFiltering:"printer-event-class-filtering",eventTypeFiltering:"printer-event-type-filtering"},kd=(e,t)=>`${yd["prefix"]}.${t}`,Sd=(e,t,i)=>Object(a["a"])(kd(e,t),i),Pd=12;var xd={name:"PrinterEventsPage",components:{MugenScroll:Wt.a,PageLayout:vt,PrinterEventCard:wd},props:{},data(){return{printerEvents:[],loading:!1,noMoreData:!1,eventClassFiltering:[{key:"ERROR",title:"Error",selected:Sd("eventClassFiltering","ERROR",!0)},{key:"WARNING",title:"Warning",selected:Sd("eventClassFiltering","WARNING",!0)},{key:"SUCCESS",title:"Successs",selected:Sd("eventClassFiltering","SUCCESS",!0)},{key:"INFO",title:"Other",selected:Sd("eventClassFiltering","INFO",!0)}],eventTypeFiltering:[{key:"ALERT",title:"Failure Detection",selected:Sd("eventTypeFiltering","ALERT",!0)},{key:"ENDED",title:"Print Job Ended",selected:Sd("eventTypeFiltering","ENDED",!0)},{key:"STARTED",title:"Print Job Started",selected:Sd("eventTypeFiltering","STARTED",!0)},{key:"PAUSE_RESUME",title:"Print Job Paused/Resumed",selected:Sd("eventTypeFiltering","PAUSE_RESUME",!0)},{key:"FILAMENT_CHANGE",title:"Filament Change",selected:Sd("eventTypeFiltering","FILAMENT_CHANGE",!0)},{key:"PRINTER_ERROR",title:"Printer Error",selected:Sd("eventTypeFiltering","PRINTER_ERROR",!0)}]}},created(){this.refetchData()},methods:{fetchMoreData(){if(this.noMoreData)return;this.loading=!0;const e=Ss()(co()(this.eventClassFiltering,"selected"),"key"),t=Ss()(co()(this.eventTypeFiltering,"selected"),"key");Q["a"].get(X["a"].printerEvents(),{params:{start:this.printerEvents.length,limit:Pd,filter_by_classes:e,filter_by_types:t}}).then(e=>{this.loading=!1,this.noMoreData=e.data.length<Pd,this.printerEvents.push(...e.data.map(e=>ke(e)))})},refetchData(){this.printerEvents=[],this.noMoreData=!1,this.fetchMoreData()},cssClassFromEventClass(e){switch(e){case"ERROR":return"text-danger";case"INFO":return"";default:return"text-"+e.toLowerCase()}},toggleEventFiltering(e,t){const i=Qe()(this[e],e=>e.key==t),s=this[e][i];this.$set(this[e],i,{...s,selected:!s.selected}),Object(a["b"])(kd("eventClassFiltering",e.key),!s.selected),this.refetchData()}}},Td=xd,Fd=Object(E["a"])(Td,fd,md,!1,null,"170eef32",null),Dd=Fd.exports,Od=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"topBarLeft",fn:function(){return[t("div",{staticClass:"printer-name truncated"},[e._v(" "+e._s(e.printer?e.printer.name:"")+" ")])]},proxy:!0},{key:"topBarRight",fn:function(){return[e.printer?t("div",{staticClass:"action-panel"},[t("a",{staticClass:"btn shadow-none action-btn icon-btn",attrs:{href:`/tunnels/${e.printer.id}/`,title:"OctoPrint Tunnel"}},[t("svg",{staticClass:"custom-svg-icon"},[t("use",{attrs:{href:"#svg-tunnel"}})]),t("span",{staticClass:"sr-only"},[e._v("OctoPrint Tunnel")])]),t("a",{staticClass:"btn shadow-none action-btn icon-btn",attrs:{href:`/printers/${e.printer.id}/`,title:"Configure"}},[t("i",{staticClass:"fas fa-wrench"}),t("span",{staticClass:"sr-only"},[e._v("Configure")])]),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn d-md-none"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}],null,!1,3452768261)},[t("cascaded-dropdown",{ref:"cascadedDropdown",attrs:{"menu-options":[{key:"tunnel",svgIcon:"svg-tunnel",title:"OctoPrint Tunnel",href:`/tunnels/${e.printer.id}/`},{key:"settings",icon:"fas fa-wrench",title:"Configure",href:`/printers/${e.printer.id}/`}]},on:{menuOptionClicked:e.onMenuOptionClicked}})],1)],1):e._e()]},proxy:!0},{key:"content",fn:function(){return[t("div",{staticClass:"contentWrap"},[t("div",{staticClass:"controlsWrap"},[t("div",{staticClass:"inputWrap"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputValue,expression:"inputValue"}],staticClass:"textInput",attrs:{type:"text",placeholder:"Enter code..."},domProps:{value:e.inputValue},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage.apply(null,arguments)},input:function(t){t.target.composing||(e.inputValue=t.target.value)}}}),t("div",{staticClass:"sendBtn",on:{click:e.sendMessage}},[t("i",{staticClass:"fas fa-chevron-right sendIcon"})])]),t("div",{staticClass:"buttonWrap"},[t("div",{staticClass:"buttonHolder",on:{click:e.clearFeed}},[t("i",{staticClass:"fas fa-trash actionIcon"})]),t("b-dropdown",{staticClass:"actionBtnNoP",attrs:{right:"","no-caret":"","toggle-class":"action-btn icon-btn","menu-class":"scrollable",title:"Filter"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-filter"})]},proxy:!0}])},[t("div",[t("div",[t("b-dropdown-text",{staticClass:"small text-secondary"},[e._v("Filter")]),t("b-dropdown-item",{nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.updateFilterPrefs("temperature",!e.hideTempMessages)}}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.hideTempMessages?"visible":"hidden"}}),t("div",{staticClass:"filterItemH"},[t("i",{staticClass:"fas fa-fire"}),t("div",{staticClass:"text"},[e._v("Suppress Temperature")])])])]),t("b-dropdown-item",{nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.updateFilterPrefs("sd",!e.hideSDMessages)}}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.hideSDMessages?"visible":"hidden"}}),t("div",{staticClass:"filterItemH"},[t("i",{staticClass:"fas fa-sd-card"}),t("div",{staticClass:"text"},[e._v("Suppress SD Status Messages")])])])]),t("b-dropdown-item",{nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.updateFilterPrefs("gcode",!e.hideGCodeMessages)}}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.hideGCodeMessages?"visible":"hidden"}}),t("div",{staticClass:"filterItemH"},[t("i",{staticClass:"fas fa-code"}),t("div",{staticClass:"text"},[e._v("Suppress Position Messages")])])])]),t("b-dropdown-item",{nativeOn:{"!click":function(t){return t.stopPropagation(),t.preventDefault(),e.updateFilterPrefs("ok",!e.hideOKMessages)}}},[t("div",{staticClass:"dropdown-text-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.hideOKMessages?"visible":"hidden"}}),t("div",{staticClass:"filterItemH"},[t("i",{staticClass:"fas fa-thumbs-up"}),t("div",{staticClass:"text"},[e._v("Suppress 'OK' Messages")])])])])],1)])])],1)]),t("terminal-window",{staticClass:"feedWrap",attrs:{"terminal-feed-array":e.terminalFeedArray}})],1)]},proxy:!0}])})},Id=[],Ad={name:"PrinterTerminalPage",components:{PageLayout:vt,CascadedDropdown:Kt,TerminalWindow:qc},mixins:[$c],data:function(){return{user:null,printerId:null,printer:null}},created(){this.user=Object(Se["f"])(),this.printerId=Ue()(window.location.pathname,"/").slice(-3,-2).pop(),this.printerComm=cn.getOrCreatePrinterComm(this.printerId,X["a"].printerWebSocket(this.printerId),{onPrinterUpdateReceived:e=>{this.printer=ye(e,this.printer),this.webrtc&&!this.webrtc.initialized&&(this.webrtc.openForPrinter(this.printer.id,this.printer.auth_token),this.printerComm.setWebRTC(this.webrtc))},onTerminalFeedReceived:this.onNextTerminalFeed}),this.printerComm.connect()},methods:{onMenuOptionClicked(e){"share"===e&&this.onSharePrinter()}}},Md=Ad,Ed=(i("b62f"),Object(E["a"])(Md,Od,Id,!1,null,"3ee1b864",null)),Nd=Ed.exports;const Rd=new n["a"]({mode:"history",routes:[{path:"/g_code_folders/cloud/:parentFolder",component:ro},{path:"/g_code_folders/local/:printerId/:parentFolder?",component:ro},{path:"/g_code_files/cloud/:fileId",component:Co},{path:"/g_code_files/local/:printerId/:fileId",component:Co},{path:"/user_preferences",component:hd},...Object.values(H).map(e=>({path:e,component:hd})),...Object.values(Y).map(e=>({path:e,component:Hl}))]}),jd={NewOctoPrintTunnelPage:Le,OctoPrintTunnelPage:qe,PrintShotFeedbackApp:$t,PrinterListPage:Zo,SharedPrinterPage:cl,PrinterSettingsPage:Sl,PrinterWizardPage:Hl,PrinterControlPage:nd,GCodeFoldersPage:ro,GCodeFilePage:Co,PrintsPage:Xs,PrintPage:Ln,PrintHistoryPage:Xi,StatsPage:Cs,UploadPrintPage:qn,UserPreferencesPage:hd,PrinterEventsPage:Dd,PrinterTerminalPage:Nd};z(Rd,jd)},"587d":function(e,t,i){"use strict";i("9135")},"58d0":function(e,t,i){"use strict";i("30c2")},"596e":function(e,t,i){},"59cf":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"c",(function(){return r})),i.d(t,"b",(function(){return c})),i.d(t,"d",(function(){return d}));var s=i("6c44");const n={Light:"Light",Dark:"Dark",System:"System"},r=(Object(s["a"])()?localStorage.getItem("colorTheme"):n.Dark)||n.Dark,a=[{name:"primary",values:{[n.Light]:"#01A299",[n.Dark]:"#03DAC5"}},{name:"primary-hover",values:{[n.Light]:"#019592",[n.Dark]:"#70EFDE"}},{name:"primary-muted",values:{[n.Light]:"#03DAC5",[n.Dark]:"#018786"}},{name:"on-primary",values:{[n.Light]:"#FFFFFF",[n.Dark]:"#001210"}},{name:"secondary",values:{[n.Light]:"#28303A",[n.Dark]:"#EBEBEB"}},{name:"secondary-hover",values:{[n.Light]:"#424A54",[n.Dark]:"#D0D0D0"}},{name:"on-secondary",values:{[n.Light]:"#EBEBEB",[n.Dark]:"#28303A"}},{name:"success",values:{[n.Light]:"#5CB85C",[n.Dark]:"#5CB85C"}},{name:"success-hover",values:{[n.Light]:"#4CAE4C",[n.Dark]:"#4CAE4C"}},{name:"on-success",values:{[n.Light]:"#ffffff",[n.Dark]:"#ffffff"}},{name:"danger",values:{[n.Light]:"#D9534F",[n.Dark]:"#D9534F"}},{name:"danger-hover",values:{[n.Light]:"#C2413D",[n.Dark]:"#C2413D"}},{name:"on-danger",values:{[n.Light]:"#ffffff",[n.Dark]:"#ffffff"}},{name:"warning",values:{[n.Light]:"#F0AD4E",[n.Dark]:"#F0AD4E"}},{name:"warning-hover",values:{[n.Light]:"#DB9A3F",[n.Dark]:"#DB9A3F"}},{name:"on-warning",values:{[n.Light]:"#ffffff",[n.Dark]:"#ffffff"}},{name:"on-warning-2",values:{[n.Light]:"#000000",[n.Dark]:"#000000"}},{name:"background",values:{[n.Light]:"#EBEBEB",[n.Dark]:"#233141"}},{name:"surface-primary",values:{[n.Light]:"#ffffff",[n.Dark]:"#485B71"}},{name:"surface-secondary",values:{[n.Light]:"#F5F5F5",[n.Dark]:"#2D3E4F"}},{name:"overlay",values:{[n.Light]:"#F5F5F5CC",[n.Dark]:"#000000CC"}},{name:"hover",values:{[n.Light]:"#66666613",[n.Dark]:"#FFFFFF13"}},{name:"hover-accent",values:{[n.Light]:"#66666626",[n.Dark]:"#C9E0FA26"}},{name:"divider",values:{[n.Light]:"#ABB6C2",[n.Dark]:"#6A7B8A"}},{name:"divider-muted",values:{[n.Light]:"#ABB6C266",[n.Dark]:"#6A7B8A66"}},{name:"text-primary",values:{[n.Light]:"#28303A",[n.Dark]:"#EBEBEB"}},{name:"text-secondary",values:{[n.Light]:"#8A94A2",[n.Dark]:"#AAACB0"}},{name:"text-help",values:{[n.Light]:"#4C9BE8",[n.Dark]:"#4C9BE8"}},{name:"input-background",values:{[n.Light]:"#E2E8ED",[n.Dark]:"#42566B"}},{name:"input-placeholder",values:{[n.Light]:"#28303A80",[n.Dark]:"#EBEBEB80"}},{name:"table-accent",values:{[n.Light]:"#E3E3E3",[n.Dark]:"#283848"}},{name:"icon-tunneling-1",values:{[n.Light]:"#4E5D6C",[n.Dark]:"#EAEAEA"}},{name:"icon-tunneling-2",values:{[n.Light]:"#1D2935",[n.Dark]:"#CDCDCD"}}],o=[{name:"loader",values:{[n.Light]:'url("/static/img/loader/loader_light-scheme.svg")',[n.Dark]:'url("/static/img/loader/loader_dark-scheme.svg")'}}],l=[{name:"top-nav",values:{[n.Light]:"0px 2px 10px rgb(0 0 0 / .1)",[n.Dark]:"0px 2px 10px rgb(0 0 0 / .3)"}}];function c(e){return e.value===n.System?"not all"!==window.matchMedia("(prefers-color-scheme)").media&&window.matchMedia("(prefers-color-scheme: light)").matches?n.Light:n.Dark:e.value}function d(e){a.forEach((function(t){if(document.documentElement.style.setProperty("--color-"+t.name,t.values[e]),"surface-secondary"===t.name){let i=document.querySelector('meta[name="theme-color"]');i.content=t.values[e]}})),o.forEach((function(t){document.documentElement.style.setProperty("--url-"+t.name,t.values[e])})),l.forEach((function(t){document.documentElement.style.setProperty("--shadow-"+t.name,t.values[e])}))}},"5a0b":function(e,t,i){"use strict";i("ffb3")},"5b32":function(e,t,i){"use strict";i("e6d7")},"5d5f":function(e,t,i){"use strict";i("f1ca")},"5e59":function(e,t,i){},"5f1e":function(e,t,i){},"5fdc":function(e,t,i){"use strict";i("bc75")},"60f8":function(e,t,i){},"664d":function(e,t,i){"use strict";i("b818")},6652:function(e,t,i){},6727:function(e,t,i){"use strict";i("f444")},"67fa":function(e,t,i){},6892:function(e,t,i){"use strict";i("04b2")},6919:function(e,t,i){},"6a40":function(e,t,i){},"6c44":function(e,t,i){"use strict";function s(){try{const e="__random_key_we_are_not_going_to_use__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}i.d(t,"a",(function(){return s}))},"6dc3":function(e,t,i){},7022:function(e,t,i){},"740f":function(e,t,i){"use strict";i("28d5")},"767e":function(e,t,i){e.exports={primary:"#00c4b4",white:"#fff"}},7902:function(e,t,i){},"7eaa":function(e,t,i){},"7f6b":function(e,t,i){"use strict";i("f5a0")},"800e":function(e,t,i){"use strict";i("60f8")},"807a":function(e,t,i){"use strict";i("67fa")},8373:function(e,t,i){},"847e":function(e,t,i){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{class:{"saving-in-progress":e.savingClass,"successfully-saved":e.savingDoneClass,"failed-to-save":e.savingFailedClass,"small-height":e.smallHeightClass}},[e._t("default")],2),e.errors&&e.errors.length>0?t("small",{staticClass:"text-danger"},[e._v(e._s(e.errorMsg))]):e._e()])},n=[],r={name:"SavingAnimation",props:{saving:{default(){return!1},type:Boolean},errors:{type:Array,default:null},height:{default(){return"normal"},type:String}},data(){return{savingTimeout:null,savingDoneTimeout:null}},computed:{savingClass(){return this.saving&&this.savingTimeout},savingDoneClass(){return!this.saving&&this.savingDoneTimeout&&!this.errors},savingFailedClass(){return!this.saving&&this.savingDoneTimeout&&this.errors&&this.errors.length>0},smallHeightClass(){return"small"===this.height},errorMsg(){return this.errors?this.errors.join(" "):""}},watch:{saving:function(e,t){!t&&e?(this.clearSavingTimeout(),this.savingTimeout=setTimeout(this.clearSavingTimeout,15e3)):t&&!e&&(this.clearSavingTimeout(),this.savingDoneTimeout=setTimeout(()=>{clearTimeout(this.savingDoneTimeout),this.savingDoneTimeout=null},2e3))}},methods:{clearSavingTimeout(){this.savingTimeout&&(clearTimeout(this.savingTimeout),this.savingTimeout=null)}}},a=r,o=(i("8a34"),i("2877")),l=Object(o["a"])(a,s,n,!1,null,"2e4df370",null);t["a"]=l.exports},8505:function(e,t,i){"use strict";i("4a39")},"86d5":function(e,t,i){"use strict";i("d689")},"886f":function(e,t,i){e.exports=i.p+"img/klipper_logo.jpg"},"89d8":function(e,t,i){"use strict";i("7eaa")},"8a10":function(e,t,i){},"8a34":function(e,t,i){"use strict";i("0fcf")},"8bf8":function(e,t,i){},"8f46":function(e,t,i){},"90cf":function(e,t,i){},9135:function(e,t,i){},"95bd":function(e,t,i){"use strict";i("3d45")},9605:function(e,t,i){e.exports=i.p+"img/raspberry_pi.png"},9675:function(e,t,i){"use strict";i("49f2")},"999e":function(e,t,i){"use strict";i("5424")},"9ab4":function(e,t,i){},"9cac":function(e,t,i){"use strict";i("596e")},a085:function(e,t,i){e.exports=i.p+"img/fluidd_logo.png"},a17f:function(e,t,i){"use strict";i("cdf7")},a21a:function(e,t,i){"use strict";i("b877")},a413:function(e,t,i){"use strict";i("5f1e")},a4bc:function(e,t,i){},a67f:function(e,t,i){},a7af:function(e,t,i){"use strict";i("47b9")},aad1:function(e,t,i){},ac31:function(e,t,i){},adc8:function(e,t,i){"use strict";i("ac31")},ade3:function(e,t,i){"use strict";i("b249")},ade5:function(e,t,i){},af1e:function(e,t,i){"use strict";i("df40")},b025:function(e,t,i){"use strict";i("4580")},b231:function(e,t,i){e.exports=i.p+"img/plugin_rerun_setup.png"},b249:function(e,t,i){},b279:function(e,t,i){"use strict";i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return p})),i.d(t,"d",(function(){return h})),i.d(t,"g",(function(){return f})),i.d(t,"c",(function(){return m})),i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return v}));i("5494");var s=i("e740c"),n=i.n(s),r=i("2f9f"),a=i.n(r),o=i("6373"),l=i.n(o),c=i("9b02"),d=i.n(c);function u(e,t){return`${e.channelName}_${t}`}function p(e){return n()(a()(l()(e,/_/g," ")))}const h=(e,t,i)=>{const s=Math.round(e.length*t),n=i?"p":"fields.normalized_p";return d()(e[s],""+n,0)},f=(e,t)=>{if(e)if(e instanceof Blob){const i=new FileReader;i.addEventListener("loadend",e=>{e.srcElement&&t(e.srcElement.result)}),i.readAsArrayBuffer(e)}else t(e)},m=()=>{var e;return null===(e=document.getElementsByName("csrfmiddlewaretoken")[0])||void 0===e?void 0:e.value},g=(e,t)=>{fetch(e).then(e=>e.blob()).then(e=>{const i=document.createElement("a");i.setAttribute("download",t);const s=URL.createObjectURL(e);i.href=s,i.setAttribute("target","_blank"),i.click(),URL.revokeObjectURL(s)})},v=(e,t)=>e.utcOffset(e._tzm).format(t)},b3d0:function(e,t,i){},b4a7:function(e,t,i){"use strict";i("0993")},b5c8:function(e,t,i){"use strict";i("b3d0")},b62f:function(e,t,i){"use strict";i("34a4")},b6d2:function(e,t,i){},b760:function(e,t,i){"use strict";i("6dc3")},b818:function(e,t,i){},b877:function(e,t,i){},bb8b:function(e,t,i){"use strict";i("6652")},bc75:function(e,t,i){},bcfa:function(e,t,i){"use strict";i("4b33")},bd96:function(e,t,i){"use strict";i("4dac")},be61:function(e,t,i){"use strict";i("4463")},c131:function(e,t,i){"use strict";i("8373")},c1e9:function(e,t,i){"use strict";i("50b5")},c49c:function(e,t,i){"use strict";i("8f46")},c5c0:function(e,t,i){"use strict";i("edea")},c7f6:function(e,t,i){"use strict";var s=i("0b49"),n=i.n(s),r=i("dd61"),a=i.n(r);t["a"]={printShotFeedback:(e,t)=>`/api/v1/printshotfeedbacks/${e}/?print_id=${t}`,print:e=>`/api/v1/prints/${e}/`,prints:()=>"/api/v1/prints/",printsBulkDelete:()=>"/api/v1/prints/bulk_delete/",stats:()=>"/api/v1/prints/stats/",printers:()=>"/api/v1/printers/",printer:e=>`/api/v1/printers/${e}/`,printerAction:(e,t)=>`/api/v1/printers/${e}${t}`,pubPrinter:()=>"/api/v1p/printer/",tunnels:()=>"/api/v1/tunnels/",tunnel:e=>`/api/v1/tunnels/${e}/`,tunnelUsage:()=>"/api/v1/tunnelusage/",verificationCode:()=>"/api/v1/onetimeverificationcodes/",user:()=>"/api/v1/users/me/",sharedResources:e=>"/api/v1/sharedresources/?"+a()(n()(e),e=>e.join("=")).join("&"),sharedResource:e=>`/api/v1/sharedresources/${e}/`,printerDiscovery:()=>"/api/v1/printer_discovery/",printerEvents:()=>"/api/v1/printer_events/",notificationPlugins:()=>"/api/v1/notification_settings/available_plugins/",notificationChannels:()=>"/api/v1/notification_settings/",updateNotificationChannel:e=>`/api/v1/notification_settings/${e}/`,testNotificationChannel:e=>`/api/v1/notification_settings/${e}/send_test_message/`,printerControl:e=>`/printers/${e}/control/`,printerWebSocket:e=>`/ws/web/${e}/`,printerSharedWebSocket:e=>`/ws/share_token/web/${e}/`,printerWizard:e=>"/printers/wizard/?printerId="+e,gcodeFile:e=>`/api/v1/g_code_files/${e}/`,gcodeFiles:()=>"/api/v1/g_code_files/",gcodeFolder:e=>`/api/v1/g_code_folders/${e}/`,gcodeFolders:()=>"/api/v1/g_code_folders/",gcode:e=>`/api/v1/g_code_files/${e}/`,gcodeFolderBulkDelete:()=>"/api/v1/g_code_folders/bulk_delete/",gcodeFileBulkDelete:()=>"/api/v1/g_code_files/bulk_delete/",gcodeFolderBulkMove:()=>"/api/v1/g_code_folders/bulk_move/",gcodeFileBulkMove:()=>"/api/v1/g_code_files/bulk_move/"}},ca14:function(e,t,i){e.exports=i.p+"img/octoapp.webp"},cadd:function(e,t,i){"use strict";i("6919")},cc8e:function(e,t,i){"use strict";i("fda6")},ccf6:function(e,t){},cdf7:function(e,t,i){},d112:function(e,t,i){"use strict";i("6a40")},d1d5:function(e,t,i){e.exports=i.p+"img/generic-app.png"},d3f8:function(e,t,i){"use strict";i("a4bc")},d689:function(e,t,i){},d721:function(e,t,i){"use strict";i("9ab4")},d764:function(e,t,i){"use strict";i("a67f")},dcee:function(e,t,i){},df40:function(e,t,i){},e66b:function(e,t,i){},e6d7:function(e,t,i){},e7bf:function(e,t,i){"use strict";i("dcee")},e8c1:function(e,t,i){"use strict";i("ade5")},ea64:function(e,t,i){"use strict";i("3d3c")},edea:function(e,t,i){},f1ca:function(e,t,i){},f1f6:function(e,t,i){e.exports=i.p+"img/plugin_verification_code.png"},f23d:function(e,t,i){e.exports=i.p+"img/vacation.gif"},f444:function(e,t,i){},f5a0:function(e,t,i){},f757:function(e,t,i){"use strict";i("1a62")},fc0f:function(e,t,i){"use strict";i("412b")},fcb3:function(e,t,i){"use strict";i("e66b")},fda6:function(e,t,i){},ffb3:function(e,t,i){}});
//# sourceMappingURL=root.js.map